{"meta":{"title":"å½¤å“¥å“¥çš„åšå®¢","subtitle":"ä¸ºæ¢¦æƒ³è€Œæˆ˜","description":"95å,æŠ€æœ¯çˆ±å¥½è€…","author":"YeaMin","url":"http://ltyeamin.github.io"},"pages":[{"title":"æå½¤","date":"2017-12-02T08:42:39.000Z","updated":"2019-05-29T14:03:53.000Z","comments":true,"path":"about/index.html","permalink":"http://ltyeamin.github.io/about/index.html","excerpt":"","text":"ğŸ‘±ç®€ä»‹æå½¤,90å,é™•è¥¿è¥¿å®‰äºº,ç›®å‰åœ¨ä¸Šæµ·å·¥ä½œ.é—²æš‡æ—¶é—´å–œæ¬¢æŠ€æœ¯é’»ç ”,æŠ€æœ¯ç•¥æ‚,ä½†å°æœ‰æˆå°±.æ¬¢è¿æŠ€æœ¯äººå‘˜å¤šå¤šäº¤æµ.ä¸šä½™çˆ±å¥½å–œæ¬¢æ‘„å½±å’Œæ—…æ¸¸,æ­£å‡†å¤‡å…¥æ‰‹Canon 80Då•åç›¸æœº,è¿™æ˜¯æˆ‘ä¸€ç›´ä»¥æ¥çš„è¿½æ±‚. ğŸ’»æˆ‘çš„æŠ€æœ¯æ ˆJava: æ—¥å¸¸å¼€å‘è¯­è¨€,ä¸»è¦æ„å»ºä¼ä¸šçº§Webåº”ç”¨.ç†Ÿæ‚‰Maven+Spring Boot+Spring Cloud+MybatisJavaScript: Webå¼€å‘å¿…ä¼šè¯­è¨€.ç†Ÿæ‚‰ES6+Vue2.0+NodeJs+Express/KoaPython: ç›®å‰æš‚æ—¶ç”¨ä¸åˆ°,æˆ‘ä¸»è¦ç”¨äºåšçˆ¬è™«ä»¥åŠæ•°æ®åˆ†æ.è¿ç»´: Linux+Jenkins+Docker ğŸµæˆ‘æ‰€å–œæ¬¢çš„éŸ³ä¹ ğŸ’«æ¢¦æƒ³ æ›¾ç»çš„æ¢¦æƒ³:ç»„å»ºä¸€å®¶å±äºè‡ªå·±çš„å…¬å¸-ã€å¥•æ˜åˆ›æ„ä¼ åª’-YeaMinã€‘,å¾ˆæ˜æ˜¾è¿™ä¸ªè®¡åˆ’å¤±è´¥äº†. ç°åœ¨çš„æ¢¦æƒ³: ä¹°æˆ¿+å¥åº·+å®¶åº­ = æé«˜äººç”Ÿå“è´¨ â˜ï¸è”ç³»æ–¹å¼ é‚®ç®±: ltyeamin@gmail.com å¾®ä¿¡: YeaMin2014 QQ: 1301015490"}],"posts":[{"title":"LinuxåŸºç¡€-SSHå…å¯†ç™»å½•","slug":"LinuxåŸºç¡€-SSHå…å¯†ç™»å½•","date":"2019-11-23T05:01:17.000Z","updated":"2019-11-23T03:10:40.215Z","comments":true,"path":"2019/11/23/LinuxåŸºç¡€-SSHå…å¯†ç™»å½•/","link":"","permalink":"http://ltyeamin.github.io/2019/11/23/LinuxåŸºç¡€-SSHå…å¯†ç™»å½•/","excerpt":"","text":"Linux SSHç™»å½•ç”±ä¸¤ç§æ–¹å¼: è´¦æˆ·å¯†ç ç™»å½• å¯†é’¥ç™»å½• æˆ‘æœ‰ä¸¤å°ä¸»æœºï¼Œipåˆ†åˆ«ä¸º192.168.5.1å’Œ192.168.5.100ï¼Œæˆ‘è¦ä»å‰è€…è¿œç¨‹ç™»å½•åˆ°åè€…ä¸»æœºä¸Šï¼Œä¸‹é¢æˆ‘åˆ†åˆ«æ¥æ¼”ç¤ºä¸€ä¸‹ä¸¤ç§æ–¹å¼: è´¦å·å¯†ç ç™»å½•1ssh root@192.168.5.100 æ³¨æ„ï¼š é»˜è®¤ç«¯å£å·æ˜¯22,å¦‚æœä¸æ˜¯22éœ€è¦åŠ å…¥-p+ç«¯å£å·è¿›è¡Œç™»å½•ï¼Œæ¯”å¦‚è¿œç¨‹ç™»å½•ç¤ºä¾‹: 123456789101112litong@LT:~$ ssh -p22 root@192.168.5.100root@192.168.5.100's password: Last login: Sat Nov 23 18:34:53 2019 from 192.168.5.1[root@localhost ~]# ifconfig ens33ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500 inet 192.168.5.100 netmask 255.255.255.0 broadcast 192.168.5.255 inet6 fe80::79ad:6fa6:c473:3647 prefixlen 64 scopeid 0x20&lt;link&gt; ether 00:0c:29:b3:a4:0f txqueuelen 1000 (Ethernet) RX packets 281 bytes 40054 (39.1 KiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 211 bytes 37007 (36.1 KiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 å…¬é’¥å…å¯†ç™»å½• å…ˆåœ¨192.168.5.1è¿™å¤ªæœºå™¨ä¸Šç”Ÿæˆå…¬é’¥ï¼› 1ssh-keygen -t rsa æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œæ•²ä¸‰æ¬¡å›è½¦å³å¯ç”Ÿæˆï¼Œç”Ÿæˆåä¼šåœ¨å½“å‰è´¦å·çš„homeçš„.sshç›®å½•ä¸­ã€‚ 12345678910litong@LT:~$ ssh-keygen -t rsaGenerating public/private rsa key pair.Enter file in which to save the key (/home/litong/.ssh/id_rsa): /home/litong/.ssh/id_rsa already exists.Overwrite (y/n)? litong@LT:~$ ls -l ~/.ssh/æ€»ç”¨é‡ 12-rw------- 1 litong litong 1675 9æœˆ 10 22:03 id_rsa-rw-r--r-- 1 litong litong 400 9æœˆ 10 22:03 id_rsa.pub-rw-r--r-- 1 litong litong 2214 11æœˆ 20 21:54 known_hosts â€‹ authorized_keys:å­˜æ”¾è¿œç¨‹å…å¯†ç™»å½•çš„å…¬é’¥,ä¸»è¦é€šè¿‡è¿™ä¸ªæ–‡ä»¶è®°å½•å¤šå°æœºå™¨çš„å…¬é’¥,è¿™ä¸ªæ–‡ä»¶å¯ä»¥æ²¡æœ‰ï¼› id_rsa : ç”Ÿæˆçš„ç§é’¥æ–‡ä»¶ï¼› id_rsa.pub ï¼š ç”Ÿæˆçš„å…¬é’¥æ–‡ä»¶ï¼› know_hosts : å·²çŸ¥çš„ä¸»æœºå…¬é’¥æ¸…å•ã€‚ æ³¨æ„: â€‹ 1). sshç›®å½•çš„æƒé™å¿…é¡»æ˜¯700 â€‹ 2). .ssh/authorized_keysæ–‡ä»¶æƒé™å¿…é¡»æ˜¯600 ç¡®è®¤å…¬é’¥æ–‡ä»¶id_rsa.pubæ˜¯å¦å­˜åœ¨ï¼Œå¹¶æŠŠå…¬é’¥æ–‡ä»¶ä¸Šä¼ åˆ°è¿œç¨‹ç™»å½•çš„æœºå™¨ä¸Šã€‚ å¤åˆ¶æ–‡ä»¶æœ‰å¤šç§æ–¹å¼ï¼š é€šè¿‡ssh-copy-idçš„æ–¹å¼ 1ssh-copy-id -i ~/.ssh/id_rsa.pub 192.168.5.100 é€šè¿‡scpå°†å†…å®¹å†™åˆ°å¯¹æ–¹çš„æ–‡ä»¶ä¸­ 1scp -p ~/.ssh/id_rsa.pub root@192.168.5.100:/root/.ssh/authorized_keys ä¸Šä¼ æˆåŠŸåï¼ŒæŸ¥çœ‹è¿œç¨‹ä¸»æœº~/.ssh/authorized_keysæ–‡ä»¶çš„å†…å®¹ï¼Œå…¶ä¸­å†…å®¹åŒ…å«è¦è¿œç¨‹ä¸»æœºçš„å…¬é’¥åˆ™è¯´å—é…ç½®å®Œæˆ 192.168.5.1æœºå™¨å…¬é’¥12litong@LT:~/.ssh$ cat id_rsa.pub ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDEeCQP2arzLybGinLvKEgN6cJtINUhDL8uLIwaCJdsv7FbYrBK9R2I01F+pftjiiILCrg0GgwSThAJ7cCxbmriw+D1ZoZdC+MJPONiv4PF9KBWNTGdZ1fLjpEifUI3Aax23TdQqkHs+4+T8zOK2v4MsDgit4nqJheV2I+cXuumPlCONndfr43KxPsGJqAtb8yzkMA20/r8fnnOMbfblDnsAOTGWjC+ond2Eph5AlY2tW+s9JiFBHVawalheqYBVmKlNT3vqVp5IKrnJrIVagN59FKqSOAYTFc/7eR61npGtf0+Ftew137FICGp7F6v4JxjqNuSkxsXsH6+2Z071A3X ltyeamin@gmail.com 192.168.5.100è¿œç¨‹æœºå™¨å…å¯†ç™»å½•å…¬é’¥12root@localhost .ssh]# cat authorized_keys ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDEeCQP2arzLybGinLvKEgN6cJtINUhDL8uLIwaCJdsv7FbYrBK9R2I01F+pftjiiILCrg0GgwSThAJ7cCxbmriw+D1ZoZdC+MJPONiv4PF9KBWNTGdZ1fLjpEifUI3Aax23TdQqkHs+4+T8zOK2v4MsDgit4nqJheV2I+cXuumPlCONndfr43KxPsGJqAtb8yzkMA20/r8fnnOMbfblDnsAOTGWjC+ond2Eph5AlY2tW+s9JiFBHVawalheqYBVmKlNT3vqVp5IKrnJrIVagN59FKqSOAYTFc/7eR61npGtf0+Ftew137FICGp7F6v4JxjqNuSkxsXsH6+2Z071A3X ltyeamin@gmail.com å°è¯•å…å¯†ç™»å½•ã€‚ 12litong@LT:~/.ssh$ ssh root@192.168.5.100Last login: Sat Nov 23 19:07:01 2019 from 192.168.5.1 æ€»ç»“ æ—¥å¸¸å·¥ä½œä¸­ï¼Œå…å¯†ç™»å½•ç”¨å¤„ç‰¹åˆ«å¤šï¼Œé¡¹ç›®éƒ¨ç½²çš„æ—¶å€™ä¸Šä¼ æ—¶å€™éœ€è¦å…å¯†ç™»å½•ï¼Œä¸å¯èƒ½å°†å¯†ç åŸæ–‡è®¾ç½®åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™æ ·ç‰¹åˆ«ä¸å®‰å…¨ã€‚","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://ltyeamin.github.io/tags/Linux/"}]},{"title":"RocketMQæ¦‚è¿°","slug":"RocketMQæ¦‚è¿°","date":"2019-11-08T14:15:16.000Z","updated":"2019-11-23T04:18:53.354Z","comments":true,"path":"2019/11/08/RocketMQæ¦‚è¿°/","link":"","permalink":"http://ltyeamin.github.io/2019/11/08/RocketMQæ¦‚è¿°/","excerpt":"","text":"1. MQä»‹ç»1.1 ä¸ºä»€ä¹ˆè¦ç”¨MQæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§â€œå…ˆè¿›å…ˆå‡ºâ€çš„æ•°æ®ç»“æ„ å…¶åº”ç”¨åœºæ™¯ä¸»è¦åŒ…å«ä»¥ä¸‹3ä¸ªæ–¹é¢ åº”ç”¨è§£è€¦ ç³»ç»Ÿçš„è€¦åˆæ€§è¶Šé«˜ï¼Œå®¹é”™æ€§å°±è¶Šä½ã€‚ä»¥ç”µå•†åº”ç”¨ä¸ºä¾‹ï¼Œç”¨æˆ·åˆ›å»ºè®¢å•åï¼Œå¦‚æœè€¦åˆè°ƒç”¨åº“å­˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿï¼Œä»»ä½•ä¸€ä¸ªå­ç³»ç»Ÿå‡ºäº†æ•…éšœæˆ–è€…å› ä¸ºå‡çº§ç­‰åŸå› æš‚æ—¶ä¸å¯ç”¨ï¼Œéƒ½ä¼šé€ æˆä¸‹å•æ“ä½œå¼‚å¸¸ï¼Œå½±å“ç”¨æˆ·ä½¿ç”¨ä½“éªŒã€‚ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦åˆï¼Œç³»ç»Ÿçš„è€¦åˆæ€§å°±ä¼šæé«˜äº†ã€‚æ¯”å¦‚ç‰©æµç³»ç»Ÿå‘ç”Ÿæ•…éšœï¼Œéœ€è¦å‡ åˆ†é’Ÿæ‰èƒ½æ¥ä¿®å¤ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œç‰©æµç³»ç»Ÿè¦å¤„ç†çš„æ•°æ®è¢«ç¼“å­˜åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”¨æˆ·çš„ä¸‹å•æ“ä½œæ­£å¸¸å®Œæˆã€‚å½“ç‰©æµç³»ç»Ÿå›å¤åï¼Œè¡¥å……å¤„ç†å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è®¢å•æ¶ˆæ¯å³å¯ï¼Œç»ˆç«¯ç³»ç»Ÿæ„ŸçŸ¥ä¸åˆ°ç‰©æµç³»ç»Ÿå‘ç”Ÿè¿‡å‡ åˆ†é’Ÿæ•…éšœã€‚ æµé‡å‰Šå³° åº”ç”¨ç³»ç»Ÿå¦‚æœé‡åˆ°ç³»ç»Ÿè¯·æ±‚æµé‡çš„ç¬é—´çŒ›å¢ï¼Œæœ‰å¯èƒ½ä¼šå°†ç³»ç»Ÿå‹å®ã€‚æœ‰äº†æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å°†å¤§é‡è¯·æ±‚ç¼“å­˜èµ·æ¥ï¼Œåˆ†æ•£åˆ°å¾ˆé•¿ä¸€æ®µæ—¶é—´å¤„ç†ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æåˆ°ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚ ä¸€èˆ¬æƒ…å†µï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œå¦‚æœç³»ç»Ÿè´Ÿè½½è¶…è¿‡é˜ˆå€¼ï¼Œå°±ä¼šé˜»æ­¢ç”¨æˆ·è¯·æ±‚ï¼Œè¿™ä¼šå½±å“ç”¨æˆ·ä½“éªŒï¼Œè€Œå¦‚æœä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å°†è¯·æ±‚ç¼“å­˜èµ·æ¥ï¼Œç­‰å¾…ç³»ç»Ÿå¤„ç†å®Œæ¯•åé€šçŸ¥ç”¨æˆ·ä¸‹å•å®Œæ¯•ï¼Œè¿™æ ·æ€»ä¸èƒ½ä¸‹å•ä½“éªŒè¦å¥½ã€‚ å¤„äºç»æµè€ƒé‡ç›®çš„ï¼š ä¸šåŠ¡ç³»ç»Ÿæ­£å¸¸æ—¶æ®µçš„QPSå¦‚æœæ˜¯1000ï¼Œæµé‡æœ€é«˜å³°æ˜¯10000ï¼Œä¸ºäº†åº”å¯¹æµé‡é«˜å³°é…ç½®é«˜æ€§èƒ½çš„æœåŠ¡å™¨æ˜¾ç„¶ä¸åˆ’ç®—ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¯¹å³°å€¼æµé‡å‰Šå³° æ•°æ®åˆ†å‘ é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥è®©æ•°æ®åœ¨å¤šä¸ªç³»ç»Ÿæ›´åŠ ä¹‹é—´è¿›è¡Œæµé€šã€‚æ•°æ®çš„äº§ç”Ÿæ–¹ä¸éœ€è¦å…³å¿ƒè°æ¥ä½¿ç”¨æ•°æ®ï¼Œåªéœ€è¦å°†æ•°æ®å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ•°æ®ä½¿ç”¨æ–¹ç›´æ¥åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç›´æ¥è·å–æ•°æ®å³å¯ 1.2 MQçš„ä¼˜ç‚¹å’Œç¼ºç‚¹ä¼˜ç‚¹ï¼šè§£è€¦ã€å‰Šå³°ã€æ•°æ®åˆ†å‘ ç¼ºç‚¹åŒ…å«ä»¥ä¸‹å‡ ç‚¹ï¼š ç³»ç»Ÿå¯ç”¨æ€§é™ä½ ç³»ç»Ÿå¼•å…¥çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œç³»ç»Ÿç¨³å®šæ€§è¶Šå·®ã€‚ä¸€æ—¦MQå®•æœºï¼Œå°±ä¼šå¯¹ä¸šåŠ¡é€ æˆå½±å“ã€‚ å¦‚ä½•ä¿è¯MQçš„é«˜å¯ç”¨ï¼Ÿ ç³»ç»Ÿå¤æ‚åº¦æé«˜ MQçš„åŠ å…¥å¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œä»¥å‰ç³»ç»Ÿé—´æ˜¯åŒæ­¥çš„è¿œç¨‹è°ƒç”¨ï¼Œç°åœ¨æ˜¯é€šè¿‡MQè¿›è¡Œå¼‚æ­¥è°ƒç”¨ã€‚ å¦‚ä½•ä¿è¯æ¶ˆæ¯æ²¡æœ‰è¢«é‡å¤æ¶ˆè´¹ï¼Ÿæ€ä¹ˆå¤„ç†æ¶ˆæ¯ä¸¢å¤±æƒ…å†µï¼Ÿé‚£ä¹ˆä¿è¯æ¶ˆæ¯ä¼ é€’çš„é¡ºåºæ€§ï¼Ÿ ä¸€è‡´æ€§é—®é¢˜ Aç³»ç»Ÿå¤„ç†å®Œä¸šåŠ¡ï¼Œé€šè¿‡MQç»™Bã€Cã€Dä¸‰ä¸ªç³»ç»Ÿå‘æ¶ˆæ¯æ•°æ®ï¼Œå¦‚æœBç³»ç»Ÿã€Cç³»ç»Ÿå¤„ç†æˆåŠŸï¼ŒDç³»ç»Ÿå¤„ç†å¤±è´¥ã€‚ å¦‚ä½•ä¿è¯æ¶ˆæ¯æ•°æ®å¤„ç†çš„ä¸€è‡´æ€§ï¼Ÿ 1.3 RocetMQå†å²åŠå…¶ç‰¹å¾â€‹ é˜¿é‡Œçš„æ¶ˆæ¯ä¸­é—´ä»¶æœ‰å¾ˆé•¿çš„å†å²ï¼Œä»2007å¹´çš„Notifyåˆ°2010å¹´çš„Napoli, 2011å¹´å‡çº§åæ”¹ä¸ºMetaQï¼Œç„¶ååˆ°2012å¹´å¼€å§‹åšRocketMQ, RocketMQä½¿ç”¨Javaè¯­è¨€å¼€å‘ï¼Œäº2016å¹´å¼€æºã€‚ç¬¬ä¸€ä»£çš„Notifyä¸»è¦ä½¿ç”¨äº†æ¨æ¨¡å‹ï¼Œè§£å†³äº†äº‹åŠ¡æ¶ˆæ¯ï¼›ç¬¬äºŒä»£çš„MetaQä¸»è¦ä½¿ç”¨äº†æ‹‰æ¨¡å‹ï¼Œè§£å†³äº†é¡ºåºæ¶ˆæ¯å’Œæµ·é‡å †ç§¯çš„é—®é¢˜ã€‚RocketMQåŸºäºé•¿è½®è¯¢çš„æ‹‰å–æ–¹å¼ï¼Œå…¼æœ‰ä¸¤è€…çš„ä¼˜ç‚¹ã€‚â€‹ æ¯ä¸€æ¬¡äº§å“è¿­ä»£ï¼Œéƒ½å¸å–äº†ä¹‹å‰çš„ç»éªŒæ•™è®­ï¼Œç›®å‰RocketMQå·²ç»æˆä¸ºApacheé¡¶çº§é¡¹ç›®ã€‚åœ¨é˜¿é‡Œå†…éƒ¨ï¼ŒRocketMQå¾ˆå¥½åœ°æœåŠ¡äº†é›†å›¢å¤§å¤§å°å°ä¸Šåƒä¸ªåº”ç”¨ï¼Œåœ¨æ¯å¹´çš„åŒåä¸€å½“å¤©ï¼Œæ›´æœ‰ä¸å¯æ€è®®çš„ä¸‡äº¿çº§æ¶ˆæ¯é€šè¿‡RocketMQæµè½¬ï¼ˆåœ¨2017å¹´çš„åŒåä¸€å½“å¤©ï¼Œæ•´ä¸ªé˜¿é‡Œå·´å·´é›†å›¢é€šè¿‡RocketMQæµè½¬çš„çº¿ä¸Šæ¶ˆæ¯è¾¾åˆ°äº†ä¸‡äº¿çº§ï¼Œå³°å€¼TPSè¾¾åˆ°5600ä¸‡ï¼‰ï¼Œåœ¨é˜¿é‡Œå¤§ä¸­å°ç­–ç•¥ä¸Šå‘æŒ¥ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨ã€‚æ­¤å¤–ï¼ŒRocketMQæ˜¯ä½¿ç”¨Javaè¯­è¨€å¼€å‘çš„ï¼Œæ¯”èµ·Kafkaçš„Scalaè¯­è¨€å’ŒRabbitMQçš„Erlangè¯­è¨€ï¼Œæ›´å®¹æ˜“æ‰¾åˆ°æŠ€æœ¯äººå‘˜è¿›è¡Œå®šåˆ¶å¼€å‘ã€‚ ä»RocketMQ Githubä¸»é¡µä¸Šå¯ä»¥æ‰¾åˆ°å¦‚ä¸‹è¡¨è¿°ã€‚ Apache RocketMQ is a distributed messaging and streaming platform with low latency, high performance and reliability, trillion-level capacity and flexible scalability. It offers a variety of features: Pub/Sub messaging model Financial grade transactional message A variety of cross language clients, such as Java, C/C++, Python, Go Pluggable transport protocols, such as TCP, SSL, AIO Inbuilt message tracing capability, also support opentracing Versatile big-data and streaming ecosytem integration Message retroactivity by time or offset Reliable FIFO and strict ordered messaging in the same queue Efficient pull&amp;push consumption model Million-level message accumulation capacity in a single queue Multiple messaging protocols like JMS and OpenMessaging Flexible distributed scale-out deployment architecture Lightning-fast batch message exchange system Various message filter mechanics such as SQL and Tag Docker images for isolated testing and cloud isolated clusters Feature-rich administrative dashboard for configuration, metrics and monitoring Authentication and authorisation å¤§æ¦‚æ„æ€æˆ‘åœ¨è¿™é‡Œç¿»è¯‘ä¸€ä¸‹: â€‹ Apache RocketMQæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’å’Œæµåª’ä½“å¹³å°ï¼Œå…·æœ‰ä½å»¶è¿Ÿï¼Œé«˜æ€§èƒ½å’Œå¯é æ€§ï¼Œä¸‡äº¿çº§å®¹é‡å’Œçµæ´»çš„å¯ä¼¸ç¼©æ€§ã€‚ å®ƒå…·æœ‰å¤šç§åŠŸèƒ½ï¼š å‘å¸ƒ/è®¢é˜…æ¶ˆæ¯ä¼ é€’æ¨¡å‹ é‡‘èçº§äº¤æ˜“æ¶ˆæ¯ å„ç§è·¨è¯­è¨€å®¢æˆ·ç«¯ï¼Œä¾‹å¦‚Javaï¼ŒC / C ++ï¼ŒPythonï¼ŒGo å¯æ’æ‹”çš„ä¼ è¾“åè®®ï¼Œä¾‹å¦‚TCPï¼ŒSSLï¼ŒAIO å†…ç½®çš„æ¶ˆæ¯è·Ÿè¸ªåŠŸèƒ½ï¼Œè¿˜æ”¯æŒå¼€æ”¾å¼è·Ÿè¸ª å¤šåŠŸèƒ½çš„å¤§æ•°æ®å’Œæµç”Ÿæ€ç³»ç»Ÿé›†æˆ æŒ‰æ—¶é—´æˆ–åç§»é‡è¿½æº¯æ¶ˆæ¯ å¯é çš„FIFOå’Œä¸¥æ ¼çš„æœ‰åºæ¶ˆæ¯ä¼ é€’åœ¨åŒä¸€é˜Ÿåˆ—ä¸­ é«˜æ•ˆçš„æ¨æ‹‰æ¶ˆè´¹æ¨¡å‹ å•ä¸ªé˜Ÿåˆ—ä¸­çš„ç™¾ä¸‡çº§æ¶ˆæ¯ç´¯ç§¯å®¹é‡ å¤šç§æ¶ˆæ¯ä¼ é€’åè®®ï¼Œä¾‹å¦‚JMSå’ŒOpenMessaging çµæ´»çš„åˆ†å¸ƒå¼æ¨ªå‘æ‰©å±•éƒ¨ç½²æ¶æ„ å¿«å¦‚é—ªç”µçš„æ‰¹é‡æ¶ˆæ¯äº¤æ¢ç³»ç»Ÿ å¦‚SQLå’ŒTagå„ç§æ¶ˆæ¯è¿‡æ»¤å™¨æœºåˆ¶ ç”¨äºéš”ç¦»æµ‹è¯•å’Œäº‘éš”ç¦»ç¾¤é›†çš„Dockeræ˜ åƒ åŠŸèƒ½ä¸°å¯Œçš„ç®¡ç†ä»ªè¡¨æ¿ï¼Œç”¨äºé…ç½®ï¼ŒæŒ‡æ ‡å’Œç›‘è§† è®¤è¯ä¸æˆæƒç®¡ç† 1.4 å„ç§MQäº§å“çš„æ¯”è¾ƒå¸¸è§çš„MQäº§å“åŒ…æ‹¬Kafkaã€ActiveMQã€RabbitMQã€RocketMQã€‚ 1.5 æ€»ç»“â€‹ RocketMQåŸºäºJavaå¼€å‘çš„ï¼Œå®Œå…¨çš„åˆ†å¸ƒå¼æ¶æ„ï¼ŒAPIç›¸å¯¹æ¯”è¾ƒç®€å•(ç›¸æ¯”RabbitMQ)ï¼Œå®¹æ˜“æŒæ¡ï¼Œå¹¶åœ¨é˜¿é‡Œå·´å·´é›†å›¢å†…éƒ¨ç»è¿‡äº†å¤§é‡(åŒ11)çš„å®è·µï¼Œåˆ†æ€§èƒ½å¼ºæ‚ã€‚å”¯ä¸€ä¸è¶³çš„ä¸€ç‚¹æ˜¯æ–‡æ¡£ç›¸å¯¹ä¸æ˜¯å¾ˆå¤šï¼Œè‹¥èƒ½è·Ÿéšæºç æ·±å…¥äº†è§£å…¶å†…éƒ¨æœºåˆ¶ï¼Œè¿™ä¹Ÿä¸ç®—ç¼ºç‚¹ã€‚ 1.6 å‚è€ƒæ–‡æ¡£ Rocketä¸»é¡µ ä¸ºä»€ä¹ˆé€‰æ‹©RocketMQ RocketMQ Github å¸¸è§MQäº§å“å¯¹æ¯” 17ä¸ªæ–¹é¢å¯¹æ¯”ä¸»æµMQå·®å¼‚ RocketæŠ€æœ¯å†…å¹• Rocketå®æˆ˜ä¸åŸç†","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"RocketMQ","slug":"RocketMQ","permalink":"http://ltyeamin.github.io/tags/RocketMQ/"}]},{"title":"ä¸ƒç‰›äº‘å¯¹è±¡å­˜å‚¨ç©ºé—´è¿ç§»è„šæœ¬","slug":"ä¸ƒç‰›äº‘å¯¹è±¡å­˜å‚¨ç©ºé—´è¿ç§»è„šæœ¬","date":"2019-11-02T10:15:00.000Z","updated":"2019-11-23T03:14:33.631Z","comments":true,"path":"2019/11/02/ä¸ƒç‰›äº‘å¯¹è±¡å­˜å‚¨ç©ºé—´è¿ç§»è„šæœ¬/","link":"","permalink":"http://ltyeamin.github.io/2019/11/02/ä¸ƒç‰›äº‘å¯¹è±¡å­˜å‚¨ç©ºé—´è¿ç§»è„šæœ¬/","excerpt":"","text":"å‰è¨€ç°åœ¨åšå®¢çš„å›¾ç‰‡éƒ½æ”¾åœ¨ä¸ƒç‰›äº‘å¯¹è±¡å­˜å‚¨ä¸Šé¢ï¼Œä¸ªäººç”¨æˆ·æœ‰å…è´¹10GBçš„å­˜å‚¨ç©ºé—´ã€‚ å› ä¸ºæ¯ä¸€ä¸ªçš„bucketç©ºé—´åˆ†é…ä¸€ä¸ªä¸ƒç‰›äº‘çš„ç©ºé—´åŸŸåï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š S3 åŸŸå Endpoint(åŒºåŸŸèŠ‚ç‚¹)ï¼š s3-cn-east-1.qiniucs.com ç©ºé—´åŸŸåï¼š 20191119.s3-cn-east-1.qiniucs.com èåˆ CDN æµ‹è¯•åŸŸå ä¸ƒç‰›èåˆ CDN æµ‹è¯•åŸŸåï¼ˆä»¥ clouddn.com/qiniucdn.com/qiniudn.com/qnssl.com/qbox.me ç»“å°¾ï¼‰ï¼Œæ¯ä¸ªåŸŸåæ¯æ—¥é™æ€»æµé‡ 10GBï¼Œæ¯ä¸ªæµ‹è¯•åŸŸåè‡ªåˆ›å»ºèµ· 30 ä¸ªè‡ªç„¶æ—¥åç³»ç»Ÿä¼šè‡ªåŠ¨å›æ”¶ï¼Œä»…ä¾›æµ‹è¯•ä½¿ç”¨å¹¶ä¸”ä¸æ”¯æŒ Https è®¿é—®ï¼Œè¯¦æƒ…æŸ¥çœ‹ ä¸ƒç‰›æµ‹è¯•åŸŸåä½¿ç”¨è§„èŒƒ ã€‚ç‚¹å‡»åŸŸåå¯æŸ¥çœ‹å‰©ä½™å›æ”¶æ—¶é—´ã€‚ q176n8af9.bkt.clouddn.com ä¸ƒç‰›äº‘å¾ˆå‘çš„ä¸€ç‚¹å°±æ˜¯è¿™ä¸ªæµ‹è¯•åŸŸåæœ‰æ•ˆæœŸæ˜¯30å¤©(éšå£ä¸€è¯´ï¼Œäººå®¶å…è´¹ç»™ä½ çš„10Gå­˜å‚¨å·²ç»å¾ˆä¸é”™äº†)ï¼Œæ‰€ä»¥30å¤©ä»¥ååŸŸåä¼šè‡ªåŠ¨è¿‡æœŸï¼Œæ„å‘³ç€é‡Œé¢å­˜å‚¨çš„å›¾ç‰‡ä»¥åŠå¯¹è±¡éƒ½ä¸èƒ½è®¿é—®ã€‚ è§£å†³è¿™ç§é—®é¢˜æœ‰ä¸¤ç§æ–¹æ³•ï¼š ç»‘å®šä¸€ä¸ªå¤‡æ¡ˆçš„åŸŸå(éå¸¸å»ºè®®)ï¼› ä¼˜ç‚¹ï¼šå¿«é€Ÿå¥½ç®¡ç†ï¼Œåªæœ‰åŸŸåä¸è¿‡æœŸï¼Œç»ˆèº«äº«å—ï¼› ç¼ºç‚¹ï¼šæ¡ä»¶é™åˆ¶æ¯”è¾ƒå¤§ï¼ŒåŸŸåè¦å¤‡æ¡ˆã€‚ åˆ‡æ¢bucketç©ºé—´ï¼Œå³æ–°å»ºä¸€ä¸ªæ–°çš„bucketï¼Œç„¶åå°†æ—§çš„bucketè¿ç§»è¿‡å»ã€‚ ä¼˜ç‚¹ï¼šå…è´¹ ç¼ºç‚¹ï¼šéº»çƒ¦ï¼Œæ¯éš”30å¤©è¿ç§»ä¸€æ¬¡ è¿ç§»æˆ‘åªæœ‰å›½å†…çš„åŸŸåï¼šhttp://yeamin.top ã€‚ æˆ‘çš„BlogåŸŸåæ˜¯http://blog.yeamin.top ã€‚ å› ä¸ºæˆ‘ä¸ªäººæ²¡æœ‰æœåŠ¡å™¨ï¼Œä¸»åŸŸåéƒ½æ²¡æœ‰åœ¨å›½å†…å¤‡æ¡ˆï¼Œåœ¨æˆ‘è¿™é‡Œé€‰æ‹©äº†ç¬¬äºŒç§æ–¹å¼ï¼šè¿ç§»ç©ºé—´æ¢å–æ–°çš„bucketå’ŒåŸŸåã€‚ å‡†å¤‡å·¥ä½œæ‰“å¼€ä¸ƒç‰›äº‘å®˜ç½‘ï¼Œç™»å½•è¿›å…¥åˆ°ç®¡ç†æ§åˆ¶å°ï¼Œå·¦ä¾§é€‰æ‹©å¯¹è±¡å­˜å‚¨ æ‰¾åˆ°è¦è¿ç§»çš„bucket,å³æºå­˜å‚¨ï¼› æ–°å»ºä¸€ä¸ªbucketï¼Œå³ä¾¿ç›®æ ‡å­˜å‚¨ç©ºé—´ï¼› ä¸‹è½½å¹¶è§£å‹ä¸ƒç‰›äº‘å®˜æ–¹æä¾›çš„åŒæ­¥è¿ç§»å·¥å…·ï¼šhttp://developer.qiniu.com/docs/v6/tools/qshell.htmlï¼› åœ¨å³ä¸Šè§’æ‰¾åˆ°æˆ‘çš„å›¾åƒæ‚¬æµ®å‡ºæ¥èœå•åï¼Œé€‰æ‹©ç§˜é’¥ç®¡ç†ï¼Œå‡†å¤‡å¥½AKå’ŒSK(AccessKey/SecretKey)ã€‚ å…·ä½“è¿ç§»å¯ä»¥å‚ç…§ä¸ƒç‰›äº‘çš„è¿ç§»æ–‡æ¡£å¯å®Œæˆè¿ç§»å·¥ä½œï¼Œä½†æ˜¯æˆ‘è§‰å¾—æ¯æ¬¡éƒ½è¿™æ ·ä¸€ä¸ªä¸€ä¸ªè¿™æ ·è¿ç§»å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»Šå¤©æŠ½ç©ºå†™äº†ä¸€æ®µè„šæœ¬å»å¤„ç†è¿ç§»å·¥ä½œã€‚ è„šæœ¬123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869#!/bin/bash## author: tong.li# description: qshell bucket transfer# date: 2019-11-02 14:45:22#å‡†å¤‡é…ç½®ç¯å¢ƒecho \"Prepare Environment...\"if [ ! -x './qshell-windows-x64-v2.4.0' ] then echo \"qshell script file not exist\"fiif [[ !\"$1\" ]]; then echo -n \"please input account:\" read accountfiecho -n 'please input your AK:'read AKecho -n 'please input your SK:'read SKif [[ ! \"$AK\" || ! \"$SK\" ]]; then echo \"AK OR SK is null, please try again\" exit 0fi# å·²æœ‰è´¦æˆ·åˆ—è¡¨rs=`./qshell-windows-x64-v2.4.0 user ls | awk '&#123;print $2&#125;'`if [[ $rs=~$AK &amp;&amp; $rs=~$SK &amp;&amp; $rs=~$account ]]; then echo \"Config OK...\"else echo \"Starting AKã€SK Config...\" ./qshell-windows-x64-v2.4.0 account ak sk namefiecho \"account: $account\"echo \"AK is : $AK\"echo \"SK is: $SK\"if [[ !\"$sourcebucket\" ]]; then echo -n \"please input sourcebucket:\" read sourcebucketfiif [[ !\"$desbucket\" ]]; then echo -n \"please input desbucket:\" read desbucketfi# åˆ—ä¸¾å½“å‰éœ€è¦å¤åˆ¶bucketæ•°æ®./qshell-windows-x64-v2.4.0 listbucket $sourcebucket -o cp.txt# ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨cat cp.txt | awk '&#123;print $1&#125;' &gt; cpp.txtsize=$(du -sb cpp.txt|cut -f1)if [[ size &lt;=0 ]]; then echo \"cpp.txt size is 0KB\" exit 0fi# å¼€å§‹æ‰¹é‡è¿ç§»./qshell-windows-x64-v2.4.0 batchcopy $sourcebucket $desbucket -i cpp.txtif [ $? -eq 0 ]; then echo \"==============transfer bucket From $sourcebucket to $desbucket success==============================\"else echo \"=============================transfer bucket failed,please try again==================================\"fi æ‰§è¡Œè¿ç§» å°†ä¸Šè¿°ä»£ç ä¿å­˜batchcopy.shï¼Œå¹¶èµ‹äºˆå¯æ‰§è¡Œæƒé™ï¼› æ‰§è¡Œ./batchcopy.sh ä½ çš„ä¸ƒç‰›äº‘è´¦æˆ·å ä¹‹åæŒ‰è¾“å…¥æç¤ºè¾“å…¥AKã€SKã€æºbucketã€ç›®æ ‡bucketå³å¯å®Œæˆè¿ç§»æ“ä½œã€‚ æ€»ç»“â€‹ ç»å¸¸çœ‹åˆ«äººçš„shellè„šæœ¬ï¼Œè‡ªå·±ä»æ¥ä¹Ÿæ²¡å†™è¿‡ï¼Œè¿™æ˜¯æ˜¯ç¬¬ä¸€æ¬¡å†™è„šæœ¬ï¼Œå¤šå°‘å¯èƒ½æœ‰äº›bugã€‚åç»­å‘ç°äº†ä¼šåŠæ—¶æ›´æ­£ä»–ã€‚æ€»ä¹‹è¿˜æ˜¯å¤šå­¦å¤šå®è·µä¸€ä¸‹æ²¡åå¤„ã€‚ å‚è€ƒæ–‡æ¡£ ä¸ƒç‰›äº‘å¯¹è±¡å­˜å‚¨è¿ç§»æ–‡æ¡£ ä¸ƒç‰›äº‘å¯¹è±¡å­˜å‚¨ç©ºé—´è¿ç§»è¯¦è§£","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"å®ç”¨å·¥å…·åŠæŠ€å·§","slug":"å®ç”¨å·¥å…·åŠæŠ€å·§","permalink":"http://ltyeamin.github.io/tags/å®ç”¨å·¥å…·åŠæŠ€å·§/"}]},{"title":"è·¨å¹³å°åŠå…¬åˆ©å™¨-uTools","slug":"è·¨å¹³å°åŠå…¬åˆ©å™¨-uTools","date":"2019-10-12T14:40:10.000Z","updated":"2019-11-09T03:44:53.969Z","comments":true,"path":"2019/10/12/è·¨å¹³å°åŠå…¬åˆ©å™¨-uTools/","link":"","permalink":"http://ltyeamin.github.io/2019/10/12/è·¨å¹³å°åŠå…¬åˆ©å™¨-uTools/","excerpt":"","text":"ä¹‹å‰ä¹ æƒ¯äº†Mac Pro çš„Spotlightæ¨¡å¼è¿›è¡Œæ£€ç´¢åº”ç”¨å’Œæ–‡ä»¶ï¼Œåœ¨å‰æ®µæ—¥å­ä¸­ï¼Œæˆ‘æˆåŠŸçš„æ‰¾åˆ°äº†ä¸€æ¬¾Windowsä¸Šç±»ä¼¼çš„è½¯ä»¶Everything+Woxï¼Œä»åœ¨ä½¿ç”¨Windowsçš„æœ‹å‹æœ‰å…´è¶£å¯ä»¥çœ‹æˆ‘é˜…è¯»è¿™è¾¹æ–‡ç« è¿›è¡Œæ“ä½œä½“éªŒã€‚ è¨€å½’æ­£ä¼ ï¼Œæˆ‘åœ¨å®¶ä½¿ç”¨çš„ç”µè„‘ç³»ç»Ÿæ˜¯Deepin Linux,æ›¾ç»ä¹Ÿæƒ³æ‰¾åˆ°è¿™ç§æ¬¾é€Ÿæ£€ç´¢å·¥å…·ï¼Œä½†æ˜¯æ‰¾äº†å¾ˆé•¿æ—¶é—´å´æ²¡æœ‰æ‰¾åˆ°ã€‚ ä»Šå¤©æˆ‘å¶å°”åœ¨æ·±åº¦åº”ç”¨å•†åº—å‘ç°ä¸€æ¬¾åå«utoolsçš„è½¯ä»¶ï¼Œç±»ä¼¼äºSpotlightæ¨¡å¼ã€‚ äºæ˜¯æˆ‘æ‰“å¼€å®˜ç½‘ï¼Œå®˜ç½‘æ˜¯è¿™æ ·ä»‹ç»çš„ï¼š ä½ çš„ç”Ÿäº§åŠ›å·¥å…·é›†uToolsæ˜¯ä¸€ä¸ªæç®€ã€æ’ä»¶åŒ–ã€è·¨å¹³å°çš„ç°ä»£æ¡Œé¢è½¯ä»¶ã€‚é€šè¿‡è‡ªç”±é€‰é…ä¸°å¯Œçš„æ’ä»¶ï¼Œæ‰“é€ ä½ å¾—å¿ƒåº”æ‰‹çš„å·¥å…·é›†åˆã€‚å½“ä½ ç†Ÿæ‚‰å®ƒåï¼Œèƒ½å¤Ÿä¸ºä½ èŠ‚çº¦å¤§é‡æ—¶é—´ï¼Œè®©ä½ å¯ä»¥æ›´åŠ ä¸“æ³¨åœ°æ”¹å˜ä¸–ç•Œã€‚ uToolsæ˜¯è·¨å¹³å°çš„è½¯ä»¶,åŒæ—¶æ”¯æŒWindowsã€Macã€Linuxç­‰å¹³å°ï¼Œä¸åŒå¹³å°ç¨å¾®æœ‰äº›å·®åˆ«ã€‚Linuxå¹³å°æ²¡æœ‰æ–‡ä»¶æ£€ç´¢ï¼Œè¿™ç‚¹æ˜¯å¾ˆé—æ†¾çš„ï¼Œä½†æ˜¯ç¬”è€…ç›¸ä¿¡å¼€å‘è€…åç»­ä¼šæ…¢æ…¢å®Œå–„ã€‚ utoolså¸¸ç”¨ä½“éªŒæ’ä»¶ä¸­å¿ƒ å¿«é€Ÿå¯åŠ¨ æœ¬åœ°æœç´¢æ³¨æ„ï¼šä»…æ”¯æŒWindowså’ŒMacå¹³å°ï¼ŒLinuxå¹³å°ä¸‹ä¼šå¾ˆå¿«å¼€å‘ å›¾ç•¥ è‡ªåŠ¨è¯†åˆ« æ•°æ®åŒæ­¥ HttpæŠ“åŒ… å›¾ç•¥ å‰ªè´´æ¿ å›¾ç•¥ å›¾åºŠ å›¾ç•¥ hostsåˆ‡æ¢ å›¾ç•¥ ç¿»è¯‘ å›¾ç•¥ è®¡ç®—å™¨ å›¾ç•¥ å†…ç½‘ç©¿é€ å›¾ç•¥ ç›¸å…³ç«™ç‚¹ å®˜ç½‘åœ°å€ï¼šhttps://www.u.tools/ å®˜ç½‘ä¸‹è½½åœ°å€ï¼šhttps://www.u.tools/download.html ä½¿ç”¨æ–‡æ¡£åœ°å€: https://www.u.tools/docs/guide/about-uTools.html è®¨è®ºç¤¾åŒº: https://yuanliao.info/","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"å®ç”¨å·¥å…·åŠæŠ€å·§","slug":"å®ç”¨å·¥å…·åŠæŠ€å·§","permalink":"http://ltyeamin.github.io/tags/å®ç”¨å·¥å…·åŠæŠ€å·§/"}]},{"title":"ã€Pythonçˆ¬è™«ã€‘ä½¿ç”¨Requestsåº“çˆ¬å–çŒ«çœ¼ç”µå½±TOP100æ•°æ®","slug":"ã€Pythonçˆ¬è™«ã€‘ä½¿ç”¨Requestsåº“çˆ¬å–çŒ«çœ¼ç”µå½±TOP100æ•°æ®","date":"2019-10-12T12:23:11.000Z","updated":"2019-11-09T03:25:49.482Z","comments":true,"path":"2019/10/12/ã€Pythonçˆ¬è™«ã€‘ä½¿ç”¨Requestsåº“çˆ¬å–çŒ«çœ¼ç”µå½±TOP100æ•°æ®/","link":"","permalink":"http://ltyeamin.github.io/2019/10/12/ã€Pythonçˆ¬è™«ã€‘ä½¿ç”¨Requestsåº“çˆ¬å–çŒ«çœ¼ç”µå½±TOP100æ•°æ®/","excerpt":"","text":"çˆ¬è™«åˆ†æçˆ¬è™«éœ€æ±‚æè¿°: çˆ¬å–çŒ«çœ¼ç”µå½±TOP100çš„ç”µå½±åç§°ã€æ—¶é—´ã€è¯„åˆ†ã€æµ·æŠ¥å›¾ç‰‡ç­‰ä¿¡æ¯ ç«™ç‚¹: https://maoyan.com/board/4 åˆ†æ: æ‰“å¼€ç«™ç‚¹å³æ˜¯çŒ«çœ¼ç”µå½±TOP100çš„ç¬¬ä¸€é¡µ,ç‚¹å‡»ä¸‹ä¸€é¡µï¼Œæˆ‘ä»¬è§‚å¯Ÿåœ°å€æ URLåè¾¹è¿½åŠ äº†?offset=10çš„å‚æ•°ï¼Œæ˜¾ç„¶offsetå‚æ•°ä»£è¡¨åç§»é‡ï¼Œoffset=10è¡¨ç¤ºç¬¬ä¸€é¡µï¼Œoffset=20è¡¨ç¤ºç¬¬äºŒé¡µï¼Œç”±æ­¤å¯æ¨ï¼Œè‹¥åç§»é‡æœªnï¼Œåˆ™ç”µå½±åºå·å°±æ˜¯n+1åˆ°n+10ï¼Œæ¯é¡µæ˜¾ç¤º10ä¸ªã€‚å› æ­¤ï¼Œæƒ³è¦è·å–TOP100ï¼Œè¦åˆ†å¼€è¯·æ±‚10æ¬¡ï¼Œè€Œ10æ¬¡çš„offsetå‚æ•°å€¼åˆ†åˆ«è®¾ç½®ä¸º0ã€10ã€20â€¦90å³å¯ï¼Œè¿™æ ·è·å–ä¸åŒçš„é¡µé¢ä¹‹åï¼Œå†é€šè¿‡ä»»æ„ä¸€ä¸ªçš„è§£æå™¨æå–ç›¸å…³çš„æ•°æ®å³å¯å®Œæˆã€‚ ä»£ç ç¼–å†™åˆ©ç”¨æ­£åˆ™è¿›è¡Œè§£æ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465#!/usr/bin python3.6# -*- encoding: utf-8 -*-\"\"\"@File : __init__.py.py@Description : åˆ©ç”¨requestsåº“å’Œlxmlè§£æåº“çˆ¬å–çŒ«çœ¼ç”µå½±TOP100æ•°æ®@Author : tong.li@Email : lt_alex@163.com@Blog : http://blog.yeamin.top@Time : 2019/10/12 ä¸‹åˆ8:31\"\"\"import requestsimport reimport timefrom requests.exceptions import RequestExceptiondef request_page(url): try: # è®¾ç½®è¯·æ±‚å¤´ headers = &#123; 'User-Agent' : 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36' &#125; response = requests.get(url, headers=headers) if response.status_code == 200: text = response.text # è·å–ç”µå½±æ’åã€æµ·æŠ¥ã€åç§°ã€ä¸»æ¼”ã€å‘å¸ƒæ—¶é—´ã€è¯„åˆ† regx = re.compile('&lt;dd&gt;.*?board-index.*?&gt;(.*?)&lt;/i&gt;.*?data-src=\"(.*?)\".*?name.*?a.*?&gt;(.*?)&lt;/a&gt;' '.*?star.*?&gt;.*?ï¼š(.*?)\\s*&lt;/p&gt;.*?releasetime.*?&gt;.*?ï¼š(.*?)&lt;/p&gt;.*?integer.*?&gt;(.*?)&lt;/i&gt;' '.*?fraction.*?&gt;(.*?)&lt;/i&gt;.*?&lt;/dd&gt;', re.S) items = re.findall(regx, text) for item in items: yield &#123; 'index': item[0], 'name': item[2], 'actor': item[3], 'post_img': item[1], 'time': item[4], 'score': item[5]+item[6] &#125; return items return None except RequestException: return None# å­˜å‚¨:æ–‡ä»¶/æ•°æ®åº“def store(text,filename): with open(filename, 'a', encoding='utf-8') as file: file.write(str(text) + '\\n')def getData(url): datas = request_page(url) for data in datas: # æ§åˆ¶å°æ‰“å°æ•°æ® print(data) # å°†æ•°æ®å†™å…¥txtçº¯æ–‡æœ¬æ–‡ä»¶ä¸­ store(data,'result.txt')if __name__ == '__main__': # çŒ«çœ¼ç”µå½±TOP100æ¦œå• url = 'https://maoyan.com/board/4?offset=' for i in range(10): getData(url + str(i * 10)) # çŒ«çœ¼ç”µå½±æœ‰åçˆ¬è™«é™åˆ¶,çˆ¬çš„å¤ªå¤šä¼šæœ‰IPæˆ–éªŒè¯ç é™åˆ¶,ç­‰å¾…0.5æ¯«ç§’å†æ¬¡è¯·æ±‚ time.sleep(0.5) åˆ©ç”¨xlmlåŠXpathè§£æ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061#!/usr/bin python3.6# -*- encoding: utf-8 -*-\"\"\"@File : __init__.py.py@Description : åˆ©ç”¨requestsåº“å’Œlxmlè§£æåº“çˆ¬å–çŒ«çœ¼ç”µå½±TOP100æ•°æ®@Author : tong.li@Email : lt_alex@163.com@Blog : http://blog.yeamin.top@Time : 2019/10/12 ä¸‹åˆ8:31\"\"\"from lxml import etreeimport requestsimport timefrom requests.exceptions import RequestExceptiondef request_page(url): try: # è®¾ç½®è¯·æ±‚å¤´ headers = &#123; 'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36' &#125; response = requests.get(url, headers=headers) if response.status_code == 200: text = response.text return text return None except RequestException: return Nonedef dealData(items): for item in items: yield &#123; 'index': item[0], 'name': item[1], 'actor': item[2].strip(), 'time': item[3][5:], 'score': item[4] + item[5], 'post_img': item[6] &#125; return itemsif __name__ == '__main__': for i in range(10): # çŒ«çœ¼ç”µå½±TOP100æ¦œå• url = 'https://maoyan.com/board/4?offset='+ str(i * 10) html = etree.HTML(request_page(url)) indexs = html.xpath('//*[@id=\"app\"]/div/div/div[1]/dl/dd/i/text()') name = html.xpath('//*[@id=\"app\"]/div/div/div[1]/dl/dd/div/div/div[1]/p[1]/a/text()') actor = html.xpath('//*[@id=\"app\"]/div/div/div[1]/dl/dd/div/div/div[1]/p[2]/text()') times = html.xpath('//*[@id=\"app\"]/div/div/div[1]/dl/dd/div/div/div[1]/p[3]/text()') score1 = html.xpath('//*[@id=\"app\"]/div/div/div[1]/dl/dd/div/div/div[2]/p/i[1]/text()') score2 = html.xpath('//*[@id=\"app\"]/div/div/div[1]/dl/dd/div/div/div[2]/p/i[2]/text()') # å–å›¾ç‰‡åœ°å€çš„æ—¶å€™å‘ç°é—®é¢˜,æ‰“å¼€æµè§ˆå™¨F12æ§åˆ¶å°,åœ¨Elementçœ‹åˆ°çš„imgæ ‡ç­¾å›¾ç‰‡åœ°å€å±æ€§åä¸ºsrc, # ä½†æ˜¯åœ¨Sourceä¸‹çœ‹åˆ°çš„å±æ€§åæ˜¯data-src,åŸå› å¯èƒ½æ˜¯æµè§ˆå™¨å¯¹JavaScriptä»£ç è¿›è¡Œäº†æ¸²æŸ“ images = html.xpath('//*[@class=\"board-img\"]/@data-src') datas = zip(indexs,name,actor,times,score1,score2,images) for data in dealData(datas): print(data) # çŒ«çœ¼ç”µå½±æœ‰åçˆ¬è™«é™åˆ¶,çˆ¬çš„å¤ªå¤šä¼šæœ‰IPæˆ–éªŒè¯ç é™åˆ¶,ç­‰å¾…0.5æ¯«ç§’å†æ¬¡è¯·æ±‚ time.sleep(0.5) çˆ¬å–ç»“æœ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100&#123;'index': '1', 'name': 'éœ¸ç‹åˆ«å§¬', 'actor': 'ä¸»æ¼”ï¼šå¼ å›½è£,å¼ ä¸°æ¯…,å·©ä¿', 'time': '1993-07-26', 'score': '9.5', 'post_img': 'https://p1.meituan.net/movie/20803f59291c47e1e116c11963ce019e68711.jpg@160w_220h_1e_1c'&#125;&#123;'index': '2', 'name': 'è‚–ç”³å…‹çš„æ•‘èµ', 'actor': 'ä¸»æ¼”ï¼šè’‚å§†Â·ç½—å®¾æ–¯,æ‘©æ ¹Â·å¼—é‡Œæ›¼,é²å‹ƒÂ·å†ˆé¡¿', 'time': '1994-09-10(åŠ æ‹¿å¤§)', 'score': '9.5', 'post_img': 'https://p0.meituan.net/movie/283292171619cdfd5b240c8fd093f1eb255670.jpg@160w_220h_1e_1c'&#125;&#123;'index': '3', 'name': 'ç½—é©¬å‡æ—¥', 'actor': 'ä¸»æ¼”ï¼šæ ¼åˆ©é«˜é‡ŒÂ·æ´¾å…‹,å¥¥é»›ä¸½Â·èµ«æœ¬,åŸƒè¿ªÂ·è‰¾ä¼¯ç‰¹', 'time': '1953-09-02(ç¾å›½)', 'score': '9.1', 'post_img': 'https://p0.meituan.net/movie/289f98ceaa8a0ae737d3dc01cd05ab052213631.jpg@160w_220h_1e_1c'&#125;&#123;'index': '4', 'name': 'è¿™ä¸ªæ€æ‰‹ä¸å¤ªå†·', 'actor': 'ä¸»æ¼”ï¼šè®©Â·é›·è¯º,åŠ é‡ŒÂ·å¥¥å¾·æ›¼,å¨œå¡”è‰Â·æ³¢ç‰¹æ›¼', 'time': '1994-09-14(æ³•å›½)', 'score': '9.5', 'post_img': 'https://p1.meituan.net/movie/6bea9af4524dfbd0b668eaa7e187c3df767253.jpg@160w_220h_1e_1c'&#125;&#123;'index': '5', 'name': 'æ³°å¦å°¼å…‹å·', 'actor': 'ä¸»æ¼”ï¼šè±æ˜‚çº³å¤šÂ·è¿ªå¡æ™®é‡Œå¥¥,å‡¯ç‰¹Â·æ¸©ä¸è±ç‰¹,æ¯”åˆ©Â·èµæ©', 'time': '1998-04-03', 'score': '9.5', 'post_img': 'https://p1.meituan.net/movie/b607fba7513e7f15eab170aac1e1400d878112.jpg@160w_220h_1e_1c'&#125;&#123;'index': '6', 'name': 'å”ä¼¯è™ç‚¹ç§‹é¦™', 'actor': 'ä¸»æ¼”ï¼šå‘¨æ˜Ÿé©°,å·©ä¿,éƒ‘ä½©ä½©', 'time': '1993-07-01(ä¸­å›½é¦™æ¸¯)', 'score': '9.1', 'post_img': 'https://p0.meituan.net/movie/da64660f82b98cdc1b8a3804e69609e041108.jpg@160w_220h_1e_1c'&#125;&#123;'index': '7', 'name': 'é­‚æ–­è“æ¡¥', 'actor': 'ä¸»æ¼”ï¼šè´¹é›¯Â·ä¸½,ç½—ä¼¯ç‰¹Â·æ³°å‹’,éœ²å¡å°”Â·æ²ƒç‰¹æ£®', 'time': '1940-05-17(ç¾å›½)', 'score': '9.2', 'post_img': 'https://p0.meituan.net/movie/46c29a8b8d8424bdda7715e6fd779c66235684.jpg@160w_220h_1e_1c'&#125;&#123;'index': '8', 'name': 'ä¹±ä¸–ä½³äºº', 'actor': 'ä¸»æ¼”ï¼šè´¹é›¯Â·ä¸½,å…‹æ‹‰å…‹Â·ç›–åš,å¥¥åˆ©ç»´å¨…Â·å¾·å“ˆç»´å…°', 'time': '1939-12-15(ç¾å›½)', 'score': '9.1', 'post_img': 'https://p0.meituan.net/movie/223c3e186db3ab4ea3bb14508c709400427933.jpg@160w_220h_1e_1c'&#125;&#123;'index': '9', 'name': 'å¤©ç©ºä¹‹åŸ', 'actor': 'ä¸»æ¼”ï¼šå¯ºç”°å†œ,é¹«å°¾çœŸçŸ¥å­,é¾Ÿå±±åŠ©æ¸…', 'time': '1992-05-01', 'score': '9.0', 'post_img': 'https://p1.meituan.net/movie/ba1ed511668402605ed369350ab779d6319397.jpg@160w_220h_1e_1c'&#125;&#123;'index': '10', 'name': 'è¾›å¾·å‹’çš„åå•', 'actor': 'ä¸»æ¼”ï¼šè¿å§†Â·å°¼æ£®,æ‹‰å°”å¤«Â·è´¹å› æ–¯,æœ¬Â·é‡‘æ–¯åˆ©', 'time': '1993-12-15(ç¾å›½)', 'score': '9.2', 'post_img': 'https://p0.meituan.net/movie/b0d986a8bf89278afbb19f6abaef70f31206570.jpg@160w_220h_1e_1c'&#125;&#123;'index': '11', 'name': 'éŸ³ä¹ä¹‹å£°', 'actor': 'ä¸»æ¼”ï¼šæœ±è‰Â·å®‰å¾·é²æ–¯,å…‹é‡Œæ–¯æ‰˜å¼—Â·æ™®å¢é»˜,åŸƒç³è¯ºÂ·å¸•å…‹', 'time': '1965-03-02(ç¾å›½)', 'score': '9.0', 'post_img': 'https://p1.meituan.net/movie/6bc004d57358ee6875faa5e9a1239140128550.jpg@160w_220h_1e_1c'&#125;&#123;'index': '12', 'name': 'å–œå‰§ä¹‹ç‹', 'actor': 'ä¸»æ¼”ï¼šå‘¨æ˜Ÿé©°,è«æ–‡è”š,å¼ æŸèŠ', 'time': '1999-02-13(ä¸­å›½é¦™æ¸¯)', 'score': '9.1', 'post_img': 'https://p1.meituan.net/movie/18e3191039d5e71562477659301f04aa61905.jpg@160w_220h_1e_1c'&#125;&#123;'index': '13', 'name': 'å¤§é—¹å¤©å®«', 'actor': 'ä¸»æ¼”ï¼šé‚±å²³å³°,æ¯•å…‹,å¯Œæ¶¦ç”Ÿ', 'time': '1965-12-31', 'score': '9.0', 'post_img': 'https://p1.meituan.net/movie/14a7b337e8063e3ce05a5993ed80176b74208.jpg@160w_220h_1e_1c'&#125;&#123;'index': '14', 'name': 'æ˜¥å…‰ä¹æ³„', 'actor': 'ä¸»æ¼”ï¼šå¼ å›½è£,æ¢æœä¼Ÿ,å¼ éœ‡', 'time': '1997-05-30(ä¸­å›½é¦™æ¸¯)', 'score': '9.2', 'post_img': 'https://p0.meituan.net/movie/ae7245920d95c03765fe1615f3a1fe3865785.jpg@160w_220h_1e_1c'&#125;&#123;'index': '15', 'name': 'å‰ªåˆ€æ‰‹çˆ±å¾·å', 'actor': 'ä¸»æ¼”ï¼šçº¦ç¿°å°¼Â·å¾·æ™®,è–‡è¯ºå¨œÂ·ç‘å¾·,é»›å®‰Â·éŸ¦æ–¯ç‰¹', 'time': '1990-12-06(ç¾å›½)', 'score': '8.8', 'post_img': 'https://p1.meituan.net/movie/6a964e9cee699267053bd6a4bf6f2671195394.jpg@160w_220h_1e_1c'&#125;&#123;'index': '16', 'name': 'ç¾ä¸½äººç”Ÿ', 'actor': 'ä¸»æ¼”ï¼šç½—ä¼¯æ‰˜Â·è´å°¼å°¼,å°¼å¯è±å¡”Â·å¸ƒæ‹‰æ–¯åŸº,ä¹”æ²»Â·åå¡”é‡Œå°¼', 'time': '1997-12-20(æ„å¤§åˆ©)', 'score': '9.3', 'post_img': 'https://p0.meituan.net/movie/43d259ecbcd53e8bbe902632772281d6327525.jpg@160w_220h_1e_1c'&#125;&#123;'index': '17', 'name': 'é»‘å®¢å¸å›½', 'actor': 'ä¸»æ¼”ï¼šåŸºåŠªÂ·é‡Œç»´æ–¯,å‡¯ç‘-å®‰Â·è«æ–¯,åŠ³ä¼¦æ–¯Â·è²ä»€ä¼¯æ©', 'time': '2000-01-14', 'score': '9.0', 'post_img': 'https://p1.meituan.net/movie/ad974d3527879f00be2eec29135118163728582.jpg@160w_220h_1e_1c'&#125;&#123;'index': '18', 'name': 'å“ˆåˆ©Â·æ³¢ç‰¹ä¸é­”æ³•çŸ³', 'actor': 'ä¸»æ¼”ï¼šä¸¹å°¼å°”Â·é›·å¾·å…‹é‡Œå¤«,é²ä¼¯ç‰¹Â·æ ¼æ—ç‰¹,è‰¾ç›Â·æ²ƒç‰¹æ£®', 'time': '2002-01-26', 'score': '9.1', 'post_img': 'https://p1.meituan.net/movie/aacb9ed2a6601bfe515ef0970add1715623792.jpg@160w_220h_1e_1c'&#125;&#123;'index': '19', 'name': 'æŒ‡ç¯ç‹3ï¼šç‹è€…æ— æ•Œ', 'actor': 'ä¸»æ¼”ï¼šä¼Šè±è´¾Â·ä¼å¾·,ä¼Šæ©Â·éº¦å…‹è±æ©,ä¸½èŠ™Â·æ³°å‹’', 'time': '2004-03-15', 'score': '9.2', 'post_img': 'https://p0.meituan.net/movie/932bdfbef5be3543e6b136246aeb99b8123736.jpg@160w_220h_1e_1c'&#125;&#123;'index': '20', 'name': 'æ— é—´é“', 'actor': 'ä¸»æ¼”ï¼šåˆ˜å¾·å,æ¢æœä¼Ÿ,é»„ç§‹ç”Ÿ', 'time': '2003-09-05', 'score': '9.1', 'post_img': 'https://p0.meituan.net/movie/606de8f394d40dbcbb9b87943fec71a2130408.jpg@160w_220h_1e_1c'&#125;&#123;'index': '21', 'name': 'è™è ä¾ ï¼šé»‘æš—éª‘å£«', 'actor': 'ä¸»æ¼”ï¼šå…‹é‡Œæ–¯è’‚å®‰Â·è´å°”,å¸Œæ–¯Â·è±æ°,é˜¿ä¼¦Â·ä¼Šå…‹å“ˆç‰¹', 'time': '2008-07-18(ç¾å›½)', 'score': '9.3', 'post_img': 'https://p0.meituan.net/movie/09658109acfea0e248a63932337d8e6a4268980.jpg@160w_220h_1e_1c'&#125;&#123;'index': '22', 'name': 'æ¥šé—¨çš„ä¸–ç•Œ', 'actor': 'ä¸»æ¼”ï¼šé‡‘Â·å‡¯ç‘,åŠ³æ‹‰Â·ç³å¦®,è¯ºäºšÂ·è‰¾é»˜é‡Œå¥‡', 'time': '1998-06-01(ç¾å›½)', 'score': '8.9', 'post_img': 'https://p0.meituan.net/movie/8959888ee0c399b0fe53a714bc8a5a17460048.jpg@160w_220h_1e_1c'&#125;&#123;'index': '23', 'name': 'åŠ å‹’æ¯”æµ·ç›—', 'actor': 'ä¸»æ¼”ï¼šçº¦ç¿°å°¼Â·å¾·æ™®,å‡¯æ‹‰Â·å¥ˆç‰¹è‰,å¥¥å…°å¤šÂ·å¸ƒé²å§†', 'time': '2003-11-21', 'score': '8.9', 'post_img': 'https://p0.meituan.net/movie/b05b94b28eca53f325ae8d807fcd4ce01798036.jpg@160w_220h_1e_1c'&#125;&#123;'index': '24', 'name': 'æ•™çˆ¶2', 'actor': 'ä¸»æ¼”ï¼šé˜¿å°”Â·å¸•è¥¿è¯º,ç½—ä¼¯ç‰¹Â·å¾·å°¼ç½—,é»›å®‰Â·åŸºé¡¿', 'time': '1974-12-12(ç¾å›½)', 'score': '9.0', 'post_img': 'https://p0.meituan.net/movie/bb1dee5e0b25889a2410211c1d5010ae190824.jpg@160w_220h_1e_1c'&#125;&#123;'index': '25', 'name': 'å°„é›•è‹±é›„ä¼ ä¹‹ä¸œæˆè¥¿å°±', 'actor': 'ä¸»æ¼”ï¼šå¼ å›½è£,æ¢æœä¼Ÿ,å¼ å­¦å‹', 'time': '1993-02-05(ä¸­å›½é¦™æ¸¯)', 'score': '8.9', 'post_img': 'https://p1.meituan.net/movie/53b6f0b66882a53b08896c92076515a8236400.jpg@160w_220h_1e_1c'&#125;&#123;'index': '26', 'name': 'æœºå™¨äººæ€»åŠ¨å‘˜', 'actor': 'ä¸»æ¼”ï¼šæœ¬Â·è´å°”ç‰¹,è‰¾ä¸½èÂ·å¥ˆç‰¹,æ°å¤«Â·æ ¼å°”æ—', 'time': '2008-06-27(ç¾å›½)', 'score': '9.3', 'post_img': 'https://p0.meituan.net/movie/267dd2483f0fb57081474c00fbea38451415571.jpg@160w_220h_1e_1c'&#125;&#123;'index': '27', 'name': 'æŒ‡ç¯ç‹1ï¼šæŠ¤æˆ’ä½¿è€…', 'actor': 'ä¸»æ¼”ï¼šä¼Šè±è´¾Â·ä¼å¾·,ä¼Šæ©Â·éº¦å…‹è±æ©,ä¸½èŠ™Â·æ³°å‹’', 'time': '2002-04-04', 'score': '9.0', 'post_img': 'https://p1.meituan.net/movie/dd08154878aac7c8c649fe3eeb8ccd0a2498277.jpg@160w_220h_1e_1c'&#125;&#123;'index': '28', 'name': 'æŒ‡ç¯ç‹2ï¼šåŒå¡”å¥‡å…µ', 'actor': 'ä¸»æ¼”ï¼šä¼Šè±è´¾Â·ä¼å¾·,ä¼Šæ©Â·éº¦å…‹è±æ©,ä¸½èŠ™Â·æ³°å‹’', 'time': '2003-04-25', 'score': '9.1', 'post_img': 'https://p0.meituan.net/movie/02bb9fd161c05bad6089133098efcdb5546589.jpg@160w_220h_1e_1c'&#125;&#123;'index': '29', 'name': 'ç‹®å­ç‹', 'actor': 'ä¸»æ¼”ï¼šé©¬ä¿®Â·å¸ƒç½—å¾·é‡Œå…‹,å°¼åŸºå¡”Â·å¡å…°å§†,è©¹å§†æ–¯Â·å„å°”Â·ç¼æ–¯', 'time': '1995-07-15', 'score': '8.8', 'post_img': 'https://p0.meituan.net/movie/27b76fe6cf3903f3d74963f70786001e1438406.jpg@160w_220h_1e_1c'&#125;&#123;'index': '30', 'name': 'æ´»ç€', 'actor': 'ä¸»æ¼”ï¼šè‘›ä¼˜,å·©ä¿,ç‰›çŠ‡', 'time': '1994-05-18(æ³•å›½)', 'score': '9.0', 'post_img': 'https://p0.meituan.net/movie/4c41068ef7608c1d4fbfbe6016e589f7204391.jpg@160w_220h_1e_1c'&#125;&#123;'index': '31', 'name': 'æ‹¯æ•‘å¤§å…µç‘æ©', 'actor': 'ä¸»æ¼”ï¼šæ±¤å§†Â·æ±‰å…‹æ–¯,é©¬ç‰¹Â·è¾¾è’™,æ±¤å§†Â·å¡å…¹æ‘©å°”', 'time': '1998-11-13', 'score': '8.9', 'post_img': 'https://p1.meituan.net/movie/a2a287c77415dc1f85b04d288f7d63ab1089754.jpg@160w_220h_1e_1c'&#125;&#123;'index': '32', 'name': 'ç›—æ¢¦ç©ºé—´', 'actor': 'ä¸»æ¼”ï¼šè±æ˜‚çº³å¤šÂ·è¿ªå¡æ™®é‡Œå¥¥,æ¸¡è¾¹è°¦,çº¦ç‘Ÿå¤«Â·é«˜ç™»-è±ç»´ç‰¹', 'time': '2010-09-01', 'score': '9.2', 'post_img': 'https://p1.meituan.net/movie/2f344a9f9575edbcae9f0abe0578bc90339773.jpg@160w_220h_1e_1c'&#125;&#123;'index': '33', 'name': 'å“ˆå°”çš„ç§»åŠ¨åŸå ¡', 'actor': 'ä¸»æ¼”ï¼šå€èµåƒæƒ å­,æœ¨æ‘æ‹“å“‰,ç¾è½®æ˜å®', 'time': '2004-11-20(æ—¥æœ¬)', 'score': '9.0', 'post_img': 'https://p0.meituan.net/movie/0127b451d5b8f0679c6f81c8ed414bb2432442.jpg@160w_220h_1e_1c'&#125;&#123;'index': '34', 'name': 'å¿ çŠ¬å…«å…¬çš„æ•…äº‹', 'actor': 'ä¸»æ¼”ï¼šForest,ç†æŸ¥Â·åŸºå°”,ç¼Â·è‰¾ä¼¦', 'time': '2010-03-12(è‹±å›½)', 'score': '9.3', 'post_img': 'https://p0.meituan.net/movie/7787c10ad5e95b03cf83ef9473500d8e282796.jpg@160w_220h_1e_1c'&#125;&#123;'index': '35', 'name': 'ç–¯ç‹‚åŸå§‹äºº', 'actor': 'ä¸»æ¼”ï¼šå°¼å¤æ‹‰æ–¯Â·å‡¯å¥‡,è‰¾ç›Â·æ–¯é€š,ç‘å®‰Â·é›·è¯ºå…¹', 'time': '2013-04-20', 'score': '9.5', 'post_img': 'https://p1.meituan.net/movie/bc022b86345c643ca21d759166f77a553679589.jpg@160w_220h_1e_1c'&#125;&#123;'index': '36', 'name': 'æå‡»ä¿±ä¹éƒ¨', 'actor': 'ä¸»æ¼”ï¼šçˆ±å¾·åÂ·å“ˆé‡Œæ£®Â·è¯ºé¡¿,å¸ƒæ‹‰å¾·Â·çš®ç‰¹,æµ·ä¼¦å¨œÂ·ä¼¯ç¿°Â·å¡ç‰¹', 'time': '1999-10-15(ç¾å›½)', 'score': '8.8', 'post_img': 'https://p0.meituan.net/movie/b3defc07dfaa1b6f5b74852ce38a3f8f242792.jpg@160w_220h_1e_1c'&#125;&#123;'index': '37', 'name': 'ä¸œé‚ªè¥¿æ¯’', 'actor': 'ä¸»æ¼”ï¼šå¼ å›½è£,æ¢æœä¼Ÿ,åˆ˜å˜‰ç²', 'time': '1994-09-17', 'score': '8.8', 'post_img': 'https://p1.meituan.net/movie/7e471a9171a410ebc9413b2f1de67afc130067.jpg@160w_220h_1e_1c'&#125;&#123;'index': '38', 'name': 'å¹½çµå…¬ä¸»', 'actor': 'ä¸»æ¼”ï¼šæ¾ç”°æ´‹æ²»,çŸ³ç”°ç™¾åˆå­,ç”°ä¸­è£•å­', 'time': '1998-05-01', 'score': '8.9', 'post_img': 'https://p0.meituan.net/movie/a08f65e6cb50fab32df5da69ff116f593095363.jpg@160w_220h_1e_1c'&#125;&#123;'index': '39', 'name': 'é˜¿å‡¡è¾¾', 'actor': 'ä¸»æ¼”ï¼šè¨å§†Â·æ²ƒè¾›é¡¿,ä½ä¼ŠÂ·ç´¢å°”è¾¾å¨œ,ç±³æ­‡å°”Â·ç½—å¾·é‡Œæ ¼å…¹', 'time': '2010-01-04', 'score': '9.0', 'post_img': 'https://p1.meituan.net/movie/91f575ec93f019f428d1f33e3ceca7c5115495.jpg@160w_220h_1e_1c'&#125;&#123;'index': '40', 'name': 'é£ä¹‹è°·', 'actor': 'ä¸»æ¼”ï¼šå²›æœ¬é¡»ç¾,æ°¸äº•ä¸€éƒ,å‚æœ¬åƒå¤', 'time': '1992', 'score': '8.9', 'post_img': 'https://p0.meituan.net/movie/4f9638ba234c3fb673f23a09968db875371576.jpg@160w_220h_1e_1c'&#125;&#123;'index': '41', 'name': 'åäºŒæ€’æ±‰', 'actor': 'ä¸»æ¼”ï¼šäº¨åˆ©Â·æ–¹è¾¾,æÂ·ç§‘å¸ƒ,é©¬ä¸Â·é²å°”è¨å§†', 'time': '1957-04-13(ç¾å›½)', 'score': '9.1', 'post_img': 'https://p0.meituan.net/movie/df15efd261060d3094a73ef679888d4f238149.jpg@160w_220h_1e_1c'&#125;&#123;'index': '42', 'name': 'å¤§è¯è¥¿æ¸¸ä¹‹æœˆå…‰å®ç›’', 'actor': 'ä¸»æ¼”ï¼šå‘¨æ˜Ÿé©°,è«æ–‡è”š,å´å­Ÿè¾¾', 'time': '2014-10-24', 'score': '9.6', 'post_img': 'https://p0.meituan.net/movie/92eb862c42c49f8e41e459c369c4512b226610.jpg@160w_220h_1e_1c'&#125;&#123;'index': '43', 'name': 'Vå­—ä»‡æ€é˜Ÿ', 'actor': 'ä¸»æ¼”ï¼šå¨œå¡”è‰Â·æ³¢ç‰¹æ›¼,é›¨æœÂ·ç»´æ–‡,æ–¯è’‚èŠ¬Â·ç‘', 'time': '2006-03-17(ç¾å›½)', 'score': '8.8', 'post_img': 'https://p1.meituan.net/movie/06ec3c1c647942b1e40bca84036014e9490863.jpg@160w_220h_1e_1c'&#125;&#123;'index': '44', 'name': 'æ”¾ç‰›ç­çš„æ˜¥å¤©', 'actor': 'ä¸»æ¼”ï¼šçƒ­æ‹‰å°”Â·æœ±å°¼å¥¥,è®©-å·´è’‚æ–¯ç‰¹Â·è«å°¼è€¶,ç›ä¸½Â·å¸ƒå¥ˆå°”', 'time': '2004-10-16', 'score': '8.8', 'post_img': 'https://p0.meituan.net/movie/70de97ebb6b5251ecb7c3f6d7a782a7f189340.jpg@160w_220h_1e_1c'&#125;&#123;'index': '45', 'name': 'å½“å¹¸ç¦æ¥æ•²é—¨', 'actor': 'ä¸»æ¼”ï¼šå¨å°”Â·å²å¯†æ–¯,è´¾ç™»Â·å²å¯†æ–¯,å¦è¿ªÂ·ç‰›é¡¿', 'time': '2008-01-17', 'score': '8.9', 'post_img': 'https://p1.meituan.net/movie/5896de3c1474277730e321c9b1db04a9205644.jpg@160w_220h_1e_1c'&#125;&#123;'index': '46', 'name': 'é€Ÿåº¦ä¸æ¿€æƒ…5', 'actor': 'ä¸»æ¼”ï¼šèŒƒÂ·è¿ªå¡å°”,ä¿ç½—Â·æ²ƒå…‹,é“æ©Â·å¼ºæ£®', 'time': '2011-05-12', 'score': '9.2', 'post_img': 'https://p0.meituan.net/movie/845ce32778a1b3f258de089f91a3979b5766154.jpg@160w_220h_1e_1c'&#125;&#123;'index': '47', 'name': 'é©¯é¾™é«˜æ‰‹', 'actor': 'ä¸»æ¼”ï¼šæ°ä¼ŠÂ·å·´é²åˆ‡å°”,æ°æ‹‰å¾·Â·å·´ç‰¹å‹’,äºšç¾è‰å¡Â·è´¹é›·æ‹‰', 'time': '2010-05-14', 'score': '9.0', 'post_img': 'https://p0.meituan.net/movie/b0d97e4158b47d653d7a81d66f7dd3092146907.jpg@160w_220h_1e_1c'&#125;&#123;'index': '48', 'name': 'å‹‡æ•¢çš„å¿ƒ', 'actor': 'ä¸»æ¼”ï¼šæ¢…å°”Â·å‰å¸ƒæ£®,è‹è²Â·ç›ç´¢,å¸•ç‰¹é‡Œå…‹Â·éº¦é«˜æ±‰', 'time': '1995-05-24(ç¾å›½)', 'score': '8.8', 'post_img': 'https://p1.meituan.net/movie/f8e9d5a90224746d15dfdbd53d4fae3d209420.jpg@160w_220h_1e_1c'&#125;&#123;'index': '49', 'name': 'é—»é¦™è¯†å¥³äºº', 'actor': 'ä¸»æ¼”ï¼šé˜¿å°”Â·å¸•è¥¿è¯º,å…‹é‡Œæ–¯Â·å¥¥å”çº³,åŠ å¸ƒé‡ŒåŸƒå°”Â·å®‰ç“¦å°”', 'time': '1992-12-23(ç¾å›½)', 'score': '8.8', 'post_img': 'https://p1.meituan.net/movie/8d7b0b902afd4ec1a3dd7a9c6149463c187734.jpg@160w_220h_1e_1c'&#125;&#123;'index': '50', 'name': 'ç¥å·å¥¶çˆ¸', 'actor': 'ä¸»æ¼”ï¼šå²è’‚å¤«Â·å¡ç‘å°”,æ°æ£®Â·å¸­æ ¼å°”,æ‹‰å¡å°”Â·å¸ƒå…°å¾·', 'time': '2010-07-09(ç¾å›½)', 'score': '9.0', 'post_img': 'https://p0.meituan.net/movie/85c2bfba6025bfbfb53291ae5924c215308805.jpg@160w_220h_1e_1c'&#125;&#123;'index': '51', 'name': 'é»‘å®¢å¸å›½3ï¼šçŸ©é˜µé©å‘½', 'actor': 'ä¸»æ¼”ï¼šåŸºåŠªÂ·é‡Œç»´æ–¯,é›¨æœÂ·ç»´æ–‡,å‡¯ç‘-å®‰Â·è«æ–¯', 'time': '2003-11-05', 'score': '8.8', 'post_img': 'https://p0.meituan.net/movie/2e383b5f5f306f10f9f26d9f1c28cf1d825537.jpg@160w_220h_1e_1c'&#125;&#123;'index': '52', 'name': 'é£å±‹ç¯æ¸¸è®°', 'actor': 'ä¸»æ¼”ï¼šçˆ±å¾·åÂ·é˜¿æ–¯çº³,ä¹”ä¸¹Â·é•¿äº•,é²å‹ƒÂ·å½¼å¾·æ£®', 'time': '2009-08-04', 'score': '8.9', 'post_img': 'https://p0.meituan.net/movie/47dd790e19dad72b50580641de5608c5199014.jpg@160w_220h_1e_1c'&#125;&#123;'index': '53', 'name': 'æ–­èƒŒå±±', 'actor': 'ä¸»æ¼”ï¼šå¸Œæ–¯Â·è±æ°,æ°å…‹Â·å‰ä¼¦å“ˆå°”,ç±³æ­‡å°”Â·å¨å»‰å§†æ–¯', 'time': '2006-01-13(ç¾å›½)', 'score': '9.0', 'post_img': 'https://p0.meituan.net/movie/e71affe126eeb4f8bfcc738cbddeebc8288766.jpg@160w_220h_1e_1c'&#125;&#123;'index': '54', 'name': 'æ€¦ç„¶å¿ƒåŠ¨', 'actor': 'ä¸»æ¼”ï¼šç›å¾·ç³Â·å¡ç½—å°”,å¡å…°Â·éº¦å…‹å¥¥åˆ©è²,è‰¾ä¸¹Â·å¥å› ', 'time': '2010-08-06(ç¾å›½)', 'score': '8.9', 'post_img': 'https://p0.meituan.net/movie/15f1ac49b6d1ff7b71207672993ed6901536456.jpg@160w_220h_1e_1c'&#125;&#123;'index': '55', 'name': 'ä¸‰å‚»å¤§é—¹å®è±å', 'actor': 'ä¸»æ¼”ï¼šé˜¿ç±³å°”Â·æ±—,é»„æ¸¤,å¡ç³å¨œÂ·å¡æ™®', 'time': '2011-12-08', 'score': '9.1', 'post_img': 'https://p1.meituan.net/movie/ca4a128a5a54d5b5e35ceba622636c831810197.jpg@160w_220h_1e_1c'&#125;&#123;'index': '56', 'name': 'æœ«ä»£çš‡å¸', 'actor': 'ä¸»æ¼”ï¼šå°Šé¾™,é™ˆå†²,å½¼å¾—Â·å¥¥å›¾å°”', 'time': '1987-10-23', 'score': '8.8', 'post_img': 'https://p1.meituan.net/movie/21b9211eb1094af360842472018db634286646.jpg@160w_220h_1e_1c'&#125;&#123;'index': '57', 'name': 'æ— æ•Œç ´åç‹', 'actor': 'ä¸»æ¼”ï¼šçº¦ç¿°Â·CÂ·èµ–åˆ©,è¨æ‹‰Â·è¥¿å°”å¼—æ›¼,ç®€Â·æ—å¥‡', 'time': '2012-11-06', 'score': '9.1', 'post_img': 'https://p0.meituan.net/movie/fcc17667b8343131101eeb4c67d90bf9150883.jpg@160w_220h_1e_1c'&#125;&#123;'index': '58', 'name': 'è‡´å‘½é­”æœ¯', 'actor': 'ä¸»æ¼”ï¼šä¼‘Â·æ°å…‹æ›¼,å…‹é‡Œæ–¯è’‚å®‰Â·è´å°”,è¿ˆå…‹å°”Â·å‡¯æ©', 'time': '2006-10-20(ç¾å›½)', 'score': '8.8', 'post_img': 'https://p1.meituan.net/movie/75c0d3eb584be030a01f2e26741a8f41251454.jpg@160w_220h_1e_1c'&#125;&#123;'index': '59', 'name': 'å°‘å¹´æ´¾çš„å¥‡å¹»æ¼‚æµ', 'actor': 'ä¸»æ¼”ï¼šè‹æ‹‰Â·æ²™ç›,ä¼Šå°”å‡¡Â·å¯æ±—,å¡”å¸ƒ', 'time': '2012-11-22', 'score': '9.1', 'post_img': 'https://p0.meituan.net/movie/34998e31c6d07475f1add6b8b16fd21d192579.jpg@160w_220h_1e_1c'&#125;&#123;'index': '60', 'name': 'é¬¼å­æ¥äº†', 'actor': 'ä¸»æ¼”ï¼šå§œæ–‡,å§œå®æ³¢,é™ˆå¼º', 'time': '2000-05-12(æ³•å›½æˆ›çº³)', 'score': '8.9', 'post_img': 'https://p1.meituan.net/movie/0b507aa44c4dfbbcc91949b69b1b39a168922.jpg@160w_220h_1e_1c'&#125;&#123;'index': '61', 'name': 'è™è ä¾ ï¼šé»‘æš—éª‘å£«å´›èµ·', 'actor': 'ä¸»æ¼”ï¼šå…‹é‡Œæ–¯è’‚å®‰Â·è´å°”,è¿ˆå…‹å°”Â·å‡¯æ©,åŠ é‡ŒÂ·å¥¥å¾·æ›¼', 'time': '2012-08-27', 'score': '8.9', 'post_img': 'https://p1.meituan.net/movie/96bb58f3e9d213fb0438987d16d27561379209.jpg@160w_220h_1e_1c'&#125;&#123;'index': '62', 'name': 'ç¾ä¸½å¿ƒçµ', 'actor': 'ä¸»æ¼”ï¼šç½—ç´ Â·å…‹æ´›,è©¹å¦®å¼—Â·åº·çº³åˆ©,è‰¾å¾·Â·å“ˆé‡Œæ–¯', 'time': '2001-12-21(ç¾å›½)', 'score': '8.8', 'post_img': 'https://p0.meituan.net/movie/7b7d1f8aa36d7a15463ce6942708a1a7265296.jpg@160w_220h_1e_1c'&#125;&#123;'index': '63', 'name': 'å“ˆåˆ©Â·æ³¢ç‰¹ä¸æ­»äº¡åœ£å™¨ï¼ˆä¸‹ï¼‰', 'actor': 'ä¸»æ¼”ï¼šä¸¹å°¼å°”Â·é›·å¾·å…‹é‡Œå¤«,é²ä¼¯ç‰¹Â·æ ¼æ—ç‰¹,è‰¾ç›Â·æ²ƒç‰¹æ£®', 'time': '2011-08-04', 'score': '9.0', 'post_img': 'https://p1.meituan.net/movie/bb0eca029cd25329776a4549b3fbe262924727.jpg@160w_220h_1e_1c'&#125;&#123;'index': '64', 'name': 'å€©å¥³å¹½é­‚', 'actor': 'ä¸»æ¼”ï¼šå¼ å›½è£,ç‹ç¥–è´¤,åˆé©¬', 'time': '2011-04-30', 'score': '9.2', 'post_img': 'https://p1.meituan.net/movie/96d98200d2afb4b87ff189f9c15b6545568339.jpg@160w_220h_1e_1c'&#125;&#123;'index': '65', 'name': 'å¤œè®¿å¸è¡€é¬¼', 'actor': 'ä¸»æ¼”ï¼šæ±¤å§†Â·å…‹é²æ–¯,å¸ƒæ‹‰å¾·Â·çš®ç‰¹,å…‹å°”æ–¯æ»•Â·é‚“æ–¯ç‰¹', 'time': '1994-11-11(ç¾å›½)', 'score': '8.8', 'post_img': 'https://p0.meituan.net/movie/7ec873ba943f13e3c63789d899bd0e23256871.jpg@160w_220h_1e_1c'&#125;&#123;'index': '66', 'name': 'é’¢ç´å®¶', 'actor': 'ä¸»æ¼”ï¼šè‰¾å¾·é‡Œå®‰Â·å¸ƒæ´›è¿ª,è‰¾ç±³è‰å¨…Â·ç¦å…‹æ–¯,ç±³å“ˆä¹ŒÂ·çƒ­å¸ƒç½—å¤«æ–¯åŸº', 'time': '2002-09-25(æ³•å›½)', 'score': '8.8', 'post_img': 'https://p1.meituan.net/movie/484171372de45945e8bbbcc97db57e09136701.jpg@160w_220h_1e_1c'&#125;&#123;'index': '67', 'name': 'è§¦ä¸å¯åŠ', 'actor': 'ä¸»æ¼”ï¼šå¼—æœ—ç´¢ç“¦Â·å…‹é²å¡,å¥¥ç›Â·å¸Œ,å®‰å¨œÂ·å‹’å°¼', 'time': '2011-11-02(æ³•å›½)', 'score': '9.1', 'post_img': 'https://p1.meituan.net/movie/1e700e53e4fe29dd5942381bb353c8532239179.jpg@160w_220h_1e_1c'&#125;&#123;'index': '68', 'name': 'æœ¬æ°æ˜Â·å·´é¡¿å¥‡äº‹', 'actor': 'ä¸»æ¼”ï¼šå¸ƒæ‹‰å¾·Â·çš®ç‰¹,å‡¯ç‰¹Â·å¸ƒå…°åˆ‡ç‰¹,å¡”æ‹‰å‰Â·PÂ·æ±‰æ£®', 'time': '2008-12-25(ç¾å›½)', 'score': '8.8', 'post_img': 'https://p0.meituan.net/movie/2526f77c650bf7cf3d5ee2dccdeac332244951.jpg@160w_220h_1e_1c'&#125;&#123;'index': '69', 'name': 'ç”œèœœèœœ', 'actor': 'ä¸»æ¼”ï¼šé»æ˜,å¼ æ›¼ç‰,æ›¾å¿—ä¼Ÿ', 'time': '2015-02-13', 'score': '9.2', 'post_img': 'https://p1.meituan.net/movie/0b0d45b58946078dd24d4945dd6be3b51329411.jpg@160w_220h_1e_1c'&#125;&#123;'index': '70', 'name': 'å¤§è¯è¥¿æ¸¸ä¹‹å¤§åœ£å¨¶äº²', 'actor': 'ä¸»æ¼”ï¼šå‘¨æ˜Ÿé©°,æœ±èŒµ,è«æ–‡è”š', 'time': '2014-10-24', 'score': '8.8', 'post_img': 'https://p1.meituan.net/moviemachine/508056769092059fe43a611b949f27d14863831.jpg@160w_220h_1e_1c'&#125;&#123;'index': '71', 'name': 'åˆæ‹è¿™ä»¶å°äº‹', 'actor': 'ä¸»æ¼”ï¼šé©¬é‡Œå¥¥Â·æ¯›ç‘å°”,å¹³é‡‡å¨œÂ·ä¹ç»´ç‘Ÿæ´¾å¸ƒæ©,é˜¿æŸ¥æ‹‰é‚£Â·é˜¿ç‘äºšå«è€ƒ', 'time': '2012-06-05', 'score': '8.8', 'post_img': 'https://p1.meituan.net/movie/7ed07b8ea8c0e0d0c7b685d20e3ec64e232004.jpg@160w_220h_1e_1c'&#125;&#123;'index': '72', 'name': 'ç†”ç‚‰', 'actor': 'ä¸»æ¼”ï¼šå­”åˆ˜,éƒ‘æœ‰ç¾,é‡‘æ™ºè‹±', 'time': '2011-09-22(éŸ©å›½)', 'score': '8.8', 'post_img': 'https://p1.meituan.net/movie/2a0783b4fd95566568f24adfad2181bb5392280.jpg@160w_220h_1e_1c'&#125;&#123;'index': '73', 'name': 'æ–°é¾™é—¨å®¢æ ˆ', 'actor': 'ä¸»æ¼”ï¼šå¼ æ›¼ç‰,æ¢å®¶è¾‰,ç”„å­ä¸¹', 'time': '2012-02-24', 'score': '8.8', 'post_img': 'https://p1.meituan.net/movie/7833126c8c21a11571bb52fbdece0acb811449.jpg@160w_220h_1e_1c'&#125;&#123;'index': '74', 'name': 'ç´ åª›', 'actor': 'ä¸»æ¼”ï¼šææ¥,è–›è€¿æ±‚,ä¸¥å¿—åª›', 'time': '2013-10-02(éŸ©å›½)', 'score': '9.1', 'post_img': 'https://p0.meituan.net/movie/19653e8af59cf473cd40f9ccc0658d93692304.jpg@160w_220h_1e_1c'&#125;&#123;'index': '75', 'name': 'å°é‹å­', 'actor': 'ä¸»æ¼”ï¼šé»˜ç½•é»˜å¾·Â·é˜¿ç±³å°”Â·çº³å‰,Kamal Mirkarimi,Behzad Rafi', 'time': '1999-01-22(ç¾å›½)', 'score': '9.0', 'post_img': 'https://p1.meituan.net/movie/135c612860fae899df2220149664d97a173555.jpg@160w_220h_1e_1c'&#125;&#123;'index': '76', 'name': 'è¤ç«ä¹‹æ£®', 'actor': 'ä¸»æ¼”ï¼šå†…å±±æ˜‚è¾‰,ä½ä»“ç»«éŸ³,åè—¤å¼˜æ ‘', 'time': '2011-09-17(æ—¥æœ¬)', 'score': '9.0', 'post_img': 'https://p0.meituan.net/movie/5420be40e3b755ffe04779b9b199e935256906.jpg@160w_220h_1e_1c'&#125;&#123;'index': '77', 'name': 'æ•™çˆ¶', 'actor': 'ä¸»æ¼”ï¼šé©¬é¾™Â·ç™½å…°åº¦,é˜¿å°”Â·å¸•è¥¿è¯º,è©¹å§†æ–¯Â·è‚¯æ©', 'time': '2015-04-18', 'score': '9.3', 'post_img': 'https://p0.meituan.net/movie/1199dc6273680f175fd9b06c9c36d08a219658.jpg@160w_220h_1e_1c'&#125;&#123;'index': '78', 'name': 'ç©¿æ¡çº¹ç¡è¡£çš„ç”·å­©', 'actor': 'ä¸»æ¼”ï¼šé˜¿æ²™Â·å·´ç‰¹è²å°”å¾·,ç»´æ‹‰Â·æ³•æ¢…åŠ ,å¤§å«Â·ä¼‘é‡Œæ–¯', 'time': '2008-09-12(è‹±å›½)', 'score': '9.0', 'post_img': 'https://p1.meituan.net/movie/d5970e36c8868a4b746c80f3b3f8a404174615.jpg@160w_220h_1e_1c'&#125;&#123;'index': '79', 'name': 'æ—¶ç©ºæ‹æ—…äºº', 'actor': 'ä¸»æ¼”ï¼šç‘ç§‹Â·éº¦å…‹äºšå½“æ–¯,å¤šå§†çº³å°”Â·æ ¼é‡Œæ£®,æ¯”å°”Â·å¥ˆä¼Š', 'time': '2013-09-04(è‹±å›½)', 'score': '8.9', 'post_img': 'https://p0.meituan.net/movie/4abc8c932cfacfc0089e2883765d02d1295222.jpg@160w_220h_1e_1c'&#125;&#123;'index': '80', 'name': 'çªƒå¬é£æš´', 'actor': 'ä¸»æ¼”ï¼šä¹Œå°”é‡Œå¸ŒÂ·ç©†åŸƒ,å¡å·´æ–¯è’‚å®‰Â·ç§‘èµ«,é©¬è’‚å¨œÂ·æ ¼å¾·å…‹', 'time': '2006-03-23(å¾·å›½)', 'score': '9.0', 'post_img': 'https://p0.meituan.net/movie/3985eaf3858bea0f2a3d966bf7ee2103178217.jpg@160w_220h_1e_1c'&#125;&#123;'index': '81', 'name': '7å·æˆ¿çš„ç¤¼ç‰©', 'actor': 'ä¸»æ¼”ï¼šæŸ³æ‰¿é¾™,éƒ‘é•‡è£,æœ´ä¿¡æƒ ', 'time': '2013-01-23(éŸ©å›½)', 'score': '8.9', 'post_img': 'https://p1.meituan.net/movie/6a6e74b2c289f9fa4433dd2dc04a7741331638.jpg@160w_220h_1e_1c'&#125;&#123;'index': '82', 'name': 'ææ€–ç›´æ’­', 'actor': 'ä¸»æ¼”ï¼šæ²³æ­£å®‡,æç’Ÿè£,æå¤§ä¸º', 'time': '2013-07-31(éŸ©å›½)', 'score': '8.8', 'post_img': 'https://p0.meituan.net/movie/b5ff0216e689b3fcc065590c48cd5105255305.jpg@160w_220h_1e_1c'&#125;&#123;'index': '83', 'name': 'æµ·è±šæ¹¾', 'actor': 'ä¸»æ¼”ï¼šé‡Œå…‹Â·å¥¥å·´ç‘,è·¯æ˜“Â·è¥¿éœå°¤æ–¯,å“ˆè¿ªÂ·ç¼æ–¯', 'time': '2009-07-31(ç¾å›½)', 'score': '8.9', 'post_img': 'https://p0.meituan.net/movie/7373dbba07b50ce6f24336edb96b2ea4271536.jpg@160w_220h_1e_1c'&#125;&#123;'index': '84', 'name': 'å¿ çŠ¬å…«å…¬ç‰©è¯­', 'actor': 'ä¸»æ¼”ï¼šä»²ä»£è¾¾çŸ¢,æ˜¥å·çœŸæ¾„,äº•å·æ¯”ä½å¿—', 'time': '1987-08-01(æ—¥æœ¬)', 'score': '9.0', 'post_img': 'https://p1.meituan.net/movie/c835b3588d0061ed3b992388a0a96f15160913.jpg@160w_220h_1e_1c'&#125;&#123;'index': '85', 'name': 'ä¸Šå¸ä¹‹åŸ', 'actor': 'ä¸»æ¼”ï¼šäºšå†æ¡‘å¾·é›·Â·ç½—å¾·é‡Œæ ¼æ–¯,è‰¾è‰ä¸Â·å¸ƒæ‹‰åŠ ,è±å®‰å¾·é²Â·è²å°”ç±³è¯º', 'time': '2002-08-30(å·´è¥¿)', 'score': '8.9', 'post_img': 'https://p1.meituan.net/movie/b553d13f30100db731ab6cf45668e52d94703.jpg@160w_220h_1e_1c'&#125;&#123;'index': '86', 'name': 'è¾©æŠ¤äºº', 'actor': 'ä¸»æ¼”ï¼šå®‹åº·æ˜Š,éƒ­åº¦æ²…,å´è¾¾æ´™', 'time': '2013-12-18(éŸ©å›½)', 'score': '8.8', 'post_img': 'https://p0.meituan.net/movie/8fabf3894b7d12d3d2f6e66404813670265761.jpg@160w_220h_1e_1c'&#125;&#123;'index': '87', 'name': 'ç¾å›½å¾€äº‹', 'actor': 'ä¸»æ¼”ï¼šç½—ä¼¯ç‰¹Â·å¾·å°¼ç½—,è©¹å§†æ–¯Â·ä¼å…¹,ä¼Šä¸½èç™½Â·éº¦æˆˆæ–‡', 'time': '2015-04-23', 'score': '9.1', 'post_img': 'https://p1.meituan.net/movie/92198a6fc8c3f5d13aa1bdf203572c0f99438.jpg@160w_220h_1e_1c'&#125;&#123;'index': '88', 'name': 'å®Œç¾çš„ä¸–ç•Œ', 'actor': 'ä¸»æ¼”ï¼šå‡¯æ–‡Â·ç§‘æ–¯ç‰¹çº³,å…‹æ—ç‰¹Â·ä¼Šæ–¯ç‰¹ä¼å¾·,TÂ·JÂ·åŠ³ç‘Ÿ', 'time': '1993-11-24(ç¾å›½)', 'score': '8.9', 'post_img': 'https://p1.meituan.net/movie/30310858fdab34c7a17cfd7ec8ad8bfc112201.jpg@160w_220h_1e_1c'&#125;&#123;'index': '89', 'name': 'ä¸ƒæ­¦å£«', 'actor': 'ä¸»æ¼”ï¼šä¸‰èˆ¹æ•éƒ,å¿—æ‘ä¹”,åƒç§‹å®', 'time': '1954-04-26(æ—¥æœ¬)', 'score': '9.1', 'post_img': 'https://p1.meituan.net/movie/4ffca83fd972f71e291f8ea8d78a4b58594878.jpg@160w_220h_1e_1c'&#125;&#123;'index': '90', 'name': 'ä¸€ä¸€', 'actor': 'ä¸»æ¼”ï¼šå´å¿µçœŸ,é‡‘ç‡•ç²,æå‡¯è‰', 'time': '2000-09-20(æ³•å›½)', 'score': '8.9', 'post_img': 'https://p1.meituan.net/movie/2c0a5fedf4b43d142121b91c6ccabe1b59051.jpg@160w_220h_1e_1c'&#125;&#123;'index': '91', 'name': 'è‹±é›„æœ¬è‰²', 'actor': 'ä¸»æ¼”ï¼šç‹„é¾™,å¼ å›½è£,å‘¨æ¶¦å‘', 'time': '2017-11-17', 'score': '9.2', 'post_img': 'https://p0.meituan.net/movie/3e5f5f3aa4b7e5576521e26c2c7c894d253975.jpg@160w_220h_1e_1c'&#125;&#123;'index': '92', 'name': 'é˜¿é£æ­£ä¼ ', 'actor': 'ä¸»æ¼”ï¼šå¼ å›½è£,å¼ æ›¼ç‰,åˆ˜å¾·å', 'time': '2018-06-25', 'score': '8.8', 'post_img': 'https://p0.meituan.net/movie/885fc379c614a2b4175587b95ac98eb95045650.jpg@160w_220h_1e_1c'&#125;&#123;'index': '93', 'name': 'çˆ±Â·å›å®¶', 'actor': 'ä¸»æ¼”ï¼šä¿æ‰¿è±ª,é‡‘è‰ºèŠ¬,ç«¥å­ç†™', 'time': '2002-04-05(éŸ©å›½)', 'score': '9.0', 'post_img': 'https://p1.meituan.net/movie/36a893c53a13f9bb934071b86ae3b5c492427.jpg@160w_220h_1e_1c'&#125;&#123;'index': '94', 'name': 'æµ·æ´‹', 'actor': 'ä¸»æ¼”ï¼šé›…å…‹Â·è´æ±‰,å§œæ–‡,å…°æ–¯æ´›ç‰¹Â·ä½©æ—', 'time': '2011-08-12', 'score': '9.0', 'post_img': 'https://p0.meituan.net/movie/0018b57299d0d4540330a31244c880a9112971.jpg@160w_220h_1e_1c'&#125;&#123;'index': '95', 'name': 'æˆ‘çˆ±ä½ ', 'actor': 'ä¸»æ¼”ï¼šå®‹åœ¨æµ©,æé¡ºæ‰,å°¹ç§€æ™¶', 'time': '2011-02-17(éŸ©å›½)', 'score': '9.0', 'post_img': 'https://p1.meituan.net/movie/ed50b58bf636d207c56989872a91f4cf305138.jpg@160w_220h_1e_1c'&#125;&#123;'index': '96', 'name': 'é»„é‡‘ä¸‰é•–å®¢', 'actor': 'ä¸»æ¼”ï¼šå…‹æ—ç‰¹Â·ä¼Šæ–¯ç‰¹ä¼å¾·,æÂ·èŒƒÂ·å…‹é‡Œå¤«,åŸƒé‡ŒÂ·ç“¦æ‹‰èµ«', 'time': '1966-12-23(æ„å¤§åˆ©)', 'score': '8.9', 'post_img': 'https://p0.meituan.net/movie/cd18ed2c5cda9e71e17e5e6ef61ced172912303.jpg@160w_220h_1e_1c'&#125;&#123;'index': '97', 'name': 'è¿å¾™çš„é¸Ÿ', 'actor': 'ä¸»æ¼”ï¼šé›…å…‹Â·è´æ±‰,Philippe Labro', 'time': '2001-12-12(æ³•å›½)', 'score': '9.1', 'post_img': 'https://p1.meituan.net/movie/a1634f4e49c8517ae0a3e4adcac6b0dc43994.jpg@160w_220h_1e_1c'&#125;&#123;'index': '98', 'name': 'åƒä¸åƒå¯»', 'actor': 'ä¸»æ¼”ï¼šæŸŠç‘ ç¾,å‘¨å†¬é›¨,å…¥é‡è‡ªç”±', 'time': '2019-06-21', 'score': '9.3', 'post_img': 'https://p0.meituan.net/movie/30b20139e68c46d02e0893277d633b701292458.jpg@160w_220h_1e_1c'&#125;&#123;'index': '99', 'name': 'å¤©å ‚ç”µå½±é™¢', 'actor': 'ä¸»æ¼”ï¼šè²åˆ©æµ¦Â·è¯ºç“¦é›·,èµ›å°”ä¹”Â·å¡æ–¯ç‰¹åˆ©æ‰˜,è’‚å…¹äºšå¨œÂ·ç½—è¾¾æ‰˜', 'time': '2019-06-15', 'score': '9.2', 'post_img': 'https://p0.meituan.net/movie/76fc92cfa6c8f2959431b8aa604ef7ae126414.jpg@160w_220h_1e_1c'&#125;&#123;'index': '100', 'name': 'é¾™çŒ«', 'actor': 'ä¸»æ¼”ï¼šç§¦å²š,ç³¸äº•é‡é‡Œ,å²›æœ¬é¡»ç¾', 'time': '2018-12-14', 'score': '9.1', 'post_img': 'https://p0.meituan.net/movie/c304c687e287c7c2f9e22cf78257872d277201.jpg@160w_220h_1e_1c'&#125; æ€»ç»“å…¶å®è¿˜å¯ä»¥åˆ©ç”¨å…¶ä»–è§£æåº“è¿›è¡Œè§£æï¼Œæ¯”å¦‚Beautiful Soup 4å’ŒPyQueryåº“,è¿™ä¸¤ä¸ªåº“ç›¸æ¯”æ­£åˆ™å’ŒXpathè§£æè½»å·§ç®€å•ï¼Œä½†æ˜¯ç›¸æ¯”ä¹‹ä¸‹æ€§èƒ½ä¼šæœ‰æ‰€ç‰ºç‰²ã€‚ Beautiful Soup 4 è§£æåº“å¯¹XMlæ–‡æ¡£çš„å®½å®¹åº¦ä¸å¥½ï¼Œåœ¨å½“ä¸‹çš„äº’è”ç½‘ç¯å¢ƒä¸‹ï¼Œç½‘ç«™ç»“æ„å¼€å‘ã€å‡çº§å’Œç»´æŠ¤å˜çš„å¾ˆå¤æ‚ï¼Œå¯¹äºä¸€äº›ä¸è§„èŒƒçš„ç½‘ç«™è€Œè¨€ï¼Œè§£æä¼šæœ‰é—®é¢˜ï¼Œè€Œlxmlè§£å†³äº†è¯¥é—®é¢˜ã€‚å¦å¤–ï¼Œ Beautiful Soup 4 è§£ææ—¶å€™ä¼šå°†æ‰€æœ‰çš„XMlèŠ‚ç‚¹åŠ è½½åˆ°å†…å­˜ä¸­å½¢æˆDOMæ ‘ï¼Œæ€§èƒ½ç›¸æ¯”æ­£åˆ™ä¸‹é™äº†å¾ˆå¤šã€‚ PyQueryè§£æåº“ï¼Œå…¶å®è¯­æ³•ç»“æ„å…¶å®å°±æ˜¯ç”±JavaScriptçš„JQueryåº“æ¼”å˜è€Œæ¥çš„ï¼Œè¯¥åº“CSSé€‰æ‹©å™¨æ”¯æŒæ€§ç‰¹åˆ«å¥½ï¼Œç†Ÿç»ƒä½¿ç”¨JQueryçš„æœ‹å‹ä¹Ÿå¿…å®šä¼šä½¿ç”¨è¯¥ä¼šã€‚ å› ä¸ºæˆ‘æœ¬äººä¸å–œæ¬¢ç”¨è¿™ä¸ªBeautiful Soup 4 åº“ï¼Œæ‰€ä»¥ä¸æ‰“ç®—æ·±å…¥ç ”ç©¶ï¼Œå¦å¤–,PyQueryå’ŒJQueryæ“ä½œç±»ä¼¼ï¼Œæˆ‘åœ¨æœ¬æ–‡ä¹Ÿä¸åšç´¯è¿°ã€‚è‹¥æœ‰è¯»è€…å¯¹è¯¥åº“æ„Ÿå…´è¶£å¯è‡ªè¡Œç ”ç©¶ã€‚","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Python","slug":"Python","permalink":"http://ltyeamin.github.io/tags/Python/"}]},{"title":"Nginxè®¾ç½®é»‘ç™½åå•","slug":"Nginxè®¾ç½®é»‘ç™½åå•","date":"2019-09-02T10:15:00.000Z","updated":"2019-11-20T15:08:56.125Z","comments":true,"path":"2019/09/02/Nginxè®¾ç½®é»‘ç™½åå•/","link":"","permalink":"http://ltyeamin.github.io/2019/09/02/Nginxè®¾ç½®é»‘ç™½åå•/","excerpt":"","text":"åœ¨æ—¥å¸¸è¿ç»´å·¥ä½œä¸­ï¼Œä¼šç¢°åˆ°è¿™æ ·çš„éœ€æ±‚ï¼Œå¯¹äºä¸€äº›httpè¯·æ±‚åªå¯¹æŸäº›ipå¼€å‘ï¼Œå…¶ä»–çš„ipçš„å®¢æˆ·ç«¯éƒ½ä¸èƒ½è®¿é—®ã€‚ åœ¨æµ‹è¯•ä¹‹å‰æˆ‘åˆ—ä¸€ä¸‹æœ¬æ¬¡æµ‹è¯•çš„ç»ˆç«¯IPã€‚ å®¿ä¸»æœºDeepin Linux ï¼š 192.168.1.106 è™šæ‹ŸæœºWindows 10 : 192.168.1.107 ç§»åŠ¨Androidç»ˆç«¯æœº MIUI10: 192.168.1.100 Nginxæ˜¯åœ¨Deepinéƒ¨ç½²çš„ï¼Œç°åœ¨æˆ‘ä»¬å¯åŠ¨Nginx 12cd /usr/local/nginx/sbin./nginx 1å¯åŠ¨åï¼Œåœ¨å®¿ä¸»æœºéšä¾¿è®¿é—®ä¸€ä¸ªè¯·æ±‚(è¿™é‡Œæ˜¯æˆ‘ä¹‹å‰æ–‡ç« é…ç½®çš„é™æ€å›¾ç‰‡èµ„æºçš„è½¬å‘)ï¼Œæ¯”å¦‚http://127.0.0.1æˆ–http://192.168.1.106 æ­¤å¤–ï¼Œæˆ‘ä»¬ç”¨Androidæ‰‹æœºå’ŒWindows 10è™šæ‹ŸæœºåŒæ ·è®¿é—®http://192.168.1.106ä¹Ÿèƒ½è®¿é—®åˆ°ï¼Œæ‰‹æœºå’Œå®¿ä¸»æœºæ˜¯åŒä¸€ä¸ªè·¯ç”±å™¨ï¼Œè€Œè™šæ‹Ÿæœºç½‘ç»œæ˜¯æ¡¥æ¥æ¨¡å¼ã€‚æ‰€ä»¥æ˜¯åœ¨åŒä¸€å±€åŸŸç½‘éƒ½èƒ½å¤Ÿäº’é€šã€‚ æˆ‘ä»¬è®©æ‰‹æœºæ— æ³•è®¿é—®ï¼Œè®©è™šæ‹Ÿæœºå¯ä»¥é€šè¿‡ã€‚ åˆ©ç”¨allowã€denyå‚æ•°è¿›è¡Œè®¿é—®é™åˆ¶ æ›´æ”¹nginx.confã€‚ 12345678location / &#123; deny 192.168.1.100; #ç¦æ­¢IPä¸º192.168.1.100è®¿é—® allow all; # é™¤è¿‡ä¸Šè¿°é»‘åå•çš„é™åˆ¶å¤–ï¼Œå…è®¸å…¶ä»–IPè®¿é—® autoindex on; #å¼€å¯ç´¢å¼•åŠŸèƒ½ autoindex_exact_size off; # å…³é—­è®¡ç®—æ–‡ä»¶ç¡®åˆ‡å¤§å°ï¼ˆå•ä½bytesï¼‰ï¼Œåªæ˜¾ç¤ºå¤§æ¦‚å¤§å°ï¼ˆå•ä½kbã€mbã€gbï¼‰ autoindex_localtime on; # æ˜¾ç¤ºæœ¬æœºæ—¶é—´è€Œé GMT æ—¶é—´ &#125; é‡æ–°åŠ è½½é…ç½®ã€‚ 1sudo ./nginx -s reload é»‘åå•é™åˆ¶æ•ˆæœã€‚","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"Nginx","slug":"Nginx","permalink":"http://ltyeamin.github.io/tags/Nginx/"}]},{"title":"Deepin Linuxå®‰è£…Docker","slug":"Deepin Linuxå®‰è£…Docker","date":"2019-09-01T04:45:00.000Z","updated":"2019-09-13T02:55:05.743Z","comments":true,"path":"2019/09/01/Deepin Linuxå®‰è£…Docker/","link":"","permalink":"http://ltyeamin.github.io/2019/09/01/Deepin Linuxå®‰è£…Docker/","excerpt":"","text":"æ™®é€šå®‰è£…ä¸€èˆ¬çš„Linux(Debianã€Unbantu)å‘è¡Œç‰ˆå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š 1wget -qO- https://get.docker.com/ | sh ä½†æ˜¯åœ¨Deepinæ‰§è¡Œè¿™å‘½ä»¤ä¼šå®‰è£…å¤±è´¥ã€‚ æŸ¥é˜…èµ„æ–™å¯ä»¥æ‰¾åˆ°dockeræ”¯æŒçš„Linuxå‘è¡Œç‰ˆã€‚ 123456789101112131415161718192021222324252627282930313233343536x86_64-centos-7x86_64-fedora-28x86_64-fedora-29x86_64-debian-jessiex86_64-debian-stretchx86_64-debian-busterx86_64-ubuntu-trustyx86_64-ubuntu-xenialx86_64-ubuntu-bionicx86_64-ubuntu-cosmics390x-ubuntu-xenials390x-ubuntu-bionics390x-ubuntu-cosmicppc64le-ubuntu-xenialppc64le-ubuntu-bionicppc64le-ubuntu-cosmicaarch64-ubuntu-xenialaarch64-ubuntu-bionicaarch64-ubuntu-cosmicaarch64-debian-jessieaarch64-debian-stretchaarch64-debian-busteraarch64-fedora-28aarch64-fedora-29aarch64-centos-7armv6l-raspbian-jessiearmv7l-raspbian-jessiearmv6l-raspbian-stretcharmv7l-raspbian-stretcharmv7l-debian-jessiearmv7l-debian-stretcharmv7l-debian-busterarmv7l-ubuntu-trustyarmv7l-ubuntu-xenialarmv7l-ubuntu-bionicarmv7l-ubuntu-cosmic æŸ¥çœ‹äº†æˆ‘çš„ç³»ç»Ÿçš„ç‰ˆæœ¬ï¼š 123456litong@LT:~$ cat /etc/issueDeepin GNU/Linux 15.10.2 \\n \\llitong@LT:~$ cat /etc/debian_version 9.0litong@LT:~$ uname -r4.15.0-29deepin-generic è¿™é‡Œæˆ‘çš„ç³»ç»Ÿæ˜¯Deepin 15.10.2ï¼Œè€Œæˆ‘çš„Deepin Linuxæ˜¯åŸºäºDebian 9.0ï¼Œå³ä¸Šè¿°çš„ç‰ˆæœ¬x86_64-debian-stretchè¿›è¡Œçš„æ·±åº¦å¼€å‘ï¼Œæˆ‘ç³»ç»ŸDebian 9.0æ˜¯sidç‰ˆçš„ï¼Œå¹¶ä¸æ˜¯releaseç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¸æ˜¯dockerå®˜æ–¹è®¤è¯çš„stableç‰ˆæœ¬ï¼Œæ•…ä¸æ”¯æŒDeepin Linuxã€‚ Deepinä¸Šå®‰è£…Docker è‹¥ä»¥å‰å®‰è£…è¿‡æ—§ç‰ˆæœ¬åˆ™å…ˆå¸è½½æ—§ç‰ˆæœ¬ï¼Œå¦‚æ²¡æœ‰å®‰è£…è¿‡ï¼Œåˆ™è·³è¿‡ï¼› 1sudo apt-get remove docker.io docker-engine å®‰è£…docker-ceä¸å¯†é’¥ç®¡ç†ä¸ä¸‹è½½ç›¸å…³ä¾èµ–å·¥å…·ï¼› 1sudo apt-get install apt-transport-https ca-certificates curl python-software-properties software-properties-common ä¸‹è½½å¹¶å®‰è£…å¯†åŒ™å¹¶éªŒè¯ç§˜é’¥ï¼Œè‹¥æˆåŠŸåˆ™è¿”å›OKï¼› 1curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add - å¦‚æœä¸æˆåŠŸï¼ˆdockerå®˜æ–¹åœ¨å¢™å¤–ï¼Œéœ€ç§‘å­¦ä¸Šç½‘ï¼‰ï¼Œåˆ™ä½¿ç”¨å›½å†…é•œåƒæºå°†ä¸Šè¿°å‘½ä»¤æ¢æˆ 1curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/debian/gpg | sudo apt-key add - éªŒè¯ç§˜é’¥æ˜¯å¦å®‰è£…æˆåŠŸï¼› 123456litong@LT:~$ sudo apt-key fingerprint 0EBFCD88[sudo] litong çš„å¯†ç ï¼špub rsa4096 2017-02-22 [SCEA] 9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88uid [ æœªçŸ¥ ] Docker Release (CE deb) &lt;docker@docker.com&gt;sub rsa4096 2017-02-22 [S] å®‰è£…docker-ceç»„ä»¶ï¼› 1sudo apt-get install docker-ce æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸï¼› 123456789101112131415161718192021222324252627litong@LT:~$ docker versionClient: Docker Engine - Community Version: 19.03.2 API version: 1.40 Go version: go1.12.8 Git commit: 6a30dfca03 Built: Thu Aug 29 05:29:49 2019 OS/Arch: linux/amd64 Experimental: falseServer: Docker Engine - Community Engine: Version: 19.03.2 API version: 1.40 (minimum version 1.12) Go version: go1.12.8 Git commit: 6a30dfca03 Built: Thu Aug 29 05:28:23 2019 OS/Arch: linux/amd64 Experimental: false containerd: Version: 1.2.6 GitCommit: 894b81a4b802e4eb2a91d1ce216b8817763c29fb runc: Version: 1.0.0-rc8 GitCommit: 425e105d5a03fabd737a126ad93d62a9eeede87f docker-init: Version: 0.18.0 GitCommit: fec3683 æ™®é€šç”¨æˆ·è¿è¡Œdocker å®‰è£…dockerå®Œæˆåï¼Œæ™®é€šç”¨æˆ·æ‰§è¡Œdockerå‘½ä»¤æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°é”™è¯¯æç¤ºï¼š 1Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.26/images/json: dial unix /var/run/docker.sock: connect: permission denied é€šè¿‡æŸ¥é˜…èµ„æ–™ï¼Œåœ¨docker mannualæ‰¾åˆ°è§£å†³æ€è·¯ï¼š Manage Docker as a non-root userThe docker daemon binds to a Unix socket instead of a TCP port. By default that Unix socket is owned by the user root and other users can only access it using sudo. The docker daemon always runs as the root user.If you donâ€™t want to use sudo when you use the docker command, create a Unix group called docker and add users to it. When the docker daemon starts, it makes the ownership of the Unix socket read/writable by the docker group. å¤§æ¦‚ç¿»è¯‘äº†ä¸€ä¸‹ï¼Œæ„æ€æ˜¯ï¼šDockerè¿›ç¨‹ä½¿ç”¨Unix Socketè€Œä¸æ˜¯TCPç«¯å£ã€‚è€Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒUnix socketå±äºrootç”¨æˆ·ï¼Œéœ€è¦rootæƒé™æ‰èƒ½è®¿é—®ã€‚ è§£å†³æ–¹æ¡ˆï¼š dockerå®ˆæŠ¤è¿›ç¨‹å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šé»˜è®¤èµ‹äºˆåå­—ä¸ºdockerçš„ç”¨æˆ·ç»„è¯»å†™Unix socketçš„æƒé™ï¼Œå› æ­¤åªè¦åˆ›å»ºdockerç”¨æˆ·ç»„ï¼Œå¹¶å°†å½“å‰ç”¨æˆ·åŠ å…¥åˆ°dockerç”¨æˆ·ç»„ä¸­ï¼Œé‚£ä¹ˆå½“å‰ç”¨æˆ·å°±æœ‰æƒé™è®¿é—®Unix socketäº†ï¼Œè¿›è€Œä¹Ÿå°±å¯ä»¥æ‰§è¡Œdockerç›¸å…³å‘½ä»¤ã€‚ æ·»åŠ dockerç”¨æˆ·ç»„ï¼Œè‹¥å·²ç”±dockerç»„åˆ™è·³è¿‡ï¼› 1sudo groupadd docker å°†ç™»é™†ç”¨æˆ·åŠ å…¥åˆ°dockerç”¨æˆ·ç»„ä¸­ï¼› 1sudo gpasswd -a $USER docker æ›´æ–°ç”¨æˆ·ç»„ï¼› 1newgrp docker æµ‹è¯•dockerå‘½ä»¤æ˜¯å¦å¯ä»¥ä½¿ç”¨sudoæ­£å¸¸ä½¿ç”¨ã€‚ 1docker ps ä½¿ç”¨é˜¿é‡Œäº‘dockeré•œåƒåŠ é€Ÿ è¿›å…¥é˜¿é‡Œäº‘æ§åˆ¶å°ï¼Œé€‰æ‹©å®¹å™¨é•œåƒæœåŠ¡ï¼Œå·¦è¾¹èœå•æœ€ä¸‹æ–¹çš„é•œåƒä¸­å¿ƒ-é•œåƒåŠ é€Ÿå™¨ï¼› æ ¹æ®é˜¿é‡Œäº‘æ“ä½œæ–‡æ¡£é€‰æ‹©ä¸åŒç³»ç»Ÿçš„é•œåƒåŠ é€Ÿå‘½ä»¤ï¼› 12345678sudo mkdir -p /etc/dockersudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'&#123; \"registry-mirrors\": [\"æ›¿æ¢ä½ çš„åŠ é€Ÿå™¨åœ°å€\"]&#125;EOFsudo systemctl daemon-reloadsudo systemctl restart docker","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"http://ltyeamin.github.io/tags/Docker/"}]},{"title":"ç™¾åº¦ç½‘ç›˜ç ´é€Ÿè§£å†³","slug":"ç™¾åº¦ç½‘ç›˜ç ´é€Ÿè§£å†³","date":"2019-08-11T14:22:13.000Z","updated":"2019-11-20T15:09:00.757Z","comments":true,"path":"2019/08/11/ç™¾åº¦ç½‘ç›˜ç ´é€Ÿè§£å†³/","link":"","permalink":"http://ltyeamin.github.io/2019/08/11/ç™¾åº¦ç½‘ç›˜ç ´é€Ÿè§£å†³/","excerpt":"","text":"ä»Šå¤©åœ¨å®¶ä¸‹è½½ä¸€ä¸ªåˆ«äººç»™æˆ‘çš„ç™¾åº¦ç½‘ç›˜èµ„æ–™ï¼Œèµ„æ–™å¤§å°å·®ä¸å¤š2ä¸ªG,ä½†æ˜¯æ‰“å¼€æµè§ˆå™¨å‘ç°æœ‰ä¸€ä»¶æ˜¯éå¸¸çƒ¦èºçš„äº‹æƒ…:å°æ–‡ä»¶å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ç«¯è¿›è¡Œä¸‹è½½,ä½†æ˜¯å¤§æ–‡ä»¶å¿…é¡»ä¸‹è½½ç™¾åº¦ç½‘ç›˜å®¢æˆ·ç«¯è¿›è¡Œä¸‹è½½. æ²¡åŠæ³•,æˆ‘åªå¥½å»åº”ç”¨å•†åº—å»ä¸‹è½½ç™¾åº¦ç½‘ç›˜å®¢æˆ·ç«¯,åœ¨æ·±åº¦åº”ç”¨å•†åº—è¿˜å¥½æ‰¾åˆ°äº†ç™¾åº¦ç½‘ç›˜çš„å®¢æˆ·ç«¯(å›½äº§Deepinç³»ç»Ÿç¬¬ä¸‰æ–¹è½¯ä»¶æºè¿˜æ˜¯æ¯”è¾ƒç»™åŠ›)ã€‚ç´§æ¥ç€æˆ‘å°±åœ¨å®¢æˆ·ç«¯ç«¯ç™»å½•ä¸‹è½½,å¦‚ä¸‹å›¾: ç”¨äº†å®¢æˆ·ç«¯ä¹‹åå‘ç°,ä¸‹è½½é€Ÿåº¦ç‰¹åˆ«æ…¢,äºæ˜¯åœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸€äº›è§£å†³æ–¹æ¡ˆ:æµè§ˆå™¨æ’ä»¶+ç¬¬ä¸‰æ–¹ç½‘ç»œä¸‹è½½å·¥å…·(Motrix/Aria2)è¿›è¡Œä¸‹è½½.æˆ‘è¿™é‡Œé‡‡ç”¨Motrixæ–¹å¼,Aria2çš„æ–¹å¼è¯»è€…å¯è‡ªè¡Œç ”ç©¶å®‰è£…ä¸ä½¿ç”¨ã€‚ å®‰è£…ä¸è®¾ç½® å®‰è£…æµè§ˆå™¨æ’ä»¶ Motrix:åœ¨Chromeæµè§ˆå™¨åº”ç”¨å•†åº—æœç´¢ç™¾åº¦ç½‘ç›˜åŠ©æ‰‹å¹¶ä¸‹è½½å®‰è£…ã€‚ Aria2: åœ¨Chromeæµè§ˆå™¨åº”ç”¨å•†åº—æœç´¢YAAW for Chromeå¹¶ä¸‹è½½å®‰è£…ã€‚ ç½‘ç»œä¸‹è½½å·¥å…·å®‰è£… Motrix: ä¸‹è½½åœ°å€ Aria2:ä¸‹è½½åœ°å€ ä½¿ç”¨ä½“éªŒ æ€»ç»“ç”±ä¸Šå¯çŸ¥,ç™¾åº¦äº‘ç½‘ç›˜ç¡®å®åšäº†ç½‘é€Ÿé™åˆ¶ã€‚è™½ç„¶é€šè¿‡ç¬¬ä¸‰æ–¹ä¸‹è½½å·¥å…·æå‡äº†ä¸€äº›ä¸‹è½½é€Ÿåº¦,ä½†æ˜¯ä¸‹è½½è¿˜æ˜¯æœ‰ç‚¹æ…¢ï¼Œè¿™ä¸ªå…¶å®å¯ä»¥ç†è§£çš„ï¼Œå› ä¸ºå½“ä¸‹çš„ç½‘ç»œæ˜¯é•¿åŸå®½å¸¦ï¼Œæ…¢ä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"å®ç”¨å·¥å…·åŠæŠ€å·§","slug":"å®ç”¨å·¥å…·åŠæŠ€å·§","permalink":"http://ltyeamin.github.io/tags/å®ç”¨å·¥å…·åŠæŠ€å·§/"}]},{"title":"é­”éƒ½ä¸Šæµ·","slug":"é­”éƒ½ä¸Šæµ·","date":"2019-06-09T04:57:10.000Z","updated":"2019-11-20T15:09:02.024Z","comments":true,"path":"2019/06/09/é­”éƒ½ä¸Šæµ·/","link":"","permalink":"http://ltyeamin.github.io/2019/06/09/é­”éƒ½ä¸Šæµ·/","excerpt":"","text":"ä¸Šæµ·å®£ä¼ ç‰‡ const dp0 = new DPlayer({ container: document.getElementById('dplayer0'), screenshot: true, video: { url: 'http://q176n8af9.bkt.clouddn.com/videos/lvyou/shanghai2.mp4' }, subtitle: { url: 'webvtt.vtt' }, danmaku: { id: 'demo', api: 'https://api.prprpr.me/dplayer/' } }); const dp1 = new DPlayer({ container: document.getElementById('dplayer1'), screenshot: true, video: { url: 'http://q176n8af9.bkt.clouddn.com/videos/lvyou/shanghai1.mp4' }, subtitle: { url: 'webvtt.vtt' }, danmaku: { id: 'demo', api: 'https://api.prprpr.me/dplayer/' } });","categories":[{"name":"others","slug":"others","permalink":"http://ltyeamin.github.io/categories/others/"}],"tags":[{"name":"è‡ªåª’ä½“","slug":"è‡ªåª’ä½“","permalink":"http://ltyeamin.github.io/tags/è‡ªåª’ä½“/"}]},{"title":"SambaæœåŠ¡å™¨æ­å»º","slug":"SambaæœåŠ¡å™¨æ­å»º","date":"2019-06-08T07:17:23.000Z","updated":"2019-11-20T15:08:55.207Z","comments":true,"path":"2019/06/08/SambaæœåŠ¡å™¨æ­å»º/","link":"","permalink":"http://ltyeamin.github.io/2019/06/08/SambaæœåŠ¡å™¨æ­å»º/","excerpt":"","text":"","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"Samba","slug":"Samba","permalink":"http://ltyeamin.github.io/tags/Samba/"}]},{"title":"è®°å½•ä¸€æ¬¡Mavenä¸­é…ç½®æ–‡ä»¶å°¾å›è½¦æ¢è¡Œå¼•å‘çš„é—®é¢˜","slug":"è®°å½•ä¸€æ¬¡Mavenä¸­é…ç½®æ–‡ä»¶å°¾å›è½¦æ¢è¡Œå¼•å‘çš„é—®é¢˜","date":"2019-06-04T14:22:13.000Z","updated":"2019-11-20T15:08:56.465Z","comments":true,"path":"2019/06/04/è®°å½•ä¸€æ¬¡Mavenä¸­é…ç½®æ–‡ä»¶å°¾å›è½¦æ¢è¡Œå¼•å‘çš„é—®é¢˜/","link":"","permalink":"http://ltyeamin.github.io/2019/06/04/è®°å½•ä¸€æ¬¡Mavenä¸­é…ç½®æ–‡ä»¶å°¾å›è½¦æ¢è¡Œå¼•å‘çš„é—®é¢˜/","excerpt":"","text":"é—®é¢˜æè¿°ä»Šå¤©æ‰“å¼€IDEAåŠ è½½é¡¹ç›®æ—¶ï¼Œå‘ç°ä¸€ä¸ªå¾ˆè¯¡å¼‚çš„é—®é¢˜ï¼šé¡¹ç›®ä¾èµ–åŠä»£ç æ²¡ä»»ä½•é—®é¢˜ï¼ŒMavenä¾èµ–æ£€æµ‹çº¢è‰²æ³¢æµªçº¿ä¾æ—§å­˜åœ¨ã€‚è™½è¯´é¡¹ç›®ä¾æ—§èƒ½è·‘èµ·æ¥ä¸å½±å“å¼€å‘ï¼Œä½†æ˜¯mavenå‘½ä»¤æ“ä½œç”¨ä¸äº†ã€‚ é‡åˆ°é—®é¢˜åï¼Œæˆ‘å¤§åƒä¸€æƒŠã€‚æ˜¨å¤©çœ‹é¡¹ç›®è¿˜å¥½å¥½çš„ï¼Œä»Šå¤©å°±æŠ¥å‡ºæŸä¸ªé¡¹ç›®ä¸€ä¸ªä¾èµ–åŒ…æ‰¾ä¸åˆ°ã€‚å¯å®é™…ä¸Šã€‚è¯¥ä¾èµ–åŒ…åœ¨æœ¬åœ°åº“æ˜¯å­˜åœ¨çš„ã€‚äºæ˜¯ï¼Œæˆ‘åˆ æ‰äº†ä¾èµ–åŒ…ï¼Œé‡æ–°è¿œç¨‹ä»“åº“ä¸‹è½½ã€‚ ç§æœå’Œä¸­å¤®ä»“åº“åˆ‡æ¢å¥½å‡ æ¬¡ï¼Œé‡æ–°ä¸‹è½½çš„ä¾èµ–åŒ…éƒ½æ˜¯å®Œæ•´æ²¡é—®é¢˜çš„ã€‚åŒæ ·Mavençš„Cleanæˆ–Installæ­é…ä½¿ç”¨å¤šæ¬¡ï¼Œè¿™è®©æˆ‘æ›´åŠ éƒé—·ï¼Œå¯»æ‰¾ç€è§£å†³æ–¹æ¡ˆã€‚ é—®é¢˜æ’æŸ¥ä¸è§£å†³è§£å†³ä¸€åœ¨é¡¹ç›®ä¸­çš„pom.xmlæ–‡ä»¶é‡ŒæŠŠçº¢è‰²æ³¢æµªçº¿çš„ä¾èµ–çº¿æ³¨é‡Šæ‰ï¼Œç„¶åé‡æ–°åŠ è½½ä¹‹åï¼Œå°±ä¸ä¼šå‡ºç°ã€‚ ç„¶åæ’¤é”€æ³¨é‡Šï¼Œç„¶ååŠ è½½å°±OKäº†ï¼Œç½‘ä¸Šä¸Šè¯´è¿™æ˜¯IDEAå¼€å‘å·¥å…·çš„BUGï¼Œè¿™è°æ™“å¾—ï¼Œå…ˆè¿™æ ·å¹²å§ã€‚ è§£å†³äºŒè§£å†³ä¸€è™½ç„¶è§£å†³äº†ä¾èµ–æ‰¾ä¸åˆ°çº¢è‰²æ³¢æµªçº¿é—®é¢˜ï¼Œä½†è¿˜æ˜¯é¢„ç•™ä¸€äº›é—®é¢˜ï¼Œé‚£å°±æ˜¯Mavençš„åŸºæœ¬å‘½ä»¤æ“ä½œç”¨ä¸äº†ã€‚æ¯”å¦‚æˆ‘ä½¿ç”¨äº†mvn cleanè¿›è¡Œæ“ä½œï¼Œæ§åˆ¶å°åˆ™æŠ¥å‡ºä¸€æ®µæ—¥å¿—: 12345D:\\applications\\develop\\JDK8\\bin\\java.exe -Dmaven.multiModuleProjectDirectory=E:\\work\\code\\cashloan-api -Dmaven.home=D:\\applications\\develop\\apache-maven-3.6.1 -Dclassworlds.conf=D:\\applications\\develop\\apache-maven-3.6.1\\bin\\m2.conf \"-javaagent:D:\\applications\\develop\\IntelliJ IDEA 2019.1.3\\lib\\idea_rt.jar=57134:D:\\applications\\develop\\IntelliJ IDEA 2019.1.3\\bin\" -Dfile.encoding=UTF-8 -classpath D:\\applications\\develop\\apache-maven-3.6.1\\boot\\plexus-classworlds-2.6.0.jar org.codehaus.classworlds.Launcher -Didea.version2019.1.3 -s D:\\applications\\develop\\apache-maven-3.6.1\\conf\\settings.xml -Dmaven.repo.local=D:\\applications\\develop\\apache-maven-3.6.1\\repo install[ERROR] Error executing Maven.[ERROR] 2 problems were encountered while building the effective settings[FATAL] Non-parseable settings D:\\applications\\develop\\apache-maven-3.6.1\\conf\\settings.xml: in epilog non whitespace content is not allowed but got j (position: END_TAG seen ...&lt;/settings&gt;\\n\\nj... @300:2) @ D:\\applications\\develop\\apache-maven-3.6.1\\conf\\settings.xml, line 300, column 2[FATAL] Non-parseable settings D:\\applications\\develop\\apache-maven-3.6.1\\conf\\settings.xml: in epilog non whitespace content is not allowed but got j (position: END_TAG seen ...&lt;/settings&gt;\\n\\nj... @300:2) @ D:\\applications\\develop\\apache-maven-3.6.1\\conf\\settings.xml, line 300, column 2 é€šè¿‡æ—¥å¿—æˆ‘è§‰å¾—Mavençš„é…ç½®æ–‡ä»¶settings.xmlæœ‰é—®é¢˜ï¼Œç¬¬300è¡Œç¬¬2åˆ—æœ‰ç–‘æƒ‘ã€‚ æˆ‘æ‰“å¼€settings.xmlsæ–‡ä»¶ï¼Œæ²¡æœ‰300è¡Œï¼ŒæŸ¥çœ‹å¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ä»”ç»†é˜…è¯»æ—¥å¿—END_TAG seen â€¦\\n\\njâ€¦ @300:2ï¼Œè¿™ä¸ªè®©æˆ‘æœ‰æ‰€å¯ç¤ºï¼ŒçŒœæµ‹æ˜¯æ¢è¡Œçš„é—®é¢˜ã€‚ Whatï¼Ÿxmlæ–‡ä»¶å°¾ä¸èƒ½æœ‰å›è½¦æ¢è¡Œï¼Œæˆ‘ä¸ä¿¡è¿™ä¸ªé‚ªï¼Œæˆ‘å°±å»è¯•è¯•ã€‚ è¯•äº†ä»¥åï¼Œæ‰çŸ¥é“çœŸçš„æ˜¯è¿™ä¸ªé—®é¢˜ã€‚è¯¥æ­»ï¼Œæƒ³äº†ä¸€ä¸‹ï¼Œè‡ªå·±ä»Šå¤©æ—©ä¸Šæ”¹åŠ¨è¿‡é…ç½®æ–‡ä»¶ï¼Œå¯èƒ½åœ¨ä¿å­˜ä¹‹å‰æ•²äº†å›è½¦ï¼ŒçœŸæ˜¯è¯¥æ­»ï¼ï¼ï¼ æ€»ç»“æœ‰å‘ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯å¦‚ä½•å»å¡«å‘ã€‚","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Maven","slug":"Maven","permalink":"http://ltyeamin.github.io/tags/Maven/"}]},{"title":"Windowsæœç´¢åˆ©å™¨","slug":"Windowsæœç´¢åˆ©å™¨","date":"2019-06-03T14:22:13.000Z","updated":"2019-11-20T15:09:00.464Z","comments":true,"path":"2019/06/03/Windowsæœç´¢åˆ©å™¨/","link":"","permalink":"http://ltyeamin.github.io/2019/06/03/Windowsæœç´¢åˆ©å™¨/","excerpt":"","text":"å‰å‡ å‘¨å¿™äºæ¢å·¥ä½œï¼Œåšå®¢æ²¡æœ‰å¤ªå¤šçš„æ›´æ–°ã€‚ä»Šå¤©åˆšå¥½å…¥èŒæ–°å…¬å¸çš„ç¬¬ä¸€å¤©ï¼ŒåŠå…¬ç”µè„‘æ˜¯å°å¼DELL+Intel i5ä¸ƒä»£(å››æ ¸å››çº¿ç¨‹ï¼Œä¸»é¢‘3.1HZï¼Œç¿é¢‘3.6HZ)+8G DDR4ã€‚ç¬”è€…å‰å…¬å¸åŠå…¬ç¯å¢ƒæ˜¯Mac Pro + Mac OS X 10ï¼Œå®¶é‡Œæ—¥å¸¸ç¯å¢ƒæ˜¯è”æƒ³Lenovo+Deepin Linuxã€‚å¯ä»¥è¯´å·²ç»ä¸€å¹´å¤šæ²¡æ¥è§¦Windowsç³»ç»Ÿäº†ï¼Œç°åœ¨ä½¿ç”¨èµ·æ¥å¤šå°‘æœ‰äº›ä¸ä¹ æƒ¯ï¼Œä¸»è¦æ˜¯å„ä¸ªæ“ä½œç³»ç»Ÿæ“ä½œç†å¿µä¸åŒã€‚ æˆ‘å‡ ä¹æ¯å¤©éƒ½åœ¨ä½¿ç”¨è®¡ç®—æœºè¿›è¡Œå·¥ä½œå’Œä¸ªäººç”Ÿæ´»ï¼Œé‚£ä¹ˆæˆ‘å¯èƒ½ä¼šåœ¨è®¡ç®—æœºä¸Šæ‹¥æœ‰å¤§é‡æ–‡ä»¶ï¼Œç…§ç‰‡ï¼Œæ–‡ä»¶å¤¹ï¼Œæ–‡æ¡£å’Œå…¶ä»–æ•°æ®ã€‚å¦‚æœæ‰¾åˆ°ä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶æ˜¯éå¸¸ç—›è‹¦çš„ã€‚å¹¸è¿çš„æ˜¯ï¼ŒMacä¸­çš„Spotlightæ¨¡å¼å¯è®©æˆ‘åœ¨Macä¸Šæœç´¢å‡ ä¹ä»»ä½•å†…å®¹ï¼Œä»è€Œè½»æ¾æ‰¾åˆ°æ‚¨éœ€è¦çš„ä»»ä½•å†…å®¹ã€‚å¦‚ä¸‹å›¾ï¼š æ­£æ˜¯å› ä¸ºä¹ æƒ¯äº†åœ¨Mac OS Xé€šè¿‡Spotlightæ¨¡å¼è¿›è¡Œæœç´¢åº”ç”¨ã€æ–‡ä»¶ï¼Œæ‰€ä»¥ä»Šå¤©è£…æœºçš„æ—¶å€™æ‰¾äº†ä¸€ä¸‹Windowsçš„æ›¿ä»£æ–¹æ¡ˆã€‚ æ–‡ä»¶æœç´¢ç¥å™¨-EverythingåŸºæœ¬ç®€ä»‹åŸºäºåç§°å¿«é€Ÿå®šä½æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚ è½»é‡å®‰è£…æ–‡ä»¶ å¹²å‡€ç®€æ´çš„ç”¨æˆ·ç•Œé¢ å¿«é€Ÿæ–‡ä»¶ç´¢å¼• å¿«é€Ÿæœç´¢ æœ€å°èµ„æºä½¿ç”¨ ä¾¿äºæ–‡ä»¶åˆ†äº« å®æ—¶æ›´æ–° æ›´å¤šâ€¦ ä¸­æ–‡å®˜ç½‘ ä¸‹è½½åœ°å€ ä¸­æ–‡æ–‡æ¡£ ä½¿ç”¨ä½“éªŒ Spotlightå¿«é€Ÿæ£€ç´¢æ›¿ä»£æ–¹æ¡ˆ-WoxåŸºæœ¬ç®€ä»‹Woxæ˜¯ä¸€æ¬¾å›½äº§å¼€æºå…è´¹çš„è½¯ä»¶å¿«æ·å¯åŠ¨å·¥å…·ï¼Œå®ƒå¯ä»¥å¿«é€Ÿæœç´¢å¹¶æ‰“å¼€ä½ ç”µè„‘ä¸Šçš„ç¨‹åºã€æ–‡ä»¶ã€æŸ¥è¯ç¿»è¯‘ã€ç½‘ç«™æŸ¥æ‰¾ç­‰å…¶ä»–æ“ä½œï¼ŒåŒæ—¶è¿˜æ”¯æŒæ’ä»¶å®‰è£…ã€‚ Tips: å¦‚æœä½ éœ€è¦ç”¨åˆ°æ–‡ä»¶çš„å¿«é€Ÿæœç´¢ã€æ‰“å¼€åŠŸèƒ½ï¼Œéœ€è¦é¢„å…ˆå®‰è£…Everythingã€‚ å®˜ç½‘ ä¸‹è½½åœ°å€ ä¸­æ–‡æ–‡æ¡£ Githubåœ°å€ ä½¿ç”¨ä½“éªŒå¯åŠ¨æ–¹å¼å¿«æ·é”®å¯åŠ¨æŒ‰ä¸‹ã€Alt+Spaceã€‘å³å¯ï¼Œå¯ä»¥åœ¨settingé‡Œè®¾ç½®ã€‚æˆ‘è®¾ç½®çš„å¿«æ·é”®è®¾ç½®ä¸ºã€Ctrl+Spaceã€‘,å’ŒMacå¿«æ·é”®ä¿æŒä¸€è‡´ã€‚ è®¾ç½®åˆšåˆšä½¿ç”¨Woxçš„ç”¨æˆ·ï¼Œå¸¸å¸¸ä¼šæ‰¾ä¸åˆ°Woxçš„è®¾ç½®é¡µé¢ã€‚ç›®å‰ï¼Œç”¨æˆ·æœ‰ä¸¤ç§æ–¹å¼æ‰“å¼€è®¾ç½®ç•Œé¢ï¼š é€šè¿‡settingå‘½ä»¤ï¼ˆæ¨èï¼‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç›´æ¥è¾“å…¥settingç„¶åé€‰æ‹©ç¬¬ä¸€é¡¹ï¼› é€šè¿‡å³é”®æ‰˜ç›˜å›¾æ ‡ã€‚ åœ¨settingé‡Œï¼Œå¯ä»¥è®¾ç½®ä¸»é¢˜ã€çª—å£è®¾ç½®ã€å¿«æ·é”®è®¾ç½®ã€æœç´¢è®¾ç½®ã€æ’ä»¶è®¾ç½®ï¼Œè¯»è€…å¯æ ¹æ®è‡ªèº«éœ€æ±‚è¿›è¡Œç›¸åº”çš„è®¾ç½®å³å¯ã€‚ åº”ç”¨æœç´¢ æµè§ˆå™¨æœç´¢ å‘½ä»¤ç»ˆç«¯æ‰§è¡Œæ›¿æ¢Windowsçš„å‘½ä»¤ç»ˆç«¯ï¼Œæ›¿æ¢Windowsé”®+Ré”®ã€‚","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"å®ç”¨å·¥å…·åŠæŠ€å·§","slug":"å®ç”¨å·¥å…·åŠæŠ€å·§","permalink":"http://ltyeamin.github.io/tags/å®ç”¨å·¥å…·åŠæŠ€å·§/"}]},{"title":"Spring Cloud-Feignä½¿ç”¨æ—¶è·å–apolloé…ç½®å¤±è´¥é—®é¢˜","slug":"Spring Cloud-Feignä½¿ç”¨æ—¶è·å–apolloé…ç½®å¤±è´¥é—®é¢˜","date":"2019-05-28T01:27:55.000Z","updated":"2019-05-29T14:03:53.000Z","comments":true,"path":"2019/05/28/Spring Cloud-Feignä½¿ç”¨æ—¶è·å–apolloé…ç½®å¤±è´¥é—®é¢˜/","link":"","permalink":"http://ltyeamin.github.io/2019/05/28/Spring Cloud-Feignä½¿ç”¨æ—¶è·å–apolloé…ç½®å¤±è´¥é—®é¢˜/","excerpt":"","text":"é—®é¢˜æè¿°ä»Šå¤©å‘ç°ä¸€ä¸ªå¾ˆè¯¡å¼‚çš„äº‹æƒ…ï¼Œå°±æ˜¯æœ¬åœ°å†™æ­»çš„FeignClientçš„urlå±æ€§é…ç½®è¿›è¡Œfeignè°ƒç”¨æ²¡é—®é¢˜ï¼Œä½†æ˜¯æŠŠé…ç½®è¿ç§»åˆ°Ctrip Apolloé…ç½®ä¸­å¿ƒfeignè°ƒç”¨å°±æœ‰é—®é¢˜ã€‚ ä»£ç ç‰‡æ®µ123456789101112131415@FeignClient(url = \"$&#123;api.service.baseUrl&#125;\",name = \"sms-service\")public interface SmsClient &#123; /** * å‘é€çŸ­ä¿¡éªŒè¯ç ,4ä½æ•°å­—,5åˆ†é’Ÿæœ‰æ•ˆ */ @PostMapping(\"xxxx/xxxxx\") ApiResult&lt;String&gt; sendSmsVerifyCode(String xxx, Integer xxx) ; /** * æ ¡éªŒçŸ­ä¿¡éªŒè¯ç  */ @PostMapping(\"xxxx/xxxxx\") ApiResult&lt;String&gt; checkSmsVerifyCode(String xxx, Integer codeType, String xxx) ;&#125; æŠ¥é”™æ—¥å¿—123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115feign.RetryableException: $&#123;api.service.baseUrl&#125; executing POST http://$&#123;api.service.baseUrl&#125;/xxx/xxx?xxx=18800009999&amp;xxx=8 at feign.FeignException.errorExecuting(FeignException.java:65) at feign.SynchronousMethodHandler.executeAndDecode(SynchronousMethodHandler.java:105) at feign.SynchronousMethodHandler.invoke(SynchronousMethodHandler.java:77) at feign.ReflectiveFeign$FeignInvocationHandler.invoke(ReflectiveFeign.java:102) at com.sun.proxy.$Proxy148.sendSmsVerifyCode(Unknown Source) at com.yimi.darwin.biz.open.copartner.service.impl.SmsServiceImpl.sendVerifyCode(SmsServiceImpl.java:33) at com.yimi.darwin.biz.open.copartner.controller.SmsController.sendVerifyCode(SmsController.java:62) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:209) at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:136) at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:102) at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:891) at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:797) at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:991) at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:925) at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:974) at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:877) at javax.servlet.http.HttpServlet.service(HttpServlet.java:665) at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:851) at javax.servlet.http.HttpServlet.service(HttpServlet.java:750) at io.undertow.servlet.handlers.ServletHandler.handleRequest(ServletHandler.java:74) at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:129) at org.springframework.boot.actuate.web.trace.servlet.HttpTraceFilter.doFilterInternal(HttpTraceFilter.java:90) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) at com.yimi.tools.filter.RequestAndResponseLoggingFilter.doFilterWrapped(RequestAndResponseLoggingFilter.java:55) at com.yimi.tools.filter.RequestAndResponseLoggingFilter.doFilterInternal(RequestAndResponseLoggingFilter.java:47) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) at org.springframework.web.filter.HttpPutFormContentFilter.doFilterInternal(HttpPutFormContentFilter.java:109) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) at org.springframework.cloud.sleuth.instrument.web.ExceptionLoggingFilter.doFilter(ExceptionLoggingFilter.java:48) at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) at brave.servlet.TracingFilter.doFilter(TracingFilter.java:86) at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:155) at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.filterAndRecordMetrics(WebMvcMetricsFilter.java:123) at org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter.doFilterInternal(WebMvcMetricsFilter.java:108) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) at io.undertow.servlet.core.ManagedFilter.doFilter(ManagedFilter.java:61) at io.undertow.servlet.handlers.FilterHandler$FilterChainImpl.doFilter(FilterHandler.java:131) at io.undertow.servlet.handlers.FilterHandler.handleRequest(FilterHandler.java:84) at io.undertow.servlet.handlers.security.ServletSecurityRoleHandler.handleRequest(ServletSecurityRoleHandler.java:62) at io.undertow.servlet.handlers.ServletChain$1.handleRequest(ServletChain.java:65) at io.undertow.servlet.handlers.ServletDispatchingHandler.handleRequest(ServletDispatchingHandler.java:36) at io.undertow.servlet.handlers.security.SSLInformationAssociationHandler.handleRequest(SSLInformationAssociationHandler.java:132) at io.undertow.servlet.handlers.security.ServletAuthenticationCallHandler.handleRequest(ServletAuthenticationCallHandler.java:57) at io.undertow.server.handlers.PredicateHandler.handleRequest(PredicateHandler.java:43) at io.undertow.security.handlers.AbstractConfidentialityHandler.handleRequest(AbstractConfidentialityHandler.java:46) at io.undertow.servlet.handlers.security.ServletConfidentialityConstraintHandler.handleRequest(ServletConfidentialityConstraintHandler.java:64) at io.undertow.security.handlers.AuthenticationMechanismsHandler.handleRequest(AuthenticationMechanismsHandler.java:60) at io.undertow.servlet.handlers.security.CachedAuthenticatedSessionHandler.handleRequest(CachedAuthenticatedSessionHandler.java:77) at io.undertow.security.handlers.AbstractSecurityContextAssociationHandler.handleRequest(AbstractSecurityContextAssociationHandler.java:43) at io.undertow.server.handlers.PredicateHandler.handleRequest(PredicateHandler.java:43) at io.undertow.server.handlers.PredicateHandler.handleRequest(PredicateHandler.java:43) at io.undertow.servlet.handlers.ServletInitialHandler.handleFirstRequest(ServletInitialHandler.java:292) at io.undertow.servlet.handlers.ServletInitialHandler.access$100(ServletInitialHandler.java:81) at io.undertow.servlet.handlers.ServletInitialHandler$2.call(ServletInitialHandler.java:138) at io.undertow.servlet.handlers.ServletInitialHandler$2.call(ServletInitialHandler.java:135) at io.undertow.servlet.core.ServletRequestContextThreadSetupAction$1.call(ServletRequestContextThreadSetupAction.java:48) at io.undertow.servlet.core.ContextClassLoaderSetupAction$1.call(ContextClassLoaderSetupAction.java:43) at io.undertow.servlet.handlers.ServletInitialHandler.dispatchRequest(ServletInitialHandler.java:272) at io.undertow.servlet.handlers.ServletInitialHandler.access$000(ServletInitialHandler.java:81) at io.undertow.servlet.handlers.ServletInitialHandler$1.handleRequest(ServletInitialHandler.java:104) at io.undertow.server.Connectors.executeRootHandler(Connectors.java:336) at io.undertow.server.HttpServerExchange$1.run(HttpServerExchange.java:830) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748)Caused by: java.net.UnknownHostException: $&#123;api.service.baseUrl&#125; at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:184) at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392) at java.net.Socket.connect(Socket.java:589) at sun.net.NetworkClient.doConnect(NetworkClient.java:175) at sun.net.www.http.HttpClient.openServer(HttpClient.java:463) at sun.net.www.http.HttpClient.openServer(HttpClient.java:558) at sun.net.www.http.HttpClient.&lt;init&gt;(HttpClient.java:242) at sun.net.www.http.HttpClient.New(HttpClient.java:339) at sun.net.www.http.HttpClient.New(HttpClient.java:357) at sun.net.www.protocol.http.HttpURLConnection.getNewHttpClient(HttpURLConnection.java:1220) at sun.net.www.protocol.http.HttpURLConnection.plainConnect0(HttpURLConnection.java:1156) at sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:1050) at sun.net.www.protocol.http.HttpURLConnection.connect(HttpURLConnection.java:984) at sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1564) at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1492) at java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:480) at feign.Client$Default.convertResponse(Client.java:150) at feign.Client$Default.execute(Client.java:72) at org.springframework.cloud.sleuth.instrument.web.client.feign.TracingFeignClient.execute(TracingFeignClient.java:91) at org.springframework.cloud.sleuth.instrument.web.client.feign.LazyTracingFeignClient.execute(LazyTracingFeignClient.java:55) at feign.SynchronousMethodHandler.executeAndDecode(SynchronousMethodHandler.java:98) ... 89 common frames omitted é—®é¢˜åˆ†æä¸è§£å†³æˆ‘ä»¬ä»æŠ¥é”™æ—¥å¿—å‘ç°ï¼Œapi.service.baseUrlè¿™ä¸ªé…ç½®æ³¨å…¥å¤±è´¥ã€‚ æˆ‘ä¸ºäº†éªŒè¯ï¼Œä¸“é—¨å†™ä¸€ä¸ªæµ‹è¯•æ¥å£ï¼ŒæŸ¥çœ‹é…ç½®åˆ°åº•æœ‰æ²¡æœ‰åŠ è½½ï¼š 1234567@Value(\"$&#123;api.service.baseUrl&#125;\")private String url;@GetMapping(\"/url\")public String getUrl() &#123; return url;&#125; é€šè¿‡è°ƒç”¨localhost:8301/urlï¼Œæ¥å£å“åº”äº†ç»“æœï¼šhttps://xxx.com/, æ­¤æ—¶ï¼Œæˆ‘ä»¬å‘ç°ï¼Œé¡¹ç›®ä¸­api.service.baseUrlå´èƒ½æ‹¿åˆ°å€¼ï¼Œè¯´æ˜æ•´ä¸ªé¡¹ç›®é…ç½®æ˜¯OKçš„ã€‚ ç´§æ¥ç€æˆ‘ä»¬å»apolloå®˜æ–¹çš„githubä¸Šæ‰¾ç­”æ¡ˆï¼Œä¹Ÿæ˜¯åœ¨å®˜æ–¹issueå’Œwikiæ‰¾åˆ°ç­”æ¡ˆçš„ã€‚ å½“é¡¹ç›®å¯åŠ¨æ—¶å€™ï¼Œä¼šæ‰«æ@FeignClientæ³¨è§£ï¼Œæ‰«æçš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ³¨å…¥urlçš„å€¼ã€‚ä½†æ­¤æ—¶apolloé…ç½®æ˜¯åœ¨Feignæ‰«æååŠ è½½çš„ï¼Œå…¶å®è§£å†³æ–¹æ¡ˆå°±æ˜¯è®©apolloå…ˆäºfeignçš„æ‰«æåŠ è½½ï¼Œå³apolloé…ç½®é¥¥é¥¿åŠ è½½ã€‚ 1234# will inject &apos;application&apos; namespace in bootstrap phaseapollo.bootstrap.enabled = true# put apollo initialization before logging system initializationapollo.bootstrap.eagerLoad.enabled=true Spring Booté™¤äº†æ”¯æŒä¸Šè¿°ä¸¤ç§é›†æˆæ–¹å¼ä»¥å¤–ï¼Œè¿˜æ”¯æŒé€šè¿‡application.properties/bootstrap.propertiesæ¥é…ç½®ï¼Œè¯¥æ–¹å¼èƒ½ä½¿é…ç½®åœ¨æ›´æ—©çš„é˜¶æ®µæ³¨å…¥ï¼Œæ¯”å¦‚ä½¿ç”¨@ConditionalOnPropertyçš„åœºæ™¯æˆ–è€…æ˜¯æœ‰ä¸€äº›spring-boot-starteråœ¨å¯åŠ¨é˜¶æ®µå°±éœ€è¦è¯»å–é…ç½®åšä¸€äº›äº‹æƒ…ï¼ˆå¦‚dubbo-spring-boot-projectï¼‰ï¼Œæ‰€ä»¥å¯¹äºSpring Bootç¯å¢ƒå»ºè®®é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥æ¥å…¥Apollo(éœ€è¦0.10.0åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰ã€‚ ä»1.2.0ç‰ˆæœ¬å¼€å§‹ï¼Œå¦‚æœå¸Œæœ›æŠŠæ—¥å¿—ç›¸å…³çš„é…ç½®ï¼ˆå¦‚logging.level.root=infoæˆ–logback-spring.xmlä¸­çš„å‚æ•°ï¼‰ä¹Ÿæ”¾åœ¨Apolloç®¡ç†ï¼Œé‚£ä¹ˆå¯ä»¥é¢å¤–é…ç½®apollo.bootstrap.eagerLoad.enabled=trueæ¥ä½¿Apolloçš„åŠ è½½é¡ºåºæ”¾åˆ°æ—¥å¿—ç³»ç»ŸåŠ è½½ä¹‹å‰ï¼Œä¸è¿‡è¿™ä¼šå¯¼è‡´Apolloçš„å¯åŠ¨è¿‡ç¨‹æ— æ³•é€šè¿‡æ—¥å¿—çš„æ–¹å¼è¾“å‡º(å› ä¸ºæ‰§è¡ŒApolloåŠ è½½çš„æ—¶å€™ï¼Œæ—¥å¿—ç³»ç»Ÿå‹æ ¹æ²¡æœ‰å‡†å¤‡å¥½å‘¢ï¼æ‰€ä»¥åœ¨Apolloä»£ç ä¸­ä½¿ç”¨Slf4jçš„æ—¥å¿—è¾“å‡ºä¾¿æ²¡æœ‰ä»»ä½•å†…å®¹)ï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒPR 1614ã€‚å‚è€ƒé…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š # will inject â€˜applicationâ€™ namespace in bootstrap phase apollo.bootstrap.enabled = true # put apollo initialization before logging system initialization apollo.bootstrap.eagerLoad.enabled=true å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ‚¨çš„apollo clientä¾èµ–ç‰ˆæœ¬æ˜¯1.1.0åŠä»¥ä¸‹çš„ï¼ŒåŠ äº†ä»¥ä¸Šçš„é…ç½®ï¼Œå‘ç°æ˜¯æ²¡æœ‰ç”¨çš„ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•æ‰‹åŠ¨å»åŠ è½½ã€‚ 12345678910111213import com.ctrip.framework.apollo.ConfigService;public class ClientUrlConfig &#123; public void init() &#123; this.initSet(\"æ­¤å¤„å†™ä½ éœ€è¦æå‰åˆå§‹åŒ–çš„key\"); &#125; private void initSet(String... keys) &#123; for (String key : keys) &#123; String val = ConfigService.getAppConfig().getProperty(key, null); System.setProperty(key, val); &#125; &#125;&#125; ç„¶ååœ¨SpringApplication.run() ä¹‹å‰åŠ è½½ 1234public static void main(String[] args) &#123; new ClientUrlConfig().init(); SpringApplication.run(Application.class, args);&#125; æ‰‹åŠ¨åŠ è½½åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ ${api.service.baseUrl}è¿›è¡ŒåŠ è½½ä»¥åŠFeignè°ƒç”¨äº†ã€‚","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://ltyeamin.github.io/tags/Spring-Cloud/"}]},{"title":"èŠèŠJavaé”çš„é‚£äº›äº‹","slug":"èŠèŠJavaé”çš„é‚£äº›äº‹","date":"2019-04-02T13:12:49.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2019/04/02/èŠèŠJavaé”çš„é‚£äº›äº‹/","link":"","permalink":"http://ltyeamin.github.io/2019/04/02/èŠèŠJavaé”çš„é‚£äº›äº‹/","excerpt":"","text":"æ˜¨å¤©æˆ‘ä»¬å­¦ä¹ äº†HashMapç›¸å…³çš„æºç ï¼Œæœ¬æ¥æ‰“ç®—ä»Šå¤©å†™ConcurrentHashMapæºç åˆ†æï¼Œä½†æ˜¯ConcurrentHashMapæ¶‰åŠåˆ°ä¸€äº›é”çš„æ¦‚å¿µï¼Œæ‰€ä»¥æˆ‘è§‰å¾—è¶Šæ˜¯åº•å±‚çš„ä¸œè¥¿ï¼Œè¶Šæ˜¯è¦å¥½å¥½ç ”ç©¶ä¸€ç•ªï¼Œä»Šå¤©è¶æ­¤æœºä¼šå¥½å¥½çš„ç³»ç»Ÿå­¦ä¹ ä¸€ä¸‹ã€‚ é‚£ä¹ˆä»Šå¤©å°±æ¥èŠèŠJavaé”çš„é‚£äº›äº‹æƒ…ã€‚Javaä¸ºæˆ‘ä»¬æä¾›äº†ç§ç±»ä¸°å¯Œçš„é”ï¼Œæ¯ç§é”å› å…¶ç‰¹æ€§çš„ä¸åŒï¼Œåœ¨é€‚å½“çš„åœºæ™¯ä¸‹èƒ½å¤Ÿå±•ç°å‡ºéå¸¸é«˜çš„æ•ˆç‡ã€‚æœ¬æ–‡æ—¨åœ¨å¯¹é”ç›¸å…³æºç ï¼ˆæœ¬æ–‡ä¸­çš„æºç æ¥è‡ªJDK 8å’ŒNetty 3.10.6ï¼‰ã€ä½¿ç”¨åœºæ™¯è¿›è¡Œä¸¾ä¾‹ï¼Œä¸ºè¯»è€…ä»‹ç»ä¸»æµé”çš„çŸ¥è¯†ç‚¹ï¼Œä»¥åŠä¸åŒçš„é”çš„é€‚ç”¨åœºæ™¯ã€‚ Javaä¸­å¾€å¾€æ˜¯æŒ‰ç…§æ˜¯å¦å«æœ‰æŸä¸€ç‰¹æ€§æ¥å®šä¹‰é”ï¼Œæˆ‘ä»¬é€šè¿‡ç‰¹æ€§å°†é”è¿›è¡Œåˆ†ç»„å½’ç±»ï¼Œå†ä½¿ç”¨å¯¹æ¯”çš„æ–¹å¼è¿›è¡Œä»‹ç»ï¼Œå¸®åŠ©å¤§å®¶æ›´å¿«æ·çš„ç†è§£ç›¸å…³çŸ¥è¯†ã€‚ä¸‹é¢ç»™å‡ºæœ¬æ–‡å†…å®¹çš„æ€»ä½“åˆ†ç±»ç›®å½•ï¼š ä¹è§‚é” VS æ‚²è§‚é”ä¹è§‚é”ä¸æ‚²è§‚é”æ˜¯ä¸€ç§å¹¿ä¹‰ä¸Šçš„æ¦‚å¿µï¼Œä½“ç°äº†çœ‹å¾…çº¿ç¨‹åŒæ­¥çš„ä¸åŒè§’åº¦ã€‚åœ¨Javaå’Œæ•°æ®åº“ä¸­éƒ½æœ‰æ­¤æ¦‚å¿µå¯¹åº”çš„å®é™…åº”ç”¨ã€‚ å…ˆè¯´æ¦‚å¿µã€‚å¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ‚²è§‚é”è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®çš„æ—¶å€™ä¸€å®šæœ‰åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®(æ¯”è¾ƒæ‚²è§‚)ï¼Œå› æ­¤åœ¨è·å–æ•°æ®çš„æ—¶å€™ä¼šå…ˆåŠ é”ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šè¢«åˆ«çš„çº¿ç¨‹ä¿®æ”¹ã€‚Javaä¸­ï¼Œsynchronizedå…³é”®å­—å’ŒLockçš„å®ç°ç±»éƒ½æ˜¯æ‚²è§‚é”ã€‚ è€Œä¹è§‚é”è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®æ—¶ä¸ä¼šæœ‰åˆ«çš„çº¿ç¨‹ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šæ·»åŠ é”ï¼Œåªæ˜¯åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™å»åˆ¤æ–­ä¹‹å‰æœ‰æ²¡æœ‰åˆ«çš„çº¿ç¨‹æ›´æ–°äº†è¿™ä¸ªæ•°æ®ã€‚å¦‚æœè¿™ä¸ªæ•°æ®æ²¡æœ‰è¢«æ›´æ–°ï¼Œå½“å‰çº¿ç¨‹å°†è‡ªå·±ä¿®æ”¹çš„æ•°æ®æˆåŠŸå†™å…¥ã€‚å¦‚æœæ•°æ®å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°ï¼Œåˆ™æ ¹æ®ä¸åŒçš„å®ç°æ–¹å¼æ‰§è¡Œä¸åŒçš„æ“ä½œï¼ˆä¾‹å¦‚æŠ¥é”™æˆ–è€…è‡ªåŠ¨é‡è¯•ï¼‰ã€‚ ä¹è§‚é”åœ¨Javaä¸­æ˜¯é€šè¿‡ä½¿ç”¨æ— é”ç¼–ç¨‹æ¥å®ç°ï¼Œæœ€å¸¸é‡‡ç”¨çš„æ˜¯CASç®—æ³•ï¼ŒJavaåŸå­ç±»ä¸­çš„é€’å¢æ“ä½œå°±é€šè¿‡CASè‡ªæ—‹å®ç°çš„ã€‚ æ ¹æ®ä»ä¸Šé¢çš„æ¦‚å¿µæè¿°æˆ‘ä»¬å¯ä»¥å‘ç°ï¼š æ‚²è§‚é”é€‚åˆå†™æ“ä½œå¤šçš„åœºæ™¯ï¼Œå…ˆåŠ é”å¯ä»¥ä¿è¯å†™æ“ä½œæ—¶æ•°æ®æ­£ç¡®ã€‚ ä¹è§‚é”é€‚åˆè¯»æ“ä½œå¤šçš„åœºæ™¯ï¼Œä¸åŠ é”çš„ç‰¹ç‚¹èƒ½å¤Ÿä½¿å…¶è¯»æ“ä½œçš„æ€§èƒ½å¤§å¹…æå‡ã€‚ åªè¯´æ¦‚å¿µæœ‰äº›æŠ½è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”çš„è°ƒç”¨æ–¹å¼ç¤ºä¾‹ï¼š 1234567891011121314151617181920// ------------------------- æ‚²è§‚é”çš„è°ƒç”¨æ–¹å¼ -------------------------// synchronizedpublic void testMethod() &#123; synchronized &#123; // æ“ä½œåŒæ­¥èµ„æº &#125;&#125;// ReentrantLock// éœ€è¦ä¿è¯å¤šä¸ªçº¿ç¨‹ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªé”private ReentrantLock lock = new ReentrantLock(); public void modifyPublicResources() &#123; lock.lock(); // æ“ä½œåŒæ­¥èµ„æº lock.unlock();&#125;// ------------------------- ä¹è§‚é”çš„è°ƒç”¨æ–¹å¼ -------------------------// éœ€è¦ä¿è¯å¤šä¸ªçº¿ç¨‹ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªprivate AtomicInteger atomicInteger = new AtomicInteger();// æ‰§è¡Œè‡ªå¢1AtomicInteger atomicInteger.incrementAndGet(); é€šè¿‡è°ƒç”¨æ–¹å¼ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ‚²è§‚é”åŸºæœ¬éƒ½æ˜¯åœ¨æ˜¾å¼çš„é”å®šä¹‹åå†æ“ä½œåŒæ­¥èµ„æºï¼Œè€Œä¹è§‚é”åˆ™ç›´æ¥å»æ“ä½œåŒæ­¥èµ„æºã€‚é‚£ä¹ˆï¼Œä¸ºä½•ä¹è§‚é”èƒ½å¤Ÿåšåˆ°ä¸é”å®šåŒæ­¥èµ„æºä¹Ÿå¯ä»¥æ­£ç¡®çš„å®ç°çº¿ç¨‹åŒæ­¥å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡ä»‹ç»ä¹è§‚é”çš„ä¸»è¦å®ç°æ–¹å¼ â€œCASâ€ çš„æŠ€æœ¯åŸç†æ¥ä¸ºå¤§å®¶è§£æƒ‘ã€‚ CASå…¨ç§° Compare And Swapï¼ˆæ¯”è¾ƒä¸äº¤æ¢ï¼‰ï¼Œæ˜¯ä¸€ç§æ— é”ç®—æ³•ã€‚åœ¨ä¸ä½¿ç”¨é”ï¼ˆæ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡ï¼‰çš„æƒ…å†µä¸‹å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„å˜é‡åŒæ­¥ã€‚java.util.concurrentåŒ…ä¸­çš„åŸå­ç±»å°±æ˜¯é€šè¿‡CASæ¥å®ç°äº†ä¹è§‚é”ã€‚ CASç®—æ³•æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°ï¼š éœ€è¦è¯»å†™çš„å†…å­˜å€¼ Vï¼› è¿›è¡Œæ¯”è¾ƒçš„å€¼ Aï¼› è¦å†™å…¥çš„æ–°å€¼ Bã€‚ å½“ä¸”ä»…å½“ V å†…å­˜å€¼æŒ‡å‘çš„å€¼ç­‰äº A æ—¶ï¼ŒCASé€šè¿‡åŸå­æ–¹å¼ç”¨æ–°å€¼Bæ¥æ›´æ–°Vçš„å€¼ï¼ˆâ€œæ¯”è¾ƒ+æ›´æ–°â€æ•´ä½“æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼‰ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œâ€œæ›´æ–°â€æ˜¯ä¸€ä¸ªä¸æ–­é‡è¯•çš„æ“ä½œã€‚ ä¹‹å‰æåˆ°java.util.concurrentåŒ…ä¸­çš„åŸå­ç±»ï¼Œå°±æ˜¯é€šè¿‡CASæ¥å®ç°äº†ä¹è§‚é”ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿›å…¥åŸå­ç±»AtomicIntegerçš„æºç ï¼Œçœ‹ä¸€ä¸‹AtomicIntegerçš„å®šä¹‰ï¼š 12345678910111213141516public class AtomicInteger extends Number implements java.io.Serializable &#123; private static final long serialVersionUID = 6214790243416807050L; // setup to use Unsafe.compareAndSwapInt for updates private static final Unsafe unsafe = Unsafe.getUnsafe(); private static final long valueOffset; static &#123; try &#123; valueOffset = unsafe.objectFieldOffset (AtomicInteger.class.getDeclaredField(&quot;value&quot;)); &#125; catch (Exception ex) &#123; throw new Error(ex); &#125; &#125; private volatile int value; &#125; æ ¹æ®å®šä¹‰æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå„å±æ€§çš„ä½œç”¨ï¼š unsafeï¼š è·å–å¹¶æ“ä½œå†…å­˜çš„æ•°æ®ã€‚ valueOffsetï¼š å­˜å‚¨valueåœ¨AtomicIntegerä¸­çš„åç§»é‡ã€‚ valueï¼š å­˜å‚¨AtomicIntegerçš„intå€¼ï¼Œè¯¥å±æ€§éœ€è¦å€ŸåŠ©volatileå…³é”®å­—ä¿è¯å…¶åœ¨çº¿ç¨‹é—´æ˜¯å¯è§çš„ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŸ¥çœ‹AtomicIntegerçš„è‡ªå¢å‡½æ•°incrementAndGet()çš„æºç æ—¶ï¼Œå‘ç°è‡ªå¢å‡½æ•°åº•å±‚è°ƒç”¨çš„æ˜¯unsafe.getAndAddInt()ã€‚ä½†æ˜¯ç”±äºJDKæœ¬èº«åªæœ‰Unsafe.classï¼Œåªé€šè¿‡classæ–‡ä»¶ä¸­çš„å‚æ•°åï¼Œå¹¶ä¸èƒ½å¾ˆå¥½çš„äº†è§£æ–¹æ³•çš„ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡OpenJDK 8 æ¥æŸ¥çœ‹Unsafeçš„æºç ï¼š 123456789101112131415161718192021222324/ ------------------------- JDK 8 -------------------------// AtomicInteger è‡ªå¢æ–¹æ³•public final int incrementAndGet() &#123; return unsafe.getAndAddInt(this, valueOffset, 1) + 1;&#125;// Unsafe.classpublic final int getAndAddInt(Object var1, long var2, int var4) &#123; int var5; do &#123; var5 = this.getIntVolatile(var1, var2); &#125; while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4)); return var5;&#125;// ------------------------- OpenJDK 8 -------------------------// Unsafe.javapublic final int getAndAddInt(Object o, long offset, int delta) &#123; int v; do &#123; v = getIntVolatile(o, offset); &#125; while (!compareAndSwapInt(o, offset, v, v + delta)); return v;&#125; æ ¹æ®OpenJDK 8çš„æºç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒgetAndAddInt()å¾ªç¯è·å–ç»™å®šå¯¹è±¡oä¸­çš„åç§»é‡å¤„çš„å€¼vï¼Œç„¶ååˆ¤æ–­å†…å­˜å€¼æ˜¯å¦ç­‰äºvã€‚å¦‚æœç›¸ç­‰åˆ™å°†å†…å­˜å€¼è®¾ç½®ä¸º v + deltaï¼Œå¦åˆ™è¿”å›falseï¼Œç»§ç»­å¾ªç¯è¿›è¡Œé‡è¯•ï¼Œç›´åˆ°è®¾ç½®æˆåŠŸæ‰èƒ½é€€å‡ºå¾ªç¯ï¼Œå¹¶ä¸”å°†æ—§å€¼è¿”å›ã€‚æ•´ä¸ªâ€œæ¯”è¾ƒ+æ›´æ–°â€æ“ä½œå°è£…åœ¨compareAndSwapInt()ä¸­ï¼Œåœ¨JNIé‡Œæ˜¯å€ŸåŠ©äºä¸€ä¸ªCPUæŒ‡ä»¤å®Œæˆçš„ï¼Œå±äºåŸå­æ“ä½œï¼Œå¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿçœ‹åˆ°åŒä¸€ä¸ªå˜é‡çš„ä¿®æ”¹å€¼ã€‚ åç»­JDKé€šè¿‡CPUçš„cmpxchgæŒ‡ä»¤ï¼Œå»æ¯”è¾ƒå¯„å­˜å™¨ä¸­çš„ A å’Œ å†…å­˜ä¸­çš„å€¼ Vã€‚å¦‚æœç›¸ç­‰ï¼Œå°±æŠŠè¦å†™å…¥çš„æ–°å€¼ B å­˜å…¥å†…å­˜ä¸­ã€‚å¦‚æœä¸ç›¸ç­‰ï¼Œå°±å°†å†…å­˜å€¼ V èµ‹å€¼ç»™å¯„å­˜å™¨ä¸­çš„å€¼ Aã€‚ç„¶åé€šè¿‡Javaä»£ç ä¸­çš„whileå¾ªç¯å†æ¬¡è°ƒç”¨cmpxchgæŒ‡ä»¤è¿›è¡Œé‡è¯•ï¼Œç›´åˆ°è®¾ç½®æˆåŠŸä¸ºæ­¢ã€‚ CASè™½ç„¶å¾ˆé«˜æ•ˆï¼Œä½†æ˜¯å®ƒä¹Ÿå­˜åœ¨ä¸‰å¤§é—®é¢˜ï¼Œè¿™é‡Œä¹Ÿç®€å•è¯´ä¸€ä¸‹ï¼š ABAé—®é¢˜ã€‚CASéœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™æ£€æŸ¥å†…å­˜å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–æ‰ä¼šæ›´æ–°å†…å­˜å€¼ã€‚ä½†æ˜¯å¦‚æœå†…å­˜å€¼åŸæ¥æ˜¯Aï¼Œåæ¥å˜æˆäº†Bï¼Œç„¶ååˆå˜æˆäº†Aï¼Œé‚£ä¹ˆCASè¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘ç°å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯æœ‰å˜åŒ–çš„ã€‚ABAé—®é¢˜çš„è§£å†³æ€è·¯å°±æ˜¯åœ¨å˜é‡å‰é¢æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™éƒ½æŠŠç‰ˆæœ¬å·åŠ ä¸€ï¼Œè¿™æ ·å˜åŒ–è¿‡ç¨‹å°±ä»â€œAï¼Bï¼Aâ€å˜æˆäº†â€œ1Aï¼2Bï¼3Aâ€ã€‚ JDKä»1.5å¼€å§‹æä¾›äº†AtomicStampedReferenceç±»æ¥è§£å†³ABAé—®é¢˜ï¼Œå…·ä½“æ“ä½œå°è£…åœ¨compareAndSet()ä¸­ã€‚compareAndSet()é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨å’Œå½“å‰æ ‡å¿—ä¸é¢„æœŸå¼•ç”¨å’Œé¢„æœŸæ ‡å¿—æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœéƒ½ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†å¼•ç”¨å€¼å’Œæ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚ å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§ã€‚CASæ“ä½œå¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šå¯¼è‡´å…¶ä¸€ç›´è‡ªæ—‹ï¼Œç»™CPUå¸¦æ¥éå¸¸å¤§çš„å¼€é”€ã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ ã€‚å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼ŒCASèƒ½å¤Ÿä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼ŒCASæ˜¯æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§çš„ã€‚ Javaä»1.5å¼€å§‹JDKæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œå¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡ŒCASæ“ä½œã€‚ æœ‰å…³äºCASå’ŒUnsafeçš„å…·ä½“è¯¦è§£ï¼Œæˆ‘åç»­ä¸ºå¤§å®¶æ¢³ç†ã€‚ è‡ªæ—‹é” VS é€‚åº”æ€§è‡ªæ—‹é”åœ¨ä»‹ç»è‡ªæ—‹é”å‰ï¼Œæˆ‘ä»¬éœ€è¦ä»‹ç»ä¸€äº›å‰æçŸ¥è¯†æ¥å¸®åŠ©å¤§å®¶æ˜ç™½è‡ªæ—‹é”çš„æ¦‚å¿µã€‚ é˜»å¡æˆ–å”¤é†’ä¸€ä¸ªJavaçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœåŒæ­¥ä»£ç å—ä¸­çš„å†…å®¹è¿‡äºç®€å•ï¼ŒçŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿ã€‚ åœ¨è®¸å¤šåœºæ™¯ä¸­ï¼ŒåŒæ­¥èµ„æºçš„é”å®šæ—¶é—´å¾ˆçŸ­ï¼Œä¸ºäº†è¿™ä¸€å°æ®µæ—¶é—´å»åˆ‡æ¢çº¿ç¨‹ï¼Œçº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤ç°åœºçš„èŠ±è´¹å¯èƒ½ä¼šè®©ç³»ç»Ÿå¾—ä¸å¿å¤±ã€‚å¦‚æœç‰©ç†æœºå™¨æœ‰å¤šä¸ªå¤„ç†å™¨ï¼Œèƒ½å¤Ÿè®©ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„çº¿ç¨‹åŒæ—¶å¹¶è¡Œæ‰§è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©åé¢é‚£ä¸ªè¯·æ±‚é”çš„çº¿ç¨‹ä¸æ”¾å¼ƒCPUçš„æ‰§è¡Œæ—¶é—´ï¼Œçœ‹çœ‹æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦å¾ˆå¿«å°±ä¼šé‡Šæ”¾é”ã€‚ è€Œä¸ºäº†è®©å½“å‰çº¿ç¨‹â€œç¨ç­‰ä¸€ä¸‹â€ï¼Œæˆ‘ä»¬éœ€è®©å½“å‰çº¿ç¨‹è¿›è¡Œè‡ªæ—‹ï¼Œå¦‚æœåœ¨è‡ªæ—‹å®Œæˆåå‰é¢é”å®šåŒæ­¥èµ„æºçš„çº¿ç¨‹å·²ç»é‡Šæ”¾äº†é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±å¯ä»¥ä¸å¿…é˜»å¡è€Œæ˜¯ç›´æ¥è·å–åŒæ­¥èµ„æºï¼Œä»è€Œé¿å…åˆ‡æ¢çº¿ç¨‹çš„å¼€é”€ã€‚è¿™å°±æ˜¯è‡ªæ—‹é”ã€‚ è‡ªæ—‹é”æœ¬èº«æ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œå®ƒä¸èƒ½ä»£æ›¿é˜»å¡ã€‚è‡ªæ—‹ç­‰å¾…è™½ç„¶é¿å…äº†çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼Œä½†å®ƒè¦å ç”¨å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœé”è¢«å ç”¨çš„æ—¶é—´å¾ˆçŸ­ï¼Œè‡ªæ—‹ç­‰å¾…çš„æ•ˆæœå°±ä¼šéå¸¸å¥½ã€‚åä¹‹ï¼Œå¦‚æœé”è¢«å ç”¨çš„æ—¶é—´å¾ˆé•¿ï¼Œé‚£ä¹ˆè‡ªæ—‹çš„çº¿ç¨‹åªä¼šç™½æµªè´¹å¤„ç†å™¨èµ„æºã€‚æ‰€ä»¥ï¼Œè‡ªæ—‹ç­‰å¾…çš„æ—¶é—´å¿…é¡»è¦æœ‰ä¸€å®šçš„é™åº¦ï¼Œå¦‚æœè‡ªæ—‹è¶…è¿‡äº†é™å®šæ¬¡æ•°ï¼ˆé»˜è®¤æ˜¯10æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨-XX:PreBlockSpinæ¥æ›´æ”¹ï¼‰æ²¡æœ‰æˆåŠŸè·å¾—é”ï¼Œå°±åº”å½“æŒ‚èµ·çº¿ç¨‹ã€‚ è‡ªæ—‹é”çš„å®ç°åŸç†åŒæ ·ä¹Ÿæ˜¯CASï¼ŒAtomicIntegerä¸­è°ƒç”¨unsafeè¿›è¡Œè‡ªå¢æ“ä½œçš„æºç ä¸­çš„do-whileå¾ªç¯å°±æ˜¯ä¸€ä¸ªè‡ªæ—‹æ“ä½œï¼Œå¦‚æœä¿®æ”¹æ•°å€¼å¤±è´¥åˆ™é€šè¿‡å¾ªç¯æ¥æ‰§è¡Œè‡ªæ—‹ï¼Œç›´è‡³ä¿®æ”¹æˆåŠŸã€‚ æ—‹é”åœ¨JDK1.4.2ä¸­å¼•å…¥ï¼Œä½¿ç”¨-XX:+UseSpinningæ¥å¼€å¯ã€‚JDK 6ä¸­å˜ä¸ºé»˜è®¤å¼€å¯ï¼Œå¹¶ä¸”å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ï¼ˆé€‚åº”æ€§è‡ªæ—‹é”ï¼‰ã€‚ è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ï¼ˆæ¬¡æ•°ï¼‰ä¸å†å›ºå®šï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å¾—è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œè¿›è€Œå®ƒå°†å…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ã€‚å¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—è¿‡ï¼Œé‚£åœ¨ä»¥åå°è¯•è·å–è¿™ä¸ªé”æ—¶å°†å¯èƒ½çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œç›´æ¥é˜»å¡çº¿ç¨‹ï¼Œé¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚ åœ¨è‡ªæ—‹é”ä¸­ å¦æœ‰ä¸‰ç§å¸¸è§çš„é”å½¢å¼:TicketLockã€CLHlockå’ŒMCSlockï¼Œæœ¬æ–‡ä¸­ä»…åšåè¯ä»‹ç»ï¼Œä¸åšæ·±å…¥è®²è§£ï¼Œæ„Ÿå…´è¶£çš„å¤§å®¶å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ç›¸å…³èµ„æ–™ã€‚ æ— é” VS åå‘é” VS è½»é‡çº§é” VS é‡é‡çº§é”è¿™å››ç§é”æ˜¯æŒ‡é”çš„çŠ¶æ€ï¼Œä¸“é—¨é’ˆå¯¹synchronizedçš„ã€‚åœ¨ä»‹ç»è¿™å››ç§é”çŠ¶æ€ä¹‹å‰è¿˜éœ€è¦ä»‹ç»ä¸€äº›é¢å¤–çš„çŸ¥è¯†ã€‚ é¦–å…ˆä¸ºä»€ä¹ˆSynchronizedèƒ½å®ç°çº¿ç¨‹åŒæ­¥ï¼Ÿ åœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼šâ€œJavaå¯¹è±¡å¤´â€ã€â€œMonitorâ€ã€‚ Javaå¯¹è±¡å¤´synchronizedæ˜¯æ‚²è§‚é”ï¼Œåœ¨æ“ä½œåŒæ­¥èµ„æºä¹‹å‰éœ€è¦ç»™åŒæ­¥èµ„æºå…ˆåŠ é”ï¼Œè¿™æŠŠé”å°±æ˜¯å­˜åœ¨Javaå¯¹è±¡å¤´é‡Œçš„ï¼Œè€ŒJavaå¯¹è±¡å¤´åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘ä»¬ä»¥Hotspotè™šæ‹Ÿæœºä¸ºä¾‹ï¼ŒHotspotçš„å¯¹è±¡å¤´ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†æ•°æ®ï¼šMark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰ã€Klass Pointerï¼ˆç±»å‹æŒ‡é’ˆï¼‰ã€‚ Mark Wordï¼šé»˜è®¤å­˜å‚¨å¯¹è±¡çš„HashCodeï¼Œåˆ†ä»£å¹´é¾„å’Œé”æ ‡å¿—ä½ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯éƒ½æ˜¯ä¸å¯¹è±¡è‡ªèº«å®šä¹‰æ— å…³çš„æ•°æ®ï¼Œæ‰€ä»¥Mark Wordè¢«è®¾è®¡æˆä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ä»¥ä¾¿åœ¨æå°çš„ç©ºé—´å†…å­˜å­˜å‚¨å°½é‡å¤šçš„æ•°æ®ã€‚å®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡ŒæœŸé—´Mark Wordé‡Œå­˜å‚¨çš„æ•°æ®ä¼šéšç€é”æ ‡å¿—ä½çš„å˜åŒ–è€Œå˜åŒ–ã€‚ Klass Pointï¼šå¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚ MonitorMonitorå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåŒæ­¥å·¥å…·æˆ–ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œé€šå¸¸è¢«æè¿°ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚æ¯ä¸€ä¸ªJavaå¯¹è±¡å°±æœ‰ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼Œç§°ä¸ºå†…éƒ¨é”æˆ–è€…Monitoré”ã€‚ Monitoræ˜¯çº¿ç¨‹ç§æœ‰çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå¯ç”¨monitor recordåˆ—è¡¨ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå…¨å±€çš„å¯ç”¨åˆ—è¡¨ã€‚æ¯ä¸€ä¸ªè¢«é”ä½çš„å¯¹è±¡éƒ½ä¼šå’Œä¸€ä¸ªmonitorå…³è”ï¼ŒåŒæ—¶monitorä¸­æœ‰ä¸€ä¸ªOwnerå­—æ®µå­˜æ”¾æ‹¥æœ‰è¯¥é”çš„çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œè¡¨ç¤ºè¯¥é”è¢«è¿™ä¸ªçº¿ç¨‹å ç”¨ã€‚ ç°åœ¨è¯é¢˜å›åˆ°synchronizedï¼Œsynchronizedé€šè¿‡Monitoræ¥å®ç°çº¿ç¨‹åŒæ­¥ï¼ŒMonitoræ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„Mutex Lockï¼ˆäº’æ–¥é”ï¼‰æ¥å®ç°çš„çº¿ç¨‹åŒæ­¥ã€‚ å¦‚åŒæˆ‘ä»¬åœ¨è‡ªæ—‹é”ä¸­æåˆ°çš„â€œé˜»å¡æˆ–å”¤é†’ä¸€ä¸ªJavaçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœåŒæ­¥ä»£ç å—ä¸­çš„å†…å®¹è¿‡äºç®€å•ï¼ŒçŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿â€ã€‚è¿™ç§æ–¹å¼å°±æ˜¯synchronizedæœ€åˆå®ç°åŒæ­¥çš„æ–¹å¼ï¼Œè¿™å°±æ˜¯JDK 6ä¹‹å‰synchronizedæ•ˆç‡ä½çš„åŸå› ã€‚è¿™ç§ä¾èµ–äºæ“ä½œç³»ç»ŸMutex Lockæ‰€å®ç°çš„é”æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œé‡é‡çº§é”â€ï¼ŒJDK 6ä¸­ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ã€‚ æ‰€ä»¥ç›®å‰é”ä¸€å…±æœ‰4ç§çŠ¶æ€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚é”çŠ¶æ€åªèƒ½å‡çº§ä¸èƒ½é™çº§ã€‚ é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯¹synchronizedçš„åŠ é”æœºåˆ¶ä»¥åŠç›¸å…³çŸ¥è¯†æœ‰äº†ä¸€ä¸ªäº†è§£ï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬ç»™å‡ºå››ç§é”çŠ¶æ€å¯¹åº”çš„çš„Mark Wordå†…å®¹ï¼Œç„¶åå†åˆ†åˆ«è®²è§£å››ç§é”çŠ¶æ€çš„æ€è·¯ä»¥åŠç‰¹ç‚¹ï¼š é”çŠ¶æ€ å­˜å‚¨å†…å®¹ å­˜å‚¨å†…å®¹ æ— é” å¯¹è±¡çš„hashCodeã€å¯¹è±¡åˆ†ä»£å¹´é¾„ã€æ˜¯å¦æ˜¯åå‘é”ï¼ˆ0ï¼‰ 01 åå‘é” åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ã€å¯¹è±¡åˆ†ä»£å¹´é¾„ã€æ˜¯å¦æ˜¯åå‘é”ï¼ˆ1ï¼‰ 01 è½»é‡çº§é” æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ 00 é‡é‡çº§é” æŒ‡å‘äº’æ–¥é‡ï¼ˆé‡é‡çº§é”ï¼‰çš„æŒ‡é’ˆ 10 æ— é”æ— é”æ²¡æœ‰å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®å¹¶ä¿®æ”¹åŒä¸€ä¸ªèµ„æºï¼Œä½†åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸã€‚ æ— é”çš„ç‰¹ç‚¹å°±æ˜¯ä¿®æ”¹æ“ä½œåœ¨å¾ªç¯å†…è¿›è¡Œï¼Œçº¿ç¨‹ä¼šä¸æ–­çš„å°è¯•ä¿®æ”¹å…±äº«èµ„æºã€‚å¦‚æœæ²¡æœ‰å†²çªå°±ä¿®æ”¹æˆåŠŸå¹¶é€€å‡ºï¼Œå¦åˆ™å°±ä¼šç»§ç»­å¾ªç¯å°è¯•ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ä¿®æ”¹åŒä¸€ä¸ªå€¼ï¼Œå¿…å®šä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸï¼Œè€Œå…¶ä»–ä¿®æ”¹å¤±è´¥çš„çº¿ç¨‹ä¼šä¸æ–­é‡è¯•ç›´åˆ°ä¿®æ”¹æˆåŠŸã€‚ä¸Šé¢æˆ‘ä»¬ä»‹ç»çš„CASåŸç†åŠåº”ç”¨å³æ˜¯æ— é”çš„å®ç°ã€‚æ— é”æ— æ³•å…¨é¢ä»£æ›¿æœ‰é”ï¼Œä½†æ— é”åœ¨æŸäº›åœºåˆä¸‹çš„æ€§èƒ½æ˜¯éå¸¸é«˜çš„ã€‚ åå‘é”åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ï¼Œé™ä½è·å–é”çš„ä»£ä»·ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œæ‰€ä»¥å‡ºç°äº†åå‘é”ã€‚å…¶ç›®æ ‡å°±æ˜¯åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç å—æ—¶èƒ½å¤Ÿæé«˜æ€§èƒ½ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨Mark Wordé‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDã€‚åœ¨çº¿ç¨‹è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸å†é€šè¿‡CASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œè€Œæ˜¯æ£€æµ‹Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨æ— å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ï¼Œå› ä¸ºè½»é‡çº§é”çš„è·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡CASåŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŸå­æŒ‡ä»¤å³å¯ã€‚ åå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰ï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçŠ¶æ€ã€‚æ’¤é”€åå‘é”åæ¢å¤åˆ°æ— é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ã€‚ åå‘é”åœ¨JDK 6åŠä»¥åçš„JVMé‡Œæ˜¯é»˜è®¤å¯ç”¨çš„ã€‚å¯ä»¥é€šè¿‡JVMå‚æ•°å…³é—­åå‘é”ï¼š-XX:-UseBiasedLocking=falseï¼Œå…³é—­ä¹‹åç¨‹åºé»˜è®¤ä¼šè¿›å…¥è½»é‡çº§é”çŠ¶æ€ã€‚ è½»é‡çº§é”æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦å¤–çš„çº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ åœ¨ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºåå‘é”ä¸ºâ€œ0â€ï¼‰ï¼Œè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œç„¶åæ‹·è´å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚ æ‹·è´æˆåŠŸåï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock Recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„Mark Wordã€‚ å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ã€‚ å¦‚æœè½»é‡çº§é”çš„æ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯å°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜å¤šä¸ªçº¿ç¨‹ç«äº‰é”ã€‚ è‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™è¯¥çº¿ç¨‹é€šè¿‡è‡ªæ—‹è¿›è¡Œç­‰å¾…ã€‚ä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶ï¼Œè½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚ é‡é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”æ—¶ï¼Œé”æ ‡å¿—çš„çŠ¶æ€å€¼å˜ä¸ºâ€œ10â€ï¼Œæ­¤æ—¶Mark Wordä¸­å­˜å‚¨çš„æ˜¯æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆï¼Œæ­¤æ—¶ç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚ æ•´ä½“çš„é”çŠ¶æ€å‡çº§æµç¨‹å¦‚ä¸‹ï¼š ç»¼ä¸Šï¼Œåå‘é”é€šè¿‡å¯¹æ¯”Mark Wordè§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…æ‰§è¡ŒCASæ“ä½œã€‚è€Œè½»é‡çº§é”æ˜¯é€šè¿‡ç”¨CASæ“ä½œå’Œè‡ªæ—‹æ¥è§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’è€Œå½±å“æ€§èƒ½ã€‚é‡é‡çº§é”æ˜¯å°†é™¤äº†æ‹¥æœ‰é”çš„çº¿ç¨‹ä»¥å¤–çš„çº¿ç¨‹éƒ½é˜»å¡ã€‚ å…¬å¹³é” VS éå…¬å¹³é”å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è·å¾—é”ã€‚å…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯ç­‰å¾…é”çš„çº¿ç¨‹ä¸ä¼šé¥¿æ­»ã€‚ç¼ºç‚¹æ˜¯æ•´ä½“ååæ•ˆç‡ç›¸å¯¹éå…¬å¹³é”è¦ä½ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­é™¤ç¬¬ä¸€ä¸ªçº¿ç¨‹ä»¥å¤–çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼ŒCPUå”¤é†’é˜»å¡çº¿ç¨‹çš„å¼€é”€æ¯”éå…¬å¹³é”å¤§ã€‚ éå…¬å¹³é”æ˜¯å¤šä¸ªçº¿ç¨‹åŠ é”æ—¶ç›´æ¥å°è¯•è·å–é”ï¼Œè·å–ä¸åˆ°æ‰ä¼šåˆ°ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ç­‰å¾…ã€‚ä½†å¦‚æœæ­¤æ—¶é”åˆšå¥½å¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯ä»¥æ— éœ€é˜»å¡ç›´æ¥è·å–åˆ°é”ï¼Œæ‰€ä»¥éå…¬å¹³é”æœ‰å¯èƒ½å‡ºç°åç”³è¯·é”çš„çº¿ç¨‹å…ˆè·å–é”çš„åœºæ™¯ã€‚éå…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å‡å°‘å”¤èµ·çº¿ç¨‹çš„å¼€é”€ï¼Œæ•´ä½“çš„ååæ•ˆç‡é«˜ï¼Œå› ä¸ºçº¿ç¨‹æœ‰å‡ ç‡ä¸é˜»å¡ç›´æ¥è·å¾—é”ï¼ŒCPUä¸å¿…å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚ç¼ºç‚¹æ˜¯å¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šé¥¿æ­»ï¼Œæˆ–è€…ç­‰å¾ˆä¹…æ‰ä¼šè·å¾—é”ã€‚ ç›´æ¥ç”¨è¯­è¨€æè¿°å¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œè¿™é‡Œç¬”è€…ç”¨ä»åˆ«å¤„çœ‹åˆ°çš„ä¸€ä¸ªä¾‹å­æ¥è®²è¿°ä¸€ä¸‹å…¬å¹³é”å’Œéå…¬å¹³é”ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾æœ‰ä¸€å£æ°´äº•ï¼Œæœ‰ç®¡ç†å‘˜çœ‹å®ˆï¼Œç®¡ç†å‘˜æœ‰ä¸€æŠŠé”ï¼Œåªæœ‰æ‹¿åˆ°é”çš„äººæ‰èƒ½å¤Ÿæ‰“æ°´ï¼Œæ‰“å®Œæ°´è¦æŠŠé”è¿˜ç»™ç®¡ç†å‘˜ã€‚æ¯ä¸ªè¿‡æ¥æ‰“æ°´çš„äººéƒ½è¦ç®¡ç†å‘˜çš„å…è®¸å¹¶æ‹¿åˆ°é”ä¹‹åæ‰èƒ½å»æ‰“æ°´ï¼Œå¦‚æœå‰é¢æœ‰äººæ­£åœ¨æ‰“æ°´ï¼Œé‚£ä¹ˆè¿™ä¸ªæƒ³è¦æ‰“æ°´çš„äººå°±å¿…é¡»æ’é˜Ÿã€‚ç®¡ç†å‘˜ä¼šæŸ¥çœ‹ä¸‹ä¸€ä¸ªè¦å»æ‰“æ°´çš„äººæ˜¯ä¸æ˜¯é˜Ÿä¼é‡Œæ’æœ€å‰é¢çš„äººï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œæ‰ä¼šç»™ä½ é”è®©ä½ å»æ‰“æ°´ï¼›å¦‚æœä½ ä¸æ˜¯æ’ç¬¬ä¸€çš„äººï¼Œå°±å¿…é¡»å»é˜Ÿå°¾æ’é˜Ÿï¼Œè¿™å°±æ˜¯å…¬å¹³é”ã€‚ ä½†æ˜¯å¯¹äºéå…¬å¹³é”ï¼Œç®¡ç†å‘˜å¯¹æ‰“æ°´çš„äººæ²¡æœ‰è¦æ±‚ã€‚å³ä½¿ç­‰å¾…é˜Ÿä¼é‡Œæœ‰æ’é˜Ÿç­‰å¾…çš„äººï¼Œä½†å¦‚æœåœ¨ä¸Šä¸€ä¸ªäººåˆšæ‰“å®Œæ°´æŠŠé”è¿˜ç»™ç®¡ç†å‘˜è€Œä¸”ç®¡ç†å‘˜è¿˜æ²¡æœ‰å…è®¸ç­‰å¾…é˜Ÿä¼é‡Œä¸‹ä¸€ä¸ªäººå»æ‰“æ°´æ—¶ï¼Œåˆšå¥½æ¥äº†ä¸€ä¸ªæ’é˜Ÿçš„äººï¼Œè¿™ä¸ªæ’é˜Ÿçš„äººæ˜¯å¯ä»¥ç›´æ¥ä»ç®¡ç†å‘˜é‚£é‡Œæ‹¿åˆ°é”å»æ‰“æ°´ï¼Œä¸éœ€è¦æ’é˜Ÿï¼ŒåŸæœ¬æ’é˜Ÿç­‰å¾…çš„äººåªèƒ½ç»§ç»­ç­‰å¾…ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ReentrantLockçš„æºç æ¥è®²è§£å…¬å¹³é”å’Œéå…¬å¹³é”ã€‚ æ ¹æ®ä»£ç å¯çŸ¥ï¼ŒReentrantLocké‡Œé¢æœ‰ä¸€ä¸ªå†…éƒ¨ç±»Syncï¼ŒSyncç»§æ‰¿AQSï¼ˆAbstractQueuedSynchronizerï¼‰ï¼Œæ·»åŠ é”å’Œé‡Šæ”¾é”çš„å¤§éƒ¨åˆ†æ“ä½œå®é™…ä¸Šéƒ½æ˜¯åœ¨Syncä¸­å®ç°çš„ã€‚å®ƒæœ‰å…¬å¹³é”FairSyncå’Œéå…¬å¹³é”NonfairSyncä¸¤ä¸ªå­ç±»ã€‚ReentrantLocké»˜è®¤ä½¿ç”¨éå…¬å¹³é”ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å™¨æ¥æ˜¾ç¤ºçš„æŒ‡å®šä½¿ç”¨å…¬å¹³é”ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…¬å¹³é”ä¸éå…¬å¹³é”çš„åŠ é”æ–¹æ³•çš„æºç : é€šè¿‡ä¸Šå›¾ä¸­çš„æºä»£ç å¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºå…¬å¹³é”ä¸éå…¬å¹³é”çš„lock()æ–¹æ³•å”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºå…¬å¹³é”åœ¨è·å–åŒæ­¥çŠ¶æ€æ—¶å¤šäº†ä¸€ä¸ªé™åˆ¶æ¡ä»¶ï¼šhasQueuedPredecessors()ã€‚ å†è¿›å…¥hasQueuedPredecessors()ï¼Œå¯ä»¥çœ‹åˆ°è¯¥æ–¹æ³•ä¸»è¦åšä¸€ä»¶äº‹æƒ…ï¼šä¸»è¦æ˜¯åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä½äºåŒæ­¥é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªã€‚å¦‚æœæ˜¯åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ ç»¼ä¸Šï¼Œå…¬å¹³é”å°±æ˜¯é€šè¿‡åŒæ­¥é˜Ÿåˆ—æ¥å®ç°å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œä»è€Œå®ç°å…¬å¹³çš„ç‰¹æ€§ã€‚éå…¬å¹³é”åŠ é”æ—¶ä¸è€ƒè™‘æ’é˜Ÿç­‰å¾…é—®é¢˜ï¼Œç›´æ¥å°è¯•è·å–é”ï¼Œæ‰€ä»¥å­˜åœ¨åç”³è¯·å´å…ˆè·å¾—é”çš„æƒ…å†µã€‚ å¯é‡å…¥é” VS éå¯é‡å…¥é”å¯é‡å…¥é”åˆåé€’å½’é”ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œå†è¿›å…¥è¯¥çº¿ç¨‹çš„å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ï¼ˆå‰æé”å¯¹è±¡å¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€…classï¼‰ï¼Œä¸ä¼šå› ä¸ºä¹‹å‰å·²ç»è·å–è¿‡è¿˜æ²¡é‡Šæ”¾è€Œé˜»å¡ã€‚Javaä¸­ReentrantLockå’Œsynchronizedéƒ½æ˜¯å¯é‡å…¥é”ï¼Œå¯é‡å…¥é”çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä¸€å®šç¨‹åº¦é¿å…æ­»é”ã€‚ä¸‹é¢ç”¨ç¤ºä¾‹ä»£ç æ¥è¿›è¡Œåˆ†æï¼š 12345678910public class Widget &#123; public synchronized void doSomething() &#123; System.out.println(\"æ–¹æ³•1æ‰§è¡Œ...\"); doOthers(); &#125; public synchronized void doOthers() &#123; System.out.println(\"æ–¹æ³•2æ‰§è¡Œ...\"); &#125;&#125; åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç±»ä¸­çš„ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯è¢«å†…ç½®é”synchronizedä¿®é¥°çš„ï¼ŒdoSomething()æ–¹æ³•ä¸­è°ƒç”¨doOthers()æ–¹æ³•ã€‚å› ä¸ºå†…ç½®é”æ˜¯å¯é‡å…¥çš„ï¼Œæ‰€ä»¥åŒä¸€ä¸ªçº¿ç¨‹åœ¨è°ƒç”¨doOthers()æ—¶å¯ä»¥ç›´æ¥è·å¾—å½“å‰å¯¹è±¡çš„é”ï¼Œè¿›å…¥doOthers()è¿›è¡Œæ“ä½œã€‚ å¦‚æœæ˜¯ä¸€ä¸ªä¸å¯é‡å…¥é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹åœ¨è°ƒç”¨doOthers()ä¹‹å‰éœ€è¦å°†æ‰§è¡ŒdoSomething()æ—¶è·å–å½“å‰å¯¹è±¡çš„é”é‡Šæ”¾æ‰ï¼Œå®é™…ä¸Šè¯¥å¯¹è±¡é”å·²è¢«å½“å‰çº¿ç¨‹æ‰€æŒæœ‰ï¼Œä¸”æ— æ³•é‡Šæ”¾ã€‚æ‰€ä»¥æ­¤æ—¶ä¼šå‡ºç°æ­»é”ã€‚ è€Œä¸ºä»€ä¹ˆå¯é‡å…¥é”å°±å¯ä»¥åœ¨åµŒå¥—è°ƒç”¨æ—¶å¯ä»¥è‡ªåŠ¨è·å¾—é”å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡å›¾ç¤ºå’Œæºç æ¥åˆ†åˆ«è§£æä¸€ä¸‹ã€‚ è¿˜æ˜¯æ‰“æ°´çš„ä¾‹å­ï¼Œæœ‰å¤šä¸ªäººåœ¨æ’é˜Ÿæ‰“æ°´ï¼Œæ­¤æ—¶ç®¡ç†å‘˜å…è®¸é”å’ŒåŒä¸€ä¸ªäººçš„å¤šä¸ªæ°´æ¡¶ç»‘å®šã€‚è¿™ä¸ªäººç”¨å¤šä¸ªæ°´æ¡¶æ‰“æ°´æ—¶ï¼Œç¬¬ä¸€ä¸ªæ°´æ¡¶å’Œé”ç»‘å®šå¹¶æ‰“å®Œæ°´ä¹‹åï¼Œç¬¬äºŒä¸ªæ°´æ¡¶ä¹Ÿå¯ä»¥ç›´æ¥å’Œé”ç»‘å®šå¹¶å¼€å§‹æ‰“æ°´ï¼Œæ‰€æœ‰çš„æ°´æ¡¶éƒ½æ‰“å®Œæ°´ä¹‹åæ‰“æ°´äººæ‰ä¼šå°†é”è¿˜ç»™ç®¡ç†å‘˜ã€‚è¿™ä¸ªäººçš„æ‰€æœ‰æ‰“æ°´æµç¨‹éƒ½èƒ½å¤ŸæˆåŠŸæ‰§è¡Œï¼Œåç»­ç­‰å¾…çš„äººä¹Ÿèƒ½å¤Ÿæ‰“åˆ°æ°´ã€‚è¿™å°±æ˜¯å¯é‡å…¥é”ã€‚ ä½†å¦‚æœæ˜¯éå¯é‡å…¥é”çš„è¯ï¼Œæ­¤æ—¶ç®¡ç†å‘˜åªå…è®¸é”å’ŒåŒä¸€ä¸ªäººçš„ä¸€ä¸ªæ°´æ¡¶ç»‘å®šã€‚ç¬¬ä¸€ä¸ªæ°´æ¡¶å’Œé”ç»‘å®šæ‰“å®Œæ°´ä¹‹åå¹¶ä¸ä¼šé‡Šæ”¾é”ï¼Œå¯¼è‡´ç¬¬äºŒä¸ªæ°´æ¡¶ä¸èƒ½å’Œé”ç»‘å®šä¹Ÿæ— æ³•æ‰“æ°´ã€‚å½“å‰çº¿ç¨‹å‡ºç°æ­»é”ï¼Œæ•´ä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½æ— æ³•è¢«å”¤é†’ã€‚ ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ReentrantLockå’Œsynchronizedéƒ½æ˜¯é‡å…¥é”ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡é‡å…¥é”ReentrantLockä»¥åŠéå¯é‡å…¥é”NonReentrantLockçš„æºç æ¥å¯¹æ¯”åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆéå¯é‡å…¥é”åœ¨é‡å¤è°ƒç”¨åŒæ­¥èµ„æºæ—¶ä¼šå‡ºç°æ­»é”ã€‚ é¦–å…ˆReentrantLockå’ŒNonReentrantLockéƒ½ç»§æ‰¿çˆ¶ç±»AQSï¼Œå…¶çˆ¶ç±»AQSä¸­ç»´æŠ¤äº†ä¸€ä¸ªåŒæ­¥çŠ¶æ€statusæ¥è®¡æ•°é‡å…¥æ¬¡æ•°ï¼Œstatusåˆå§‹å€¼ä¸º0ã€‚ å½“çº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œå¯é‡å…¥é”å…ˆå°è¯•è·å–å¹¶æ›´æ–°statuså€¼ï¼Œå¦‚æœstatus == 0è¡¨ç¤ºæ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œåˆ™æŠŠstatusç½®ä¸º1ï¼Œå½“å‰çº¿ç¨‹å¼€å§‹æ‰§è¡Œã€‚å¦‚æœstatus != 0ï¼Œåˆ™åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯è·å–åˆ°è¿™ä¸ªé”çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯çš„è¯æ‰§è¡Œstatus+1ï¼Œä¸”å½“å‰çº¿ç¨‹å¯ä»¥å†æ¬¡è·å–é”ã€‚è€Œéå¯é‡å…¥é”æ˜¯ç›´æ¥å»è·å–å¹¶å°è¯•æ›´æ–°å½“å‰statusçš„å€¼ï¼Œå¦‚æœstatus != 0çš„è¯ä¼šå¯¼è‡´å…¶è·å–é”å¤±è´¥ï¼Œå½“å‰çº¿ç¨‹é˜»å¡ã€‚ é‡Šæ”¾é”æ—¶ï¼Œå¯é‡å…¥é”åŒæ ·å…ˆè·å–å½“å‰statusçš„å€¼ï¼Œåœ¨å½“å‰çº¿ç¨‹æ˜¯æŒæœ‰é”çš„çº¿ç¨‹çš„å‰æä¸‹ã€‚å¦‚æœstatus-1 == 0ï¼Œåˆ™è¡¨ç¤ºå½“å‰çº¿ç¨‹æ‰€æœ‰é‡å¤è·å–é”çš„æ“ä½œéƒ½å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç„¶åè¯¥çº¿ç¨‹æ‰ä¼šçœŸæ­£é‡Šæ”¾é”ã€‚è€Œéå¯é‡å…¥é”åˆ™æ˜¯åœ¨ç¡®å®šå½“å‰çº¿ç¨‹æ˜¯æŒæœ‰é”çš„çº¿ç¨‹ä¹‹åï¼Œç›´æ¥å°†statusç½®ä¸º0ï¼Œå°†é”é‡Šæ”¾ã€‚ ç‹¬äº«é” VS å…±äº«é”ç‹¬äº«é”å’Œå…±äº«é”åŒæ ·æ˜¯ä¸€ç§æ¦‚å¿µã€‚æˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹å…·ä½“çš„æ¦‚å¿µï¼Œç„¶åé€šè¿‡ReentrantLockå’ŒReentrantReadWriteLockçš„æºç æ¥ä»‹ç»ç‹¬äº«é”å’Œå…±äº«é”ã€‚ ç‹¬äº«é”ä¹Ÿå«æ’ä»–é”ï¼Œæ˜¯æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šæ’å®ƒé”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹ä¸èƒ½å†å¯¹AåŠ ä»»ä½•ç±»å‹çš„é”ã€‚è·å¾—æ’å®ƒé”çš„çº¿ç¨‹å³èƒ½è¯»æ•°æ®åˆèƒ½ä¿®æ”¹æ•°æ®ã€‚JDKä¸­çš„synchronizedå’ŒJUCä¸­Lockçš„å®ç°ç±»å°±æ˜¯äº’æ–¥é”ã€‚ å…±äº«é”æ˜¯æŒ‡è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šå…±äº«é”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹åªèƒ½å¯¹Aå†åŠ å…±äº«é”ï¼Œä¸èƒ½åŠ æ’å®ƒé”ã€‚è·å¾—å…±äº«é”çš„çº¿ç¨‹åªèƒ½è¯»æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚ ç‹¬äº«é”ä¸å…±äº«é”ä¹Ÿæ˜¯é€šè¿‡AQSæ¥å®ç°çš„ï¼Œé€šè¿‡å®ç°ä¸åŒçš„æ–¹æ³•ï¼Œæ¥å®ç°ç‹¬äº«æˆ–è€…å…±äº«ã€‚ ä¸‹å›¾ä¸ºReentrantReadWriteLockçš„éƒ¨åˆ†æºç ï¼š æˆ‘ä»¬çœ‹åˆ°ReentrantReadWriteLockæœ‰ä¸¤æŠŠé”ï¼šReadLockå’ŒWriteLockï¼Œç”±è¯çŸ¥æ„ï¼Œä¸€ä¸ªè¯»é”ä¸€ä¸ªå†™é”ï¼Œåˆç§°â€œè¯»å†™é”â€ã€‚å†è¿›ä¸€æ­¥è§‚å¯Ÿå¯ä»¥å‘ç°ReadLockå’ŒWriteLockæ˜¯é å†…éƒ¨ç±»Syncå®ç°çš„é”ã€‚Syncæ˜¯AQSçš„ä¸€ä¸ªå­ç±»ï¼Œè¿™ç§ç»“æ„åœ¨CountDownLatchã€ReentrantLockã€Semaphoreé‡Œé¢ä¹Ÿéƒ½å­˜åœ¨ã€‚ åœ¨ReentrantReadWriteLocké‡Œé¢ï¼Œè¯»é”å’Œå†™é”çš„é”ä¸»ä½“éƒ½æ˜¯Syncï¼Œä½†è¯»é”å’Œå†™é”çš„åŠ é”æ–¹å¼ä¸ä¸€æ ·ã€‚è¯»é”æ˜¯å…±äº«é”ï¼Œå†™é”æ˜¯ç‹¬äº«é”ã€‚è¯»é”çš„å…±äº«é”å¯ä¿è¯å¹¶å‘è¯»éå¸¸é«˜æ•ˆï¼Œè€Œè¯»å†™ã€å†™è¯»ã€å†™å†™çš„è¿‡ç¨‹äº’æ–¥ï¼Œå› ä¸ºè¯»é”å’Œå†™é”æ˜¯åˆ†ç¦»çš„ã€‚æ‰€ä»¥ReentrantReadWriteLockçš„å¹¶å‘æ€§ç›¸æ¯”ä¸€èˆ¬çš„äº’æ–¥é”æœ‰äº†å¾ˆå¤§æå‡ã€‚ é‚£è¯»é”å’Œå†™é”çš„å…·ä½“åŠ é”æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿåœ¨äº†è§£æºç ä¹‹å‰æˆ‘ä»¬éœ€è¦å›é¡¾ä¸€ä¸‹å…¶ä»–çŸ¥è¯†ã€‚ åœ¨æœ€å¼€å§‹æåŠAQSçš„æ—¶å€™æˆ‘ä»¬ä¹Ÿæåˆ°äº†stateå­—æ®µï¼ˆintç±»å‹ï¼Œ32ä½ï¼‰ï¼Œè¯¥å­—æ®µç”¨æ¥æè¿°æœ‰å¤šå°‘çº¿ç¨‹è·æŒæœ‰é”ã€‚ åœ¨ç‹¬äº«é”ä¸­è¿™ä¸ªå€¼é€šå¸¸æ˜¯0æˆ–è€…1ï¼ˆå¦‚æœæ˜¯é‡å…¥é”çš„è¯stateå€¼å°±æ˜¯é‡å…¥çš„æ¬¡æ•°ï¼‰ï¼Œåœ¨å…±äº«é”ä¸­stateå°±æ˜¯æŒæœ‰é”çš„æ•°é‡ã€‚ä½†æ˜¯åœ¨ReentrantReadWriteLockä¸­æœ‰è¯»ã€å†™ä¸¤æŠŠé”ï¼Œæ‰€ä»¥éœ€è¦åœ¨ä¸€ä¸ªæ•´å‹å˜é‡stateä¸Šåˆ†åˆ«æè¿°è¯»é”å’Œå†™é”çš„æ•°é‡ï¼ˆæˆ–è€…ä¹Ÿå¯ä»¥å«çŠ¶æ€ï¼‰ã€‚äºæ˜¯å°†stateå˜é‡â€œæŒ‰ä½åˆ‡å‰²â€åˆ‡åˆ†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œé«˜16ä½è¡¨ç¤ºè¯»é”çŠ¶æ€ï¼ˆè¯»é”ä¸ªæ•°ï¼‰ï¼Œä½16ä½è¡¨ç¤ºå†™é”çŠ¶æ€ï¼ˆå†™é”ä¸ªæ•°ï¼‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š äº†è§£äº†æ¦‚å¿µä¹‹åæˆ‘ä»¬å†æ¥çœ‹ä»£ç ï¼Œå…ˆçœ‹å†™é”çš„åŠ é”æºç ï¼š 12345678910111213141516171819protected final boolean tryAcquire(int acquires) &#123; Thread current = Thread.currentThread(); int c = getState(); // å–åˆ°å½“å‰é”çš„ä¸ªæ•° int w = exclusiveCount(c); // å–å†™é”çš„ä¸ªæ•°w if (c != 0) &#123; // å¦‚æœå·²ç»æœ‰çº¿ç¨‹æŒæœ‰äº†é”(c!=0) // (Note: if c != 0 and w == 0 then shared count != 0) if (w == 0 || current != getExclusiveOwnerThread()) // å¦‚æœå†™çº¿ç¨‹æ•°ï¼ˆwï¼‰ä¸º0ï¼ˆæ¢è¨€ä¹‹å­˜åœ¨è¯»é”ï¼‰ æˆ–è€…æŒæœ‰é”çš„çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹å°±è¿”å›å¤±è´¥ return false; if (w + exclusiveCount(acquires) &gt; MAX_COUNT) // å¦‚æœå†™å…¥é”çš„æ•°é‡å¤§äºæœ€å¤§æ•°ï¼ˆ65535ï¼Œ2çš„16æ¬¡æ–¹-1ï¼‰å°±æŠ›å‡ºä¸€ä¸ªErrorã€‚ throw new Error(\"Maximum lock count exceeded\"); // Reentrant acquire setState(c + acquires); return true; &#125; if (writerShouldBlock() || !compareAndSetState(c, c + acquires)) // å¦‚æœå½“ä¸”å†™çº¿ç¨‹æ•°ä¸º0ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹éœ€è¦é˜»å¡é‚£ä¹ˆå°±è¿”å›å¤±è´¥ï¼›æˆ–è€…å¦‚æœé€šè¿‡CASå¢åŠ å†™çº¿ç¨‹æ•°å¤±è´¥ä¹Ÿè¿”å›å¤±è´¥ã€‚ return false; setExclusiveOwnerThread(current); // å¦‚æœc=0ï¼Œw=0æˆ–è€…c&gt;0ï¼Œw&gt;0ï¼ˆé‡å…¥ï¼‰ï¼Œåˆ™è®¾ç½®å½“å‰çº¿ç¨‹æˆ–é”çš„æ‹¥æœ‰è€… return true;&#125; è¿™æ®µä»£ç é¦–å…ˆå–åˆ°å½“å‰é”çš„ä¸ªæ•°cï¼Œç„¶åå†é€šè¿‡cæ¥è·å–å†™é”çš„ä¸ªæ•°wã€‚å› ä¸ºå†™é”æ˜¯ä½16ä½ï¼Œæ‰€ä»¥å–ä½16ä½çš„æœ€å¤§å€¼ä¸å½“å‰çš„cåšä¸è¿ç®—ï¼ˆ int w = exclusiveCountÂ©; ï¼‰ï¼Œé«˜16ä½å’Œ0ä¸è¿ç®—åæ˜¯0ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä½ä½è¿ç®—çš„å€¼ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æŒæœ‰å†™é”çš„çº¿ç¨‹æ•°ç›®ã€‚ åœ¨å–åˆ°å†™é”çº¿ç¨‹çš„æ•°ç›®åï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯å¦å·²ç»æœ‰çº¿ç¨‹æŒæœ‰äº†é”ã€‚å¦‚æœå·²ç»æœ‰çº¿ç¨‹æŒæœ‰äº†é”(c!=0)ï¼Œåˆ™æŸ¥çœ‹å½“å‰å†™é”çº¿ç¨‹çš„æ•°ç›®ï¼Œå¦‚æœå†™çº¿ç¨‹æ•°ä¸º0ï¼ˆå³æ­¤æ—¶å­˜åœ¨è¯»é”ï¼‰æˆ–è€…æŒæœ‰é”çš„çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹å°±è¿”å›å¤±è´¥ï¼ˆæ¶‰åŠåˆ°å…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°ï¼‰ã€‚ å¦‚æœå†™å…¥é”çš„æ•°é‡å¤§äºæœ€å¤§æ•°ï¼ˆ65535ï¼Œ2çš„16æ¬¡æ–¹-1ï¼‰å°±æŠ›å‡ºä¸€ä¸ªErrorã€‚ å¦‚æœå½“ä¸”å†™çº¿ç¨‹æ•°ä¸º0ï¼ˆé‚£ä¹ˆè¯»çº¿ç¨‹ä¹Ÿåº”è¯¥ä¸º0ï¼Œå› ä¸ºä¸Šé¢å·²ç»å¤„ç†c!=0çš„æƒ…å†µï¼‰ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹éœ€è¦é˜»å¡é‚£ä¹ˆå°±è¿”å›å¤±è´¥ï¼›å¦‚æœé€šè¿‡CASå¢åŠ å†™çº¿ç¨‹æ•°å¤±è´¥ä¹Ÿè¿”å›å¤±è´¥ã€‚ å¦‚æœc=0,w=0æˆ–è€…c&gt;0,w&gt;0ï¼ˆé‡å…¥ï¼‰ï¼Œåˆ™è®¾ç½®å½“å‰çº¿ç¨‹æˆ–é”çš„æ‹¥æœ‰è€…ï¼Œè¿”å›æˆåŠŸï¼ tryAcquire()é™¤äº†é‡å…¥æ¡ä»¶ï¼ˆå½“å‰çº¿ç¨‹ä¸ºè·å–äº†å†™é”çš„çº¿ç¨‹ï¼‰ä¹‹å¤–ï¼Œå¢åŠ äº†ä¸€ä¸ªè¯»é”æ˜¯å¦å­˜åœ¨çš„åˆ¤æ–­ã€‚å¦‚æœå­˜åœ¨è¯»é”ï¼Œåˆ™å†™é”ä¸èƒ½è¢«è·å–ï¼ŒåŸå› åœ¨äºï¼šå¿…é¡»ç¡®ä¿å†™é”çš„æ“ä½œå¯¹è¯»é”å¯è§ï¼Œå¦‚æœå…è®¸è¯»é”åœ¨å·²è¢«è·å–çš„æƒ…å†µä¸‹å¯¹å†™é”çš„è·å–ï¼Œé‚£ä¹ˆæ­£åœ¨è¿è¡Œçš„å…¶ä»–è¯»çº¿ç¨‹å°±æ— æ³•æ„ŸçŸ¥åˆ°å½“å‰å†™çº¿ç¨‹çš„æ“ä½œã€‚ å› æ­¤ï¼Œåªæœ‰ç­‰å¾…å…¶ä»–è¯»çº¿ç¨‹éƒ½é‡Šæ”¾äº†è¯»é”ï¼Œå†™é”æ‰èƒ½è¢«å½“å‰çº¿ç¨‹è·å–ï¼Œè€Œå†™é”ä¸€æ—¦è¢«è·å–ï¼Œåˆ™å…¶ä»–è¯»å†™çº¿ç¨‹çš„åç»­è®¿é—®å‡è¢«é˜»å¡ã€‚å†™é”çš„é‡Šæ”¾ä¸ReentrantLockçš„é‡Šæ”¾è¿‡ç¨‹åŸºæœ¬ç±»ä¼¼ï¼Œæ¯æ¬¡é‡Šæ”¾å‡å‡å°‘å†™çŠ¶æ€ï¼Œå½“å†™çŠ¶æ€ä¸º0æ—¶è¡¨ç¤ºå†™é”å·²è¢«é‡Šæ”¾ï¼Œç„¶åç­‰å¾…çš„è¯»å†™çº¿ç¨‹æ‰èƒ½å¤Ÿç»§ç»­è®¿é—®è¯»å†™é”ï¼ŒåŒæ—¶å‰æ¬¡å†™çº¿ç¨‹çš„ä¿®æ”¹å¯¹åç»­çš„è¯»å†™çº¿ç¨‹å¯è§ã€‚ æ¥ç€æ˜¯è¯»é”çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627protected final int tryAcquireShared(int unused) &#123; Thread current = Thread.currentThread(); int c = getState(); if (exclusiveCount(c) != 0 &amp;&amp; getExclusiveOwnerThread() != current) return -1; // å¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–è¯»é”å¤±è´¥ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ int r = sharedCount(c); if (!readerShouldBlock() &amp;&amp; r &lt; MAX_COUNT &amp;&amp; compareAndSetState(c, c + SHARED_UNIT)) &#123; if (r == 0) &#123; firstReader = current; firstReaderHoldCount = 1; &#125; else if (firstReader == current) &#123; firstReaderHoldCount++; &#125; else &#123; HoldCounter rh = cachedHoldCounter; if (rh == null || rh.tid != getThreadId(current)) cachedHoldCounter = rh = readHolds.get(); else if (rh.count == 0) readHolds.set(rh); rh.count++; &#125; return 1; &#125; return fullTryAcquireShared(current);&#125; å¯ä»¥çœ‹åˆ°åœ¨tryAcquireShared(int unused)æ–¹æ³•ä¸­ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–è¯»é”å¤±è´¥ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚å¦‚æœå½“å‰çº¿ç¨‹è·å–äº†å†™é”æˆ–è€…å†™é”æœªè¢«è·å–ï¼Œåˆ™å½“å‰çº¿ç¨‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œä¾é CASä¿è¯ï¼‰å¢åŠ è¯»çŠ¶æ€ï¼ŒæˆåŠŸè·å–è¯»é”ã€‚è¯»é”çš„æ¯æ¬¡é‡Šæ”¾ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼Œå¯èƒ½æœ‰å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶é‡Šæ”¾è¯»é”ï¼‰å‡å‡å°‘è¯»çŠ¶æ€ï¼Œå‡å°‘çš„å€¼æ˜¯â€œ1&lt;&lt;16â€ã€‚æ‰€ä»¥è¯»å†™é”æ‰èƒ½å®ç°è¯»è¯»çš„è¿‡ç¨‹å…±äº«ï¼Œè€Œè¯»å†™ã€å†™è¯»ã€å†™å†™çš„è¿‡ç¨‹äº’æ–¥ã€‚ æ­¤æ—¶ï¼Œæˆ‘ä»¬å†å›å¤´çœ‹ä¸€ä¸‹äº’æ–¥é”ReentrantLockä¸­å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŠ é”æºç ï¼š æˆ‘ä»¬å‘ç°åœ¨ReentrantLockè™½ç„¶æœ‰å…¬å¹³é”å’Œéå…¬å¹³é”ä¸¤ç§ï¼Œä½†æ˜¯å®ƒä»¬æ·»åŠ çš„éƒ½æ˜¯ç‹¬äº«é”ã€‚æ ¹æ®æºç æ‰€ç¤ºï¼Œå½“æŸä¸€ä¸ªçº¿ç¨‹è°ƒç”¨lockæ–¹æ³•è·å–é”æ—¶ï¼Œå¦‚æœåŒæ­¥èµ„æºæ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹åœ¨ä½¿ç”¨CASæ›´æ–°stateæˆåŠŸåå°±ä¼šæˆåŠŸæŠ¢å è¯¥èµ„æºã€‚è€Œå¦‚æœå…¬å…±èµ„æºè¢«å ç”¨ä¸”ä¸æ˜¯è¢«å½“å‰çº¿ç¨‹å ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šåŠ é”å¤±è´¥ã€‚æ‰€ä»¥å¯ä»¥ç¡®å®šReentrantLockæ— è®ºè¯»æ“ä½œè¿˜æ˜¯å†™æ“ä½œï¼Œæ·»åŠ çš„é”éƒ½æ˜¯éƒ½æ˜¯ç‹¬äº«é”ã€‚ é—­é” VS æ­»é” VS æ´»é”é—­é”é—­é”æ˜¯ä¸€ç§åŒæ­¥å·¥å…·ç±»ï¼Œå¯ä»¥å»¶è¿Ÿçº¿ç¨‹çš„è¿›åº¦ç›´åˆ°å…¶åˆ°è¾¾ç»ˆæ­¢çŠ¶æ€ã€‚é—­é”çš„ä½œç”¨ç›¸å½“äºä¸€æ‰‡é—¨ï¼šåœ¨é—­é”åˆ°è¾¾ç»“æŸçŠ¶æ€ä¹‹å‰ï¼Œè¿™æ‰‡é—¨ä¸€ç›´æ˜¯å…³é—­çš„ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•çº¿ç¨‹èƒ½é€šè¿‡ï¼Œå½“åˆ°è¾¾ç»“æŸçŠ¶æ€æ—¶ï¼Œè¿™æ‰‡é—¨ä¼šæ‰“å¼€å…è®¸æ‰€æœ‰çš„çº¿ç¨‹é€šè¿‡ã€‚å½“é—­é”åˆ°è¾¾ç»“æŸçŠ¶æ€åï¼Œå°†ä¸ä¼šå†æ”¹å˜çŠ¶æ€ï¼Œå› æ­¤è¿™æ‰‡é—¨å°†æ°¸è¿œä¿æŒæ‰“å¼€çŠ¶æ€ã€‚é—­é”å¯ä»¥ç”¨æ¥ç¡®ä¿æŸäº›æ´»åŠ¨æŒ‡å¯¼å…¶ä»–æ´»åŠ¨éƒ½å®Œæˆåæ‰ç»§ç»­æ‰§è¡Œã€‚CountDownLatchå°±æ˜¯ä¸€ç§çµæ´»çš„é—­é”å®ç°ã€‚ æ­»é”æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…ï¼ˆé”åµŒå¥—ï¼‰çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œä»–ä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œå› ä¸ºæ­»é”ä¼šè®©ä½ çš„ç¨‹åºæŒ‚èµ·æ— æ³•å®Œæˆä»»åŠ¡ï¼Œæ­»é”çš„å‘ç”Ÿå¿…é¡»æ»¡è¶³ä¸€ä¸‹4ä¸ªæ¡ä»¶ï¼š äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚ è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚ ä¸å‰¥å¤ºæ¡ä»¶ï¼šè¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚ å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šè‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚ é¿å…æ­»é”æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯é˜»æ­¢å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼Œå°†ç³»ç»Ÿä¸­æ‰€æœ‰çš„èµ„æºè®¾ç½®æ ‡å¿—ä½ã€æ’åºï¼Œè§„å®šæ‰€æœ‰çš„è¿›ç¨‹ç”³è¯·èµ„æºå¿…é¡»ä»¥ä¸€å®šçš„é¡ºåºåšæ“ä½œæ¥é¿å…æ­»é”ã€‚ æ´»é”LiveLockæ˜¯ä¸€ç§å½¢å¼æ´»è·ƒæ€§é—®é¢˜ï¼Œè¯¥é—®é¢˜å°½ç®¡ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œä½†ä¹Ÿä¸èƒ½ç»§ç»­æ‰§è¡Œï¼Œå› ä¸ºçº¿ç¨‹å°†ä¸æ–­é‡å¤æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œè€Œä¸”æ€»ä¼šå¤±è´¥ã€‚æ´»é”é€šå¸¸å‘é€åœ¨å¤„ç†äº‹åŠ¡æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºä¸­ï¼šå¦‚æœä¸èƒ½æˆåŠŸåœ°å¤„ç†æŸä¸ªæ¶ˆæ¯ï¼Œé‚£ä¹ˆæ¶ˆæ¯å¤„ç†æœºåˆ¶å°†å›æ»šæ•´ä¸ªäº‹åŠ¡ï¼Œå¹¶å°†å®ƒé‡æ–°æ”¾åˆ°é˜Ÿåˆ—çš„å¼€å¤´ï¼šå¦‚æœä¸èƒ½æˆåŠŸåœ°å¤„ç†æŸä¸ªæ¶ˆæ¯ï¼Œé‚£ä¹ˆæ¶ˆæ¯å¤„ç†æœºåˆ¶å°†å›æ»šæ•´ä¸ªäº‹åŠ¡ï¼Œå¹¶å°†å®ƒé‡æ–°æ”¾åˆ°é˜Ÿåˆ—çš„å¼€å¤´ã€‚å¦‚æœæ¶ˆæ¯å¤„ç†å™¨åœ¨å¤„ç†æŸç§ç‰¹å®šç±»å‹çš„æ¶ˆæ¯æ—¶å­˜åœ¨é”™è¯¯å¹¶å¯¼è‡´å®ƒå¤±è´¥ï¼Œé‚£ä¹ˆæ¯å½“è¿™ä¸ªæ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­å–å‡ºå¹¶ä¼ é€’åˆ°å­˜åœ¨é”™è¯¯çš„å¤„ç†å™¨æ—¶ï¼Œéƒ½ä¼šå‘ç”Ÿäº‹åŠ¡å›æ»šã€‚ç”±äºè¿™æ¡æ¶ˆæ¯åˆè¢«æ”¾å›åˆ°é˜Ÿåˆ—å¼€å¤´ï¼Œå› æ­¤å¤„ç†å™¨å°†è¢«åå¤è°ƒç”¨ï¼Œå¹¶è¿”å›ç›¸åŒçš„ç»“æœã€‚ æ€»ç»“æœ¬æ–‡Javaä¸­å¸¸ç”¨çš„é”ä»¥åŠå¸¸è§çš„é”çš„æ¦‚å¿µè¿›è¡Œäº†åŸºæœ¬ä»‹ç»ï¼Œå¹¶ä»æºç ä»¥åŠå®é™…åº”ç”¨çš„è§’åº¦è¿›è¡Œäº†å¯¹æ¯”åˆ†æã€‚é™äºç¯‡å¹…ä»¥åŠä¸ªäººæ°´å¹³ï¼Œæ²¡æœ‰åœ¨æœ¬ç¯‡æ–‡ç« ä¸­å¯¹æ‰€æœ‰å†…å®¹è¿›è¡Œæ·±å±‚æ¬¡çš„è®²è§£ã€‚åç»­æˆ‘æœ¬äººå°†ä¼šå¯¹Javaçš„é”è¿›è¡Œä¾æ¬¡è®²è§£ã€‚ å…¶å®Javaæœ¬èº«å·²ç»å¯¹é”æœ¬èº«è¿›è¡Œäº†è‰¯å¥½çš„å°è£…ï¼Œé™ä½äº†æˆ‘ä»¬åœ¨å¹³æ—¶å·¥ä½œä¸­çš„ä½¿ç”¨éš¾åº¦ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿéœ€è¦ç†Ÿæ‚‰é”çš„åº•å±‚åŸç†ï¼Œä¸åŒåœºæ™¯ä¸‹é€‰æ‹©æœ€é€‚åˆçš„é”ã€‚è€Œä¸”æºç ä¸­çš„æ€è·¯éƒ½æ˜¯éå¸¸å¥½çš„æ€è·¯ï¼Œä¹Ÿæ˜¯å€¼å¾—å¤§å®¶å»å­¦ä¹ å’Œå€Ÿé‰´çš„ã€‚ å‚è€ƒæ–‡çŒ® ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬2ç‰ˆï¼‰ã€‹å‘¨å¿—æ˜è‘— ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹æ–¹è…¾é£ç­‰è‘— Java CAS åŸç†å‰–æ Javaä¸­çš„é” Java synchronizedåŸç†æ€»ç»“ Javaå¹¶å‘â€”å…³é”®å­—synchronizedè§£æ èŠèŠå¹¶å‘ï¼ˆäºŒï¼‰â€”Java SE1.6ä¸­çš„Synchronized æ·±å…¥ç†è§£è¯»å†™é”â€”ReadWriteLockæºç åˆ†æ ã€JUCã€‘JDK1.8æºç åˆ†æä¹‹ReentrantReadWriteLock Javaå¤šçº¿ç¨‹ï¼ˆåï¼‰ä¹‹ReentrantReadWriteLockæ·±å…¥åˆ†æ Javaâ€“è¯»å†™é”çš„å®ç°åŸç†","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"JVMåŠå¹¶å‘ç¼–ç¨‹","slug":"JVMåŠå¹¶å‘ç¼–ç¨‹","permalink":"http://ltyeamin.github.io/tags/JVMåŠå¹¶å‘ç¼–ç¨‹/"}]},{"title":"æ·±å…¥åˆ†æHashMapæºç ","slug":"æ·±å…¥åˆ†æHashMapæºç ","date":"2019-04-01T12:47:22.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2019/04/01/æ·±å…¥åˆ†æHashMapæºç /","link":"","permalink":"http://ltyeamin.github.io/2019/04/01/æ·±å…¥åˆ†æHashMapæºç /","excerpt":"","text":"Mapè¿™ç§Key-Valueæ ¼å¼çš„æ•°æ®ç»“æ„åœ¨æ—¥å¸¸å¼€å‘ä¸­æ˜¯éå¸¸çš„å¸¸è§ï¼Œå¤§éƒ¨åˆ†çš„é«˜çº§ç¼–ç¨‹è¯­è¨€éƒ½æœ‰Mapç±»å‹ï¼ŒMapç±»å‹å¸¸ç”¨äºåœ¨å†…å­˜ä¸­å­˜å–æ•°æ®ã€‚ åœ¨Javaä¸­ï¼ŒHashMapæ˜¯Javaç¨‹åºå‘˜ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„ç”¨äºæ˜ å°„(é”®å€¼å¯¹)å¤„ç†çš„æ•°æ®ç±»å‹ã€‚éšç€JDKï¼ˆJava Developmet Kitï¼‰ç‰ˆæœ¬çš„æ›´æ–°ï¼ŒJDK1.8å¯¹HashMapåº•å±‚çš„å®ç°è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¾‹å¦‚å¼•å…¥çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„å’Œæ‰©å®¹çš„ä¼˜åŒ–ç­‰ã€‚æœ¬æ–‡æ·±å…¥æ¢è®¨JDK1.8çš„HashMapçš„ç»“æ„å®ç°å’ŒåŠŸèƒ½åŸç†ã€‚ Javaä¸ºæ•°æ®ç»“æ„ä¸­çš„æ˜ å°„å®šä¹‰äº†ä¸€ä¸ªæ¥å£java.util.Mapï¼Œæ­¤æ¥å£ä¸»è¦æœ‰å››ä¸ªå¸¸ç”¨çš„å®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯HashMapã€Hashtableã€LinkedHashMapå’ŒTreeMapï¼Œç±»ç»§æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸‹é¢é’ˆå¯¹å„ä¸ªå®ç°ç±»çš„ç‰¹ç‚¹åšä¸€äº›è¯´æ˜ï¼š HashMapï¼šå®ƒæ ¹æ®é”®çš„hashCodeå€¼å­˜å‚¨æ•°æ®ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éå†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚ HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚HashMapéçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚ Hashtableï¼šHashtableæ˜¯é—ç•™ç±»ï¼Œå¾ˆå¤šæ˜ å°„çš„å¸¸ç”¨åŠŸèƒ½ä¸HashMapç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒæ‰¿è‡ªDictionaryç±»ï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»»ä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å†™Hashtableï¼Œå¹¶å‘æ€§ä¸å¦‚ConcurrentHashMapï¼Œå› ä¸ºConcurrentHashMapå¼•å…¥äº†åˆ†æ®µé”ï¼ˆJDK8è¿˜æœ‰ä¼˜åŒ–ï¼‰ã€‚Hashtableä¸å»ºè®®åœ¨æ–°ä»£ç ä¸­ä½¿ç”¨ï¼Œä¸éœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨HashMapæ›¿æ¢ï¼Œéœ€è¦çº¿ç¨‹å®‰å…¨çš„åœºåˆå¯ä»¥ç”¨ConcurrentHashMapæ›¿æ¢ã€‚ LinkedHashMapï¼šLinkedHashMapæ˜¯HashMapçš„ä¸€ä¸ªå­ç±»ï¼Œä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåºï¼Œåœ¨ç”¨Iteratoréå†LinkedHashMapæ—¶ï¼Œå…ˆå¾—åˆ°çš„è®°å½•è‚¯å®šæ˜¯å…ˆæ’å…¥çš„ï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ—¶å¸¦å‚æ•°ï¼ŒæŒ‰ç…§è®¿é—®æ¬¡åºæ’åºã€‚ TreeMapï¼šTreeMapå®ç°SortedMapæ¥å£ï¼Œèƒ½å¤ŸæŠŠå®ƒä¿å­˜çš„è®°å½•æ ¹æ®é”®æ’åºï¼Œé»˜è®¤æ˜¯æŒ‰é”®å€¼çš„å‡åºæ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ’åºçš„æ¯”è¾ƒå™¨ï¼Œå½“ç”¨Iteratoréå†TreeMapæ—¶ï¼Œå¾—åˆ°çš„è®°å½•æ˜¯æ’è¿‡åºçš„ã€‚å¦‚æœä½¿ç”¨æ’åºçš„æ˜ å°„ï¼Œå»ºè®®ä½¿ç”¨TreeMapã€‚åœ¨ä½¿ç”¨TreeMapæ—¶ï¼Œkeyå¿…é¡»å®ç°Comparableæ¥å£æˆ–è€…åœ¨æ„é€ TreeMapä¼ å…¥è‡ªå®šä¹‰çš„Comparatorï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºjava.lang.ClassCastExceptionç±»å‹çš„å¼‚å¸¸ã€‚ å¯¹äºä¸Šè¿°å››ç§Mapç±»å‹çš„ç±»ï¼Œè¦æ±‚æ˜ å°„ä¸­çš„keyæ˜¯ä¸å¯å˜å¯¹è±¡ã€‚ä¸å¯å˜å¯¹è±¡æ˜¯è¯¥å¯¹è±¡åœ¨åˆ›å»ºåå®ƒçš„å“ˆå¸Œå€¼ä¸ä¼šè¢«æ”¹å˜ã€‚å¦‚æœå¯¹è±¡çš„å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–ï¼ŒMapå¯¹è±¡å¾ˆå¯èƒ½å°±å®šä½ä¸åˆ°æ˜ å°„çš„ä½ç½®äº†ã€‚ é€šè¿‡ä¸Šé¢çš„æ¯”è¾ƒï¼Œæˆ‘ä»¬çŸ¥é“äº†HashMapæ˜¯Javaçš„Mapå®¶æ—ä¸­ä¸€ä¸ªæ™®é€šæˆå‘˜ï¼Œé‰´äºå®ƒå¯ä»¥æ»¡è¶³å¤§å¤šæ•°åœºæ™¯çš„ä½¿ç”¨æ¡ä»¶ï¼Œæ‰€ä»¥æ˜¯ä½¿ç”¨é¢‘åº¦æœ€é«˜çš„ä¸€ä¸ªã€‚ä¸‹æ–‡æˆ‘ä»¬ä¸»è¦ç»“åˆæºç ï¼Œä»å­˜å‚¨ç»“æ„ã€å¸¸ç”¨æ–¹æ³•åˆ†æã€æ‰©å®¹ä»¥åŠå®‰å…¨æ€§ç­‰æ–¹é¢æ·±å…¥è®²è§£HashMapçš„å·¥ä½œåŸç†ã€‚ ææ¸…æ¥šHashMapï¼Œé¦–å…ˆéœ€è¦çŸ¥é“HashMapæ˜¯ä»€ä¹ˆï¼Œå³å®ƒçš„å­˜å‚¨ç»“æ„-å­—æ®µï¼›å…¶æ¬¡å¼„æ˜ç™½å®ƒèƒ½å¹²ä»€ä¹ˆï¼Œå³å®ƒçš„åŠŸèƒ½å®ç°-æ–¹æ³•ã€‚ä¼—æ‰€å‘¨çŸ¥ HashMap åº•å±‚æ˜¯åŸºäºæ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œä¸‹é¢æˆ‘ä»¬é’ˆå¯¹è¿™ä¸¤ä¸ªæ–¹é¢è¯¦ç»†å±•å¼€è®²è§£ã€‚ æ•°æ®ç»“æ„åœ¨JDK1.7ä¹‹å‰çš„HashMapçš„ç»“æ„ä¸­ï¼Œå…¶å®å­˜åœ¨ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„ç¼ºé™·å°±æ˜¯: å½“ Hash å†²çªä¸¥é‡æ—¶ï¼Œåœ¨æ¡¶ä¸Šå½¢æˆçš„é“¾è¡¨ä¼šå˜çš„è¶Šæ¥è¶Šé•¿ï¼Œè¿™æ ·åœ¨æŸ¥è¯¢æ—¶çš„æ•ˆç‡å°±ä¼šè¶Šæ¥è¶Šä½ï¼›æ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚ JDK8é‡ç‚¹ä¼˜åŒ–äº†è¿™ä¸ªæŸ¥è¯¢æ•ˆç‡ï¼Œåœ¨åŸå…ˆçš„æ•°ç»„+é“¾è¡¨ä¸Šå†å¢åŠ çº¢é»‘æ ‘ã€‚å½“é“¾è¡¨å¤§å°è¾¾åˆ°ä¸€å®šçš„é˜ˆå€¼(HashMapæ˜¯8)æ—¶ï¼Œä¼šè‡ªåŠ¨è½¬æ¢ä¸ºçº¢é»‘æ ‘çš„æ•°æ®ç»“æ„ã€‚ä¿®æ”¹ä¸ºçº¢é»‘æ ‘ä¹‹åæŸ¥è¯¢æ•ˆç‡å³æ—¶é—´å¤æ‚åº¦ç›´æ¥æé«˜åˆ°äº† O(logn)ã€‚ æºç åˆ†ææˆå‘˜å˜é‡123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108/** * é»˜è®¤ä½æ¡¶æ•°ç»„åˆå§‹å®¹é‡,å¿…é¡»æ˜¯2çš„å¹‚,è¿™é‡Œé»˜è®¤æ˜¯16 * The default initial capacity - MUST be a power of two. */static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16/** * ä½æ¡¶æ•°ç»„å¤§å°çš„æœ€å¤§å€¼ã€‚æ„é€ å‚æ•°çš„å¤§å°å¿…é¡»æ˜¯2çš„å‡ æ¬¡å¹‚å¹¶ä¸”å°äºç­‰äº1&lt;&lt;30 * The maximum capacity, used if a higher value is implicitly specified * by either of the constructors with arguments. * MUST be a power of two &lt;= 1&lt;&lt;30. */static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;/** * é»˜è®¤è´Ÿè½½å› å­æ˜¯0.75ï¼Œå¯ä»¥åœ¨æ„é€ å‚æ•°é‡Œè®¾ç½® * The load factor used when none specified in constructor. */static final float DEFAULT_LOAD_FACTOR = 0.75f;/** * ä¸€ä¸ªæ¡¶ä¸­çš„binçš„å­˜å‚¨æ–¹å¼ç”±é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘çš„é˜ˆå€¼ï¼Œå½“é“¾è¡¨å¤§å°è¶…è¿‡TREEIFY_THRESHOLDçš„æ—¶å€™è½¬æ¢ä¸ºçº¢é»‘æ ‘ * The bin count threshold for using a tree rather than list for a * bin. Bins are converted to trees when adding an element to a * bin with at least this many nodes. The value must be greater * than 2 and should be at least 8 to mesh with assumptions in * tree removal about conversion back to plain bins upon * shrinkage. */static final int TREEIFY_THRESHOLD = 8;/** * çº¢é»‘æ•°è½¬æ¢ä¸ºé“¾è¡¨(æ”¶ç¼©æœºåˆ¶)ï¼Œå½“æ‰§è¡Œresizeæ“ä½œæ—¶,æ¡¶ä¸­binçš„æ•°é‡å°‘äºUNTREEIFY_THRESHOLDæ—¶6æ—¶ï¼Œæ­¤æ—¶æ”¶ * ç¼©ä¸ºæ™®é€šé“¾è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ * The bin count threshold for untreeifying a (split) bin during a * resize operation. Should be less than TREEIFY_THRESHOLD, and at * most 6 to mesh with shrinkage detection under removal. */static final int UNTREEIFY_THRESHOLD = 6;/** * å½“æ¡¶ä¸­binè¢«æ ‘åŒ–æ—¶æœ€å°çš„hashè¡¨å®¹é‡.(è‹¥æ²¡æœ‰è¾¾åˆ°è¿™ä¸ªé˜ˆå€¼,å³hashè¡¨å®¹é‡å°äºMIN_TREEIFY_CAPACITY * å½“æ¡¶ä¸­binæ•°é‡å¤ªå¤šæ—¶ä¼šæ‰§è¡Œresizeæ‰©å®¹æ“ä½œ).è¿™ä¸ªMIN_TREEIFY_CAPACITYçš„å€¼è‡³å°‘TREEIFY_THRESHOLD * çš„4å€ã€‚ * The smallest table capacity for which bins may be treeified. * (Otherwise the table is resized if too many nodes in a bin.) * Should be at least 4 * TREEIFY_THRESHOLD to avoid conflicts * between resizing and treeification thresholds. */static final int MIN_TREEIFY_CAPACITY = 64;/** * ä½æ¡¶æ•°ç»„ï¼Œå³Hashè¡¨ï¼Œå…¶å¤§å°æ€»æ˜¯2çš„å‡ æ¬¡å¹‚ï¼ŒJDK1.7ç±»å‹æ˜¯Entry&lt;K,V&gt;[],JDK8ä¼˜åŒ–æˆNode&lt;K,V&gt;[] * The table, initialized on first use, and resized as * necessary. When allocated, length is always a power of two. * (We also tolerate length zero in some operations to allow * bootstrapping mechanics that are currently not needed.) */transient Node&lt;K,V&gt;[] table;/** * ç¼“å­˜çš„entrySetï¼Œå³é”®å€¼å¯¹æ˜ å°„å¯¹è±¡ï¼Œè¿™é‡Œä½¿ç”¨äº†AbstractMapçš„keyset()å’Œvalues() * Holds cached entrySet(). Note that AbstractMap fields are used * for keySet() and values(). */transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;/** * å½“å‰mapä¸­åŒ…å«çš„key-valueæ•°ï¼Œå³mapçš„å¤§å° * The number of key-value mappings contained in this map. */transient int size;/** * * HashMapçš„ä¿®æ”¹æ¬¡æ•°ï¼Œåœ¨è¿­ä»£å™¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¼šå°†è¿™ä¸ªå€¼èµ‹ç»™è¿­ä»£å™¨çš„expectedModCountï¼Œ * æ¯”å¦‚è¿­ä»£å™¨è¿­ä»£æ—¶å€™æˆ‘ä»¬æ‰‹åŠ¨åˆ é™¤å…ƒç´ æ—¶ï¼ŒmodCountä¼šå¢åŠ è¿™ä¸ªå€¼ã€‚åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œåˆ¤æ–­modCountå’Œ * expectedModCountæ˜¯å¦ç›¸ç­‰ï¼Œä¸ç›¸ç­‰åˆ™æŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ * Fail-Fastæœºåˆ¶ã€‚åŒæ ·ï¼ŒArrayList,LinkedListä¹Ÿæœ‰è¿™ä¸ªå­—æ®µã€‚ * å…·ä½“è¯¦æƒ…è¯·å‚ç…§HashMapæºç ä¸‹çš„æŠ½è±¡è¿­ä»£ç±»HashIteratorï¼Œ * The number of times this HashMap has been structurally modified * Structural modifications are those that change the number of mappings in * the HashMap or otherwise modify its internal structure (e.g., * rehash). This field is used to make iterators on Collection-views of * the HashMap fail-fast. (See ConcurrentModificationException). */transient int modCount;/** * è¦æ ¹æ®thresholdçš„é˜ˆå€¼æ¥åˆ¤æ–­mapæ˜¯å¦è¦æ‰©å®¹ï¼Œå³threshold = capacity * load factorï¼Œ * ç¬¬ä¸€æ¬¡æ‰©å®¹ä¸º16 * 0.75 = 12 ï¼Œ å½“mapçš„æ•°ç»„å®¹é‡ä¸º12çš„æ—¶ï¼Œæ­¤æ—¶éœ€è¦ç»§ç»­æ‰©å®¹ã€‚ * The next size value at which to resize (capacity * load factor). * * @serial */// (The javadoc description is true upon serialization.// Additionally, if the table array has not been allocated, this// field holds the initial array capacity, or zero signifying// DEFAULT_INITIAL_CAPACITY.)int threshold;/** * hash tableçš„é»˜è®¤è´Ÿè½½å› å­ï¼Œé»˜è®¤æ˜¯DEFAULT_LOAD_FACTORï¼Œå³0.75 * The load factor for the hash table. * @serial */final float loadFactor; æ•°æ®ç»“æ„Nodeä½æ¡¶èŠ‚ç‚¹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859/** * åŸºæœ¬çš„hashæ¡¶èŠ‚ç‚¹ï¼Œå³æ•°ç»„å­˜æ”¾çš„å…ƒç´ ç±»å‹ï¼Œå®ç°äº†Map.Entry&lt;K,V&gt;æ¥å£ã€‚ * JDK1.7çš„ç»“æ„æ˜¯Map.Entry&lt;K, V&gt;çš„å­ç±»HashEntry&lt;K, V&gt; * Basic hash bin node, used for most entries. (See below for * TreeNode subclass, and in LinkedHashMap for its Entry subclass.) */static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; // keyçš„å“ˆå¸Œå€¼ï¼Œç”¨æ¥å®šä½æ•°ç»„ç´¢å¼•ä½ç½® final int hash; // mapçš„keyï¼Œä¸å¯ä¸å˜å¯¹è±¡ï¼Œä¸€æ—¦è®¾ç½®æ–°Keyï¼Œä¸å¯æ›´æ”¹keyçš„å€¼ï¼ŒHashMapä¸­å¯å­˜nullå€¼ final K key; // mapçš„valueï¼Œä¹Ÿå¯ä»¥å­˜æ”¾nullå€¼ã€‚keyç›¸åŒåˆ™è¦†ç›–value, V value; // é“¾è¡¨çš„ä¸‹ä¸€ä¸ªnode Node&lt;K,V&gt; next; // æ„é€ å‡½æ•° Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125; // è·å–key public final K getKey() &#123; return key; &#125; // è·å–value public final V getValue() &#123; return value; &#125; // é‡å†™toString public final String toString() &#123; return key + \"=\" + value; &#125; // é‡å†™hashCodeï¼Œnodeçš„hashCodeä¸ºkeyçš„hashCodeä¸valueçš„hashCodeçš„å¼‚æˆ–ç»“æœ public final int hashCode() &#123; return Objects.hashCode(key) ^ Objects.hashCode(value); &#125; // è®¾ç½®æ–°çš„valueï¼Œè¿”å›æ—§çš„value public final V setValue(V newValue) &#123; V oldValue = value; value = newValue; return oldValue; &#125; // ä¸€èˆ¬é‡å†™äº†hashCodeæ–¹æ³•ï¼Œequalsä¹Ÿä¼šé‡å†™ã€‚ public final boolean equals(Object o) &#123; // å¼•ç”¨éƒ½æ˜¯ä¸€ä¸ªï¼Œåˆ™åˆ¤æ–­æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œç›´æ¥è¿”å›true if (o == this) return true; // åˆ¤æ–­æ˜¯å¦æ˜¯Map.EntryåŒä¸€ç±»å‹ï¼Œè‹¥ç±»å‹ä¸åŒï¼Œåˆ™è¿”å›false if (o instanceof Map.Entry) &#123; // è‹¥æ˜¯ Map.Entryç±»å‹ï¼Œè¿›è¡Œå‘ä¸‹è½¬å‹ã€‚ Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o; // å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„keyå’ŒvalueåŒæ—¶éƒ½ç›¸ç­‰ï¼Œåˆ™è®¤ä¸ºæ˜¯ç›¸ç­‰ï¼Œè¿”å›true if (Objects.equals(key, e.getKey()) &amp;&amp; Objects.equals(value, e.getValue())) return true; &#125; return false; &#125;&#125; TreeNodeçº¢é»‘æ ‘123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133/** * çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œç»§æ‰¿LinkedHashMap.Entry&lt;K,V&gt; * Entry for Tree bins. Extends LinkedHashMap.Entry (which in turn * extends Node) so can be used as extension of either regular or * linked node. */static final class TreeNode&lt;K,V&gt; extends LinkedHashMap.Entry&lt;K,V&gt; &#123; TreeNode&lt;K,V&gt; parent; // red-black tree links TreeNode&lt;K,V&gt; left; TreeNode&lt;K,V&gt; right; TreeNode&lt;K,V&gt; prev; // needed to unlink next upon deletion boolean red; TreeNode(int hash, K key, V val, Node&lt;K,V&gt; next) &#123; super(hash, key, val, next); &#125; /** * Returns root of tree containing this node. */ final TreeNode&lt;K,V&gt; root() &#123; for (TreeNode&lt;K,V&gt; r = this, p;;) &#123; if ((p = r.parent) == null) return r; r = p; &#125; &#125; /** * æŠŠçº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹è®¾ä¸º å…¶æ‰€åœ¨çš„æ•°ç»„æ§½ çš„ç¬¬ä¸€ä¸ªå…ƒç´  * é¦–å…ˆæ˜ç¡®ï¼šTreeNodeæ—¢æ˜¯ä¸€ä¸ªçº¢é»‘æ ‘ç»“æ„ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåŒé“¾è¡¨ç»“æ„ * è¿™ä¸ªæ–¹æ³•é‡Œåšçš„äº‹æƒ…ï¼Œå°±æ˜¯ä¿è¯æ ‘çš„æ ¹èŠ‚ç‚¹ä¸€å®šä¹Ÿè¦æˆä¸ºé“¾è¡¨çš„é¦–èŠ‚ç‚¹ */ static &lt;K,V&gt; void moveRootToFront(Node&lt;K,V&gt;[] tab, TreeNode&lt;K,V&gt; root) &#123; int n; if (root != null &amp;&amp; tab != null &amp;&amp; (n = tab.length) &gt; 0) &#123; // æ ¹èŠ‚ç‚¹ä¸ä¸ºç©º å¹¶ä¸” HashMapçš„å…ƒç´ æ•°ç»„ä¸ä¸ºç©º int index = (n - 1) &amp; root.hash; // æ ¹æ®æ ¹èŠ‚ç‚¹çš„Hashå€¼ å’Œ HashMapçš„å…ƒç´ æ•°ç»„é•¿åº¦ å–å¾—æ ¹èŠ‚ç‚¹åœ¨æ•°ç»„ä¸­çš„ä½ç½® TreeNode&lt;K,V&gt; first = (TreeNode&lt;K,V&gt;)tab[index]; // é¦–å…ˆå–å¾—è¯¥ä½ç½®ä¸Šçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¯¹è±¡ if (root != first) &#123; // å¦‚æœè¯¥èŠ‚ç‚¹å¯¹è±¡ ä¸ æ ¹èŠ‚ç‚¹å¯¹è±¡ ä¸åŒ Node&lt;K,V&gt; rn; // å®šä¹‰æ ¹èŠ‚ç‚¹çš„åä¸€ä¸ªèŠ‚ç‚¹ tab[index] = root; // æŠŠå…ƒç´ æ•°ç»„indexä½ç½®çš„å…ƒç´ æ›¿æ¢ä¸ºæ ¹èŠ‚ç‚¹å¯¹è±¡ TreeNode&lt;K,V&gt; rp = root.prev; // è·å–æ ¹èŠ‚ç‚¹å¯¹è±¡çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ if ((rn = root.next) != null) // å¦‚æœåèŠ‚ç‚¹ä¸ä¸ºç©º ((TreeNode&lt;K,V&gt;)rn).prev = rp; // rootåèŠ‚ç‚¹çš„å‰èŠ‚ç‚¹ æŒ‡å‘åˆ° rootçš„å‰èŠ‚ç‚¹ï¼Œç›¸å½“äºæŠŠrootä»é“¾è¡¨ä¸­æ‘˜é™¤ if (rp != null) // å¦‚æœrootçš„å‰èŠ‚ç‚¹ä¸ä¸ºç©º rp.next = rn; // rootå‰èŠ‚ç‚¹çš„åèŠ‚ç‚¹ æŒ‡å‘åˆ° rootçš„åèŠ‚ç‚¹ if (first != null) // å¦‚æœæ•°ç»„è¯¥ä½ç½®ä¸ŠåŸæ¥çš„å…ƒç´ ä¸ä¸ºç©º first.prev = root; // è¿™ä¸ªåŸæœ‰çš„å…ƒç´ çš„ å‰èŠ‚ç‚¹ æŒ‡å‘åˆ° rootï¼Œç›¸å½“äºrootç›®å‰ä½äºé“¾è¡¨é¦–ä½ root.next = first; // åŸæ¥çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ç°åœ¨ä½œä¸ºrootçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå˜æˆäº†ç¬¬äºŒä¸ªèŠ‚ç‚¹ root.prev = null; // é¦–èŠ‚ç‚¹æ²¡æœ‰å‰èŠ‚ç‚¹ &#125; /* * è¿™ä¸€æ­¥æ˜¯é˜²å¾¡æ€§çš„ç¼–ç¨‹ * æ ¡éªŒTreeNodeå¯¹è±¡æ˜¯å¦æ»¡è¶³çº¢é»‘æ ‘å’ŒåŒé“¾è¡¨çš„ç‰¹æ€§ * å¦‚æœè¿™ä¸ªæ–¹æ³•æ ¡éªŒä¸é€šè¿‡ï¼šå¯èƒ½æ˜¯å› ä¸ºç”¨æˆ·ç¼–ç¨‹å¤±è¯¯ï¼Œç ´åäº†ç»“æ„ï¼ˆä¾‹å¦‚ï¼šå¹¶å‘åœºæ™¯ä¸‹ï¼‰ï¼›ä¹Ÿå¯èƒ½æ˜¯TreeNode * çš„å®ç°æœ‰é—®é¢˜ï¼ˆè¿™ä¸ªæ˜¯ç†è®ºä¸Šçš„ä»¥é˜²ä¸‡ä¸€ï¼‰ï¼› */ assert checkInvariants(root); &#125; &#125; /** * å‚æ•°ä¸ºHashMapçš„å…ƒç´ æ•°ç»„ */ final void treeify(Node&lt;K,V&gt;[] tab) &#123; // å®šä¹‰æ ‘çš„æ ¹èŠ‚ç‚¹ TreeNode&lt;K,V&gt; root = null; // éå†é“¾è¡¨ï¼ŒxæŒ‡å‘å½“å‰èŠ‚ç‚¹ã€nextæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ for (TreeNode&lt;K,V&gt; x = this, next; x != null; x = next) &#123; next = (TreeNode&lt;K,V&gt;)x.next; // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ x.left = x.right = null; // è®¾ç½®å½“å‰èŠ‚ç‚¹çš„å·¦å³èŠ‚ç‚¹ä¸ºç©º if (root == null) &#123; // å¦‚æœè¿˜æ²¡æœ‰æ ¹èŠ‚ç‚¹ x.parent = null; // å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹è®¾ä¸ºç©º x.red = false; // å½“å‰èŠ‚ç‚¹çš„çº¢è‰²å±æ€§è®¾ä¸ºfalseï¼ˆæŠŠå½“å‰èŠ‚ç‚¹è®¾ä¸ºé»‘è‰²ï¼‰ root = x; // æ ¹èŠ‚ç‚¹æŒ‡å‘åˆ°å½“å‰èŠ‚ç‚¹ &#125; else &#123; // å¦‚æœå·²ç»å­˜åœ¨æ ¹èŠ‚ç‚¹äº† K k = x.key; // å–å¾—å½“å‰é“¾è¡¨èŠ‚ç‚¹çš„key int h = x.hash; // å–å¾—å½“å‰é“¾è¡¨èŠ‚ç‚¹çš„hashå€¼ Class&lt;?&gt; kc = null; // å®šä¹‰keyæ‰€å±çš„Class for (TreeNode&lt;K,V&gt; p = root;;) &#123; // ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ­¤éå†æ²¡æœ‰è®¾ç½®è¾¹ç•Œï¼Œåªèƒ½ä»å†…éƒ¨è·³å‡º // GOTO1 int dir, ph; // dir æ ‡è¯†æ–¹å‘ï¼ˆå·¦å³ï¼‰ã€phæ ‡è¯†å½“å‰æ ‘èŠ‚ç‚¹çš„hashå€¼ K pk = p.key; // å½“å‰æ ‘èŠ‚ç‚¹çš„key if ((ph = p.hash) &gt; h) // å¦‚æœå½“å‰æ ‘èŠ‚ç‚¹hashå€¼ å¤§äº å½“å‰é“¾è¡¨èŠ‚ç‚¹çš„hashå€¼ dir = -1; // æ ‡è¯†å½“å‰é“¾è¡¨èŠ‚ç‚¹ä¼šæ”¾åˆ°å½“å‰æ ‘èŠ‚ç‚¹çš„å·¦ä¾§ else if (ph &lt; h) dir = 1; // å³ä¾§ /* * å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹çš„keyçš„hashå€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿˜è¦é€šè¿‡å…¶ä»–æ–¹å¼å†è¿›è¡Œæ¯”è¾ƒ * å¦‚æœå½“å‰é“¾è¡¨èŠ‚ç‚¹çš„keyå®ç°äº†comparableæ¥å£ï¼Œå¹¶ä¸”å½“å‰æ ‘èŠ‚ç‚¹å’Œé“¾è¡¨èŠ‚ç‚¹æ˜¯ç›¸åŒClassçš„å® * ä¾‹ï¼Œé‚£ä¹ˆé€šè¿‡comparableçš„æ–¹å¼å†æ¯”è¾ƒä¸¤è€…ã€‚ * å¦‚æœè¿˜æ˜¯ç›¸ç­‰ï¼Œæœ€åå†é€šè¿‡tieBreakOrderæ¯”è¾ƒä¸€æ¬¡ */ else if ((kc == null &amp;&amp; (kc = comparableClassFor(k)) == null) || (dir = compareComparables(kc, k, pk)) == 0) dir = tieBreakOrder(k, pk); TreeNode&lt;K,V&gt; xp = p; // ä¿å­˜å½“å‰æ ‘èŠ‚ç‚¹ /* * å¦‚æœdir å°äºç­‰äº0 ï¼š å½“å‰é“¾è¡¨èŠ‚ç‚¹ä¸€å®šæ”¾ç½®åœ¨å½“å‰æ ‘èŠ‚ç‚¹çš„å·¦ä¾§ï¼Œä½†ä¸ä¸€å®šæ˜¯è¯¥æ ‘èŠ‚ç‚¹çš„å·¦å­© * å­ï¼Œä¹Ÿå¯èƒ½æ˜¯å·¦å­©å­çš„å³å­©å­ æˆ–è€… æ›´æ·±å±‚æ¬¡çš„èŠ‚ç‚¹ã€‚å¦‚æœdir å¤§äº0 ï¼š å½“å‰é“¾è¡¨èŠ‚ç‚¹ä¸€å®šæ”¾ç½®åœ¨ * å½“å‰æ ‘èŠ‚ç‚¹çš„å³ä¾§ï¼Œä½†ä¸ä¸€å®šæ˜¯è¯¥æ ‘èŠ‚ç‚¹çš„å³å­©å­ï¼Œä¹Ÿå¯èƒ½æ˜¯å³å­©å­çš„å·¦å­©å­ æˆ–è€… æ›´æ·±å±‚æ¬¡çš„èŠ‚ * ç‚¹ã€‚ * * å¦‚æœå½“å‰æ ‘èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæœ€ç»ˆä¼šä»¥å½“å‰æ ‘èŠ‚ç‚¹çš„å·¦å­©å­æˆ–è€…å³å­©å­ä¸ºèµ·å§‹èŠ‚ç‚¹ å†ä» * GOTO1 å¤„å¼€å§‹ é‡æ–°å¯»æ‰¾è‡ªå·±ï¼ˆå½“å‰é“¾è¡¨èŠ‚ç‚¹ï¼‰çš„ä½ç½®ã€‚ * å¦‚æœå½“å‰æ ‘èŠ‚ç‚¹å°±æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ ¹æ®dirçš„å€¼ï¼Œå°±å¯ä»¥æŠŠå½“å‰é“¾è¡¨èŠ‚ç‚¹æŒ‚è½½åˆ°å½“å‰æ ‘èŠ‚ç‚¹çš„å·¦æˆ– * è€…å³ä¾§äº†ã€‚ * æŒ‚è½½ä¹‹åï¼Œè¿˜éœ€è¦é‡æ–°æŠŠæ ‘è¿›è¡Œå¹³è¡¡ã€‚å¹³è¡¡ä¹‹åï¼Œå°±å¯ä»¥é’ˆå¯¹ä¸‹ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹è¿›è¡Œå¤„ç†äº†ã€‚ */ if ((p = (dir &lt;= 0) ? p.left : p.right) == null) &#123; x.parent = xp; // å½“å‰é“¾è¡¨èŠ‚ç‚¹ ä½œä¸º å½“å‰æ ‘èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ if (dir &lt;= 0) xp.left = x; // ä½œä¸ºå·¦å­©å­ else xp.right = x; // ä½œä¸ºå³å­©å­ root = balanceInsertion(root, x); // é‡æ–°å¹³è¡¡ break; &#125; &#125; &#125; &#125; // æŠŠæ‰€æœ‰çš„é“¾è¡¨èŠ‚ç‚¹éƒ½éå†å®Œä¹‹åï¼Œæœ€ç»ˆæ„é€ å‡ºæ¥çš„æ ‘å¯èƒ½ç»å†å¤šä¸ªå¹³è¡¡æ“ä½œï¼Œæ ¹èŠ‚ç‚¹ç›®å‰åˆ°åº•æ˜¯é“¾è¡¨çš„å“ªä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸ç¡®å®šçš„ // å› ä¸ºæˆ‘ä»¬è¦åŸºäºæ ‘æ¥åšæŸ¥æ‰¾ï¼Œæ‰€ä»¥å°±åº”è¯¥æŠŠ tab[N] å¾—åˆ°çš„å¯¹è±¡ä¸€å®šæ ¹èŠ‚ç‚¹å¯¹è±¡ï¼Œè€Œç›®å‰åªæ˜¯é“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¯¹è±¡ï¼Œæ‰€ä»¥è¦åšç›¸åº”çš„å¤„ç†ã€‚ moveRootToFront(tab, root); &#125;&#125; é‡è¦æ–¹æ³•hashæ–¹æ³•1234567891011121314151617181920212223242526272829303132/** * è®¡ç®—keyçš„hashå€¼ï¼Œ * keyä¸ºnullåˆ™hashCodeä¸º0;ä¸ä¸ºnullåˆ™å°†keyçš„hashCodeèµ‹å€¼ç»™hï¼Œæœ€ç»ˆçš„hashCode = h ^ (h &gt;&gt;&gt; 16); * è¿™é‡Œæˆ‘ä»¬è¦è®²è®²æ•°ç»„ç´¢å¼•çš„è®¡ç®—æ–¹å¼ï¼š(n- 1) &amp; hash,nè¡¨ç¤ºtable.length * è¿™é‡Œé€šè¿‡key.hashCode()è®¡ç®—å‡ºkeyçš„å“ˆå¸Œå€¼ï¼Œç„¶åå°†å“ˆå¸Œå€¼hå³ç§»16ä½ï¼Œå†ä¸åŸæ¥çš„håšå¼‚æˆ–^è¿ç®—ï¼Œè¿™ä¸€æ­¥æ˜¯é«˜ä½è¿ * ç®—ã€‚è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰é«˜ä½è¿ç®—ï¼Œé‚£ä¹ˆhashå€¼å°†æ˜¯ä¸€ä¸ªintå‹çš„32ä½æ•°ã€‚è€Œä»2çš„-31æ¬¡å¹‚åˆ°2çš„31æ¬¡å¹‚ä¹‹é—´ï¼Œæœ‰å°†è¿‘å‡  * åäº¿çš„ç©ºé—´ï¼Œå¦‚æœæˆ‘ä»¬çš„HashMapçš„tableæœ‰è¿™ä¹ˆé•¿ï¼Œå†…å­˜æ—©å°±çˆ†äº†ã€‚æ‰€ä»¥è¿™ä¸ªæ•£åˆ—å€¼ä¸èƒ½ç›´æ¥ç”¨æ¥æœ€ç»ˆçš„å–æ¨¡è¿ç®—ï¼Œè€Œ * éœ€è¦å…ˆåŠ å…¥é«˜ä½è¿ç®—ï¼Œå°†é«˜16ä½å’Œä½16ä½çš„ä¿¡æ¯\"èåˆ\"åˆ°ä¸€èµ·ï¼Œä¹Ÿç§°ä¸º\"æ‰°åŠ¨å‡½æ•°\"ã€‚è¿™æ ·æ‰èƒ½ä¿è¯hashå€¼æ‰€æœ‰ä½çš„æ•°å€¼ * ç‰¹å¾éƒ½ä¿å­˜ä¸‹æ¥è€Œæ²¡æœ‰é—æ¼ï¼Œä»è€Œä½¿æ˜ å°„ç»“æœå°½å¯èƒ½çš„æ¾æ•£ã€‚æœ€åï¼Œæ ¹æ® n-1 åšä¸æ“ä½œçš„å–æ¨¡è¿ç®—ã€‚è¿™é‡Œä¹Ÿèƒ½çœ‹å‡ºä¸ºä»€ä¹ˆ * HashMapè¦é™åˆ¶tableçš„é•¿åº¦ä¸º2çš„næ¬¡å¹‚ï¼Œå› ä¸ºè¿™æ ·ï¼Œn-1å¯ä»¥ä¿è¯äºŒè¿›åˆ¶å±•ç¤ºå½¢å¼æ˜¯ï¼ˆä»¥16ä¸ºä¾‹ï¼‰0000 0000 0000 * 0000 0000 0000 0000 1111ã€‚åœ¨åš\"ä¸\"æ“ä½œæ—¶ï¼Œå°±ç­‰åŒäºæˆªå–hashäºŒè¿›åˆ¶å€¼å¾—åå››ä½æ•°æ®ä½œä¸ºä¸‹æ ‡ã€‚è¿™é‡Œä¹Ÿå¯ä»¥çœ‹ * å‡º\"æ‰°åŠ¨å‡½æ•°\"çš„é‡è¦æ€§äº†ï¼Œå¦‚æœé«˜ä½ä¸å‚ä¸è¿ç®—ï¼Œé‚£ä¹ˆé«˜16ä½çš„hashç‰¹å¾å‡ ä¹æ°¸è¿œå¾—ä¸åˆ°å±•ç°ï¼Œå‘ç”Ÿhashç¢°æ’çš„å‡ ç‡å°± * ä¼šå¢å¤§ï¼Œä»è€Œå½±å“æ€§èƒ½ã€‚ * Computes key.hashCode() and spreads (XORs) higher bits of hash * to lower. Because the table uses power-of-two masking, sets of * hashes that vary only in bits above the current mask will * always collide. (Among known examples are sets of Float keys * holding consecutive whole numbers in small tables.) So we * apply a transform that spreads the impact of higher bits * downward. There is a tradeoff between speed, utility, and * quality of bit-spreading. Because many common sets of hashes * are already reasonably distributed (so don't benefit from * spreading), and because we use trees to handle large sets of * collisions in bins, we just XOR some shifted bits in the * cheapest possible way to reduce systematic lossage, as well as * to incorporate impact of the highest bits that would otherwise * never be used in index calculations because of table bounds. */static final int hash(Object key) &#123; int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125; putæ–¹æ³•1234// æˆ‘ä»¬å®é™…ç”¨çš„putæ–¹æ³•ï¼Œåº•å±‚è°ƒç”¨çš„æ˜¯putValæ–¹æ³•public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586/** * Implements Map.put and related methods. * * @param hash hash for key * @param key the key * @param value the value to put * @param onlyIfAbsent if true, don't change existing value * (onlyIfAbsentä¸ºtrueæ—¶ï¼Œå¦‚æœkeyå­˜åœ¨ï¼Œå°±ä¸ä¼šè¿›è¡Œputæ“ä½œï¼ŒåŸæœ‰çš„å¯¹åº”çš„valueä¸ä¼šè¢«è¦†ç›–) * @param evict if false, the table is in creation mode. * (evictå‚æ•°ç”¨äºLinkedHashMapä¸­çš„å°¾éƒ¨æ“ä½œï¼Œè¿™é‡Œæ²¡æœ‰å®é™…æ„ä¹‰ã€‚) * @return previous value, or null if none */final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; // å®šä¹‰å˜é‡tabæ˜¯å°†è¦æ“ä½œçš„Nodeæ•°ç»„å¼•ç”¨ï¼Œpè¡¨ç¤ºtabä¸Šçš„æŸNodeèŠ‚ç‚¹ï¼Œnä¸ºtabçš„é•¿åº¦ï¼Œiä¸ºtabçš„ä¸‹æ ‡ã€‚ Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; // åˆ¤æ–­å½“tableä¸ºnullæˆ–è€…tabçš„é•¿åº¦ä¸º0æ—¶ï¼Œå³tableå°šæœªåˆå§‹åŒ–ï¼Œæ­¤æ—¶é€šè¿‡resize()æ–¹æ³•å¾—åˆ°åˆå§‹åŒ–çš„tableã€‚ if ((tab = table) == null || (n = tab.length) == 0) // è¿™ç§æƒ…å†µæ˜¯å¯èƒ½å‘ç”Ÿçš„ï¼ŒHashMapçš„tableå­—æ®µæ³¨é‡Šä¸­æåˆ°ï¼šThe table, initialized on first use, and resized as necessaryã€‚ n = (tab = resize()).length; // æ­¤å¤„é€šè¿‡(n - 1)&amp; hashè®¡ç®—å‡ºçš„å€¼ä½œä¸ºtabçš„ä¸‹æ ‡iï¼Œå¹¶å¦pè¡¨ç¤ºtab[i]ï¼Œä¹Ÿå°±æ˜¯è¯¥é“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ä½ç½®ã€‚å¹¶åˆ¤æ–­pæ˜¯å¦ä¸ºnullã€‚ if ((p = tab[i = (n - 1) &amp; hash]) == null) // å½“pä¸ºnullæ—¶ï¼Œè¡¨æ˜tab[i]ä¸Šæ²¡æœ‰ä»»ä½•å…ƒç´ ï¼Œå³ä¸å­˜åœ¨Hashå†²çªï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±newç¬¬ä¸€ä¸ªNodeèŠ‚ç‚¹ï¼Œè°ƒç”¨newNodeæ–¹æ³•è¿”å›æ–°èŠ‚ç‚¹èµ‹å€¼ç»™tab[i]ã€‚è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯i = (n - 1) &amp; hashç›¸å½“äºå¯¹hashå¯¹nçš„å–æ¨¡ tab[i] = newNode(hash, key, value, null); // ä¸‹é¢è¿›å…¥pä¸ä¸ºnullçš„æƒ…å†µï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼špä¸ºé“¾è¡¨èŠ‚ç‚¹ï¼›pä¸ºçº¢é»‘æ ‘èŠ‚ç‚¹ï¼›pæ˜¯é“¾è¡¨èŠ‚ç‚¹ä½†é•¿åº¦ä¸ºä¸´ç•Œé•¿åº¦TREEIFY_THRESHOLDï¼Œå†æ’å…¥ä»»ä½•å…ƒç´ å°±è¦å˜æˆçº¢é»‘æ ‘äº†ã€‚ else &#123; // å®šä¹‰eå¼•ç”¨,è¡¨ç¤ºå³å°†æ’å…¥çš„NodeèŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸‹æ–‡å¯ä»¥çœ‹å‡º k = p.keyã€‚ Node&lt;K,V&gt; e; K k; if (p.hash == hash &amp;&amp; // HashMapä¸­åˆ¤æ–­keyç›¸åŒçš„æ¡ä»¶æ˜¯keyçš„hashç›¸åŒï¼ˆHashæ˜¯å¦å†²çªï¼‰ï¼Œå¹¶ä¸”ç¬¦åˆequalsæ–¹æ³•ã€‚è¿™é‡Œåˆ¤æ–­äº†p.keyæ˜¯å¦å’Œæ’å…¥çš„keyç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å°†pçš„å¼•ç”¨èµ‹ç»™eã€‚eä¼šåœ¨æœ€åç»Ÿä¸€è¿›è¡Œèµ‹å€¼åŠè¿”å›ã€‚ ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) // è¿™ä¸€æ­¥çš„åˆ¤æ–­å…¶å®æ˜¯å±äºä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œä¸Šè¿°ä¸‰ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼Œå³ä¸¤è€…hashå€¼ç›¸åŒä¸”keyå®Œå…¨ç›¸åŒï¼Œäºæ˜¯æ’å…¥æ“ä½œå°±ä¸éœ€è¦äº†ï¼Œåªè¦æŠŠåŸæ¥çš„valueè¦†ç›–å°±å¯ä»¥äº†ã€‚eä¼šåœ¨æœ€åç»Ÿä¸€è¿›è¡Œèµ‹å€¼åŠè¿”å›ï¼Œè¿™é‡Œå…ˆä¸è¿›è¡Œè¦†ç›–æ“ä½œã€‚ e = p; else if (p instanceof TreeNode) // ç°åœ¨å¼€å§‹äº†ç¬¬ä¸€ç§æƒ…å†µï¼Œå½“å‰æ¡¶pæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè‚¯å®šæ’å…¥åä»ç„¶æ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œå°±è¦æŒ‰ç…§çº¢é»‘æ ‘çš„æ–¹å¼å†™å…¥æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¼ºåˆ¶è½¬å‹påè°ƒç”¨TreeNode.putTreeValæ–¹æ³•ï¼Œè¿”å›çš„å¼•ç”¨èµ‹ç»™eã€‚ // ä½ å¯èƒ½å¥½å¥‡ï¼Œè¿™é‡Œæ€ä¹ˆä¸éå†treeçœ‹çœ‹æœ‰æ²¡æœ‰keyç›¸åŒçš„èŠ‚ç‚¹å‘¢ï¼Ÿå…¶å®ï¼ŒputTreeValå†…éƒ¨è¿›è¡Œäº†éå†ï¼Œå­˜åœ¨ç›¸åŒhashæ—¶è¿”å›è¢«è¦†ç›–çš„TreeNodeï¼Œå¦åˆ™è¿”å›nullã€‚ e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); // æ¥ä¸‹é‡Œå°±æ˜¯pä¸ºé“¾è¡¨èŠ‚ç‚¹çš„æƒ…å½¢ï¼Œä¹Ÿå°±æ˜¯ä¸Šè¿°è¯´çš„å¦å¤–ä¸¤ç±»æƒ…å†µï¼šæ’å…¥åè¿˜æ˜¯é“¾è¡¨/æ’å…¥åè½¬çº¢é»‘æ ‘ã€‚å¦å¤–ï¼Œä¸Šè¡Œè½¬å‹ä»£ç ä¹Ÿè¯´æ˜äº†TreeNodeæ˜¯Nodeçš„ä¸€ä¸ªå­ç±»ã€‚ else &#123; // æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè®¡æ•°å™¨æ¥è®¡ç®—å½“å‰é“¾è¡¨çš„å…ƒç´ ä¸ªæ•°ï¼Œå¹¶éå†é“¾è¡¨ï¼ŒbinCountå°±æ˜¯è¿™ä¸ªè®¡æ•°å™¨ã€‚ for (int binCount = 0; ; ++binCount) &#123; // éå†è¿‡ç¨‹ä¸­å½“å‘ç°p.nextä¸ºnullæ—¶ï¼Œè¯´æ˜é“¾è¡¨åˆ°å¤´äº†ï¼Œå°±éœ€è¦å°†å½“å‰çš„keyã€valueå°è£…æˆä¸€ä¸ªæ–°èŠ‚ç‚¹,å°†æ–°çš„é“¾è¡¨èŠ‚ç‚¹ç›´æ¥åœ¨pçš„åé¢æ’å…¥å³å¯ï¼Œå³æŠŠæ–°èŠ‚ç‚¹çš„å¼•ç”¨èµ‹ç»™p.nextï¼Œæ’å…¥æ“ä½œå°±å®Œæˆäº†ã€‚æ³¨æ„æ­¤æ—¶eèµ‹ç»™pã€‚ if ((e = p.next) == null) &#123; // æœ€åä¸€ä¸ªå‚æ•°ä¸ºæ–°èŠ‚ç‚¹çš„nextï¼Œè¿™é‡Œä¼ å…¥nullï¼Œä¿è¯äº†æ–°èŠ‚ç‚¹ç»§ç»­ä¸ºè¯¥é“¾è¡¨çš„æœ«ç«¯ã€‚ p.next = newNode(hash, key, value, null); // æ’å…¥æˆåŠŸåï¼Œè¦åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œå› ä¸ºæ’å…¥åé“¾è¡¨é•¿åº¦åŠ 1ï¼Œè€ŒbinCountå¹¶ä¸åŒ…å«æ–°èŠ‚ç‚¹ï¼Œæ‰€ä»¥åˆ¤æ–­æ—¶è¦å°†ä¸´ç•Œé˜ˆå€¼å‡1ã€‚binCountå¤§äºç­‰äº7ï¼ˆå…¶å®å®é™…ä¸Šé“¾è¡¨æ­¤æ—¶çš„å¤§å°ä¸º8ï¼‰æ—¶è½¬æ¢ä¸ºçº¢é»‘æ ‘è¿›è¡Œå¤„ç† if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st // å½“æ»¡è¶³ä¸Šè¿°è½¬æ¢æ¡ä»¶æ—¶ï¼Œè°ƒç”¨treeifyBinæ–¹æ³•ï¼Œå°†è¯¥é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚ treeifyBin(tab, hash); // å½“ç„¶å¦‚æœä¸æ»¡è¶³è½¬æ¢æ¡ä»¶ï¼Œé‚£ä¹ˆæ’å…¥æ•°æ®åç»“æ„ä¹Ÿæ— éœ€å˜åŠ¨ï¼Œæ‰€æœ‰æ’å…¥æ“ä½œä¹Ÿåˆ°æ­¤ç»“æŸäº†ï¼Œbreaké€€å‡ºå³å¯ã€‚ break; &#125; // åœ¨éå†é“¾è¡¨çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½éå†åˆ°ä¸æ’å…¥çš„keyç›¸åŒçš„èŠ‚ç‚¹ï¼Œæ­¤æ—¶åªè¦å°†è¿™ä¸ªèŠ‚ç‚¹å¼•ç”¨èµ‹å€¼ç»™eï¼Œæœ€åé€šè¿‡eå»æŠŠæ–°çš„valueè¦†ç›–æ‰å°±å¯ä»¥äº†ã€‚ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) // æ‰¾åˆ°äº†ç›¸åŒkeyçš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ’å…¥æ“ä½œä¹Ÿä¸éœ€è¦äº†ï¼Œç›´æ¥breaké€€å‡ºå¾ªç¯è¿›è¡Œæœ€åçš„valueè¦†ç›–æ“ä½œã€‚ break; // eæ˜¯å½“å‰éå†çš„èŠ‚ç‚¹pçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œp = e å°±æ˜¯ä¾æ¬¡éå†é“¾è¡¨çš„æ ¸å¿ƒè¯­å¥ã€‚æ¯æ¬¡å¾ªç¯æ—¶péƒ½æ˜¯ä¸‹ä¸€ä¸ªnodeèŠ‚ç‚¹ã€‚ p = e; &#125; &#125; // ä¸‹é¢JDKæ³¨é‡Šå·²ç»å¾ˆæ¸…æ™°äº†ï¼Œé’ˆå¯¹å·²ç»å­˜åœ¨keyçš„æƒ…å†µåšå¤„ç†ã€‚å³æˆ‘ä»¬å¯¹eè¿›è¡Œå¤„ç†ã€‚ if (e != null) &#123; // existing mapping for key //å®šä¹‰oldValueï¼Œå³åŸå­˜åœ¨çš„èŠ‚ç‚¹eçš„valueå€¼ã€‚ V oldValue = e.value; // æ–¹æ³•æ³¨é‡Šæåˆ°ï¼ŒonlyIfAbsentä¸ºtrueæ—¶ï¼Œè‹¥å­˜åœ¨keyç›¸åŒæ—¶ä¸åšè¦†ç›–å¤„ç†ï¼Œè¿™é‡Œä½œä¸ºåˆ¤æ–­æ¡ä»¶ï¼Œå¯ä»¥çœ‹å‡ºå½“onlyIfAbsentä¸ºé»˜è®¤å€¼falseæˆ–è€…oldValueä¸ºnullæ—¶ï¼Œè¿›è¡Œè¦†ç›–æ“ä½œã€‚ if (!onlyIfAbsent || oldValue == null) // è¦†ç›–æ“ä½œï¼Œå°†åŸèŠ‚ç‚¹eä¸Šçš„valueè®¾ç½®ä¸ºæ’å…¥çš„æ–°valueã€‚ e.value = value; // è¿™ä¸ªå‡½æ•°åœ¨hashmapä¸­æ²¡æœ‰ä»»ä½•æ“ä½œï¼Œæ˜¯ä¸ªç©ºå‡½æ•°ï¼Œå®ƒå­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†linkedHashMapçš„ä¸€äº›åç»­å¤„ç†å·¥ä½œã€‚ afterNodeAccess(e); // è¿”å›çš„æ˜¯è¢«è¦†ç›–çš„oldValueã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨putæ–¹æ³•æ—¶å¾ˆå°‘ç”¨ä»–çš„è¿”å›å€¼ï¼Œç”šè‡³å¿˜äº†å®ƒçš„å­˜åœ¨ï¼Œè¿™é‡Œæˆ‘ä»¬çŸ¥é“ï¼Œä»–è¿”å›çš„æ˜¯è¢«è¦†ç›–çš„oldValueã€‚ return oldValue; &#125; &#125; // æ”¶å°¾å·¥ä½œï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¯¹keyç›¸åŒè€Œè¦†ç›–oldValueçš„æƒ…å†µï¼Œåœ¨å‰é¢å·²ç»returnï¼Œä¸ä¼šæ‰§è¡Œè¿™é‡Œï¼Œæ‰€ä»¥é‚£ä¸€ç±»æƒ…å†µä¸ç®—æ•°æ®ç»“æ„å˜åŒ–ï¼Œå¹¶ä¸æ”¹å˜modCountå€¼ã€‚å¦‚æœèµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜å·²ç»æ–°å¢ä¸€ä¸ªKey-Valueçš„NodeèŠ‚ç‚¹ï¼ŒmodCountè¦è‡ªå¢ ++modCount; // åŒç†ï¼Œè¦†ç›–oldValueæ—¶æ˜¾ç„¶æ²¡æœ‰æ–°å…ƒç´ æ·»åŠ ï¼Œé™¤æ­¤ä¹‹å¤–éƒ½æ–°å¢äº†ä¸€ä¸ªå…ƒç´ ï¼Œè¿™é‡Œ++sizeå¹¶ä¸thresholdåˆ¤æ–­æ˜¯å¦è¾¾åˆ°äº†æ‰©å®¹æ ‡å‡†ã€‚ if (++size &gt; threshold) // å½“HashMapä¸­å­˜åœ¨çš„nodeèŠ‚ç‚¹å¤§äºthresholdæ—¶ï¼Œhashmapè¿›è¡Œæ‰©å®¹ã€‚ resize(); // è¿™é‡Œä¸å‰é¢çš„afterNodeAccessåŒç†ï¼Œæ˜¯ç”¨äºlinkedHashMapçš„å°¾éƒ¨æ“ä½œï¼ŒHashMapä¸­å¹¶æ— å®é™…æ„ä¹‰ã€‚ afterNodeInsertion(evict); // æœ€ç»ˆï¼Œå¯¹äºçœŸæ­£è¿›è¡Œæ’å…¥å…ƒç´ (ä¸æ˜¯è¦†ç›–çš„æ“ä½œ)çš„æƒ…å†µï¼Œputå‡½æ•°ä¸€å¾‹è¿”å›nullã€‚ return null;&#125; getæ–¹æ³•123456// æˆ‘ä»¬å®é™…ç”¨çš„getæ–¹æ³•ï¼Œåº•å±‚è°ƒç”¨çš„æ˜¯getNodeæ–¹æ³•public V get(Object key) &#123; Node&lt;K,V&gt; e; // æ ¹æ®keyåŠå…¶hashå€¼æŸ¥è¯¢nodeèŠ‚ç‚¹ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›è¯¥èŠ‚ç‚¹çš„valueå€¼ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›nullã€‚ return (e = getNode(hash(key), key)) == null ? null : e.value;&#125; 1234567891011121314151617181920212223242526272829303132333435363738/** * Implements Map.get and related methods. * * @param hash hash for key * @param key the key * @return the node, or null if none ã€‚ * å¦‚æœæ‰¾åˆ°nodeè¿”å›nodeï¼Œæ²¡æœ‰æ‰¾åˆ°nodeåˆ™è¿”å›null * æ ¹æ®keyæœç´¢èŠ‚ç‚¹çš„æ–¹æ³•ã€‚è®°ä½åˆ¤æ–­keyç›¸ç­‰çš„æ¡ä»¶ï¼šhashå€¼ç›¸åŒ å¹¶ä¸” ç¬¦åˆequalsæ–¹æ³•ã€‚ */final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; // å®šä¹‰å˜é‡tabæ˜¯å°†è¦éå†æŸ¥æ‰¾çš„Nodeæ•°ç»„å¼•ç”¨ï¼Œfirstå’Œeè¡¨ç¤ºtabä¸Šçš„æ‰¾åˆ°çš„NodeèŠ‚ç‚¹ï¼Œnä¸ºtabçš„é•¿åº¦ï¼Œkä¸ºKey Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; // æ ¹æ®è¾“å…¥çš„hashå€¼ï¼Œå¯ä»¥ç›´æ¥è®¡ç®—å‡ºå¯¹åº”çš„ä¸‹æ ‡(n - 1) &amp; hashï¼Œç¼©å°æŸ¥è¯¢èŒƒå›´ï¼Œå¦‚æœå­˜åœ¨ç»“æœï¼Œåˆ™å¿…å®šåœ¨tableçš„è¿™ä¸ªä½ç½®ä¸Šã€‚ if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) // åˆ¤æ–­ç¬¬ä¸€ä¸ªå­˜åœ¨çš„èŠ‚ç‚¹çš„keyæ˜¯å¦å’ŒæŸ¥è¯¢çš„keyç›¸ç­‰ã€‚å¦‚æœç›¸ç­‰ï¼Œç›´æ¥è¿”å›è¯¥èŠ‚ç‚¹ã€‚ return first; // å¦‚æœç¬¬ä¸€ä¸ªä¸åŒ¹é…ï¼Œåˆ™åˆ¤æ–­å®ƒçš„ä¸‹ä¸€ä¸ªæ˜¯çº¢é»‘æ ‘è¿˜æ˜¯é“¾è¡¨ã€‚éå†è¯¥é“¾è¡¨/çº¢é»‘æ ‘ç›´åˆ°nextä¸ºnullã€‚ if ((e = first.next) != null) &#123; // çº¢é»‘æ ‘å°±æŒ‰ç…§æ ‘çš„æŸ¥æ‰¾æ–¹å¼è¿”å›å€¼ã€‚ if (first instanceof TreeNode) // å½“è¿™ä¸ªtableèŠ‚ç‚¹ä¸Šå­˜å‚¨çš„æ˜¯çº¢é»‘æ ‘ç»“æ„æ—¶ï¼Œåœ¨æ ¹èŠ‚ç‚¹firstä¸Šè°ƒç”¨getTreeNodeæ–¹æ³•ï¼Œåœ¨å†…éƒ¨éå†çº¢é»‘æ ‘èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰åŒ¹é…çš„TreeNodeã€‚ return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); // é“¾è¡¨çš„æ–¹å¼éå†åŒ¹é…è¿”å›å€¼ã€‚ do &#123; // å½“è¿™ä¸ªtableèŠ‚ç‚¹ä¸Šå­˜å‚¨çš„æ˜¯é“¾è¡¨ç»“æ„æ—¶ï¼Œè‹¥ä¸¤è€…hashç›¸åŒä¸”keyæ˜¯å¦å®Œå…¨ç›¸åŒåˆ™ç›´æ¥è¿”å›ã€‚ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; // å¦‚æœkeyä¸åŒï¼Œä¸€ç›´éå†ä¸‹å»ç›´åˆ°é“¾è¡¨å°½å¤´ï¼Œç›´åˆ°e.next == nullæ‰ç»ˆæ­¢å¾ªç¯ã€‚ &#125; while ((e = e.next) != null); &#125; &#125; // æ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å›nullã€‚ return null;&#125; resizeæ–¹æ³•123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151/** * mapæ‰©å®¹æœºåˆ¶ * Initializes or doubles table size. If null, allocates in * accord with initial capacity target held in field threshold. * Otherwise, because we are using power-of-two expansion, the * elements from each bin must either stay at same index, or move * with a power of two offset in the new table. * * @return the table */final Node&lt;K,V&gt;[] resize() &#123; // å½“å‰æ‰€æœ‰å…ƒç´ æ‰€åœ¨çš„æ•°ç»„ï¼Œç§°ä¸ºè€çš„å…ƒç´ æ•°ç»„ Node&lt;K,V&gt;[] oldTab = table; // è€çš„å…ƒç´ æ•°ç»„é•¿åº¦ int oldCap = (oldTab == null) ? 0 : oldTab.length; // è€çš„æ‰©å®¹é˜€å€¼è®¾ç½® int oldThr = threshold; // æ–°æ•°ç»„çš„å®¹é‡ï¼Œæ–°æ•°ç»„çš„æ‰©å®¹é˜€å€¼éƒ½åˆå§‹åŒ–ä¸º0 int newCap, newThr = 0; // å¦‚æœè€æ•°ç»„é•¿åº¦å¤§äº0ï¼Œè¯´æ˜å·²ç»å­˜åœ¨å…ƒç´  if (oldCap &gt; 0) &#123; // è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å……äº†ï¼Œå³2çš„30æ¬¡æ–¹æ—¶ï¼Œå°±åªå¥½éšä½ ç¢°æ’å»å§ if (oldCap &gt;= MAXIMUM_CAPACITY) &#123; // æ‰©å®¹é˜€å€¼è®¾ç½®ä¸ºintæœ€å¤§å€¼ï¼ˆ2çš„31æ¬¡æ–¹ -1 ï¼‰ï¼Œå› ä¸ºoldCapå†ä¹˜2å°±æº¢å‡ºäº†ã€‚ threshold = Integer.MAX_VALUE; // è¶…è¿‡äº†æœ€å¤§çš„å®¹é‡ï¼Œä¸èƒ½æ‰©å®¹ï¼Œç›´æ¥è¿”å›è€çš„å…ƒç´ æ•°ç»„ return oldTab; &#125; /* æ²¡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±æ‰©å……ä¸ºåŸæ¥çš„2å€ * å¦‚æœæ•°ç»„å…ƒç´ ä¸ªæ•°åœ¨æ­£å¸¸èŒƒå›´å†…ï¼Œé‚£ä¹ˆæ–°çš„æ•°ç»„å®¹é‡ä¸ºè€çš„æ•°ç»„å®¹é‡çš„2å€ï¼ˆå·¦ç§»1ä½ç›¸å½“äºä¹˜ä»¥2ï¼‰ * å¦‚æœæ‰©å®¹ä¹‹åçš„æ–°å®¹é‡å°äºæœ€å¤§å®¹é‡å¹¶ä¸”è€çš„æ•°ç»„å®¹é‡å¤§äºç­‰äºé»˜è®¤åˆå§‹åŒ–å®¹é‡ï¼ˆ16ï¼‰ï¼Œé‚£ä¹ˆæ–°æ•°ç»„çš„æ‰© * å®¹é˜€å€¼è®¾ç½®ä¸ºè€é˜€å€¼çš„2å€ã€‚ï¼ˆè€çš„æ•°ç»„å®¹é‡å¤§äº16æ„å‘³ç€ï¼šè¦ä¹ˆæ„é€ å‡½æ•°æŒ‡å®šäº†ä¸€ä¸ªå¤§äº16çš„åˆå§‹åŒ–å®¹é‡å€¼ï¼Œ * è¦ä¹ˆå·²ç»ç»å†è¿‡äº†è‡³å°‘ä¸€æ¬¡æ‰©å®¹ï¼‰ */ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; // double threshold &#125; // è¿è¡Œåˆ°è¿™ä¸ªelse if,è¯´æ˜è€æ•°ç»„æ²¡æœ‰ä»»ä½•å…ƒç´  else if (oldThr &gt; 0) // initial capacity was placed in threshold // å¦‚æœè€æ•°ç»„çš„æ‰©å®¹é˜€å€¼å¤§äº0ï¼Œé‚£ä¹ˆè®¾ç½®æ–°æ•°ç»„çš„å®¹é‡ä¸ºè¯¥é˜€å€¼,è¿™ä¸€æ­¥ä¹Ÿå°±æ„å‘³ç€æ„é€ è¯¥mapçš„æ—¶å€™ï¼ŒæŒ‡å®šäº†åˆå§‹åŒ–å®¹é‡ newCap = oldThr; else &#123; // zero initial threshold signifies using defaults // èƒ½è¿è¡Œåˆ°è¿™é‡Œçš„è¯ï¼Œè¯´æ˜æ˜¯è°ƒç”¨æ— å‚æ„é€ å‡½æ•°åˆ›å»ºçš„è¯¥mapï¼Œå¹¶ä¸”ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´  // è®¾ç½®æ–°æ•°ç»„å®¹é‡ä¸º16 newCap = DEFAULT_INITIAL_CAPACITY; // è®¾ç½®æ–°æ•°ç»„æ‰©å®¹é˜€å€¼ä¸º 16 * 0.75 = 12ã€‚0.75ä¸ºè´Ÿè½½å› å­(å½“å…ƒç´ ä¸ªæ•°è¾¾åˆ°å®¹é‡äº†4åˆ†ä¹‹3ï¼Œé‚£ä¹ˆæ‰©å®¹) newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); &#125; // å¦‚æœæ‰©å®¹é˜€å€¼ä¸º0 if (newThr == 0) &#123; // è®¡ç®—æ–°çš„resizeä¸Šé™ float ft = (float)newCap * loadFactor; // è®¡ç®—æ‰©å®¹é˜€å€¼ newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; // è®¾ç½®æ–°æ•°ç»„çš„æ‰©å®¹é˜€å€¼ threshold = newThr; @SuppressWarnings(&#123;\"rawtypes\",\"unchecked\"&#125;) // åˆ›å»ºæ–°çš„æ•°ç»„ï¼ˆå¯¹äºç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ç»„å°±æ˜¯ç¬¬ä¸€ä¸ªæ•°ç»„ï¼›å¯¹äºå­˜åœ¨oldTabçš„æ—¶å€™ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ç»„å°±æ˜¯è¦éœ€è¦æ‰©å®¹åˆ°çš„æ–°æ•°ç»„ï¼‰ Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; // å°†è¯¥mapçš„tableå±æ€§æŒ‡å‘åˆ°è¯¥æ–°æ•°ç»„newTab table = newTab; // å¦‚æœè€æ•°ç»„ä¸ä¸ºç©ºï¼Œè¯´æ˜æ˜¯æ‰©å®¹æ“ä½œï¼Œé‚£ä¹ˆæ¶‰åŠåˆ°å…ƒç´ çš„è½¬ç§»æ“ä½œ if (oldTab != null) &#123; // éå†è€æ•°ç»„æŠŠæ¯ä¸ªbucketéƒ½ç§»åŠ¨åˆ°æ–°çš„bucketsä¸­ for (int j = 0; j &lt; oldCap; ++j) &#123; // æ•°ç»„ä¸­çš„æŸä¸ªå…ƒç´  Node&lt;K,V&gt; e; // å¦‚æœå½“å‰ä½ç½®å…ƒç´ ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆéœ€è¦è½¬ç§»è¯¥å…ƒç´ åˆ°æ–°æ•°ç»„ if ((e = oldTab[j]) != null) &#123; // é‡Šæ”¾æ‰è€æ•°ç»„å¯¹äºè¦è½¬ç§»èµ°çš„å…ƒç´ çš„å¼•ç”¨ï¼ˆä¸»è¦ä¸ºäº†ä½¿å¾—æ•°ç»„å¯è¢«å›æ”¶ï¼‰ oldTab[j] = null; // å¦‚æœå…ƒç´ æ²¡æœ‰æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¯´æ˜è¯¥å…ƒç´ ä¸å­˜åœ¨hashå†²çª if (e.next == null) // æŠŠå…ƒç´ å­˜å‚¨åˆ°æ–°çš„æ•°ç»„ä¸­ï¼Œå­˜å‚¨åˆ°æ•°ç»„çš„å“ªä¸ªä½ç½®éœ€è¦æ ¹æ®hashå€¼å’Œæ•°ç»„é•¿åº¦æ¥è¿›è¡Œå–æ¨¡ // ã€hashå€¼ % æ•°ç»„é•¿åº¦ã€‘ = ã€ hashå€¼ &amp; ï¼ˆæ•°ç»„é•¿åº¦-1ï¼‰ã€‘ // è¿™ç§ä¸è¿ç®—æ±‚æ¨¡çš„æ–¹å¼è¦æ±‚ æ•°ç»„é•¿åº¦å¿…é¡»æ˜¯2çš„Næ¬¡æ–¹ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°éšæ„æŒ‡å®šåˆå§‹åŒ–å®¹é‡å‘€ï¼Œå¦‚æœæŒ‡å®šäº†17,15è¿™ç§ï¼Œå²‚ä¸æ˜¯å‡ºé—®é¢˜äº†å°±ï¼Ÿæ²¡å…³ç³»ï¼Œæœ€ç»ˆä¼šé€šè¿‡tableSizeForæ–¹æ³•å°†ç”¨æˆ·æŒ‡å®šçš„è½¬åŒ–ä¸ºå¤§äºå…¶å¹¶ä¸”æœ€ç›¸è¿‘çš„2çš„Næ¬¡æ–¹ã€‚ 15 -&gt; 16ã€17-&gt; 32 newTab[e.hash &amp; (newCap - 1)] = e; /* * å¦‚æœè¯¥å…ƒç´ æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯´æ˜è¯¥ä½ç½®ä¸Šå­˜åœ¨ä¸€ä¸ªé“¾è¡¨äº†ï¼ˆhashç›¸åŒçš„å¤šä¸ªå…ƒç´ ä»¥é“¾è¡¨çš„æ–¹å¼å­˜ * å‚¨åˆ°äº†è€æ•°ç»„çš„è¿™ä¸ªä½ç½®ä¸Šäº†ï¼‰ã€‚ä¾‹å¦‚ï¼šæ•°ç»„é•¿åº¦ä¸º16ï¼Œé‚£ä¹ˆhashå€¼ä¸º1ï¼ˆ1%16=1ï¼‰çš„å’Œhashå€¼ä¸º * 17ï¼ˆ17%16=1ï¼‰çš„ä¸¤ä¸ªå…ƒç´ éƒ½æ˜¯ä¼šå­˜å‚¨åœ¨æ•°ç»„çš„ç¬¬2ä¸ªä½ç½®ä¸Šï¼ˆå¯¹åº”æ•°ç»„ä¸‹æ ‡ä¸º1ï¼‰ï¼Œå½“æ•°ç»„æ‰©å®¹ä¸º * 32ï¼ˆ1%32=1ï¼‰æ—¶ï¼Œhashå€¼ä¸º1çš„è¿˜åº”è¯¥å­˜å‚¨åœ¨æ–°æ•°ç»„çš„ç¬¬äºŒä¸ªä½ç½®ä¸Šï¼Œä½†æ˜¯hashå€¼ä¸º17(17%32=1 * 7)çš„å°±åº”è¯¥å­˜å‚¨åœ¨æ–°æ•°ç»„çš„ç¬¬18ä¸ªä½ç½®ä¸Šäº†ã€‚æ‰€ä»¥ï¼Œæ•°ç»„æ‰©å®¹åï¼Œæ‰€æœ‰å…ƒç´ éƒ½éœ€è¦é‡æ–°è®¡ç®—åœ¨æ–°æ•°ç»„ * ä¸­çš„ä½ç½®ã€‚ */ else if (e instanceof TreeNode) // å¦‚æœè¯¥èŠ‚ç‚¹ä¸ºTreeNodeç±»å‹ ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); else &#123; // preserve order // é“¾è¡¨ä¼˜åŒ–é‡hashçš„ä»£ç å— // æŒ‰å‘½åæ¥ç¿»è¯‘çš„è¯ï¼Œåº”è¯¥å«ä½ä½é¦–å°¾èŠ‚ç‚¹ Node&lt;K,V&gt; loHead = null, loTail = null; // æŒ‰å‘½åæ¥ç¿»è¯‘çš„è¯ï¼Œåº”è¯¥å«é«˜ä½é¦–å°¾èŠ‚ç‚¹ Node&lt;K,V&gt; hiHead = null, hiTail = null; // ä»¥ä¸Šçš„ä½ä½æŒ‡çš„æ˜¯æ–°æ•°ç»„çš„ 0 åˆ° oldCap-1 ã€é«˜ä½æŒ‡å®šçš„æ˜¯oldCap åˆ° newCap - 1 Node&lt;K,V&gt; next; // éå†é“¾è¡¨ do &#123; // nextè¡¨ç¤ºä¸‹ä¸€ä¸ªnodeèŠ‚ç‚¹ next = e.next; // åŸç´¢å¼• // è¿™ä¸€æ­¥åˆ¤æ–­å¥½ç‹ ï¼Œæ‹¿å…ƒç´ çš„hashå€¼å’Œè€æ•°ç»„çš„é•¿åº¦åšä¸è¿ç®— // æ•°ç»„çš„é•¿åº¦ä¸€å®šæ˜¯2çš„Næ¬¡æ–¹(ä¾‹å¦‚16)ï¼Œå¦‚æœhashå€¼å’Œè¯¥é•¿åº¦åšä¸è¿ç®—ï¼Œç»“æœä¸º0ï¼Œå°±è¯´æ˜è¯¥hashå€¼å’Œæ•°ç»„é•¿åº¦å–æ¨¡åçš„å€¼ä¸€å®šå°äºæ•°ç»„é•¿åº¦ï¼ˆä¾‹å¦‚modå€¼ä¸º1ï¼‰ã€‚ // é‚£ä¹ˆè¯¥hashå€¼å†å’Œæ–°æ•°ç»„çš„é•¿åº¦å–æ‘¸çš„è¯modå€¼ä¹Ÿä¸ä¼šæ”¾ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥è¯¥å…ƒç´ çš„åœ¨æ–°æ•°ç»„çš„ä½ç½®å’Œåœ¨è€æ•°ç»„çš„ä½ç½®æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥è¯¥å…ƒç´ å¯ä»¥æ”¾ç½®åœ¨ä½ä½é“¾è¡¨ä¸­ã€‚ if ((e.hash &amp; oldCap) == 0) &#123; if (loTail == null) // å¦‚æœæ²¡æœ‰å°¾ï¼Œè¯´æ˜é“¾è¡¨ä¸ºç©ºï¼Œé“¾è¡¨ä¸ºç©ºæ—¶ï¼Œå¤´èŠ‚ç‚¹æŒ‡å‘è¯¥å…ƒç´ ã€‚ loHead = e; else // å¦‚æœæœ‰å°¾ï¼Œé‚£ä¹ˆé“¾è¡¨ä¸ä¸ºç©ºï¼ŒæŠŠè¯¥å…ƒç´ æŒ‚åˆ°é“¾è¡¨çš„æœ€åã€‚ loTail.next = e; // æŠŠå°¾èŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰å…ƒç´ ã€‚ loTail = e; &#125; // åŸç´¢å¼•+oldCap // å¦‚æœä¸è¿ç®—ç»“æœä¸ä¸º0ï¼Œè¯´æ˜hashå€¼å¤§äºè€æ•°ç»„é•¿åº¦ï¼ˆä¾‹å¦‚hashå€¼ä¸º17ï¼‰ã€‚ // æ­¤æ—¶è¯¥å…ƒç´ åº”è¯¥æ”¾ç½®åˆ°æ–°æ•°ç»„çš„é«˜ä½ä½ç½®ä¸Šã€‚ // ä¾‹ï¼šè€æ•°ç»„é•¿åº¦16ï¼Œé‚£ä¹ˆæ–°æ•°ç»„é•¿åº¦ä¸º32ï¼Œhashä¸º17çš„åº”è¯¥æ”¾ç½®åœ¨æ•°ç»„çš„ç¬¬17ä¸ªä½ç½®ä¸Šï¼Œä¹Ÿå°±æ˜¯ä¸‹æ ‡ä¸º16ï¼Œé‚£ä¹ˆä¸‹æ ‡ä¸º16å·²ç»å±äºé«˜ä½äº†ï¼Œä½ä½æ˜¯[0-15]ï¼Œé«˜ä½æ˜¯[16-31]ã€‚ else &#123; if (hiTail == null) // å¦‚æœæ²¡æœ‰å°¾ï¼Œè¯´æ˜é“¾è¡¨ä¸ºç©ºï¼Œé“¾è¡¨ä¸ºç©ºæ—¶ï¼Œå¤´èŠ‚ç‚¹æŒ‡å‘è¯¥å…ƒç´ ã€‚ hiHead = e; else // å¦‚æœæœ‰å°¾ï¼Œé‚£ä¹ˆé“¾è¡¨ä¸ä¸ºç©ºï¼ŒæŠŠè¯¥å…ƒç´ æŒ‚åˆ°é“¾è¡¨çš„æœ€åã€‚ hiTail.next = e; // æŠŠå°¾èŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰å…ƒç´ ã€‚ hiTail = e; &#125; &#125; while ((e = next) != null); // åŸç´¢å¼•æ”¾åˆ°bucketé‡Œï¼Œå³ä½ä½çš„å…ƒç´ ç»„æˆçš„é“¾è¡¨è¿˜æ˜¯æ”¾ç½®åœ¨åŸæ¥çš„ä½ç½® if (loTail != null) &#123; loTail.next = null; newTab[j] = loHead; &#125; // åŸç´¢å¼•+oldCapæ”¾åˆ°bucketé‡Œï¼Œå³é«˜ä½çš„å…ƒç´ ç»„æˆçš„é“¾è¡¨æ”¾ç½®çš„ä½ç½®åªæ˜¯åœ¨åŸæœ‰ä½ç½®ä¸Šåç§»äº†è€æ•°ç»„çš„é•¿åº¦ä¸ªä½ç½®ã€‚ if (hiTail != null) &#123; hiTail.next = null; // ä¾‹1:hashä¸º17åœ¨è€æ•°ç»„æ”¾ç½®åœ¨0ä¸‹æ ‡,åœ¨æ–°æ•°ç»„æ”¾ç½®åœ¨16ä¸‹æ ‡; // ä¾‹2:hashä¸º18åœ¨è€æ•°ç»„æ”¾ç½®åœ¨1ä¸‹æ ‡,åœ¨æ–°æ•°ç»„æ”¾ç½®åœ¨17ä¸‹æ ‡ã€‚ newTab[j + oldCap] = hiHead; &#125; &#125; &#125; &#125; &#125; // è¿”å›æ–°çš„ä½æ¡¶æ•°ç»„ return newTab;&#125; treeifyBinæ–¹æ³•1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950/** * è½¬æ¢ä¸ºçº¢é»‘æ ‘çš„æ“ä½œ * å‚æ•°tab: å…ƒç´ æ•°ç»„ * å‚æ•°hash: keyçš„hashCode * Replaces all linked nodes in bin at index for given hash unless * table is too small, in which case resizes instead. */final void treeifyBin(Node&lt;K,V&gt;[] tab, int hash) &#123; int n, index; Node&lt;K,V&gt; e; /* * å¦‚æœå…ƒç´ æ•°ç»„ä¸ºç©ºæˆ–è€…æ•°ç»„é•¿åº¦å°äº æ ‘ç»“æ„åŒ–çš„æœ€å°é™åˆ¶ * MIN_TREEIFY_CAPACITY é»˜è®¤å€¼64ï¼Œå¯¹äºè¿™ä¸ªå€¼å¯ä»¥ç†è§£ä¸ºï¼š * å¦‚æœå…ƒç´ æ•°ç»„é•¿åº¦å°äºè¿™ä¸ªå€¼ï¼Œæ²¡æœ‰å¿…è¦å»è¿›è¡Œç»“æ„è½¬æ¢; * å½“ä¸€ä¸ªæ•°ç»„ä½ç½®ä¸Šé›†ä¸­äº†å¤šä¸ªé”®å€¼å¯¹ï¼Œé‚£æ˜¯å› ä¸ºè¿™äº›keyçš„hashå€¼å’Œæ•°ç»„é•¿åº¦å–æ¨¡ä¹‹åç»“æœç›¸åŒ.(å¹¶ä¸æ˜¯å› ä¸ºè¿™äº› * keyçš„hashå€¼ç›¸åŒ).å› ä¸ºhashå€¼ç›¸åŒçš„æ¦‚ç‡ä¸é«˜ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ‰©å®¹çš„æ–¹å¼ï¼Œæ¥ä½¿å¾—æœ€ç»ˆè¿™äº›keyçš„hashå€¼åœ¨å’Œæ–° * çš„æ•°ç»„é•¿åº¦å–æ¨¡ä¹‹åï¼Œæ‹†åˆ†åˆ°å¤šä¸ªæ•°ç»„ä½ç½®ä¸Šã€‚ */ if (tab == null || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY) // å¦‚æœæ•°ç»„ä¸ºnullæˆ–è€…å°äºMIN_TREEIFY_CAPACITY=64åˆ™è¿›è¡Œæ‰©å®¹æ“ä½œ resize(); // å¦‚æœå…ƒç´ æ•°ç»„é•¿åº¦å·²ç»å¤§äºç­‰äºäº† MIN_TREEIFY_CAPACITYï¼Œé‚£ä¹ˆå°±æœ‰å¿…è¦è¿›è¡Œç»“æ„è½¬æ¢äº†ã€‚ // æ ¹æ®hashå€¼å’Œæ•°ç»„é•¿åº¦è¿›è¡Œå–æ¨¡è¿ç®—åï¼Œå¾—åˆ°é“¾è¡¨çš„é¦–èŠ‚ç‚¹ã€‚ else if ((e = tab[index = (n - 1) &amp; hash]) != null) &#123; // å®šä¹‰é¦–ã€å°¾èŠ‚ç‚¹ã€‚ TreeNode&lt;K,V&gt; hd = null, tl = null; do &#123; // å°†è¯¥èŠ‚ç‚¹è½¬æ¢ä¸ºæ ‘èŠ‚ç‚¹ã€‚ TreeNode&lt;K,V&gt; p = replacementTreeNode(e, null); // å¦‚æœå°¾èŠ‚ç‚¹ä¸ºç©ºï¼Œè¯´æ˜è¿˜æ²¡æœ‰æ ¹èŠ‚ç‚¹ã€‚ if (tl == null) // é¦–èŠ‚ç‚¹ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰æŒ‡å‘å½“å‰èŠ‚ç‚¹ hd = p; else &#123; // å°¾èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œä»¥ä¸‹ä¸¤è¡Œä»£ç æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ç»“æ„ // å½“å‰æ ‘èŠ‚ç‚¹çš„ å‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘å°¾èŠ‚ç‚¹ p.prev = tl; // å°¾èŠ‚ç‚¹çš„ åä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘å½“å‰èŠ‚ç‚¹ tl.next = p; &#125; // æŠŠå½“å‰èŠ‚ç‚¹è®¾ä¸ºå°¾èŠ‚ tl = p; // å½“éå†å°¾èŠ‚ç‚¹ä¸ºnullæ—¶å€™ï¼Œåˆ™ç»“æŸï¼Œå¦åˆ™æœ‰èŠ‚ç‚¹ç»§ç»­éå†é“¾è¡¨ &#125; while ((e = e.next) != null); // åˆ°ç›®å‰ä¸ºæ­¢ ä¹Ÿåªæ˜¯æŠŠNodeå¯¹è±¡è½¬æ¢æˆäº†TreeNodeå¯¹è±¡ï¼ŒæŠŠå•å‘é“¾è¡¨è½¬æ¢æˆäº†åŒå‘é“¾è¡¨ // æŠŠè½¬æ¢åçš„åŒå‘é“¾è¡¨ï¼Œæ›¿æ¢åŸæ¥ä½ç½®ä¸Šçš„å•å‘é“¾è¡¨ if ((tab[index] = hd) != null) hd.treeify(tab); &#125;&#125; tableSizeForæ–¹æ³•1234567891011121314/** * è¿”å›å¤§äºè¾“å…¥å‚æ•°ä¸”æœ€è¿‘çš„2çš„æ•´æ•°æ¬¡å¹‚çš„æ•°ï¼Œä¾‹å¦‚è¾“å…¥14ï¼Œåˆ™è¿”å›2çš„4æ¬¡å¹‚ï¼Œå³16ã€‚ * å¦‚æœç®—å‡ºæ¥çš„nå¤§äºç­‰äºæœ€å¤§çš„å®¹é‡ï¼Œåˆ™å–æœ€å¤§çš„å®¹é‡ã€‚ * Returns a power of two size for the given target capacity. */static final int tableSizeFor(int cap) &#123; int n = cap - 1; n |= n &gt;&gt;&gt; 1; n |= n &gt;&gt;&gt; 2; n |= n &gt;&gt;&gt; 4; n |= n &gt;&gt;&gt; 8; n |= n &gt;&gt;&gt; 16; return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;&#125; å…ˆæ¥åˆ†ææœ‰å…³nä½æ“ä½œéƒ¨åˆ†ï¼šå…ˆæ¥å‡è®¾nçš„äºŒè¿›åˆ¶ä¸º01xxxâ€¦xxxã€‚æ¥ç€ å¯¹nå³ç§»1ä½ï¼š001xxâ€¦xxxï¼Œå†ä½æˆ–ï¼š011xxâ€¦xxx å¯¹nå³ç§»2ä¸ºï¼š00011â€¦xxxï¼Œå†ä½æˆ–ï¼š01111â€¦xxx æ­¤æ—¶å‰é¢å·²ç»æœ‰å››ä¸ª1äº†ï¼Œå†å³ç§»4ä½ä¸”ä½æˆ–å¯å¾—8ä¸ª1 åŒç†ï¼Œæœ‰8ä¸ª1ï¼Œå³ç§»8ä½è‚¯å®šä¼šè®©åå…«ä½ä¹Ÿä¸º1ã€‚ ç»¼ä¸Šå¯å¾—ï¼Œè¯¥ç®—æ³•è®©æœ€é«˜ä½çš„1åé¢çš„ä½å…¨å˜ä¸º1ã€‚ æœ€åå†è®©ç»“æœn+1ï¼Œå³å¾—åˆ°äº†2çš„æ•´æ•°æ¬¡å¹‚çš„å€¼äº†ã€‚ ç°åœ¨å›æ¥çœ‹çœ‹ç¬¬ä¸€æ¡è¯­å¥ï¼š 1int n = cap - 1; è®©cap-1å†èµ‹å€¼ç»™nçš„ç›®çš„æ˜¯å¦æ‰¾åˆ°çš„ç›®æ ‡å€¼å¤§äºæˆ–ç­‰äºåŸå€¼ã€‚ä¾‹å¦‚äºŒè¿›åˆ¶1000ï¼Œåè¿›åˆ¶æ•°å€¼ä¸º8ã€‚å¦‚æœä¸å¯¹å®ƒå‡1è€Œç›´æ¥æ“ä½œï¼Œå°†å¾—åˆ°ç­”æ¡ˆ10000ï¼Œå³16ã€‚æ˜¾ç„¶ä¸æ˜¯ç»“æœã€‚å‡1åäºŒè¿›åˆ¶ä¸º111ï¼Œå†è¿›è¡Œæ“ä½œåˆ™ä¼šå¾—åˆ°åŸæ¥çš„æ•°å€¼1000ï¼Œå³8ã€‚ å‚è€ƒæ–‡çŒ® Java8ç³»åˆ—ä¹‹é‡æ–°è®¤è¯†HashMap Java7HashMapçŸ¥è¯†ç‚¹æ•´ç†","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://ltyeamin.github.io/tags/Java/"}]},{"title":"çº¢é»‘æ ‘æ·±å…¥å‰–æåŠJavaå®ç°","slug":"çº¢é»‘æ ‘æ·±å…¥å‰–æåŠJavaå®ç°","date":"2019-03-29T11:00:09.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2019/03/29/çº¢é»‘æ ‘æ·±å…¥å‰–æåŠJavaå®ç°/","link":"","permalink":"http://ltyeamin.github.io/2019/03/29/çº¢é»‘æ ‘æ·±å…¥å‰–æåŠJavaå®ç°/","excerpt":"","text":"è°ˆåˆ°æ•°æ®ç»“æ„çš„æ ‘ï¼Œç¬”è€…çš„å°è±¡ä¸­è¿˜æ˜¯åœ¨å¤§å­¦æ—¶æœŸçš„æ¦‚å¿µï¼Œæœ€æ—©çš„æ¦‚å¿µæºè‡ªäºå“ˆå¤«æ›¼æ ‘(æœ€ä¼˜äºŒå‰æ ‘)ï¼Œå…¶ä»–çš„æ ‘ç»“æ„è¿˜æœ‰äºŒå‰æŸ¥æ‰¾æ ‘ã€å®Œå…¨äºŒå‰æ ‘ã€å¹³è¡¡äºŒå‰æ ‘(åˆåˆ†ä¸ºAVLæ ‘ã€RBçº¢é»‘æ ‘ã€SBTã€ä¼¸å±•æ ‘ã€TREAPã€æ›¿ç½ªç¾Šæ ‘ ï¼‰ã€å¹³è¡¡å¤šå‰æ ‘ï¼ˆB - Tree å’ŒB+ Tree)ç­‰ï¼Œä»Šå¤©æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹å¹³è¡¡äºŒå‰æ ‘çš„RBçº¢é»‘æ ‘ï¼Œå› ä¸ºRBçº¢é»‘æ ‘åœ¨JAVAä¸­çš„å®ç°è¿˜æ˜¯è›®å¤šçš„ã€‚ çº¢é»‘æ ‘æ˜¯å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘çš„ä¸€ç§ã€‚ä¸ºäº†æ·±å…¥ç†è§£çº¢é»‘æ ‘ï¼Œæˆ‘ä»¬å…ˆå›å¿†ä¸€ä¸‹å¤§å­¦æ•°æ®ç»“æ„ä¸­çš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘åŸºæœ¬æ¦‚å¿µç™¾åº¦ç™¾ç§‘å®šä¹‰å¦‚ä¸‹ï¼š äºŒå‰æ’åºæ ‘ï¼ˆBinary Sort Treeï¼‰ï¼Œåˆç§°äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼‰ï¼Œäº¦ç§°äºŒå‰æœç´¢æ ‘ã€‚ äºŒå‰æ’åºæ ‘æˆ–è€…æ˜¯ä¸€æ£µç©ºæ ‘ï¼Œæˆ–è€…æ˜¯å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼š ï¼ˆ1ï¼‰è‹¥å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼› ï¼ˆ2ï¼‰è‹¥å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºæˆ–ç­‰äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼› ï¼ˆ3ï¼‰å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æ’åºæ ‘ï¼› äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆBinary Search Treeï¼Œç®€ç§°BSTï¼‰æ˜¯ä¸€æ£µäºŒå‰æ ‘ï¼Œå®ƒçš„å·¦å­èŠ‚ç‚¹çš„å€¼æ¯”çˆ¶èŠ‚ç‚¹çš„å€¼è¦å°ï¼Œå³èŠ‚ç‚¹çš„å€¼è¦æ¯”çˆ¶èŠ‚ç‚¹çš„å€¼å¤§ã€‚å®ƒçš„é«˜åº¦å†³å®šäº†å®ƒçš„æŸ¥æ‰¾æ•ˆç‡ã€‚ åœ¨ç†æƒ³çš„æƒ…å†µä¸‹ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘å¢åˆ æŸ¥æ”¹çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logN)ï¼ˆå…¶ä¸­Nä¸ºèŠ‚ç‚¹æ•°ï¼‰ï¼Œæœ€åçš„æƒ…å†µä¸‹ä¸ºO(N)ã€‚å½“å®ƒçš„é«˜åº¦ä¸ºlogN+1æ—¶ï¼Œæˆ‘ä»¬å°±è¯´äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯å¹³è¡¡çš„ã€‚ åŸºæœ¬æ“ä½œæŸ¥æ‰¾1234567891011121314151617181920212223242526// å®šä¹‰ä¸€ä¸ªæœç´¢çš„KeyT key = a search key// æ ‘çš„èŠ‚ç‚¹ï¼Œå½“å‰èŠ‚ç‚¹æŒ‡çš„æ˜¯æ ‘çš„æ ¹èŠ‚ç‚¹Node root = point to the root of a BST//å¾ªç¯æŸ¥æ‰¾æ ‘while(true)&#123; // æ ¹èŠ‚ç‚¹ä¸ºç©ºï¼Œç›´æ¥ç»“æŸï¼Œæ— æ³•ç»§ç»­æŸ¥è¯¢ if(root==null)&#123; break; &#125; // å¦‚æœæŸ¥æ‰¾åˆ°ï¼Œç›´æ¥è¿”å›å½“å‰çš„èŠ‚ç‚¹ if(root.value.equals(key))&#123; return root; &#125; // æ²¡æœ‰æŸ¥åˆ°åˆ™åšæ¯”è¾ƒç»§ç»­æŸ¥è¯¢ï¼Œå¦‚æœå½“å‰è¦æŸ¥æ‰¾çš„keyä¸å½“å‰èŠ‚ç‚¹valueåšæ¯”è¾ƒï¼Œè‹¥keyå°äºå½“å‰èŠ‚ç‚¹çš„valueåœ¨å·¦å­æ ‘æŸ¥æ‰¾ else if(key.compareTo(root.value)&lt;0)&#123; root = root.left; &#125; // è‹¥keyå¤§äºå½“å‰èŠ‚ç‚¹çš„valueåœ¨å³å­æ ‘æŸ¥æ‰¾ else&#123; // å°†å³å­—æ•°æŒ‡å‘çš„rootèŠ‚ç‚¹ï¼Œç»§ç»­æŸ¥æ‰¾ root = root.right; &#125;&#125;// æ²¡æœ‰æŸ¥æ‰¾åˆ™è¿”å›nullreturn null; ä»ç¨‹åºä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“BSTæŸ¥æ‰¾çš„æ—¶å€™ï¼Œå…ˆä¸å½“å‰èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼š å¦‚æœç›¸ç­‰çš„è¯å°±è¿”å›å½“å‰èŠ‚ç‚¹ï¼› å¦‚æœå°‘äºå½“å‰èŠ‚ç‚¹åˆ™ç»§ç»­æŸ¥æ‰¾å½“å‰èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼› å¦‚æœå¤§äºå½“å‰èŠ‚ç‚¹åˆ™ç»§ç»­æŸ¥æ‰¾å½“å‰èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ ç›´åˆ°å½“å‰èŠ‚ç‚¹æŒ‡é’ˆä¸ºç©ºæˆ–è€…æŸ¥æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œç¨‹åºæŸ¥æ‰¾ç»“æŸã€‚ æ’å…¥1234567891011121314151617181920212223242526272829303132333435// æ–°èŠ‚ç‚¹Node node = create a new node with specify value// æ ‘çš„èŠ‚ç‚¹ï¼Œé»˜è®¤å½“å‰èŠ‚ç‚¹æŒ‡çš„æ˜¯æ ‘çš„æ ¹èŠ‚ç‚¹Node root = point the root node of a BST// çˆ¶èŠ‚ç‚¹å¼•ç”¨Node parent = null;//find the parent node to append the new node// åœ¨å¾ªç¯ä¸­ï¼Œæ‰¾å¾…æ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹while(true)&#123; // å¦‚æœæ ¹èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥ç»“æŸï¼Œæ·»åŠ å¤±è´¥ã€‚ if(root==null) break; // å°†çˆ¶èŠ‚ç‚¹æŒ‡å‘æ ¹èŠ‚ç‚¹ parent = root; // å¦‚æœæ–°èŠ‚ç‚¹çš„valueå€¼å°äºç­‰äºrootèŠ‚ç‚¹valueçš„ï¼Œæ·»åŠ åˆ°å·¦å­æ ‘ï¼Œæ‰¾å·¦å­æ ‘çš„çˆ¶èŠ‚ç‚¹ if(node.value.compareTo(root.value)&lt;=0)&#123; root = root.left; &#125;else&#123; // å¦åˆ™ï¼Œæ·»åŠ åˆ°å³å­æ ‘ï¼Œæ‰¾å³å­æ ‘çš„çˆ¶èŠ‚ç‚¹ root = root.right; &#125; &#125;//å¦‚æœçˆ¶èŠ‚ç‚¹ä¸ä¸ºnullï¼Œæ‰§è¡Œæ·»åŠ æ“ä½œif(parent!=null)&#123; // å¼€å§‹æ·»åŠ æ“ä½œ if(node.value.compareTo(parent.value)&lt;=0)&#123; // æ·»åŠ å·¦å­æ ‘ //append to left parent.left = node; &#125;else&#123; // append to right // å¼€å§‹æ·»åŠ æ“ä½œï¼Œæ·»åŠ å³å­æ ‘ parent.right = node; &#125;&#125; æ’å…¥æ“ä½œå…ˆé€šè¿‡å¾ªç¯æŸ¥æ‰¾åˆ°å¾…æ’å…¥çš„èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œå’ŒæŸ¥æ‰¾çˆ¶èŠ‚ç‚¹çš„é€»è¾‘ä¸€æ ·ï¼Œéƒ½æ˜¯æ¯”å¤§å°ï¼Œå°çš„å¾€å·¦ï¼Œå¤§çš„å¾€å³ã€‚æ‰¾åˆ°çˆ¶èŠ‚ç‚¹åï¼Œå¯¹æ¯”çˆ¶èŠ‚ç‚¹ï¼Œå°çš„å°±æ’å…¥åˆ°çˆ¶èŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹ï¼Œå¤§å°±æ’å…¥åˆ°çˆ¶èŠ‚ç‚¹çš„å³èŠ‚ç‚¹ä¸Šã€‚ åˆ é™¤1234567891011121314151617181920212223242526272829// å¾…åˆ é™¤èŠ‚ç‚¹ï¼Œå¯æ ¹æ®æŸ¥æ‰¾ä»£ç æŸ¥æ‰¾å‡ºå¾…åˆ é™¤çš„èŠ‚ç‚¹Node node = delete a new node with specify value// å¦‚æœèŠ‚ç‚¹å­˜åœ¨ï¼Œåˆ™è¿›è¡Œåˆ é™¤if (node != null) &#123; // å¦‚æœèŠ‚ç‚¹æœ‰å·¦å­æ ‘ï¼Œåˆ™ç»§ç»­æ“ä½œ if (node.left != null) &#123; // æ‰¾åˆ°å…¶å·¦å­æ ‘çš„æœ€å³è¾¹çš„å¶å­ç»“ç‚¹leftRï¼Œç”¨è¯¥å¶å­ç»“ç‚¹leftRæ¥æ›¿ä»£å¾…åˆ é™¤çš„èŠ‚ç‚¹node.æŠŠleftRçš„å·¦å­©å­ä½œä¸ºleftRçš„çˆ¶äº²çš„å³å­©å­ã€‚ Node leftR = node.left; // å…ˆå‰çš„èŠ‚ç‚¹çš„å¤‡ä»½ Node prev = node.left; while(leftR.left != null) &#123; prev = leftR; leftR = leftR.right; &#125; // å°†æŸ¥æ‰¾åˆ°çš„leftR.valueèµ‹å€¼åˆ°node.value node.value = leftR.value; // è‹¥leftRä¸æ˜¯nodeçš„å·¦å­æ ‘,nodeçš„å·¦å­æ ‘ä¸å˜ï¼ŒleftRçš„å·¦å­æ ‘ä½œä¸ºleftRçš„çˆ¶ç»“ç‚¹çš„å³å­©å­ç»“ç‚¹ if(prev != leftR) &#123; prev.right = leftR.left; &#125; else &#123; // è‹¥æ˜¯leftRçš„å·¦å­æ ‘ï¼Œåˆ™nodeçš„å·¦å­æ ‘æŒ‡å‘leftRçš„å·¦å­æ ‘ node.left=leftR.right; &#125; &#125; else &#123; // å¦‚æœèŠ‚ç‚¹æœ‰å·¦å­æ ‘ï¼Œç›´æ¥ç”¨nodeèŠ‚ç‚¹çš„å³å­©å­å–ä»£å®ƒ node = node.right; &#125;&#125; åˆ é™¤æ“ä½œçš„æ­¥éª¤å¦‚ä¸‹ï¼š æŸ¥æ‰¾åˆ°è¦åˆ é™¤çš„èŠ‚ç‚¹ã€‚ å¦‚æœå¾…åˆ é™¤çš„èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå³PL(å·¦å­æ ‘)å’ŒPR(å³å­æ ‘)å‡ä¸ºç©ºæ ‘ï¼Œç”±äºåˆ å»å¶å­ç»“ç‚¹ä¸ç ´åæ•´æ£µæ ‘çš„ç»“æ„ï¼Œåˆ™ç›´æ¥åˆ é™¤ã€‚ å¦‚æœå¾…åˆ é™¤çš„èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™å…ˆæ‰¾åˆ°å¾…åˆ é™¤èŠ‚ç‚¹çš„ä¸­åºéå†çš„åç»§èŠ‚ç‚¹ï¼Œç”¨è¯¥åç»§èŠ‚ç‚¹çš„å€¼æ›¿æ¢å¾…åˆ é™¤çš„èŠ‚ç‚¹çš„å€¼ï¼Œç„¶ååˆ é™¤åç»§èŠ‚ç‚¹ã€‚ å­˜åœ¨çš„å¼Šç«¯BSTå­˜åœ¨çš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œæ•°åœ¨æ’å…¥çš„æ—¶å€™ä¼šå¯¼è‡´æ ‘å€¾æ–œï¼Œä¸åŒçš„æ’å…¥é¡ºåºä¼šå¯¼è‡´æ ‘çš„é«˜åº¦ä¸ä¸€æ ·ï¼Œè€Œæ ‘çš„é«˜åº¦ç›´æ¥çš„å½±å“äº†æ ‘çš„æŸ¥æ‰¾æ•ˆç‡ã€‚ç†æƒ³çš„é«˜åº¦æ˜¯logNï¼Œæœ€åçš„æƒ…å†µæ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½åœ¨ä¸€æ¡æ–œçº¿ä¸Šï¼Œè¿™æ ·çš„æ ‘çš„é«˜åº¦ä¸ºNã€‚ ä»‹äºä»¥ä¸Šçš„å¼Šç«¯ï¼Œæˆ‘ä»¬æœ‰å…¶ä»–æ–°çš„çš„æ ‘ç»“æ„é€‰æ‹©ï¼šSize Balanced Tree(SBT)ã€AVLæ ‘ã€RBçº¢é»‘æ ‘ã€Treap(Tree+Heap)ã€‚è¿™äº›å‡å¯ä»¥ä½¿æŸ¥æ‰¾æ ‘çš„é«˜åº¦ä¸ºO(log(n))ã€‚ RBçº¢é»‘æ ‘åŸºæœ¬æ¦‚å¿µ çº¢é»‘æ ‘ï¼ˆRed Black Treeï¼‰ æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œåˆç§°å¯¹ç§°äºŒå‰Bæ ‘ï¼Œæ˜¯åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ç”¨åˆ°çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå…¸å‹çš„ç”¨é€”æ˜¯å®ç°å…³è”æ•°ç»„ã€‚ å®ƒæ˜¯åœ¨1972å¹´ç”±Rudolf Bayerå‘æ˜çš„ï¼Œå½“æ—¶è¢«ç§°ä¸ºå¹³è¡¡äºŒå‰Bæ ‘ï¼ˆsymmetric binary B-treesï¼‰ã€‚åæ¥ï¼Œåœ¨1978å¹´è¢« Leo J. Guibas å’Œ Robert Sedgewick ä¿®æ”¹ä¸ºå¦‚ä»Šçš„â€œçº¢é»‘æ ‘â€ã€‚ çº¢é»‘æ ‘å’ŒAVLæ ‘ç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶é€šè¿‡ç‰¹å®šæ“ä½œä¿æŒäºŒå‰æŸ¥æ‰¾æ ‘çš„å¹³è¡¡ï¼Œä»è€Œè·å¾—è¾ƒé«˜çš„æŸ¥æ‰¾æ€§èƒ½ã€‚ å®ƒè™½ç„¶æ˜¯å¤æ‚çš„ï¼Œä½†å®ƒçš„æœ€åæƒ…å†µè¿è¡Œæ—¶é—´ä¹Ÿæ˜¯éå¸¸è‰¯å¥½çš„ï¼Œå¹¶ä¸”åœ¨å®è·µä¸­æ˜¯é«˜æ•ˆçš„ï¼š å®ƒå¯ä»¥åœ¨O(log n)æ—¶é—´å†…åšæŸ¥æ‰¾ï¼Œæ’å…¥å’Œåˆ é™¤ï¼Œè¿™é‡Œçš„n æ˜¯æ ‘ä¸­å…ƒç´ çš„æ•°ç›®ã€‚ åŸºäºBSTå­˜åœ¨çš„é—®é¢˜ï¼Œä¸€ç§æ–°çš„æ ‘â€”â€”å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘(Balanced BST)äº§ç”Ÿäº†ã€‚å¹³è¡¡æ ‘åœ¨æ’å…¥å’Œåˆ é™¤çš„æ—¶å€™ï¼Œä¼šé€šè¿‡æ—‹è½¬æ“ä½œå°†é«˜åº¦ä¿æŒåœ¨logNã€‚å…¶ä¸­ä¸¤æ¬¾å…·æœ‰ä»£è¡¨æ€§çš„å¹³è¡¡æ ‘åˆ†åˆ«ä¸ºAVLæ ‘å’Œçº¢é»‘æ ‘ã€‚AVLæ ‘ç”±äºå®ç°æ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”æ’å…¥å’Œåˆ é™¤æ€§èƒ½å·®ï¼Œåœ¨å®é™…ç¯å¢ƒä¸‹çš„åº”ç”¨ä¸å¦‚çº¢é»‘æ ‘ã€‚ çº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼Œä»¥ä¸‹ç®€ç§°RBTreeï¼‰çš„å®é™…åº”ç”¨éå¸¸å¹¿æ³›ï¼Œæ¯”å¦‚Linuxå†…æ ¸ä¸­çš„å®Œå…¨å…¬å¹³è°ƒåº¦å™¨ã€é«˜ç²¾åº¦è®¡æ—¶å™¨ã€ext3æ–‡ä»¶ç³»ç»Ÿç­‰ç­‰ï¼Œå„ç§è¯­è¨€çš„å‡½æ•°åº“å¦‚Javaçš„TreeMapå’ŒTreeSetï¼ŒC++ STLçš„mapã€multimapã€multisetç­‰ã€‚ RBTreeä¹Ÿæ˜¯å‡½æ•°å¼è¯­è¨€ä¸­æœ€å¸¸ç”¨çš„æŒä¹…æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œåœ¨è®¡ç®—å‡ ä½•ä¸­ä¹Ÿæœ‰é‡è¦ä½œç”¨ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒJava 8ä¸­HashMapçš„å®ç°ä¹Ÿå› ä¸ºç”¨RBTreeå–ä»£é“¾è¡¨ï¼Œæ€§èƒ½æœ‰æ‰€æå‡ã€‚ åŸºæœ¬å®šä¹‰RBTreeçš„å®šä¹‰å¦‚ä¸‹: ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰é¢œè‰²ï¼Œé»‘è‰²æˆ–è€…çº¢è‰²ï¼› æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼› çˆ¶å­èŠ‚ç‚¹ä¹‹é—´ä¸èƒ½å‡ºç°ä¸¤ä¸ªè¿ç»­çš„çº¢èŠ‚ç‚¹ ï¼› ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹å‘ä¸‹éå†åˆ°å…¶å­å­™çš„å¶å­èŠ‚ç‚¹ï¼Œæ‰€ç»è¿‡çš„é»‘èŠ‚ç‚¹ä¸ªæ•°å¿…é¡»ç›¸ç­‰ ï¼› ç©ºèŠ‚ç‚¹è¢«è®¤ä¸ºæ˜¯é»‘è‰²çš„ã€‚ æ•°æ®ç»“æ„è¡¨ç¤ºå¦‚ä¸‹ï¼š 1234567lass Node&lt;T&gt;&#123; public T value; public Node&lt;T&gt; parent; public boolean isRed; public Node&lt;T&gt; left; public Node&lt;T&gt; right;&#125; RBTreeåœ¨ç†è®ºä¸Šè¿˜æ˜¯ä¸€æ£µBSTæ ‘ï¼Œä½†æ˜¯å®ƒåœ¨å¯¹BSTçš„æ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶ä¼šç»´æŒæ ‘çš„å¹³è¡¡ï¼Œå³ä¿è¯æ ‘çš„é«˜åº¦åœ¨[logN,logN+1]ï¼ˆç†è®ºä¸Šï¼Œæç«¯çš„æƒ…å†µä¸‹å¯ä»¥å‡ºç°RBTreeçš„é«˜åº¦è¾¾åˆ°2*logNï¼Œä½†å®é™…ä¸Šå¾ˆéš¾é‡åˆ°ï¼‰ã€‚è¿™æ ·RBTreeçš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦å§‹ç»ˆä¿æŒåœ¨O(logN)ä»è€Œæ¥è¿‘äºç†æƒ³çš„BSTã€‚RBTreeçš„åˆ é™¤å’Œæ’å…¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯O(logN)ã€‚RBTreeçš„æŸ¥æ‰¾æ“ä½œå°±æ˜¯BSTçš„æŸ¥æ‰¾æ“ä½œã€‚ åŸºæœ¬æ“ä½œæ—‹è½¬æ“ä½œæ—‹è½¬æ“ä½œ(Rotate)çš„ç›®çš„æ˜¯ä½¿èŠ‚ç‚¹é¢œè‰²ç¬¦åˆå®šä¹‰ï¼Œè®©RBTreeçš„é«˜åº¦è¾¾åˆ°å¹³è¡¡ã€‚ Rotateåˆ†ä¸ºleft-rotateï¼ˆå·¦æ—‹ï¼‰å’Œright-rotateï¼ˆå³æ—‹ï¼‰ï¼ŒåŒºåˆ†å·¦æ—‹å’Œå³æ—‹çš„æ–¹æ³•æ˜¯ï¼šå¾…æ—‹è½¬çš„èŠ‚ç‚¹ä»å·¦è¾¹ä¸Šå‡åˆ°çˆ¶èŠ‚ç‚¹å°±æ˜¯å³æ—‹ï¼Œå¾…æ—‹è½¬çš„èŠ‚ç‚¹ä»å³è¾¹ä¸Šå‡åˆ°çˆ¶èŠ‚ç‚¹å°±æ˜¯å·¦æ—‹ã€‚ æŸ¥æ‰¾æ“ä½œRBTreeçš„æŸ¥æ‰¾æ“ä½œå’ŒBSTçš„æŸ¥æ‰¾æ“ä½œæ˜¯ä¸€æ ·çš„ã€‚è¯·å‚è€ƒBSTçš„æŸ¥æ‰¾æ“ä½œä»£ç ã€‚ æ’å…¥æ“ä½œRBTreeçš„æ’å…¥ä¸BSTçš„æ’å…¥æ–¹å¼æ˜¯ä¸€è‡´çš„ï¼Œåªä¸è¿‡æ˜¯åœ¨æ’å…¥è¿‡åï¼Œå¯èƒ½ä¼šå¯¼è‡´æ ‘çš„ä¸å¹³è¡¡ï¼Œè¿™æ—¶å°±éœ€è¦å¯¹æ ‘è¿›è¡Œæ—‹è½¬æ“ä½œå’Œé¢œè‰²ä¿®å¤ï¼ˆåœ¨è¿™é‡Œç®€ç§°æ’å…¥ä¿®å¤ï¼‰ï¼Œä½¿å¾—å®ƒç¬¦åˆRBTreeçš„å®šä¹‰ã€‚ æ–°æ’å…¥çš„èŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œæ’å…¥ä¿®å¤æ“ä½œå¦‚æœé‡åˆ°çˆ¶èŠ‚ç‚¹çš„é¢œè‰²ä¸ºé»‘åˆ™ä¿®å¤æ“ä½œç»“æŸã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰åœ¨çˆ¶èŠ‚ç‚¹ä¸ºçº¢è‰²èŠ‚ç‚¹çš„æ—¶å€™æ˜¯éœ€è¦æ’å…¥ä¿®å¤æ“ä½œçš„ã€‚ æ’å…¥ä¿®å¤æ“ä½œåˆ†ä¸ºä»¥ä¸‹çš„ä¸‰ç§æƒ…å†µï¼Œè€Œä¸”æ–°æ’å…¥çš„èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹éƒ½æ˜¯çº¢è‰²çš„ï¼š å”å”èŠ‚ç‚¹ä¹Ÿä¸ºçº¢è‰²ã€‚ å”å”èŠ‚ç‚¹ä¸ºç©ºï¼Œä¸”ç¥–çˆ¶èŠ‚ç‚¹ã€çˆ¶èŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹å¤„äºä¸€æ¡æ–œçº¿ä¸Šã€‚ å”å”èŠ‚ç‚¹ä¸ºç©ºï¼Œä¸”ç¥–çˆ¶èŠ‚ç‚¹ã€çˆ¶èŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹ä¸å¤„äºä¸€æ¡æ–œçº¿ä¸Šã€‚ æ’å…¥æ“ä½œç¤ºä¾‹1 ç¤ºä¾‹1çš„æ“ä½œæ˜¯å°†çˆ¶èŠ‚ç‚¹å’Œå”å”èŠ‚ç‚¹ä¸ç¥–çˆ¶èŠ‚ç‚¹çš„é¢œè‰²äº’æ¢ï¼Œè¿™æ ·å°±ç¬¦åˆäº†RBTReeçš„å®šä¹‰ã€‚å³ç»´æŒäº†é«˜åº¦çš„å¹³è¡¡ï¼Œä¿®å¤åé¢œè‰²ä¹Ÿç¬¦åˆRBTreeå®šä¹‰çš„ç¬¬ä¸‰æ¡å’Œç¬¬å››æ¡ã€‚ä¸‹å›¾ä¸­ï¼Œæ“ä½œå®ŒæˆåAèŠ‚ç‚¹å˜æˆäº†æ–°çš„èŠ‚ç‚¹ã€‚å¦‚æœAèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸æ˜¯é»‘è‰²çš„è¯ï¼Œåˆ™ç»§ç»­åšä¿®å¤æ“ä½œã€‚ æ’å…¥æ“ä½œç¤ºä¾‹2 ç¤ºä¾‹2çš„æ“ä½œæ˜¯å°†BèŠ‚ç‚¹è¿›è¡Œå³æ—‹æ“ä½œï¼Œå¹¶ä¸”å’Œçˆ¶èŠ‚ç‚¹Aäº’æ¢é¢œè‰²ã€‚é€šè¿‡è¯¥ä¿®å¤æ“ä½œRBTReeçš„é«˜åº¦å’Œé¢œè‰²éƒ½ç¬¦åˆçº¢é»‘æ ‘çš„å®šä¹‰ã€‚å¦‚æœBå’ŒCèŠ‚ç‚¹éƒ½æ˜¯å³èŠ‚ç‚¹çš„è¯ï¼Œåªè¦å°†æ“ä½œå˜æˆå·¦æ—‹å°±å¯ä»¥äº†ã€‚ æ’å…¥æ“ä½œç¤ºä¾‹3 ç¤ºä¾‹ 3çš„æ“ä½œæ˜¯å°†CèŠ‚ç‚¹è¿›è¡Œå·¦æ—‹ï¼Œè¿™æ ·å°±ä»ç¤ºä¾‹ 3è½¬æ¢æˆç¤ºä¾‹ 2äº†ï¼Œç„¶åé’ˆå¯¹ç¤ºä¾‹ 2è¿›è¡Œæ“ä½œå¤„ç†å°±è¡Œäº†ã€‚ç¤ºä¾‹ 2æ“ä½œåšäº†ä¸€ä¸ªå³æ—‹æ“ä½œå’Œé¢œè‰²äº’æ¢æ¥è¾¾åˆ°ç›®çš„ã€‚å¦‚æœæ ‘çš„ç»“æ„æ˜¯ä¸‹å›¾çš„é•œåƒç»“æ„ï¼Œåˆ™åªéœ€è¦å°†å¯¹åº”çš„å·¦æ—‹å˜æˆå³æ—‹ï¼Œå³æ—‹å˜æˆå·¦æ—‹å³å¯ã€‚ æ’å…¥æ“ä½œçš„æ€»ç»“: æ’å…¥åçš„ä¿®å¤æ“ä½œæ˜¯ä¸€ä¸ªå‘rootèŠ‚ç‚¹å›æº¯çš„æ“ä½œï¼Œä¸€æ—¦ç‰µæ¶‰çš„èŠ‚ç‚¹éƒ½ç¬¦åˆäº†çº¢é»‘æ ‘çš„å®šä¹‰ï¼Œä¿®å¤æ“ä½œç»“æŸã€‚ä¹‹æ‰€ä»¥ä¼šå‘ä¸Šå›æº¯æ˜¯ç”±äºç¤ºä¾‹ 1æ“ä½œä¼šå°†çˆ¶èŠ‚ç‚¹ï¼Œå”å”èŠ‚ç‚¹å’Œç¥–çˆ¶èŠ‚ç‚¹è¿›è¡Œæ¢é¢œè‰²ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´ç¥–çˆ¶èŠ‚ç‚¹ä¸å¹³è¡¡(çº¢é»‘æ ‘å®šä¹‰3)ã€‚è¿™ä¸ªæ—¶å€™éœ€è¦å¯¹ç¥–çˆ¶èŠ‚ç‚¹ä¸ºèµ·ç‚¹è¿›è¡Œè°ƒèŠ‚ï¼ˆå‘ä¸Šå›æº¯ï¼‰ã€‚ ç¥–çˆ¶èŠ‚ç‚¹è°ƒèŠ‚åå¦‚æœè¿˜æ˜¯é‡åˆ°å®ƒçš„ç¥–çˆ¶é¢œè‰²é—®é¢˜ï¼Œæ“ä½œå°±ä¼šç»§ç»­å‘ä¸Šå›æº¯ï¼Œç›´åˆ°rootèŠ‚ç‚¹ä¸ºæ­¢ï¼Œæ ¹æ®å®šä¹‰rootèŠ‚ç‚¹æ°¸è¿œæ˜¯é»‘è‰²çš„ã€‚åœ¨å‘ä¸Šçš„è¿½æº¯çš„è¿‡ç¨‹ä¸­ï¼Œé’ˆå¯¹æ’å…¥çš„3ä¸­æƒ…å†µè¿›è¡Œè°ƒèŠ‚ã€‚ç›´åˆ°ç¬¦åˆçº¢é»‘æ ‘çš„å®šä¹‰ä¸ºæ­¢ã€‚ç›´åˆ°ç‰µæ¶‰çš„èŠ‚ç‚¹éƒ½ç¬¦åˆäº†çº¢é»‘æ ‘çš„å®šä¹‰ï¼Œä¿®å¤æ“ä½œç»“æŸã€‚ å¦‚æœä¸Šé¢çš„3ä¸­æƒ…å†µå¦‚æœå¯¹åº”çš„æ“ä½œæ˜¯åœ¨å³å­æ ‘ä¸Šï¼Œåšå¯¹åº”çš„é•œåƒæ“ä½œå°±æ˜¯äº†ã€‚ åˆ é™¤æ“ä½œåˆ é™¤æ“ä½œé¦–å…ˆéœ€è¦åšçš„ä¹Ÿæ˜¯BSTçš„åˆ é™¤æ“ä½œï¼Œåˆ é™¤æ“ä½œä¼šåˆ é™¤å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯å¶å­èŠ‚ç‚¹å°±ç›´æ¥åˆ é™¤ï¼Œå¦‚æœæ˜¯éå¶å­èŠ‚ç‚¹ï¼Œä¼šç”¨å¯¹åº”çš„ä¸­åºéå†çš„åç»§èŠ‚ç‚¹æ¥é¡¶æ›¿è¦åˆ é™¤èŠ‚ç‚¹çš„ä½ç½®ã€‚åˆ é™¤åå°±éœ€è¦åšåˆ é™¤ä¿®å¤æ“ä½œï¼Œä½¿çš„æ ‘ç¬¦åˆçº¢é»‘æ ‘çš„å®šä¹‰ï¼Œç¬¦åˆå®šä¹‰çš„çº¢é»‘æ ‘é«˜åº¦æ˜¯å¹³è¡¡çš„ã€‚ åˆ é™¤ä¿®å¤æ“ä½œåœ¨é‡åˆ°è¢«åˆ é™¤çš„èŠ‚ç‚¹æ˜¯çº¢è‰²èŠ‚ç‚¹æˆ–è€…åˆ°è¾¾rootèŠ‚ç‚¹æ—¶ï¼Œä¿®å¤æ“ä½œå®Œæ¯•ã€‚ åˆ é™¤ä¿®å¤æ“ä½œæ˜¯é’ˆå¯¹åˆ é™¤é»‘è‰²èŠ‚ç‚¹æ‰æœ‰çš„ï¼Œå½“é»‘è‰²èŠ‚ç‚¹è¢«åˆ é™¤åä¼šè®©æ•´ä¸ªæ ‘ä¸ç¬¦åˆRBTreeçš„å®šä¹‰çš„ç¬¬å››æ¡ã€‚éœ€è¦åšçš„å¤„ç†æ˜¯ä»å…„å¼ŸèŠ‚ç‚¹ä¸Šå€Ÿè°ƒé»‘è‰²çš„èŠ‚ç‚¹è¿‡æ¥ï¼Œå¦‚æœå…„å¼ŸèŠ‚ç‚¹æ²¡æœ‰é»‘èŠ‚ç‚¹å¯ä»¥å€Ÿè°ƒçš„è¯ï¼Œå°±åªèƒ½å¾€ä¸Šè¿½æº¯ï¼Œå°†æ¯ä¸€çº§çš„é»‘èŠ‚ç‚¹æ•°å‡å»ä¸€ä¸ªï¼Œä½¿å¾—æ•´æ£µæ ‘ç¬¦åˆçº¢é»‘æ ‘çš„å®šä¹‰ã€‚ åˆ é™¤æ“ä½œçš„æ€»ä½“æ€æƒ³æ˜¯ä»å…„å¼ŸèŠ‚ç‚¹å€Ÿè°ƒé»‘è‰²èŠ‚ç‚¹ä½¿æ ‘ä¿æŒå±€éƒ¨çš„å¹³è¡¡ï¼Œå¦‚æœå±€éƒ¨çš„å¹³è¡¡è¾¾åˆ°äº†ï¼Œå°±çœ‹æ•´ä½“çš„æ ‘æ˜¯å¦æ˜¯å¹³è¡¡çš„ï¼Œå¦‚æœä¸å¹³è¡¡å°±æ¥ç€å‘ä¸Šè¿½æº¯è°ƒæ•´ã€‚ åˆ é™¤ä¿®å¤æ“ä½œåˆ†ä¸ºå››ç§æƒ…å†µ(åˆ é™¤é»‘èŠ‚ç‚¹å)ï¼š å¾…åˆ é™¤çš„èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹æ˜¯çº¢è‰²çš„èŠ‚ç‚¹ã€‚ å¾…åˆ é™¤çš„èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹æ˜¯é»‘è‰²çš„èŠ‚ç‚¹ï¼Œä¸”å…„å¼ŸèŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ã€‚ å¾…è°ƒæ•´çš„èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹æ˜¯é»‘è‰²çš„èŠ‚ç‚¹ï¼Œä¸”å…„å¼ŸèŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œå³èŠ‚ç‚¹æ˜¯é»‘è‰²çš„(å…„å¼ŸèŠ‚ç‚¹åœ¨å³è¾¹)ï¼Œ å¦‚æœå…„å¼ŸèŠ‚ç‚¹åœ¨å·¦è¾¹çš„è¯ï¼Œå°±æ˜¯å…„å¼ŸèŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œå·¦èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ã€‚ å¾…è°ƒæ•´çš„èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹æ˜¯é»‘è‰²çš„èŠ‚ç‚¹ï¼Œä¸”å³å­èŠ‚ç‚¹æ˜¯æ˜¯çº¢è‰²çš„(å…„å¼ŸèŠ‚ç‚¹åœ¨å³è¾¹)ï¼Œå¦‚æœå…„å¼ŸèŠ‚ç‚¹åœ¨å·¦è¾¹ï¼Œåˆ™å°±æ˜¯å¯¹åº”çš„å°±æ˜¯å·¦èŠ‚ç‚¹æ˜¯çº¢è‰²çš„ã€‚ åˆ é™¤æ“ä½œç¤ºä¾‹1 ç”±äºå…„å¼ŸèŠ‚ç‚¹æ˜¯çº¢è‰²èŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ— æ³•å€Ÿè°ƒé»‘èŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦å°†å…„å¼ŸèŠ‚ç‚¹æå‡åˆ°çˆ¶èŠ‚ç‚¹ï¼Œç”±äºå…„å¼ŸèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œæ ¹æ®RBTreeçš„å®šä¹‰ï¼Œå…„å¼ŸèŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ï¼Œå°±å¯ä»¥ä»å®ƒçš„å­èŠ‚ç‚¹å€Ÿè°ƒäº†ã€‚ ç¤ºä¾‹1è¿™æ ·è½¬æ¢ä¹‹åå°±ä¼šå˜æˆåé¢çš„ç¤ºä¾‹2ï¼Œç¤ºä¾‹3ï¼Œæˆ–è€…ç¤ºä¾‹4è¿›è¡Œå¤„ç†äº†ã€‚ä¸Šå‡æ“ä½œéœ€è¦å¯¹Cåšä¸€ä¸ªå·¦æ—‹æ“ä½œï¼Œå¦‚æœæ˜¯é•œåƒç»“æ„çš„æ ‘åªéœ€è¦åšå¯¹åº”çš„å³æ—‹æ“ä½œå³å¯ã€‚ ä¹‹æ‰€ä»¥è¦åšç¤ºä¾‹1æ“ä½œæ˜¯å› ä¸ºå…„å¼ŸèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œæ— æ³•å€Ÿåˆ°ä¸€ä¸ªé»‘èŠ‚ç‚¹æ¥å¡«è¡¥åˆ é™¤çš„é»‘èŠ‚ç‚¹ã€‚ åˆ é™¤æ“ä½œç¤ºä¾‹2 ç¤ºä¾‹2çš„åˆ é™¤æ“ä½œæ˜¯ç”±äºå…„å¼ŸèŠ‚ç‚¹å¯ä»¥æ¶ˆé™¤ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ï¼Œå› ä¸ºå…„å¼ŸèŠ‚ç‚¹å’Œå…„å¼ŸèŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²çš„ï¼Œæ‰€ä»¥å¯ä»¥å°†å…„å¼ŸèŠ‚ç‚¹å˜çº¢ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æ ‘çš„å±€éƒ¨çš„é¢œè‰²ç¬¦åˆå®šä¹‰äº†ã€‚è¿™ä¸ªæ—¶å€™éœ€è¦å°†çˆ¶èŠ‚ç‚¹Aå˜æˆæ–°çš„èŠ‚ç‚¹ï¼Œç»§ç»­å‘ä¸Šè°ƒæ•´ï¼Œç›´åˆ°æ•´é¢—æ ‘çš„é¢œè‰²ç¬¦åˆRBTreeçš„å®šä¹‰ä¸ºæ­¢ã€‚ ç¤ºä¾‹2è¿™ç§æƒ…å†µä¸‹ä¹‹æ‰€ä»¥è¦å°†å…„å¼ŸèŠ‚ç‚¹å˜çº¢ï¼Œæ˜¯å› ä¸ºå¦‚æœæŠŠå…„å¼ŸèŠ‚ç‚¹å€Ÿè°ƒè¿‡æ¥ï¼Œä¼šå¯¼è‡´å…„å¼Ÿçš„ç»“æ„ä¸ç¬¦åˆRBTreeçš„å®šä¹‰ï¼Œè¿™æ ·çš„æƒ…å†µä¸‹åªèƒ½æ˜¯å°†å…„å¼ŸèŠ‚ç‚¹ä¹Ÿå˜æˆçº¢è‰²æ¥è¾¾åˆ°é¢œè‰²çš„å¹³è¡¡ã€‚å½“å°†å…„å¼ŸèŠ‚ç‚¹ä¹Ÿå˜çº¢ä¹‹åï¼Œè¾¾åˆ°äº†å±€éƒ¨çš„å¹³è¡¡äº†ï¼Œä½†æ˜¯å¯¹äºç¥–çˆ¶èŠ‚ç‚¹æ¥è¯´æ˜¯ä¸ç¬¦åˆå®šä¹‰4çš„ã€‚è¿™æ ·å°±éœ€è¦å›æº¯åˆ°çˆ¶èŠ‚ç‚¹ï¼Œæ¥ç€è¿›è¡Œä¿®å¤æ“ä½œã€‚ åˆ é™¤æ“ä½œç¤ºä¾‹3 ç¤ºä¾‹3çš„åˆ é™¤æ“ä½œæ˜¯ä¸€ä¸ªä¸­é—´æ­¥éª¤ï¼Œå®ƒçš„ç›®çš„æ˜¯å°†å·¦è¾¹çš„çº¢è‰²èŠ‚ç‚¹å€Ÿè°ƒè¿‡æ¥ï¼Œè¿™æ ·å°±å¯ä»¥è½¬æ¢æˆç¤ºä¾‹4çŠ¶æ€äº†ï¼Œåœ¨ç¤ºä¾‹4çŠ¶æ€ä¸‹å¯ä»¥å°†Dï¼ŒEèŠ‚ç‚¹éƒ½é˜¶æ®µè¿‡æ¥ï¼Œé€šè¿‡å°†ä¸¤ä¸ªèŠ‚ç‚¹å˜æˆé»‘è‰²æ¥ä¿è¯çº¢é»‘æ ‘çš„æ•´ä½“å¹³è¡¡ã€‚ ä¹‹æ‰€ä»¥è¯´case-3æ˜¯ä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼Œæ˜¯å› ä¸ºæ ¹æ®çº¢é»‘æ ‘çš„å®šä¹‰æ¥è¯´ï¼Œä¸‹å›¾å¹¶ä¸æ˜¯å¹³è¡¡çš„ï¼Œä»–æ˜¯é€šè¿‡ç¤ºä¾‹2æ“ä½œå®Œåå‘ä¸Šå›æº¯å‡ºç°çš„çŠ¶æ€ã€‚ä¹‹æ‰€ä»¥ä¼šå‡ºç°ç¤ºä¾‹3å’Œåé¢çš„ç¤ºä¾‹4çš„æƒ…å†µï¼Œæ˜¯å› ä¸ºå¯ä»¥é€šè¿‡å€Ÿç”¨ä¾„å­èŠ‚ç‚¹çš„çº¢è‰²ï¼Œå˜æˆé»‘è‰²æ¥ç¬¦åˆçº¢é»‘æ ‘å®šä¹‰4. åˆ é™¤æ“ä½œç¤ºä¾‹4 ç¤ºä¾‹4çš„æ“ä½œæ˜¯çœŸæ­£çš„èŠ‚ç‚¹å€Ÿè°ƒæ“ä½œï¼Œé€šè¿‡å°†å…„å¼ŸèŠ‚ç‚¹ä»¥åŠå…„å¼ŸèŠ‚ç‚¹çš„å³èŠ‚ç‚¹å€Ÿè°ƒè¿‡æ¥ï¼Œå¹¶å°†å…„å¼ŸèŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹å˜æˆçº¢è‰²æ¥è¾¾åˆ°å€Ÿè°ƒä¸¤ä¸ªé»‘èŠ‚ç‚¹çš„ç›®çš„ï¼Œè¿™æ ·çš„è¯ï¼Œæ•´æ£µæ ‘è¿˜æ˜¯ç¬¦åˆRBTreeçš„å®šä¹‰çš„ã€‚ ç¤ºä¾‹4è¿™ç§æƒ…å†µçš„å‘ç”Ÿåªæœ‰åœ¨å¾…åˆ é™¤çš„èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ä¸ºé»‘ï¼Œä¸”å­èŠ‚ç‚¹ä¸å…¨éƒ¨ä¸ºé»‘ï¼Œæ‰æœ‰å¯èƒ½å€Ÿè°ƒåˆ°ä¸¤ä¸ªèŠ‚ç‚¹æ¥åšé»‘èŠ‚ç‚¹ä½¿ç”¨ï¼Œä»è€Œä¿æŒæ•´æ£µæ ‘éƒ½ç¬¦åˆçº¢é»‘æ ‘çš„å®šä¹‰ã€‚ åˆ é™¤æ“ä½œçš„æ€»ç»“: çº¢é»‘æ ‘çš„åˆ é™¤æ“ä½œæ˜¯æœ€å¤æ‚çš„æ“ä½œï¼Œå¤æ‚çš„åœ°æ–¹å°±åœ¨äºå½“åˆ é™¤äº†é»‘è‰²èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå¦‚ä½•ä»å…„å¼ŸèŠ‚ç‚¹å»å€Ÿè°ƒèŠ‚ç‚¹ï¼Œä»¥ä¿è¯æ ‘çš„é¢œè‰²ç¬¦åˆå®šä¹‰ã€‚ç”±äºçº¢è‰²çš„å…„å¼ŸèŠ‚ç‚¹æ˜¯æ²¡æ³•å€Ÿè°ƒå‡ºé»‘èŠ‚ç‚¹çš„ï¼Œè¿™æ ·åªèƒ½é€šè¿‡é€‰æ‹©æ“ä½œè®©ä»–ä¸Šå‡åˆ°çˆ¶èŠ‚ç‚¹ï¼Œè€Œç”±äºå®ƒæ˜¯çº¢èŠ‚ç‚¹ï¼Œæ‰€ä»¥å®ƒçš„å­èŠ‚ç‚¹å°±æ˜¯é»‘çš„ï¼Œå¯ä»¥å€Ÿè°ƒã€‚ å¯¹äºå…„å¼ŸèŠ‚ç‚¹æ˜¯é»‘è‰²èŠ‚ç‚¹çš„å¯ä»¥åˆ†æˆ3ç§æƒ…å†µæ¥å¤„ç†ï¼Œå½“æ‰€ä»¥çš„å…„å¼ŸèŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½æ˜¯é»‘è‰²èŠ‚ç‚¹æ—¶ï¼Œå¯ä»¥ç›´æ¥å°†å…„å¼ŸèŠ‚ç‚¹å˜çº¢ï¼Œè¿™æ ·å±€éƒ¨çš„çº¢é»‘æ ‘é¢œè‰²æ˜¯ç¬¦åˆå®šä¹‰çš„ã€‚ä½†æ˜¯æ•´é¢—æ ‘ä¸ä¸€å®šæ˜¯ç¬¦åˆçº¢é»‘æ ‘å®šä¹‰çš„ï¼Œéœ€è¦å¾€ä¸Šè¿½æº¯ç»§ç»­è°ƒæ•´ã€‚ å¯¹äºå…„å¼ŸèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ºå·¦çº¢å³é»‘æˆ–è€… (å…¨éƒ¨ä¸ºçº¢ï¼Œå³çº¢å·¦é»‘)è¿™ä¸¤ç§æƒ…å†µï¼Œå¯ä»¥å…ˆå°†å‰é¢çš„æƒ…å†µé€šè¿‡é€‰æ‹©è½¬æ¢ä¸ºåä¸€ç§æƒ…å†µï¼Œåœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œå› ä¸ºå…„å¼ŸèŠ‚ç‚¹ä¸ºé»‘ï¼Œå…„å¼ŸèŠ‚ç‚¹çš„å³èŠ‚ç‚¹ä¸ºçº¢ï¼Œå¯ä»¥å€Ÿè°ƒå‡ºä¸¤ä¸ªèŠ‚ç‚¹å‡ºæ¥åšé»‘èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯åˆ é™¤äº†é»‘èŠ‚ç‚¹ï¼Œæ•´æ£µæ ‘è¿˜æ˜¯ç¬¦åˆçº¢é»‘æ ‘çš„å®šä¹‰çš„ï¼Œå› ä¸ºé»‘è‰²èŠ‚ç‚¹çš„ä¸ªæ•°æ²¡æœ‰æ”¹å˜ã€‚ çº¢é»‘æ ‘çš„åˆ é™¤æ“ä½œæ˜¯é‡åˆ°åˆ é™¤çš„èŠ‚ç‚¹ä¸ºçº¢è‰²ï¼Œæˆ–è€…è¿½æº¯è°ƒæ•´åˆ°äº†rootèŠ‚ç‚¹ï¼Œè¿™æ—¶åˆ é™¤çš„ä¿®å¤æ“ä½œå®Œæ¯•ã€‚ RBçº¢é»‘æ ‘çš„Javaå®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584public class RBTreeNode&lt;T extends Comparable&lt;T&gt;&gt; &#123; private T value;//node value private RBTreeNode&lt;T&gt; left;//left child pointer private RBTreeNode&lt;T&gt; right;//right child pointer private RBTreeNode&lt;T&gt; parent;//parent pointer private boolean red;//color is red or not red public RBTreeNode()&#123;&#125; public RBTreeNode(T value)&#123;this.value=value;&#125; public RBTreeNode(T value,boolean isRed)&#123;this.value=value;this.red = isRed;&#125; public T getValue() &#123; return value; &#125; void setValue(T value) &#123; this.value = value; &#125; RBTreeNode&lt;T&gt; getLeft() &#123; return left; &#125; void setLeft(RBTreeNode&lt;T&gt; left) &#123; this.left = left; &#125; RBTreeNode&lt;T&gt; getRight() &#123; return right; &#125; void setRight(RBTreeNode&lt;T&gt; right) &#123; this.right = right; &#125; RBTreeNode&lt;T&gt; getParent() &#123; return parent; &#125; void setParent(RBTreeNode&lt;T&gt; parent) &#123; this.parent = parent; &#125; boolean isRed() &#123; return red; &#125; boolean isBlack()&#123; return !red; &#125; /** * is leaf node **/ boolean isLeaf()&#123; return left==null &amp;&amp; right==null; &#125; void setRed(boolean red) &#123; this.red = red; &#125; void makeRed()&#123; red=true; &#125; void makeBlack()&#123; red=false; &#125; @Override public String toString()&#123; return value.toString(); &#125;&#125;public class RBTree&lt;T extends Comparable&lt;T&gt;&gt; &#123; private final RBTreeNode&lt;T&gt; root; //node number private java.util.concurrent.atomic.AtomicLong size = new java.util.concurrent.atomic.AtomicLong(0); //in overwrite mode,all node's value can not has same value //in non-overwrite mode,node can have same value, suggest don't use non-overwrite mode. private volatile boolean overrideMode=true; public RBTree()&#123; this.root = new RBTreeNode&lt;T&gt;(); &#125; public RBTree(boolean overrideMode)&#123; this(); this.overrideMode=overrideMode; &#125; public boolean isOverrideMode() &#123; return overrideMode; &#125; public void setOverrideMode(boolean overrideMode) &#123; this.overrideMode = overrideMode; &#125; /** * number of tree number * @return */ public long getSize() &#123; return size.get(); &#125; /** * get the root node * @return */ private RBTreeNode&lt;T&gt; getRoot()&#123; return root.getLeft(); &#125; /** * add value to a new node,if this value exist in this tree, * if value exist,it will return the exist value.otherwise return null * if override mode is true,if value exist in the tree, * it will override the old value in the tree * * @param value * @return */ public T addNode(T value)&#123; RBTreeNode&lt;T&gt; t = new RBTreeNode&lt;T&gt;(value); return addNode(t); &#125; /** * find the value by give value(include key,key used for search, * other field is not used,@see compare method).if this value not exist return null * @param value * @return */ public T find(T value)&#123; RBTreeNode&lt;T&gt; dataRoot = getRoot(); while(dataRoot!=null)&#123; int cmp = dataRoot.getValue().compareTo(value); if(cmp&lt;0)&#123; dataRoot = dataRoot.getRight(); &#125;else if(cmp&gt;0)&#123; dataRoot = dataRoot.getLeft(); &#125;else&#123; return dataRoot.getValue(); &#125; &#125; return null; &#125; /** * remove the node by give value,if this value not exists in tree return null * @param value include search key * @return the value contain in the removed node */ public T remove(T value)&#123; RBTreeNode&lt;T&gt; dataRoot = getRoot(); RBTreeNode&lt;T&gt; parent = root; while(dataRoot!=null)&#123; int cmp = dataRoot.getValue().compareTo(value); if(cmp&lt;0)&#123; parent = dataRoot; dataRoot = dataRoot.getRight(); &#125;else if(cmp&gt;0)&#123; parent = dataRoot; dataRoot = dataRoot.getLeft(); &#125;else&#123; if(dataRoot.getRight()!=null)&#123; RBTreeNode&lt;T&gt; min = removeMin(dataRoot.getRight()); //x used for fix color balance RBTreeNode&lt;T&gt; x = min.getRight()==null ? min.getParent() : min.getRight(); boolean isParent = min.getRight()==null; min.setLeft(dataRoot.getLeft()); setParent(dataRoot.getLeft(),min); if(parent.getLeft()==dataRoot)&#123; parent.setLeft(min); &#125;else&#123; parent.setRight(min); &#125; setParent(min,parent); boolean curMinIsBlack = min.isBlack(); //inherit dataRoot's color min.setRed(dataRoot.isRed()); if(min!=dataRoot.getRight())&#123; min.setRight(dataRoot.getRight()); setParent(dataRoot.getRight(),min); &#125; //remove a black node,need fix color if(curMinIsBlack)&#123; if(min!=dataRoot.getRight())&#123; fixRemove(x,isParent); &#125;else if(min.getRight()!=null)&#123; fixRemove(min.getRight(),false); &#125;else&#123; fixRemove(min,true); &#125; &#125; &#125;else&#123; setParent(dataRoot.getLeft(),parent); if(parent.getLeft()==dataRoot)&#123; parent.setLeft(dataRoot.getLeft()); &#125;else&#123; parent.setRight(dataRoot.getLeft()); &#125; //current node is black and tree is not empty if(dataRoot.isBlack() &amp;&amp; !(root.getLeft()==null))&#123; RBTreeNode&lt;T&gt; x = dataRoot.getLeft()==null ? parent :dataRoot.getLeft(); boolean isParent = dataRoot.getLeft()==null; fixRemove(x,isParent); &#125; &#125; setParent(dataRoot,null); dataRoot.setLeft(null); dataRoot.setRight(null); if(getRoot()!=null)&#123; getRoot().setRed(false); getRoot().setParent(null); &#125; size.decrementAndGet(); return dataRoot.getValue(); &#125; &#125; return null; &#125; /** * fix remove action * @param node * @param isParent */ private void fixRemove(RBTreeNode&lt;T&gt; node,boolean isParent)&#123; RBTreeNode&lt;T&gt; cur = isParent ? null : node; boolean isRed = isParent ? false : node.isRed(); RBTreeNode&lt;T&gt; parent = isParent ? node : node.getParent(); while(!isRed &amp;&amp; !isRoot(cur))&#123; RBTreeNode&lt;T&gt; sibling = getSibling(cur,parent); //sibling is not null,due to before remove tree color is balance //if cur is a left node boolean isLeft = parent.getRight()==sibling; if(sibling.isRed() &amp;&amp; !isLeft)&#123;//ç¤ºä¾‹1 //cur in right parent.makeRed(); sibling.makeBlack(); rotateRight(parent); &#125;else if(sibling.isRed() &amp;&amp; isLeft)&#123; //cur in left parent.makeRed(); sibling.makeBlack(); rotateLeft(parent); &#125;else if(isBlack(sibling.getLeft()) &amp;&amp; isBlack(sibling.getRight()))&#123;//ç¤ºä¾‹2 sibling.makeRed(); cur = parent; isRed = cur.isRed(); parent=parent.getParent(); &#125;else if(isLeft &amp;&amp; !isBlack(sibling.getLeft()) &amp;&amp; isBlack(sibling.getRight()))&#123;//ç¤ºä¾‹3 sibling.makeRed(); sibling.getLeft().makeBlack(); rotateRight(sibling); &#125;else if(!isLeft &amp;&amp; !isBlack(sibling.getRight()) &amp;&amp; isBlack(sibling.getLeft()) )&#123; sibling.makeRed(); sibling.getRight().makeBlack(); rotateLeft(sibling); &#125;else if(isLeft &amp;&amp; !isBlack(sibling.getRight()))&#123;//ç¤ºä¾‹4 sibling.setRed(parent.isRed()); parent.makeBlack(); sibling.getRight().makeBlack(); rotateLeft(parent); cur=getRoot(); &#125;else if(!isLeft &amp;&amp; !isBlack(sibling.getLeft()))&#123; sibling.setRed(parent.isRed()); parent.makeBlack(); sibling.getLeft().makeBlack(); rotateRight(parent); cur=getRoot(); &#125; &#125; if(isRed)&#123; cur.makeBlack(); &#125; if(getRoot()!=null)&#123; getRoot().setRed(false); getRoot().setParent(null); &#125; &#125; //get sibling node private RBTreeNode&lt;T&gt; getSibling(RBTreeNode&lt;T&gt; node,RBTreeNode&lt;T&gt; parent)&#123; parent = node==null ? parent : node.getParent(); if(node==null)&#123; return parent.getLeft()==null ? parent.getRight() : parent.getLeft(); &#125; if(node==parent.getLeft())&#123; return parent.getRight(); &#125;else&#123; return parent.getLeft(); &#125; &#125; private boolean isBlack(RBTreeNode&lt;T&gt; node)&#123; return node==null || node.isBlack(); &#125; private boolean isRoot(RBTreeNode&lt;T&gt; node)&#123; return root.getLeft() == node &amp;&amp; node.getParent()==null; &#125; /** * find the successor node * @param node current node's right node * @return */ private RBTreeNode&lt;T&gt; removeMin(RBTreeNode&lt;T&gt; node)&#123; //find the min node RBTreeNode&lt;T&gt; parent = node; while(node!=null &amp;&amp; node.getLeft()!=null)&#123; parent = node; node = node.getLeft(); &#125; //remove min node if(parent==node)&#123; return node; &#125; parent.setLeft(node.getRight()); setParent(node.getRight(),parent); //don't remove right pointer,it is used for fixed color balance //node.setRight(null); return node; &#125; private T addNode(RBTreeNode&lt;T&gt; node)&#123; node.setLeft(null); node.setRight(null); node.setRed(true); setParent(node,null); if(root.getLeft()==null)&#123; root.setLeft(node); //root node is black node.setRed(false); size.incrementAndGet(); &#125;else&#123; RBTreeNode&lt;T&gt; x = findParentNode(node); int cmp = x.getValue().compareTo(node.getValue()); if(this.overrideMode &amp;&amp; cmp==0)&#123; T v = x.getValue(); x.setValue(node.getValue()); return v; &#125;else if(cmp==0)&#123; //value exists,ignore this node return x.getValue(); &#125; setParent(node,x); if(cmp&gt;0)&#123; x.setLeft(node); &#125;else&#123; x.setRight(node); &#125; fixInsert(node); size.incrementAndGet(); &#125; return null; &#125; /** * find the parent node to hold node x,if parent value equals x.value return parent. * @param x * @return */ private RBTreeNode&lt;T&gt; findParentNode(RBTreeNode&lt;T&gt; x)&#123; RBTreeNode&lt;T&gt; dataRoot = getRoot(); RBTreeNode&lt;T&gt; child = dataRoot; while(child!=null)&#123; int cmp = child.getValue().compareTo(x.getValue()); if(cmp==0)&#123; return child; &#125; if(cmp&gt;0)&#123; dataRoot = child; child = child.getLeft(); &#125;else if(cmp&lt;0)&#123; dataRoot = child; child = child.getRight(); &#125; &#125; return dataRoot; &#125; /** * red black tree insert fix. * @param x */ private void fixInsert(RBTreeNode&lt;T&gt; x)&#123; RBTreeNode&lt;T&gt; parent = x.getParent(); while(parent!=null &amp;&amp; parent.isRed())&#123; RBTreeNode&lt;T&gt; uncle = getUncle(x); if(uncle==null)&#123;//need to rotate RBTreeNode&lt;T&gt; ancestor = parent.getParent(); //ancestor is not null due to before before add,tree color is balance if(parent == ancestor.getLeft())&#123; boolean isRight = x == parent.getRight(); if(isRight)&#123; rotateLeft(parent); &#125; rotateRight(ancestor); if(isRight)&#123; x.setRed(false); parent=null;//end loop &#125;else&#123; parent.setRed(false); &#125; ancestor.setRed(true); &#125;else&#123; boolean isLeft = x == parent.getLeft(); if(isLeft)&#123; rotateRight(parent); &#125; rotateLeft(ancestor); if(isLeft)&#123; x.setRed(false); parent=null;//end loop &#125;else&#123; parent.setRed(false); &#125; ancestor.setRed(true); &#125; &#125;else&#123;//uncle is red parent.setRed(false); uncle.setRed(false); parent.getParent().setRed(true); x=parent.getParent(); parent = x.getParent(); &#125; &#125; getRoot().makeBlack(); getRoot().setParent(null); &#125; /** * get uncle node * @param node * @return */ private RBTreeNode&lt;T&gt; getUncle(RBTreeNode&lt;T&gt; node)&#123; RBTreeNode&lt;T&gt; parent = node.getParent(); RBTreeNode&lt;T&gt; ancestor = parent.getParent(); if(ancestor==null)&#123; return null; &#125; if(parent == ancestor.getLeft())&#123; return ancestor.getRight(); &#125;else&#123; return ancestor.getLeft(); &#125; &#125; private void rotateLeft(RBTreeNode&lt;T&gt; node)&#123; RBTreeNode&lt;T&gt; right = node.getRight(); if(right==null)&#123; throw new java.lang.IllegalStateException(\"right node is null\"); &#125; RBTreeNode&lt;T&gt; parent = node.getParent(); node.setRight(right.getLeft()); setParent(right.getLeft(),node); right.setLeft(node); setParent(node,right); if(parent==null)&#123;//node pointer to root //right raise to root node root.setLeft(right); setParent(right,null); &#125;else&#123; if(parent.getLeft()==node)&#123; parent.setLeft(right); &#125;else&#123; parent.setRight(right); &#125; //right.setParent(parent); setParent(right,parent); &#125; &#125; private void rotateRight(RBTreeNode&lt;T&gt; node)&#123; RBTreeNode&lt;T&gt; left = node.getLeft(); if(left==null)&#123; throw new java.lang.IllegalStateException(\"left node is null\"); &#125; RBTreeNode&lt;T&gt; parent = node.getParent(); node.setLeft(left.getRight()); setParent(left.getRight(),node); left.setRight(node); setParent(node,left); if(parent==null)&#123; root.setLeft(left); setParent(left,null); &#125;else&#123; if(parent.getLeft()==node)&#123; parent.setLeft(left); &#125;else&#123; parent.setRight(left); &#125; setParent(left,parent); &#125; &#125; private void setParent(RBTreeNode&lt;T&gt; node,RBTreeNode&lt;T&gt; parent)&#123; if(node!=null)&#123; node.setParent(parent); if(parent==root)&#123; node.setParent(null); &#125; &#125; &#125; /** * debug method,it used print the given node and its children nodes, * every layer output in one line * @param root */ public void printTree(RBTreeNode&lt;T&gt; root)&#123; java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt; queue =new java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt;(); java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt; queue2 =new java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt;(); if(root==null)&#123; return ; &#125; queue.add(root); boolean firstQueue = true; while(!queue.isEmpty() || !queue2.isEmpty())&#123; java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt; q = firstQueue ? queue : queue2; RBTreeNode&lt;T&gt; n = q.poll(); if(n!=null)&#123; String pos = n.getParent()==null ? \"\" : ( n == n.getParent().getLeft() ? \" LE\" : \" RI\"); String pstr = n.getParent()==null ? \"\" : n.getParent().toString(); String cstr = n.isRed()?\"R\":\"B\"; cstr = n.getParent()==null ? cstr : cstr+\" \"; System.out.print(n+\"(\"+(cstr)+pstr+(pos)+\")\"+\"\\t\"); if(n.getLeft()!=null)&#123; (firstQueue ? queue2 : queue).add(n.getLeft()); &#125; if(n.getRight()!=null)&#123; (firstQueue ? queue2 : queue).add(n.getRight()); &#125; &#125;else&#123; System.out.println(); firstQueue = !firstQueue; &#125; &#125; &#125; public static void main(String[] args) &#123; RBTree&lt;String&gt; bst = new RBTree&lt;String&gt;(); bst.addNode(\"d\"); bst.addNode(\"d\"); bst.addNode(\"c\"); bst.addNode(\"c\"); bst.addNode(\"b\"); bst.addNode(\"f\"); bst.addNode(\"a\"); bst.addNode(\"e\"); bst.addNode(\"g\"); bst.addNode(\"h\"); bst.remove(\"c\"); bst.printTree(bst.getRoot()); &#125;&#125; ä»£ç è°ƒè¯•çš„æ—¶å€™ï¼ŒprintTreeè¾“å‡ºæ ¼å¼å¦‚ä¸‹: 12345d(B)b(B d LE) g(R d RI)a(R b LE) e(B g LE) h(B g RI)f(R e RI) æ‹¬å·å·¦è¾¹è¡¨ç¤ºå…ƒç´ çš„å†…å®¹ã€‚æ‹¬å·å†…çš„ç¬¬ä¸€ä¸ªå…ƒç´ è¡¨ç¤ºé¢œè‰²ï¼ŒBè¡¨ç¤ºblackï¼ŒRè¡¨ç¤ºredï¼›ç¬¬äºŒä¸ªå…ƒç´ è¡¨ç¤ºçˆ¶å…ƒç´ çš„å€¼ï¼›ç¬¬ä¸‰ä¸ªå…ƒç´ è¡¨ç¤ºå·¦å³ï¼ŒLEè¡¨ç¤ºåœ¨çˆ¶å…ƒç´ çš„å·¦è¾¹ã€‚RIè¡¨ç¤ºåœ¨çˆ¶å…ƒç´ çš„å³è¾¹ã€‚ ç¬¬ä¸€ä¸ªå…ƒç´ dæ˜¯rootèŠ‚ç‚¹ï¼Œç”±äºå®ƒæ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ‹¬å·å†…åªæœ‰ä¸€ä¸ªå…ƒç´ ã€‚ æ€»ç»“ä½œä¸ºå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘é‡Œé¢ä¼—å¤šçš„å®ç°ä¹‹ä¸€ï¼Œçº¢é»‘æ ‘æ— ç–‘æ˜¯æœ€ç®€æ´ã€å®ç°æœ€ä¸ºç®€å•çš„ã€‚çº¢é»‘æ ‘é€šè¿‡å¼•å…¥é¢œè‰²çš„æ¦‚å¿µï¼Œé€šè¿‡é¢œè‰²è¿™ä¸ªçº¦æŸæ¡ä»¶çš„ä½¿ç”¨æ¥ä¿æŒæ ‘çš„é«˜åº¦å¹³è¡¡ã€‚ä½œä¸ºå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ—‹è½¬æ˜¯ä¸€ä¸ªå¿…ä¸å¯å°‘çš„æ“ä½œã€‚é€šè¿‡æ—‹è½¬å¯ä»¥é™ä½æ ‘çš„é«˜åº¦ï¼Œåœ¨çº¢é»‘æ ‘é‡Œé¢è¿˜å¯ä»¥è½¬æ¢é¢œè‰²ã€‚ çº¢é»‘æ ‘é‡Œé¢çš„æ’å…¥å’Œåˆ é™¤çš„æ“ä½œæ¯”è¾ƒéš¾ç†è§£ï¼Œè¿™æ—¶è¦æ³¨æ„è®°ä½ä¸€ç‚¹ï¼šæ“ä½œä¹‹å‰çº¢é»‘æ ‘æ˜¯å¹³è¡¡çš„ï¼Œé¢œè‰²æ˜¯ç¬¦åˆå®šä¹‰çš„ã€‚åœ¨æ“ä½œçš„æ—¶å€™å°±éœ€è¦å‘å…„å¼ŸèŠ‚ç‚¹ã€çˆ¶èŠ‚ç‚¹ã€ä¾„å­èŠ‚ç‚¹å€Ÿè°ƒå’Œäº’æ¢é¢œè‰²ï¼Œè¦è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œå°±éœ€è¦ä¸æ–­çš„è¿›è¡Œæ—‹è½¬ã€‚æ‰€ä»¥çº¢é»‘æ ‘çš„æ’å…¥åˆ é™¤æ“ä½œéœ€è¦ä¸åœçš„æ—‹è½¬ï¼Œä¸€æ—¦å€Ÿè°ƒäº†åˆ«çš„èŠ‚ç‚¹ï¼Œåˆ é™¤å’Œæ’å…¥çš„èŠ‚ç‚¹å°±ä¼šè¾¾åˆ°å±€éƒ¨çš„å¹³è¡¡ï¼ˆå±€éƒ¨ç¬¦åˆçº¢é»‘æ ‘çš„å®šä¹‰ï¼‰ï¼Œä½†æ˜¯è¢«å€Ÿè°ƒçš„èŠ‚ç‚¹å°±ä¸ä¼šå¹³è¡¡äº†ï¼Œè¿™æ—¶å°±éœ€è¦ä»¥è¢«å€Ÿè°ƒçš„èŠ‚ç‚¹ä¸ºèµ·ç‚¹ç»§ç»­è¿›è¡Œè°ƒæ•´ï¼Œç›´åˆ°æ•´æ£µæ ‘éƒ½æ˜¯å¹³è¡¡çš„ã€‚åœ¨æ•´ä¸ªä¿®å¤çš„è¿‡ç¨‹ä¸­ï¼Œæ’å…¥å…·ä½“çš„åˆ†ä¸º3ç§æƒ…å†µï¼Œåˆ é™¤åˆ†ä¸º4ç§æƒ…å†µã€‚ æ•´ä¸ªçº¢é»‘æ ‘çš„æŸ¥æ‰¾ï¼Œæ’å…¥å’Œåˆ é™¤éƒ½æ˜¯O(logN)çš„ï¼ŒåŸå› å°±æ˜¯æ•´ä¸ªçº¢é»‘æ ‘çš„é«˜åº¦æ˜¯logNï¼ŒæŸ¥æ‰¾ä»æ ¹åˆ°å¶ï¼Œèµ°è¿‡çš„è·¯å¾„æ˜¯æ ‘çš„é«˜åº¦ï¼Œåˆ é™¤å’Œæ’å…¥æ“ä½œæ˜¯ä»å¶åˆ°æ ¹çš„ï¼Œæ‰€ä»¥ç»è¿‡çš„è·¯å¾„éƒ½æ˜¯logNã€‚ å‚è€ƒæ–‡çŒ® Cormen T H, Leiserson C E, Rivest R L, ç­‰. ç®—æ³•å¯¼è®ºï¼ˆç¬¬3ç‰ˆï¼‰. æ®·å»ºå¹³, ç­‰. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2012. Sedgewick R, Wayne K. ç®—æ³•ï¼ˆç¬¬4ç‰ˆï¼‰. è°¢è·¯äº‘ è¯‘. äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾, 2012. Weiss M A. æ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†æï¼ˆç¬¬2ç‰ˆï¼‰. å†¯èˆœçº è¯‘. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2004. Knuth D E. è®¡ç®—æœºç¨‹åºè®¾è®¡è‰ºæœ¯ å·3ï¼šæ’åºä¸æŸ¥æ‰¾ï¼ˆè‹±æ–‡ç‰ˆ ç¬¬2ç‰ˆï¼‰. äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾, 2010. äºŒå‰æŸ¥æ‰¾æ ‘ç™¾åº¦ç™¾ç§‘ RBçº¢é»‘æ ‘ç™¾åº¦ç™¾ç§‘","categories":[{"name":"algorithm","slug":"algorithm","permalink":"http://ltyeamin.github.io/categories/algorithm/"}],"tags":[{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"http://ltyeamin.github.io/tags/äºŒå‰æ ‘/"}]},{"title":"è°ˆè°ˆå›½å†…å¤§ç¯å¢ƒä¸‹çš„996åŠ ç­æ–‡åŒ–","slug":"è°ˆè°ˆå›½å†…å¤§ç¯å¢ƒä¸‹çš„996åŠ ç­æ–‡åŒ–","date":"2019-03-28T04:57:10.000Z","updated":"2019-11-20T15:09:01.274Z","comments":true,"path":"2019/03/28/è°ˆè°ˆå›½å†…å¤§ç¯å¢ƒä¸‹çš„996åŠ ç­æ–‡åŒ–/","link":"","permalink":"http://ltyeamin.github.io/2019/03/28/è°ˆè°ˆå›½å†…å¤§ç¯å¢ƒä¸‹çš„996åŠ ç­æ–‡åŒ–/","excerpt":"","text":"LZæ¯å¤©éƒ½è¦æ‰“å¼€å¼€æºä¸­å›½ç½‘ç«™çœ‹çœ‹äº’è”ç½‘ç™¾æ€ï¼Œåœ¨ä»Šå¤©çš„ç½‘ç«™é‡Œï¼Œçœ‹åˆ°äº†ä¸¤ä»¶æœ‰æ„æ€çš„è¶£äº‹: æŠµåˆ¶996åŠ ç­æ–‡åŒ–996.icuï¼Œå¤§å®¶åœ¨996I.ICU GitHubç•…è°ˆè‡ªç”±ã€åæ§½åŠ ç­ æŸç¨‹åºå‘˜åˆ åº“è·‘è·¯åˆ¶ä½œçš„ç½‘ç«™-å®‰å¾½æ±½è½¦ç½‘æ˜¯ç”±ç®€å•çš„å›¾ç‰‡æ˜¾ç¤ºæ‹¼æ¥è€Œæˆçš„ã€‚ 996åŠ ç­æ–‡åŒ–æ— è®ºæ˜¯ä¼ ç»Ÿè¡Œä¸šï¼Œè¿˜æ˜¯äº’è”ç½‘è¡Œä¸šï¼Œç°åœ¨å…¬å¸åŠ ç­æƒ…å†µå¯ä»¥è¯´å¾—æ˜¯å¸ç©ºè§æƒ¯äº†ã€‚å°¤å…¶æ˜¯åœ¨äº’è”ç½‘è¡Œä¸šèƒ½æ›´åŠ ä½“ç°å‡ºæ¥ï¼Œæ¯”å¦‚åä¸ºã€äº¬ä¸œæœ€ä¸ºå¸¸è§ã€‚åŠ ç­æ–‡åŒ–å·²ç»æˆä¸ºäº†æ™®éç°è±¡ï¼ŒåŠ³åŠ¨æ³•è§„å®šåœ¨å¿…è¦çš„æƒ…å†µä¸‹ï¼Œå…¬å¸å¯ä»¥é€‚å½“å®‰æ’ä¸€ä¸‹åŠ ç­ï¼Œå‘˜å·¥éœ€é…åˆï¼Œå…¬å¸æ‰¿è¯ºå¹¶ç»™æ›´å¥½çš„ç¦åˆ©å¾…é‡ã€‚ åœ¨å¤§å…¬å¸é‡Œï¼Œå·¥ä½œå¼ºåº¦å¤§å¾ˆæ­£å¸¸ï¼Œå‘˜å·¥æ—©å·²ä¹ ä»¥ä¸ºå¸¸ï¼Œä¸ä»…ä»…æ„¿æ„æ¥å—åŠ ç­ï¼Œè€Œä¸”åŠ ç­åŠ çš„ä¸€èº«çƒ­è¡€ã€‚æˆ‘æƒ³æ¥å—çš„åŸå› æ˜¯å„ç§ç¦åˆ©å¾…é‡çš„è¯±æƒ‘ã€‚ä½†æ˜¯ä¸­å°å‹å…¬å¸é‡Œä¸è§å¾—æ˜¯è¿™æ ·å­çš„ï¼Œå¦‚æœæ™®é€šå…¬å¸éƒ½å’Œåä¸ºã€äº¬ä¸œè¿™æ ·å¤§å‹å…¬å¸å¾…é‡ä¸€æ ·çš„è¯ï¼Œå¤§å®¶è‚¯å®šå¯¹åŠ ç­çš„ç§¯ææ€§å¾ˆå¼ºã€‚ æˆ‘æ›¾ç»å…¥èŒçš„ä¸€å®¶å…¬å¸ä¹Ÿå­˜åœ¨çš„996åŠ ç­æ–‡åŒ–ï¼Œå½“æ—¶å…¬å¸ä¸šåŠ¡æ­£å¤„äºé«˜é€Ÿå‘å±•æœŸï¼Œæ•´ä¸ªæŠ€æœ¯éƒ¨é—¨ç»å¸¸åŠ ç­ï¼Œå½“æ—¶ç¦åˆ©å¾…é‡æ˜¯æŒ‰æ—¶æ”¯ä»˜åŠ ç­è´¹æ¥å…‘ç°çš„ï¼Œå·¥ä½œæ—¥æ™šä¸Š7ç‚¹ç®—åŠ ç­ï¼ŒåŠ ç­è´¹æŒ‰åŠ ç­å°æ—¶ä¹˜ä»¥1å€å†ä¹˜ä»¥å¹³å‡æ—¥è–ªå»ç®—ï¼Œå‘¨æœ«ä»¥åŠæ³•å®šèŠ‚æ—¥åŠ ç­è´¹æŒ‰åŠ ç­å°æ—¶ä¹˜ä»¥1.5å€å†ä¹˜ä»¥å¹³å‡æ—¥è–ªï¼Œå‡¡æ˜¯åŠ ç­è¶…è¿‡3ä¸ªå°æ—¶çš„ï¼Œæœ‰é¤è¡¥ï¼Œè¶…è¿‡4ä¸ªå°æ—¶çš„ï¼Œæœ‰é¤è¡¥è½¦è¡¥ã€‚ æˆ‘ä¸Šå­¦æœŸé—´æ›¾ç»çœ‹è¿‡é©¬å…‹æ€ä¸»ä¹‰å“²å­¦ï¼Œé©¬å…‹æ€ä¸»ä¹‰è®¤ä¸ºä»»ä½•äº‹ç‰©éƒ½æ˜¯ä½œä¸ºçŸ›ç›¾ç»Ÿä¸€ä½“è€Œå­˜åœ¨çš„ï¼ŒçŸ›ç›¾æ˜¯äº‹ç‰©å‘å±•çš„æºæ³‰å’ŒåŠ¨åŠ›ã€‚ç®€è¨€ä¹‹ï¼ŒçŸ›ç›¾å°±æ˜¯å¯¹ç«‹ç»Ÿä¸€ï¼Œä»»ä½•äº‹æƒ…éƒ½æœ‰ä¸¤é¢æ€§ã€‚æ¥ä¸‹æ¥æˆ‘ç«™åœ¨ä¸åŒçš„å®¢è§‚è§’åº¦æ¥åˆ†æä¸€ä¸‹ä¸Šè¿°åŠ ç­æ–‡åŒ–: ç«™åœ¨å‘˜å·¥çš„è§’åº¦ æˆ‘ä»¬ä¸å¯å¦è®¤åŠ ç­ç¡®å®èƒ½æé«˜å·¥ä½œæ•ˆç‡ï¼Œå…¬å¸éœ€è¦æˆ‘ä»¬åŠ ç­ï¼Œæˆ‘ä»¬ç»ä¸æ¨è¾ï¼Œå› ä¸ºæœ‰äº†ç¦åˆ©å¾…é‡çš„ä¿è¯ã€‚ åªè¦æœ‰ç¦åˆ©å¾…é‡ï¼Œå¤§å®¶éƒ½å¾ˆæ„¿æ„åŠ ç­ï¼Œå¦‚æœæ²¡æœ‰ç¦åˆ©ï¼Œå¤§å®¶å‡ ä¹æ˜¯æ²¡æœ‰æ„å‘ä¸»åŠ¨åŠ ç­ï¼Œé™¤éæœ‰éå¸¸ç´§æ€¥çš„ä»»åŠ¡æ‰å‹‰å¼ºæ¥å—åŠ ç­ã€‚å¦‚æœæ²¡æœ‰ç¦åˆ©å¾…é‡ï¼Œä½œä¸ºå‘˜å·¥å®æ„¿æé«˜å·¥ä½œæ•ˆç‡ï¼Œä¹Ÿä¸æ„¿æ„åœ¨å…¬å¸è¿›è¡Œæ— å¿åŠ ç­ã€‚ä½†æ˜¯ï¼Œè¯æœ‰è¯´å›æ¥ï¼Œå¦‚æœæœ‰ç¦åˆ©å¾…é‡ï¼Œä¸è§å¾—èƒ½å¤Ÿæé«˜å·¥ä½œæ•ˆç‡ã€‚ ç«™åœ¨å…¬å¸çš„è§’åº¦ ä»å…¬å¸çš„è§’åº¦ä¸Šæ¥è®²ï¼ŒåŠ ç­å¯ä»¥è®©äººåŠ›èµ„æºåˆç†åˆ†é…ï¼Œä½¿å¾—å…¬å¸å¤§æ­¥å‘å‰è¿ˆã€‚ä½†æ˜¯å®¢è§‚æ¥è®²ï¼Œä¸€èˆ¬å…¬å¸å¤§è‚†å®£æ‰¬åŠ ç­æ–‡åŒ–ï¼Œæœ‰å¯èƒ½å…¬å¸å‡ºç°å¥åº·çŠ¶å†µï¼Œè¿™ä¸ªæ˜¯ç”±åŠ ç­æ•ˆç‡é«˜ä½æ¥å†³å®šçš„ï¼ŒåŠ ç­ä¸ä¸€å®šæé«˜æ•ˆç‡ã€‚è¿™å°±å’Œä¸­å›½50å¹´ä»£å¤§è·ƒè¿›èµ¶è‹±è¶…ç¾æ€æƒ³ä¸€æ ·ï¼Œå†’è¿›æ€æƒ³ï¼Œå¹¶æ²¡æœ‰ç«‹è¶³ç°å®ã€‚ è¿™ä¸ªè®©æˆ‘æƒ³æˆ‘çš„ä¸€ä¸ªåŒäº‹ï¼Œä»–å¹³æ—¶å‡ ä¹ä¹Ÿä¸æ€ä¹ˆåŠ ç­ï¼Œåªæœ‰ç´§æ€¥ä»»åŠ¡çš„æ—¶å€™æ‰ä¼šé€‰æ‹©åŠ ç­ã€‚æœ‰ä¸€æ¬¡ä»–çš„Leaderé—®ï¼šå¤§å®¶éƒ½åœ¨åŠ ç­ï¼Œä¸ºä»€ä¹ˆä½ ä¸åŠ ç­ï¼Ÿå®ƒçš„å›ç­”Leaderå¤§åƒä¸€æƒŠï¼Œä»–è¯´ä»–å½“å¤©çš„ä»»åŠ¡å·²ç»å®Œæˆï¼Œåªè¦æŒ‰ç…§é¢„æœŸæ—¶é—´å®Œæˆå°±å¥½ã€‚å¦‚æœå…¬å¸æŠ€æœ¯æ°›å›´å’ŒBATå¤§å‹äº’è”ç½‘å…¬å¸ä¸€ä¸ªçº§åˆ«çš„ï¼Œæˆ‘æ›´æ„¿æ„æ— å¿åŠ åˆ°11ç‚¹ã€‚å¦‚æœæ²¡æœ‰æŠ€æœ¯æ°›å›´ï¼ŒåŠ ç­å¯¹è‡ªèº«æ¥è®²æ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯æ”¶è·å’Œèƒ½åŠ›æå‡ã€‚å¹³æ—¶åªéœ€è¦ä¿è¯æ­£å¸¸çš„ä»»åŠ¡æŒ‰ç‚¹å®Œæˆå³å¯ã€‚ä»–çš„Leaderå¬åˆ°åä¹Ÿæ— è¯­äº†ï¼Œç¬é—´è®¤ä¸ºä»–ä¸åˆç¾¤ã€‚ æˆ‘è§‰å¾—ä»»ä½•è€æ¿å’ŒLeaderéƒ½æ²¡æœ‰å¼ºåˆ¶è¦æ±‚åŠ ç­çš„æƒåˆ©ã€‚æˆ‘é‚£ä¸ªåŒäº‹ä½çš„åœ°æ–¹å’Œå…¬å¸å¾ˆè¿œï¼Œæ—¥å¸¸ä¸Šä¸‹ç­ååœ°é“è¦1ä¸ªå°æ—¶å››ååˆ†é’Ÿï¼Œå³ä¾¿æ™šä¸Š6ç‚¹æ•´ä¸‹ç­ï¼Œå›å»éƒ½å¿«8ç‚¹äº†ã€‚æˆ‘é—®ä»–ä¸ºä»€ä¹ˆä¸ç»™Leaderååº”è¿™ä¸ªé—®é¢˜ï¼Œè®©Leaderä½“è°…ä¸€ä¸‹ã€‚ä»–è¯´ä¸ç”¨ï¼Œä»–å‘ç°å¹¶ä¸æ˜¯ä»–ä¸åˆç¾¤ï¼Œè€Œæ˜¯ä¸ä¹ æƒ¯é‚£ç§å…¬å¸æ°›å›´ï¼Œè€æ¿è¦äº§å‡ºè¦åŠ ç­ï¼ŒåŠ ç­æ²¡å¾…é‡ï¼Œé¢†å¯¼ä¹Ÿæ˜¯å¬è€æ¿çš„å©å’ï¼Œå°±è¦æ±‚åŠ ç­ï¼Œäºæ˜¯æ•ˆæœå¾ˆæ˜æ˜¾ï¼Œå¤§å®¶éƒ½æ˜¯ç™½å¤©å¹²å…¶ä»–äº‹æƒ…ï¼Œæ™šä¸Šå¹²æ´»ï¼Œå¦‚æœæ˜¯æˆ‘çš„è¯ï¼Œæˆ‘ä¹Ÿå—ä¸äº†ï¼Œæ¯•ç«Ÿæˆ‘ä»¬æ­£å¹´è½»ã€‚åæ¥æˆ‘åŒäº‹ç¦»èŒäº†ï¼Œæ¢äº†ä¸€å®¶åªæœ‰20äººçš„å¤©ä½¿è½®åˆ›ä¸šå‹å…¬å¸ï¼Œä»–ç»™æˆ‘è¯´è™½ç„¶å¾ˆç´¯ï¼Œä½†æ˜¯æ¯å¤©å¾ˆå……å®ï¼Œå¯¹æœªæ¥æœ‰äº†æ›´å¥½çš„å¸Œæœ›ã€‚ å¬åˆ°æˆ‘è¿™ä¸ªåŒäº‹çš„æƒ…å†µï¼Œæˆ‘çš„æ€»ç»“æ˜¯ï¼šä½œä¸ºå‘˜å·¥ï¼Œå°½é‡æé«˜ç™½å¤©çš„å·¥ä½œæ•ˆç‡ï¼ŒæŠŠè‡ªå·±çš„å·¥ä½œåšå¥½ï¼Œè‡ªå·±åšçš„ä¸œè¥¿å°½é‡ä¸è¦å‡ºå¤§é—®é¢˜ã€‚å¦‚æœçœŸçš„æœ‰éœ€è¦åŠ ç­çš„ï¼Œå¬ä»Leaderçš„å®‰æ’ï¼Œå¦‚æœæœ‰ç¦åˆ©å¾…é‡çš„ä¿è¯ï¼Œå¤šä¸ºå…¬å¸äº§å‡ºï¼Œå¦‚æœæ²¡æœ‰å¾…é‡ï¼Œé€‚å½“å³å¯ï¼Œæ¯•ç«Ÿè‡ªå·±çš„ç¦åˆ©å¾…é‡ä¹Ÿæ˜¯æœ‰å¿…è¦çš„ã€‚ å¤§å…¬å¸æˆ‘å°±ä¸è¯´äº†ï¼Œä¸­å°å‹å…¬å¸æˆ‘å»ºè®®æŠµåˆ¶996ã€985ä¸è‰¯çš„åŠ ç­æ–‡åŒ–ï¼Œè€Œæå€¡724çš„åŠ ç­æ–‡åŒ–ï¼Œè¿™é‡Œçš„724å¹¶ä¸æ˜¯å…¬å¸è®©å‘˜å·¥æ¯å‘¨å·¥ä½œ7å¤©ï¼Œæ¯æ—¥å·¥ä½œ24å°æ—¶ã€‚è€Œæ˜¯æ— è®ºä»€ä¹ˆæ—¥å­ï¼Œå¦‚æœæœ‰ç´§æ€¥ä»»åŠ¡ï¼Œ7å¤©ä¸­ï¼Œäº”å¤©åœ¨å…¬å¸æ­£å¸¸ä¸Šç­ï¼Œæœ‰å¿…è¦åŠ ç­å¯ä»¥åœ¨å®¶å®Œæˆå·¥ä½œï¼Œç¦åˆ©å¾…é‡ä¿è¯ï¼Œè¿™æ ·åšä¸€ä¸ªåè°ƒï¼Œé¿å…å¯èƒ½1ä¸ªå°æ—¶è§£å†³çš„é—®é¢˜ï¼Œéè¦èµ¶å¾€å…¬å¸é€ æˆå¤šä¸ªå°æ—¶åŠ ç­ï¼Œè§£å†³äº†æ•ˆç‡ä½çš„é—®é¢˜ï¼Œåœ¨å®¶åŠ ç­ç›¸ä¿¡å¤§éƒ¨åˆ†ç¨‹åºå‘˜ä¼šä¸è®¡è¾ƒé‚£ä¸€ä¸ªå°æ—¶çš„æ—¶é—´ï¼Œå¦‚æœåŠ ç­æ—¶é—´è¾ƒé•¿ï¼Œå…¬å¸ç»™äºˆç›¸åº”çš„ç¦åˆ©å¾…é‡ï¼Œå³èŠ‚çœäº†å‘˜å·¥è¿”å…¬å¸çš„æ—¶é—´ï¼Œä¹Ÿè§£å†³äº†å®é™…æ€§é—®é¢˜ã€‚åœ¨è¿™é‡Œï¼Œæœ‰äº›äººå¯èƒ½è´¨ç–‘ï¼Œå› ä¸ºåœ¨å®¶å…·ä½“æ˜¯å¦åšäº‹ï¼Œå…¬å¸å¹¶ä¸çŸ¥æƒ…ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µï¼Œæ˜¯æ°¸è¿œæ— æ³•é¿å…çš„ï¼Œå› ä¸ºè¿™æ˜¯ç¨‹åºå‘˜çš„èŒä¸šæ“ä½œï¼Œæ˜¯ä¸€ä¸ªäººçš„åŸºæœ¬ç´ å…»é—®é¢˜ã€‚å¦‚æœäººéƒ½æ˜¯è¿™æ ·è‡ªç§è‡ªåˆ©ã€ç¼ºä¹è´£ä»»å¿ƒï¼Œä¹Ÿå°±æ²¡æœ‰å›¢é˜Ÿï¼Œæ›´æ²¡æœ‰æœ‹å‹ï¼Œæˆ‘ç›¸ä¿¡è¿™ç§äººçš„äººç”Ÿä¸ä¼šèµ°çš„æ›´è¿œã€‚ ç¨‹åºå‘˜çš„æŠ±æ€¨å¤§å®¶ç»å¸¸å¬åˆ°ä¸€å¥è¯å°±æ˜¯ï¼šå¹²çš„ä¸çˆ½ï¼Œåˆ åº“è·‘è·¯ã€‚æ¯å¤©å…¨å›½çš„äº’è”ç½‘å…¬å¸éƒ½å¯èƒ½å‘ç”Ÿè¿™æ ·çš„äº‹æƒ…ï¼ŒæŸç¨‹åºå‘˜å› å’Œå…¬å¸äº§ç”Ÿåˆ©ç›Šçº çº·é”æœåŠ¡å™¨ã€åˆ åº“ã€åˆ ä»£ç ã€æ•…æ„æŒ–å‘ã€‚ å‡ºç°è¿™æ ·çš„æƒ…å†µå·²ç»å¸ç©ºè§æƒ¯äº†ã€‚æˆ‘ä½œä¸ºäº’è”ç½‘è¡Œä¸šçš„ä¸€ä»½å­ï¼Œç«™åœ¨æˆ‘çš„è§’åº¦åˆ†æï¼Œæ¯ä¸ªç¨‹åºå‘˜éƒ½åº”è¯¥æœ‰è‰¯å¥½çš„èŒä¸šæ“å®ˆï¼Œå¦‚æœçœŸå‡ºç°åˆ©ç›Šçº çº·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åˆæ³•çš„æ–¹å¼å»è§£å†³ï¼Œç”¨æ³•å¾‹æ–¹å¼å»ç»´æƒï¼Œå’Œå¹³è§£å†³ï¼Œå°½å¯èƒ½ä¸è¦èµ·ä»»ä½•å†²çªã€‚è¯´åˆ°è¿™é‡Œæœ‰äº›æ—¶å€™é æ³•å¾‹ç¡®å®æ²¡åŠæ³•å æ®æœ‰åˆ©åœ°ä½ï¼Œæ¯•ç«Ÿå•äººä¸å¯èƒ½ç©è¿‡å…¬å¸çš„ã€‚æˆ‘ä»¬åªèƒ½ä»å…¥èŒçš„é‚£ä¸€å¤©å¼€å§‹ï¼Œä»€ä¹ˆçš„ç¦åˆ©å¾…é‡éƒ½å†™åœ¨åˆåŒé‡Œï¼Œè¿™æ‰ç®—æ•°ã€‚å¦‚æœå› ä¸ºå…¶ä»–åŸå› çš„è¯ï¼Œå¤§å¯ä¸å¿…ä¸ºä¹‹æ¼æ€’ï¼Œå› ä¸ºç‰©ä»¥ç±»èšã€äººä»¥ç¾¤åˆ†ï¼Œä¸»åŠ¨ç¦»èŒä¾¿æ˜¯ã€‚ åˆ›ä¸šå…¬å¸å¥½å¤šè€æ¿éƒ½åœ¨ç»™å‘˜å·¥ç”»é¥¼ï¼Œè¿™ç§æ´—è„‘å¼çš„ç”»é¥¼å‘˜å·¥ä»¬è¿˜æ˜¯æ–Ÿé…Œæ–Ÿé…Œã€‚å¯¹è€æ¿è¯´çš„è¯ï¼Œå»å…¶ç³Ÿç²•ï¼Œå–å…¶ç²¾åã€‚åªå¬å¯¹è‡ªå·±æœ‰ç›Šçš„è¯ï¼Œä¹‹æ‰€ä»¥è€æ¿èƒ½å¼€ä¸€ä¸ªå…¬å¸ï¼Œè‚¯å®šæ˜¯åœ¨æŸæ–¹é¢æœ‰ä¸€å®šçš„è¿‡äººä¹‹å¤„ã€‚ å†™åœ¨æœ€åçš„ç½‘ç»œæ®µå­ 2019å¹´3æœˆ27æ—¥ï¼Œ996.icué¡¹ç›®ä¸Šçº¿ï¼Œç¬¬äºŒå¤©ï¼Œé¡¹ç›®è¾¾åˆ°3wä¸ªstarï¼Œå°±åœ¨å½“æ—¥ï¼Œå®‰å¾½æ±½è½¦ç½‘çš„å…„å¼Ÿç¬¬ä¸€ä¸ªæ­ç«¿èµ·ä¹‰ï¼Œåˆ åº“è·‘è·¯ï¼Œå²ç§°3.28äº‹ä»¶ï¼ŒåŒå¹´äº”æœˆå·¥ç¨‹å¸ˆä»¬æˆç«‹ååŠ ç­å·¥ä¼šã€‚ 2020å¹´ä¸¤ä¼šæœŸé—´ï¼Œè¿«äºç¤¾ä¼šå’ŒååŠ ç­å·¥ä¼šå‹åŠ›ï¼Œå›½å®¶å°†ç¦æ­¢åŠ ç­å†™å…¥å®ªæ³•ã€‚","categories":[{"name":"others","slug":"others","permalink":"http://ltyeamin.github.io/categories/others/"}],"tags":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"http://ltyeamin.github.io/tags/æ‚è°ˆ/"}]},{"title":"è§†é¢‘ä¸‹è½½ç¥å™¨ä¹‹you-get","slug":"è§†é¢‘ä¸‹è½½ç¥å™¨ä¹‹you-get","date":"2019-03-27T05:00:50.000Z","updated":"2019-11-20T15:08:51.075Z","comments":true,"path":"2019/03/27/è§†é¢‘ä¸‹è½½ç¥å™¨ä¹‹you-get/","link":"","permalink":"http://ltyeamin.github.io/2019/03/27/è§†é¢‘ä¸‹è½½ç¥å™¨ä¹‹you-get/","excerpt":"","text":"æˆ‘ä»¬æ—¥å¸¸ä¸Šç½‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å°†ç½‘é¡µä¸­çš„è§†é¢‘èµ„æºæå–ä¸‹è½½å‡ºæ¥ï¼Œä¸€èˆ¬å¦‚æœç½‘ç«™æ²¡æœ‰å±è”½è§†é¢‘åœ°å€ä¸”ç”¨çš„æ˜¯éFlashæ’­æ”¾å™¨(ç°æµè¡ŒHTML5æ’­æ”¾å™¨),æˆ‘ä»¬å¯ä»¥åœ¨è§†é¢‘æ’­æ”¾å™¨å³é”®ç›´æ¥ä¸‹è½½è§†é¢‘èµ„æºï¼Œä½†æ˜¯å›½å†…ç½‘ç«™è¿è¥å•†ä¸ºäº†ä¿æŠ¤ç‰ˆæƒï¼Œä¼šå°†çœŸæ­£çš„èµ„æºåœ°å€å±è”½èµ·æ¥ï¼Œæˆ‘ä»¬æ— æ³•æ‰¾åˆ°çœŸå®åœ°å€å¹¶è¿›è¡Œä¸‹è½½ã€‚å› æ­¤å‡ºç°äº†å¥½å¤šç¬¬ä¸‰æ–¹çš„åº”ç”¨æ¥å¸®åŠ©æˆ‘ä»¬æå–ç½‘é¡µä¸­çš„è§†é¢‘ï¼Œå¸¸è§çš„æå–è½¯ä»¶æœ‰Chromeæ’ä»¶Video download helperå’ŒVideo Downloader GetThemAllã€å›½å†…ä»¥å‰å¾ˆè‘—åçš„ç¡•é¼ å’Œç»´æ£ è§†é¢‘ä¸‹è½½(è¿™ä¸¤ä¸ªLZä¹‹å‰ç»å¸¸ç”¨ï¼Œç¡•é¼ ç»å¸¸ç”¨äºä¸‹è½½51CTOçš„æ•™å­¦è§†é¢‘ï¼Œç»´æ£ ç»å¸¸ç”¨äºç”µè§†å‰§æ‰¹é‡ä¸‹è½½)ã€‚ ä»Šå¤©æˆ‘ç»™å¤§å®¶å¸¦æ¥ä¸€æ¬¾è§†é¢‘ä¸‹è½½ç¥å™¨you-getï¼Œyou-get ä¹ƒä¸€å°å°å“’å‘½ä»¤è¡Œç¨‹åºï¼Œæä¾›ä¾¿åˆ©çš„æ–¹å¼æ¥ä¸‹è½½ç½‘ç»œä¸Šçš„åª’ä½“ä¿¡æ¯ã€‚å¥½äº†ï¼Œè¯ä¸å¤šè¯´ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬å¼€å§‹ä½“éªŒä¸€ä¸‹å§ã€‚ ä¸ºä»€ä¹ˆä½ è¦å¥½å¥½çš„ç”¨ ä½ æ¬¢å–œäºäº’è”ç½‘ä¸Šçš„å¯Œåª’ä½“å†…å®¹ï¼Œå¹¶ä¸ºä¸ªäººå¯»æ¬¢è€Œå‚¨å­˜ ä½ å–œæ‚¦è§‚çœ‹çš„è§†é¢‘ï¼Œç„¶è€Œä¸å¾—ä¿å­˜ï¼›å¯¹ä¸ªäººè®¾å¤‡æ— ä»æ§åˆ¶ï¼Œæ­¤ä¹ƒè¿èƒŒå¼€æ”¾äº’è”ç½‘ä¹‹è¡Œä¸º ä½ å¯»æ±‚è§£è„±äºé—­æºè½¯ä»¶æˆ–JavaScriptä»£ç ï¼Œå¹¶ç¦æ­¢Flashè¿è¡Œ ä½ ä¸ºé»‘å®¢ç²¾ç¥ä¸è‡ªç”±è½¯ä»¶è€Œæ¬£å–œ åŠŸèƒ½ç‰¹æ€§ ä¸‹è½½æµè¡Œç½‘ç«™ä¹‹éŸ³è§†é¢‘ï¼Œä¾‹å¦‚YouTube, Youku, Niconico,ä»¥åŠæ›´å¤š. (æŸ¥çœ‹å®Œæ•´æ”¯æŒåˆ—è¡¨) äºæ‚¨å¿ƒä»ªçš„åª’ä½“æ’­æ”¾å™¨ä¸­è§‚çœ‹åœ¨çº¿è§†é¢‘ï¼Œè„±ç¦»æµè§ˆå™¨ä¸å¹¿å‘Š ä¸‹è½½æ‚¨å–œæ¬¢çš„ç½‘é¡µä¸Šçš„å›¾ç‰‡ ä¸‹è½½ä»»ä½•éHTMLå†…å®¹ï¼Œä¾‹å¦‚äºŒè¿›åˆ¶æ–‡ä»¶ å®‰è£…æ–¹å¼Macå®‰è£… åœ¨Macä¸Šå®‰è£…Homebrewï¼ŒHomebrewæ˜¯ä¸€æ¬¾Mac OSå¹³å°ä¸‹çš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ï¼Œæ‹¥æœ‰å®‰è£…ã€å¸è½½ã€æ›´æ–°ã€æŸ¥çœ‹ã€æœç´¢ç­‰å¾ˆå¤šå®ç”¨çš„åŠŸèƒ½ï¼ŒåŠŸèƒ½ç±»ä¼¼äºLinuxå¹³å°ä¸Šçš„apt-getæˆ–yumæ“ä½œã€‚è¿›å…¥Macç»ˆç«¯è¾“å…¥ä¸€ä¸‹å‘½ä»¤å³å¯å®‰è£…Homebrew; 1/usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\" å®‰è£…å®ŒæˆHomebrewåï¼Œæˆ‘ä»¬æ¥å®‰è£…you-getå·¥å…·ï¼Œè¾“å…¥ä¸€ä¸‹å‘½ä»¤å³å¯å®‰è£…å®Œæˆ; 1Yeamin:Hexo mac$ brew install you-get å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬æ£€æŸ¥ç‰ˆæœ¬æ¥ç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸã€‚ 12Yeamin:Hexo mac$ you-get -Vyou-get: version 0.4.1205, a tiny downloader that scrapes the web. Linuxå®‰è£… å®‰è£…Python3ï¼› ä½¿ç”¨pipæ¥å®‰è£… 1$ pip3 install you-get Windowså®‰è£… ä¸‹è½½Windowsé¢„è£…åŒ…å³å¯ï¼› å®‰è£…å¹¶æ‰§è¡Œå¯è¿è¡Œç¨‹åºã€‚ Gitå®‰è£…å³ä½¿æ‚¨ä¸å¸¸ä½¿ç”¨Pythonï¼Œä½œä¸ºå¼€å‘è€…ï¼Œä¹Ÿè¯·ä½¿ç”¨æ­¤æ–¹æ³•ã€‚ ä¸‹è½½å®‰è£…èµ„æºï¼Œå¦‚ä¸‹å‘½ä»¤; 1$ git clone git://github.com/soimort/you-get.git å°†ç›®å½•åŠ å…¥ PATH, æˆ–è¿è¡Œ make install ä»¥å®‰è£…you-getäºæ°¸ä¹…è·¯å¾„ã€‚ ä½¿ç”¨ä½“éªŒä»¥æœ€è¿‘çƒ­æ’­çš„ç”µè§†å‰§ã€Šéƒ½æŒºå¥½ã€‹ä¸ºä¾‹ï¼Œæ“ä½œå¦‚ä¸‹ï¼š æŸ¥è¯¢è§†é¢‘ä¿¡æ¯å¯ä»¥ä½¿ç”¨ --info/-i ä»¥æŸ¥çœ‹æ‰€æœ‰å¯ç”¨ç”»è´¨ä¸æ ¼å¼ 1you-get -i 'https://v.youku.com/v_show/id_XNDA3OTMzMTE4MA==.html?spm=a2h1n.8261147.reload_1.1~3~A&amp;s=4e4e42efbfbdefbfbd62' æ‰§è¡Œä¸Šè¿°å‘½ä»¤åï¼Œè§‚å¯Ÿæ‰§è¡Œç»“æœæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿå‡ºç”µè§†å‰§ã€Šéƒ½æŒºå¥½ã€‹ç¬¬1é›†çš„ç‰‡æºæ¥è‡ªä¼˜é…·ï¼Œç”»è´¨æœ‰è¶…æ¸…ã€é«˜æ¸…ã€æ¸£æ¸…ã€æ ‡æ¸…ï¼Œè§†é¢‘æ ¼å¼éƒ½ä¸ºmp4ï¼Œè§†é¢‘æ–‡ä»¶å¤§å°ä»¥åŠç›¸å…³åœ°å€é“¾æ¥ã€‚ ä¸‹è½½è§†é¢‘1you-get 'https://v.youku.com/v_show/id_XNDA3OTMzMTE4MA==.html?spm=a2h1n.8261147.reload_1.1~3~A&amp;s=4e4e42efbfbdefbfbd62' è¾“å…¥ä¸Šè¿°å‘½ä»¤åï¼Œå³å¯å¼€å§‹ä¸‹è½½ï¼Œé»˜è®¤ç”»è´¨ä¸ºè¶…æ¸…ç”»è´¨ï¼Œè§†é¢‘ä¼šåˆ†æ®µä¸‹è½½ï¼Œä¸‹è½½å®Œæˆä¹‹åï¼Œyou-getè‡ªåŠ¨è°ƒç”¨ffmpegå°†å¤šæ®µè§†é¢‘è¿›è¡Œåˆå¹¶æ“ä½œã€‚ åŠ è½½Cookiesåœ¨è¿™ä¸ªä¸‹è½½çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ä¸‹è½½ä¸‹æ¥çš„è§†é¢‘å¤§å°ä¸æ˜¾ç¤ºçš„å¤§å°ä¸ç¬¦åˆï¼Œæˆ‘ä»¬ä¸‹ä¸‹æ¥åªæœ‰80Må·¦å³ï¼Œè§†é¢‘æ—¶é—´ä¸º10åˆ†é’Ÿå·¦å³ã€‚ ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼ŸLZæŸ¥å¥½å¥½é˜…è¯»äº†ä¸€ä¸‹WIKIï¼ŒåŸå› æ˜¯ç½‘ç«™è§†é¢‘åªå…¬å¼€ä¸€éƒ¨åˆ†è§†é¢‘ç‰‡æ®µï¼Œå¹¶éæ‰€æœ‰è§†é¢‘å¯ä¾›ä»»ä½•äººè§‚çœ‹ã€‚å¦‚æœéœ€è¦ç™»å½•ä»¥è§‚çœ‹ (ä¾‹å¦‚, ç§å¯†è§†é¢‘), å¯èƒ½å¿…é¡»å°†æµè§ˆå™¨cookieé€šè¿‡--cookies/-c åŠ è½½å…¥ you-getã€‚éœ€è¦æˆ‘ä»¬ç™»å½•çš„Cookiesä¿¡æ¯ï¼Œæˆ‘ä»¬ç™»å½•åå°†æ‰“å¼€F12æŸ¥çœ‹Cookieä¿¡æ¯ï¼Œä¸€æŸ¥çœ‹ï¼Œä¸€å¤§å †Cookieï¼Œæ€ä¹ˆæ•´ï¼Œäºæ˜¯LZåˆæ‰¾åˆ°ä¸€ä¸ªChromeæµè§ˆå™¨çš„æ’ä»¶ï¼Œè‡ªåŠ¨ç”ŸæˆCookiesï¼Œå¦‚å›¾ï¼Œå¯ä»¥å°†çº¢è‰²åŒºåŸŸæ‹·è´åˆ°Cookies.txtä¸­ï¼Œç„¶åç»§ç»­æ‰§è¡Œä¸‹è½½æ“ä½œã€‚ æ³¨æ„: ç›®å‰æˆ‘ä»¬æ”¯æŒä¸¤ç§cookieæ ¼å¼ï¼šMozilla cookies.sqlite å’Œ Netscape cookies.txt. 1you-get -c Cookies.txt https://v.youku.com/v_show/id_XNDA3OTMzMTE4MA==.html æœ¬åœ°æ’­æ”¾å™¨æ’­æ”¾å¦‚æœä½ åªæ˜¯åœ¨ç”¨è‡ªå·±æœ¬åœ°æ’­æ”¾å™¨è¿›è¡Œè§‚çœ‹çš„è¯ä½¿ç”¨è€Œä¸æ˜¯ä¸‹è½½çš„è¯ï¼Œåˆ™å¯ä»¥ --player/-p å°†è§†é¢‘å–‚è¿›æ’­æ”¾å™¨, ä¾‹å¦‚ mplayeræˆ–è€… vlcã€‚ 1$ you-get -p vlc 'https://www.youtube.com/watch?v=jNQXAC9IVRw' æˆ–è€…ä½ æƒ³åœ¨æµè§ˆå™¨ä¸­è§‚çœ‹è€Œä¸å¸Œæœ›çœ‹å¹¿å‘Šæˆ–è¯„è®ºåŒº: 1$ you-get -p chromium 'https://www.youtube.com/watch?v=jNQXAC9IVRw' æ”¯æŒä¸»æµç½‘ç«™åˆ—è¡¨ ç½‘ç«™ URL è§†é¢‘? å›¾åƒ? éŸ³é¢‘? YouTube https://www.youtube.com/ âœ“ Twitter https://twitter.com/ âœ“ âœ“ VK http://vk.com/ âœ“ Vine https://vine.co/ âœ“ Vimeo https://vimeo.com/ âœ“ Vidto http://vidto.me/ âœ“ Veoh http://www.veoh.com/ âœ“ Tumblr https://www.tumblr.com/ âœ“ âœ“ âœ“ TED http://www.ted.com/ âœ“ SoundCloud https://soundcloud.com/ âœ“ Pinterest https://www.pinterest.com/ âœ“ MusicPlayOn http://en.musicplayon.com/ âœ“ MTV81 http://www.mtv81.com/ âœ“ Mixcloud https://www.mixcloud.com/ âœ“ Metacafe http://www.metacafe.com/ âœ“ Magisto http://www.magisto.com/ âœ“ Khan Academy https://www.khanacademy.org/ âœ“ JPopsuki TV http://www.jpopsuki.tv/ âœ“ Internet Archive https://archive.org/ âœ“ Instagram https://instagram.com/ âœ“ âœ“ Heavy Music Archive http://www.heavy-music.ru/ âœ“ Google+ https://plus.google.com/ âœ“ âœ“ Freesound http://www.freesound.org/ âœ“ Flickr https://www.flickr.com/ âœ“ âœ“ Facebook https://www.facebook.com/ âœ“ eHow http://www.ehow.com/ âœ“ Dailymotion http://www.dailymotion.com/ âœ“ CBS http://www.cbs.com/ âœ“ Bandcamp http://bandcamp.com/ âœ“ AliveThai http://alive.in.th/ âœ“ interest.me http://ch.interest.me/tvn âœ“ 755ãƒŠãƒŠã‚´ãƒ¼ã‚´ãƒ¼ http://7gogo.jp/ âœ“ âœ“ niconicoãƒ‹ã‚³ãƒ‹ã‚³å‹•ç”» http://www.nicovideo.jp/ âœ“ 163ç½‘æ˜“è§†é¢‘ç½‘æ˜“äº‘éŸ³ä¹ http://v.163.com/ http://music.163.com/ âœ“ âœ“ 56ç½‘ http://www.56.com/ âœ“ AcFun http://www.acfun.tv/ âœ“ Baiduç™¾åº¦è´´å§ http://tieba.baidu.com/ âœ“ âœ“ çˆ†ç±³èŠ±ç½‘ http://www.baomihua.com/ âœ“ bilibiliå“”å“©å“”å“© http://www.bilibili.com/ âœ“ Dilidili http://www.dilidili.com/ âœ“ è±†ç“£ http://www.douban.com/ âœ“ æ–—é±¼ http://www.douyutv.com/ âœ“ å‡¤å‡°è§†é¢‘ http://v.ifeng.com/ âœ“ é£è¡Œç½‘ http://www.fun.tv/ âœ“ iQIYI çˆ±å¥‡è‰º http://www.iqiyi.com/ âœ“ æ¿€åŠ¨ç½‘ http://www.joy.cn/ âœ“ é…·6ç½‘ http://www.ku6.com/ âœ“ é…·ç‹—éŸ³ä¹ http://www.kugou.com/ âœ“ é…·æˆ‘éŸ³ä¹ http://www.kuwo.cn/ âœ“ ä¹è§†ç½‘ http://www.letv.com/ âœ“ è”æFM http://www.lizhi.fm/ âœ“ ç§’æ‹ http://www.miaopai.com/ âœ“ MioMioå¼¹å¹•ç½‘ http://www.miomio.tv/ âœ“ ç—å®¢é‚¦ https://www.pixnet.net/ âœ“ PPTVèšåŠ› http://www.pptv.com/ âœ“ é½é²ç½‘ http://v.iqilu.com/ âœ“ QQ è…¾è®¯è§†é¢‘ http://v.qq.com/ âœ“ é˜¡é™Œè§†é¢‘ http://qianmo.com/ âœ“ Sina æ–°æµªè§†é¢‘ å¾®åšç§’æ‹è§†é¢‘ http://video.sina.com.cn/ http://video.weibo.com/ âœ“ Sohu æœç‹è§†é¢‘ http://tv.sohu.com/ âœ“ å¤©å¤©åŠ¨å¬ http://www.dongting.com/ âœ“ TudouåœŸè±† http://www.tudou.com/ âœ“ è™¾ç±³ http://www.xiami.com/ âœ“ é˜³å…‰å«è§† http://www.isuntv.com/ âœ“ éŸ³æ‚¦Tai http://www.yinyuetai.com/ âœ“ Youkuä¼˜é…· http://www.youku.com/ âœ“ æˆ˜æ——TV http://www.zhanqi.tv/lives âœ“ å¤®è§†ç½‘ http://www.cntv.cn/ âœ“ å…¶ä»–ç±»ä¼¼å·¥å…· youtube-dlï¼šyoutube-dlåŠŸèƒ½å’Œyou-getç±»ä¼¼ã€‚ Video Download Managerï¼šå¯è§†åŒ–å·¥å…·ï¼Œç›¸å½“äºyoutube-dl+you-getã€‚ ykdlï¼šä¸“æ³¨äºä¼˜é…·è§†é¢‘ã€‚ annieï¼šä¸“æ³¨äºåœ¨çº¿è§†é¢‘ä¸‹è½½çš„è½»é‡çº§å‘½ä»¤è¡Œå·¥å…· ç»´æ£ :ç»´æ£ æœ€ä¸“ä¸šflvè§†é¢‘ä¸‹è½½è½¯ä»¶ ç¡•é¼ ï¼šç¡•é¼ æœ€ç¨³å®šçš„FLVè§†é¢‘ä¸‹è½½å¹³å° æ— æ°´å°é¢„è§ˆ å‚è€ƒèµ„æ–™you-getä¸­æ–‡æ–‡æ¡£ you-getæºç ","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"å®ç”¨å·¥å…·åŠæŠ€å·§","slug":"å®ç”¨å·¥å…·åŠæŠ€å·§","permalink":"http://ltyeamin.github.io/tags/å®ç”¨å·¥å…·åŠæŠ€å·§/"}]},{"title":"GCè°ƒä¼˜åŸºç¡€ä¹‹å †å¤§å°","slug":"GCè°ƒä¼˜åŸºç¡€ä¹‹å †å¤§å°","date":"2019-01-05T11:11:09.000Z","updated":"2019-05-29T14:03:53.000Z","comments":true,"path":"2019/01/05/GCè°ƒä¼˜åŸºç¡€ä¹‹å †å¤§å°/","link":"","permalink":"http://ltyeamin.github.io/2019/01/05/GCè°ƒä¼˜åŸºç¡€ä¹‹å †å¤§å°/","excerpt":"","text":"è°ƒæ•´å †å¤§å°GCè°ƒæ•´çš„ç¬¬ä¸€å ‚è¯¾æ˜¯è°ƒæ•´åº”ç”¨ç¨‹åºå †çš„å¤§å°ã€‚å…³äºå †å¤§å°çš„è°ƒæ•´è¿˜æœ‰æ›´é«˜çº§çš„è¯é¢˜ï¼Œä¸è¿‡ä½œä¸ºç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬é¦–å…ˆè®¨è®ºå¦‚ä½•è®¾ç½®æ€»ä½“å †çš„å¤§å°ã€‚ ä¸å…¶ä»–çš„æ€§èƒ½é—®é¢˜ä¸€æ ·ï¼Œé€‰æ‹©å †çš„å¤§å°å…¶å®æ˜¯ä¸€ç§å¹³è¡¡ã€‚å¦‚æœåˆ†é…çš„å †è¿‡äºå°ï¼Œç¨‹åºçš„å¤§éƒ¨åˆ†æ—¶é—´å¯èƒ½éƒ½æ¶ˆè€—åœ¨GCä¸Šï¼Œæ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´å»è¿è¡Œåº”ç”¨ç¨‹åºçš„é€»è¾‘ã€‚ä½†æ˜¯ï¼Œç®€å•ç²—æš´åœ°è®¾ç½®ä¸€ä¸ªç‰¹åˆ«å¤§çš„å †ä¹Ÿä¸æ˜¯è§£å†³é—®é¢˜çš„æ–¹æ³•ã€‚ GCåœé¡¿æ¶ˆè€—çš„æ—¶é—´å–å†³äºå †çš„å¤§å°ï¼Œå¦‚æœå¢å¤§å †çš„ç©ºé—´ï¼Œåœé¡¿çš„æŒç»­æ—¶é—´ä¹Ÿä¼šå˜é•¿ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåœé¡¿çš„é¢‘ç‡ä¼šå˜å¾—æ›´å°‘ï¼Œä½†æ˜¯å®ƒä»¬æŒç»­çš„ä¸–ç•Œä¼šè®©ç¨‹åºçš„æ•´ä½“æ€§èƒ½å˜æ…¢ã€‚ ä½¿ç”¨è¶…å¤§å †è¿˜æœ‰å¦ä¸€ä¸ªé£é™©ã€‚æ“ä½œç³»ç»Ÿä½¿ç”¨è™šæ‹Ÿå†…å­˜æœºåˆ¶ç®¡ç†æœºå™¨çš„ç‰©ç†å†…å­˜ã€‚ä¸€å°æœºå™¨å¯èƒ½æœ‰8Gçš„ç‰©ç†å†…å­˜ï¼Œä¸è¿‡æ“ä½œç³»ç»Ÿå¯èƒ½è®©ä½ æ„Ÿè§‰æœ‰æ›´å¤šçš„å¯ç”¨å†…å­˜ã€‚è™šæ‹Ÿå†…å­˜çš„æ•°é‡å–å†³äºæ“ä½œç³»ç»Ÿçš„è®¾ç½®ï¼Œè­¬å¦‚æ“ä½œç³»ç»Ÿå¯èƒ½è®©ä½ æ„Ÿè§‰åˆ°å®ƒçš„å†…å­˜è¾¾åˆ°äº†16Gã€‚æ“ä½œç³»ç»Ÿåä¸ºâ€äº¤æ¢â€(swappingï¼Œç§°ä¹‹ä¸ºåˆ†é¡µï¼Œè™½ç„¶è¿™ä¸¤è€…åœ¨æŠ€æœ¯ä¸Šå­˜åœ¨ç€å·®å¼‚ï¼Œä½†æ˜¯è¿™äº›å·®å¼‚ï¼Œåœ¨è¿™é‡Œä¸å½±å“æˆ‘ä»¬çš„è®¨è®º)ã€‚ä½ å¯ä»¥è½½å…¥éœ€è¦16GGå†…å­˜çš„åº”ç”¨ç¨‹åºï¼Œæ“ä½œç³»ç»Ÿåœ¨éœ€è¦æ—¶ä¼šå°†ç¨‹åºè¿è¡Œæ—¶ä¸æ´»è·ƒçš„æ•°æ®ç”±å†…å­˜å¤åˆ¶åˆ°ç£ç›˜ã€‚å†æ¬¡éœ€è¿™éƒ¨åˆ†å†…å­˜çš„å†…å®¹æ—¶ï¼Œæ“ä½œç³»ç»Ÿå†å°†å®ƒä»¬ç”±ç£ç›˜é‡æ–°è½½å…¥åˆ°å†…å­˜(ä¸ºäº†è…¾å‡ºç©ºé—´ï¼Œé€šå¸¸å®ƒä¼šå…ˆå°†å¦ä¸€éƒ¨åˆ†å†…å­˜çš„å†…å®¹å¤åˆ¶åˆ°ç£ç›˜)ã€‚ ç³»ç»Ÿä¸­è¿è¡Œç€å¤§é‡ä¸åŒçš„åº”ç”¨ç¨‹åºæ—¶ï¼Œè¿™ä¸ªæµç¨‹å·¥ä½œå¾—å¾ˆä¸é¡ºç•…ï¼Œå› ä¸ºå¤§å¤šæ•°çš„åº”ç”¨ç¨‹åºä¸ä¼šåŒæ—¶å¤„äºæ´»è·ƒçŠ¶æ€ã€‚ä½†æ˜¯ï¼Œå¯¹äºJavaåº”ç”¨ï¼Œå®ƒå·¥ä½œå¾—å¹¶ä¸æ˜¯å¾ˆå¥½ã€‚å¦‚æœä¸€ä¸ªJavaåº”ç”¨ä½¿ç”¨äº†è¿™ä¸ªç³»ç»Ÿä¸Šå¤§çº¦12Gçš„å †ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½åœ¨RAMä¸Šåˆ†é…8Gçš„å †ç©ºé—´ï¼Œå¦å¤–4Gçš„ç©ºé—´å­˜åœ¨äºç£ç›˜(è¿™ä¸ªå‡è®¾å¯¹å®é™…æƒ…å†µè¿›è¡Œäº†ä¸€äº›ç®€åŒ–ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºä¹Ÿä¼šä½¿ç”¨éƒ¨åˆ†çš„RAM)ã€‚JVMä¸ä¼šäº†è§£è¿™äº›ï¼šæ“ä½œç³»ç»Ÿå®Œå…¨å±è”½äº†å†…å­˜äº¤äº’çš„ç»†èŠ‚ã€‚è¿™æ ·ï¼ŒJVMæ„‰å¿«çš„åœ°å¡«æ»¡äº†åˆ†é…ç»™å®ƒçš„12Gå †ç©ºé—´ã€‚ä½†è¿™æ ·å°±å¯¼è‡´äº†ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿéœ€è¦å°†ç›¸å½“ä¸€éƒ¨åˆ†çš„æ•°æ®ç”±ç£ç›˜äº¤æ¢åˆ°å†…å­˜(è¿™æ˜¯ä¸€ä¸ªæ˜‚è´µæ“ä½œçš„å¼€å§‹)ã€‚ æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™ç§åŸæœ¬æœŸæœ›ä¸€æ¬¡æ€§çš„å†…å­˜äº¤æ¢æ“ä½œåœ¨Full GCæ—¶ä¸€å®šä¼šå†æ¬¡é‡æ¼”ï¼Œå› ä¸ºJVMå¿…é¡»è®¿é—®æ•´ä¸ªå †çš„å†…å®¹ã€‚å¦‚æœFull GCæ—¶ç³»ç»Ÿå‘ç”Ÿå†…å­˜äº¤æ¢ï¼Œåœé¡¿æ—¶é—´ä¼šä»¥æ­£å¸¸åœé¡¿æ—¶é—´æ•°ä¸ªé‡çº§çš„æ–¹å¼å¢é•¿ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœä½¿ç”¨Concurrentæ”¶é›†å™¨ï¼Œåå°çº¿ç¨‹åœ¨å›æ”¶å †æ—¶ï¼Œå®ƒçš„é€Ÿåº¦ä¹Ÿå¯èƒ½ä¼šè¢«æ‹–æ…¢ï¼Œå› ä¸ºéœ€è¦ç­‰å¾…ä»è£åˆ¤å¤åˆ¶æ•°æ®åˆ°å†…å­˜ï¼Œç»“æœå¯¼è‡´å‘ç”Ÿä»£ä»·æ˜‚è´µçš„å¹¶å‘æ¨¡å¼å¤±æ•ˆã€‚ å› æ­¤ï¼Œè°ƒæ•´å †å¤§å°æ—¶é¦–è¦çš„åŸåˆ™å°±æ˜¯æ°¸è¿œä¸è¦å°†å †çš„å®¹é‡è®¾ç½®å¾—æ¯”æœºå™¨çš„ç‰©ç†å†…å­˜è¿˜å¤§ã€‚å¦å¤–ï¼Œå¦‚æœåŒä¸€å°æœºå™¨ä¸Šè¿è¡Œç€å¤šä¸ªJVMå®ä¾‹ï¼Œè¿™ä¸ªåŸåˆ™é€‚ç”¨äºæ‰€æœ‰å †çš„æ€»å’Œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜éœ€è¦ä¸ºJVMè‡ªèº«ä»¥åŠæœºå™¨ä¸Šå…¶ä»–çš„åº”ç”¨ç¨‹åºé¢„ç•™ä¸€éƒ¨åˆ†çš„å†…å­˜ç©ºé—´ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹äºæ™®é€šçš„æ“ä½œç³»ç»Ÿï¼Œåº”è¯¥é¢„ç•™è‡³å°‘1Gçš„å†…å­˜ç©ºé—´ã€‚ å †çš„å¤§å°ç”±2ä¸ªå‚æ•°å€¼æ§åˆ¶ï¼šåˆ†åˆ«æ˜¯åˆå§‹å€¼(é€šè¿‡-Xms Nè®¾ç½®)å’Œæœ€å¤§å€¼(é€šè¿‡ -Xmx Nè®¾ç½®)ã€‚é»˜è®¤å€¼çš„è°ƒèŠ‚å–å†³äºå¤šä¸ªå› ç´ ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿç±»å‹ã€ç³»ç»Ÿå†…å­˜å¤§å°ã€ä½¿ç”¨çš„JVMã€‚å…¶ä»–çš„å‘½ä»¤æ ‡å¿—ä¹Ÿä¼šå¯¹è¯¥å€¼é€ æˆå½±å“ï¼Œå †å¤§å°çš„è°ƒèŠ‚æ˜¯JVmè‡ªé€‚åº”è°ƒä¼˜çš„æ ¸å¿ƒã€‚ JVMçš„ç›®æ ‡æ˜¯ä¸€å¥ç³»ç»Ÿå¯ç”¨çš„èµ„æºæƒ…å†µæ‰¾åˆ°ä¸€ä¸ªâ€åˆç†çš„â€é»˜è®¤åˆå§‹åŒ–å€¼ï¼Œå½“ä¸”ä»…å½“åº”ç”¨ç¨‹åºéœ€è¦æ›´å¤šçš„å†…å­˜(ä¾æ®åƒåœ¾å›æ”¶æ—¶æ¶ˆè€—çš„æ—¶é—´æ¥å†³å®š)æ—¶å°†å †çš„å¤§å°å¢å¤§åˆ°ä¸€ä¸ªåˆç†çš„æœ€å¤§å€¼ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒJVMçš„é«˜çº§è°ƒä¼˜æ ‡å¿—ä»¥åŠè°ƒä¼˜ç»†èŠ‚éƒ½æ²¡æœ‰æåŠã€‚ä¸ºäº†è®©å¤§å®¶æœ‰ä¸ªæ„Ÿæ€§çš„è®¤è¯†ï¼Œæˆ‘ä»¬åˆ—å‡ºäº†å †å¤§å°çš„é»˜è®¤æœ€å¤§å€¼å’Œæœ€å°å€¼ä¾›å¤§å®¶å‚è€ƒï¼Œå‚è§å¦‚ä¸‹è¡¨ã€‚(ä¸ºäº†ä½¿å†…å­˜å¯¹é½ï¼ŒJVMä¼šå¯¹è¿™äº›å€¼è¿›è¡Œåœ†æ•´æ“ä½œï¼›æ‰€ä»¥GCæ—¥å¿—ä¸­è¾“å‡ºçš„å¤§å°å¯èƒ½ä¸è¡¨ä¸­ç»™å‡ºçš„å€¼å¹¶ä¸å®Œå…¨ä¸€è‡´)ã€‚ æ“ä½œç³»ç»ŸåŠJVMç±»å‹ åˆå§‹å †å¤§å°(Xms) æœ€å¤§å †å¤§å°(Xmx) Linux/Solaris,32ä½å®¢æˆ·ç«¯ 16MB 256MB Linux/Solaris,32ä½å®¢æˆ·ç«¯ 64MB å–1GBå’Œç‰©ç†å†…å­˜å¤§å°1/4äºŒè€…ä¸­çš„æœ€å°å€¼ Linux/Solaris,32ä½å®¢æˆ·ç«¯ å–512MBå’Œç‰©ç†å†…å­˜å¤§å°1/64äºŒè€…ä¸­çš„æœ€å°å€¼ å–32GBå’Œç‰©ç†å†…å­˜å¤§å°1/4äºŒè€…ä¸­çš„æœ€å°å€¼ MacOSï¼Œ64ä½æœåŠ¡å™¨å‹JVM 64MB(æ•°æ®æœ‰è¯¯,åº”è¯¥æ˜¯256MB) å–1GBå’Œç‰©ç†å†…å­˜å¤§å°1/4äºŒè€…ä¸­çš„æœ€å°å€¼ Windowsï¼Œ32ä½å®¢æˆ·ç«¯JVM 16MB 256MB Windowsï¼Œ64ä½æœåŠ¡ç«¯JVM 64MB å–1GBå’Œç‰©ç†å†…å­˜å¤§å°1/4äºŒè€…ä¸­çš„æœ€å°å€¼ å¦‚æœæœºå™¨çš„ç‰©ç†å†…å­˜å°‘äº192MBï¼Œæœ€å¤§å †çš„å¤§å°ä¼šæ˜¯ç‰©ç†å†…å­˜çš„ä¸€åŠ(å¤§çº¦96MBï¼Œæˆ–æ›´å°‘)ã€‚ å †å¤§å°å…·æœ‰åˆå§‹å€¼å’Œæœ€å¤§å€¼çš„è¿™ç§è®¾è®¡è®©JVMèƒ½å¤Ÿæ ¹æ®å®é™…çš„è´Ÿè·æƒ…å†µæ›´çµæ´»åœ°è°ƒæ•´JVMçš„è¡Œä¸ºã€‚å¦‚æœJVMå‘ç°ä½¿ç”¨åˆå§‹çš„å †å¤§å°ï¼Œé¢‘ç¹åœ°å‘ç”ŸGCï¼Œå®ƒå°±ä¼šå°è¯•å¢å¤§å †çš„ç©ºé—´ï¼Œç›´åˆ°JVMçš„GCçš„é¢‘ç‡å›å½’åˆ°æ­£å¸¸çš„èŒƒå›´ï¼Œæˆ–ç›´åˆ°å †å¤§å°å¢å¤§åˆ°å®ƒçš„ä¸Šé™å€¼ã€‚ å¯¹å¾ˆå¤šåº”ç”¨æ¥è¯´ï¼Œè¿™æ„å‘³ç€å †çš„å¤§å°ä¸å†éœ€è¦è°ƒæ•´äº†ï¼Œå®é™…ä¸Šï¼Œä½ åªéœ€è¦ä¸ºä½ é€‰æ‹©çš„GCç®—æ³•è®¾å®šæ€§èƒ½ç›®æ ‡ï¼šè­¬å¦‚ä½ èƒ½å¿å—çš„åœé¡¿çš„æŒç»­æ—¶é—´ã€ä½ æœŸæœ›åƒåœ¾å›æ”¶åœ¨æ•´ä¸ªæ—¶é—´ä¸­æ‰€å ç”¨çš„ç™¾åˆ†æ¯”ç­‰ã€‚ å¦‚æœåº”ç”¨ç¨‹åºåœ¨GCæ—¶æ¶ˆè€—äº†å¤ªé•¿çš„æ—¶é—´ï¼Œä½ å¾ˆæœ‰å¯èƒ½éœ€è¦ä½¿ç”¨-Xmxæ ‡å¿—å¢å¤§å †çš„å¤§å°ã€‚é€‰æ‹©ä»€ä¹ˆæ ·çš„å¤§å°æ²¡æœ‰ä¸€ä¸ªç¡¬æ€§çš„æˆ–ç®€å•çš„è§„åˆ™ã€‚ä¸€ä¸ªç»éªŒæ³•åˆ™æ˜¯å®ŒæˆFull GCåï¼Œåº”è¯¥é‡Šæ”¾å‡º70%çš„ç©ºé—´(30%çš„ç©ºé—´ä»ç„¶å ç”¨)ã€‚ æ³¨æ„ï¼Œå³ä½¿ä½ æ˜¾ç¤ºåœ°è®¾ç½®äº†å †çš„æœ€å¤§å®¹é‡ï¼Œè¿˜æ˜¯ä¼šå‘ç”Ÿå †çš„è‡ªåŠ¨è°ƒèŠ‚ï¼šåˆå§‹æ—¶å †ä»¥é»˜è®¤çš„å¤§å°å¼€å§‹è¿è¡Œï¼Œä¸ºäº†è¾¾åˆ°æ ¹æ®åƒåœ¾æ”¶é›†ç®—æ³•è®¾ç½®çš„æ€§èƒ½ç›®æ ‡ï¼ŒJVMä¼šé€æ­¥å¢å¤§å †çš„å¤§å°ã€‚å°†å †çš„å¤§å°è®¾ç½®å¾—æ¯”å®é™…éœ€è¦æ›´å¤§ä¸ä¸€å®šä¼šå¸¦æ¥æ€§èƒ½æŸè€—ï¼šå †å¹¶ä¸ä¼šæ— é™åœ°å¢å¤§ï¼ŒJVMä¼šè°ƒèŠ‚å †çš„å¤§å°ç›´åˆ°å…¶æ»¡è¶³GCçš„æ€§èƒ½ç›®æ ‡ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ ç¡®åˆ‡åœ°äº†è§£åº”ç”¨ç¨‹åºéœ€è¦å¤šå¤§çš„å †ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†å †çš„åˆå§‹åŒ–å’Œæœ€å¤§å€¼è®¾ç½®ä¸€è‡´æ•°å€¼(è­¬å¦‚ï¼š-Xms1024M -Xmx1024M)ã€‚è¿™ç§è®¾ç½®èƒ½ç¨å¾®æé«˜GCçš„è¿è¡Œæ•ˆç‡ï¼Œå› ä¸ºå®ƒä¸å†éœ€è¦ä¼°ç®—å †æ˜¯å¦éœ€è¦è°ƒæ•´å¤§å°ã€‚ å †å†…å­˜çº é”™åœ¨ä¸Šè¿°è¡¨æˆ‘ä»¬çŸ¥é“äº†ä¸åŒæ“ä½œç³»ç»Ÿã€ä¸åŒJVMã€ä¸åŒç‰©ç†å†…å­˜çš„é»˜è®¤å †å¤§å°ã€‚ä½†æ˜¯å®é™…ä¸Šï¼ŒMac OSè¿™ä¸ªæ•°æ®æœ‰é—®é¢˜çš„ã€‚æˆ‘çš„Mac Pro 2013çš„é…ç½®ç‰©ç†å†…å­˜æ˜¯16Gã€64ä½çš„JVMã€‚ ä¸‹é¢ä¸¤ä¸ªå‘½ä»¤ç”¨äºæŸ¥çœ‹å½“å‰JREé»˜è®¤çš„å †å¤§å°ï¼Œè¯¥æ–¹æ³•é€‚ç”¨äºJava 6u20ä»¥åŠä¹‹åç‰ˆæœ¬ã€‚ 1234567891011121314151617181920# ä½¿ç”¨-serverYeamin:~ mac$ java -server -XX:+UnlockDiagnosticVMOptions -XX:+PrintFlagsFinal -version | grep -i heapsize uintx ErgoHeapSizeLimit = 0 &#123;product&#125; uintx HeapSizePerGCThread = 87241520 &#123;product&#125; uintx InitialHeapSize := 268435456 &#123;product&#125; uintx LargePageHeapSizeThreshold = 134217728 &#123;product&#125; uintx MaxHeapSize := 4294967296 &#123;product&#125;java version \"1.8.0_192\"Java(TM) SE Runtime Environment (build 1.8.0_192-b12)Java HotSpot(TM) 64-Bit Server VM (build 25.192-b12, mixed mode)# ä½¿ç”¨-clientYeamin:~ mac$ java -client -XX:+UnlockDiagnosticVMOptions -XX:+PrintFlagsFinal -version | grep -i heapsize uintx ErgoHeapSizeLimit = 0 &#123;product&#125; uintx HeapSizePerGCThread = 87241520 &#123;product&#125; uintx InitialHeapSize := 268435456 &#123;product&#125; uintx LargePageHeapSizeThreshold = 134217728 &#123;product&#125; uintx MaxHeapSize := 4294967296 &#123;product&#125;java version \"1.8.0_192\"Java(TM) SE Runtime Environment (build 1.8.0_192-b12)Java HotSpot(TM) 64-Bit Server VM (build 25.192-b12, mixed mode) æŸ¥çœ‹ç»“æœï¼Œæˆ‘ä»¬å‘ç°ï¼ŒMac OSä¸­clientå’Œserveræ¨¡å¼çš„åˆå§‹åŒ–å †å¤§å°æ˜¯268435456(å³268435456/1024/1024=256M=ç‰©ç†å†…å­˜16G \\ 1024 \\ 1/64)ã€‚æˆ‘ä»¬å‘ç°å®é™…ä¸Šè¿™ä¸ªè¡¨ä¸­æ•°æ®æ˜¯æœ‰è¯¯çš„ã€‚ å…¶å®ä¸ä»…ä»…æ˜¯Mac OSï¼ŒWindows 64ä½ä¹Ÿæ˜¯è¿™æ ·çš„ã€‚ æ€»ç»“ å †åˆ†é…è¿‡å°ï¼Œç¨‹åºå¤§éƒ¨åˆ†æ—¶é—´æ¶ˆè€—åœ¨GCä¸Šã€‚å †åˆ†é…è¿‡å¤§ï¼ŒGCåœé¡¿æ—¶é—´åŠ é•¿ï¼Œåœé¡¿é¢‘ç‡å‡å°‘ï¼Œä½¿å¾—ç¨‹åºæ€§èƒ½æ•´å¤©ä¸‹é™ã€‚ JVMä¸åƒæ˜¯ç‰©ç†å†…å­˜ä¸€æ ·å¯ä»¥ä½¿ç”¨äº¤äº’/åˆ†é¡µæŠ€æœ¯ã€‚è®¡ç®—æœºæ˜¯ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜ç»“åˆä½¿ç”¨ï¼Œç¨‹åºä¸­è¿è¡Œä¸æ´»è·ƒçš„æ•°æ®å¤åˆ¶åˆ°è™šæ‹Ÿå†…å­˜(ç£ç›˜)ï¼Œè€ŒJVMå®Œå…¨æ²¡æœ‰è¿™ç§å†…å­˜äº¤æ¢ç»†èŠ‚ï¼Œåˆ†é…å¤šå°‘Gå°±æ˜¯å¤šå°‘Gã€‚ ä¸åŒæ“ä½œç³»ç»Ÿã€ä¸åŒå¤§å°ç‰©ç†å†…å­˜ã€ä¸åŒJVMçš„é»˜è®¤å †å¤§å°æœ‰æ‰€å·®å¼‚ã€‚ä½†æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„éƒ½æ˜¯64ä½çš„JVMï¼Œå¸¸ç”¨çš„åˆå§‹åŒ–å †å¤§å°æ˜¯ç‰©ç†å†…å­˜çš„1/64,å¸¸ç”¨çš„æœ€å¤§å †å¤§å°ä¸ºç‰©ç†å†…å­˜çš„1/4ã€‚ å †çš„åˆå§‹åŒ–å¤§å°å’Œæœ€å¤§å †å¤§å°ç”±-Xms:Nå’Œ-Xmx:Nä¸¤ä¸ªå‚æ•°æ¥æ§åˆ¶ã€‚å…¶ä¸­Nè¡¨ç¤ºå­˜å‚¨å¤§å°ï¼Œé»˜è®¤ä¸ºMBä¸ºåŸºæœ¬å•ä½ã€‚ æ¯æ¬¡GCçš„æ—¶å€™ä¼šåŠ¨æ€è°ƒæ•´å †çš„å¤§å°ã€‚è‹¥é»˜è®¤ç©ºä½™å †å†…å­˜å°äº40%æ—¶ï¼ŒJVMä¼šåŠ¨æ€å°†å †å†…å­˜å¢å¤§åˆ°-Xmxæœ€å¤§é™åˆ¶ã€‚è‹¥é»˜è®¤ç©ºä½™å †å†…å­˜å°äº40%æ—¶ï¼ŒJVMä¼šåŠ¨æ€å°†å †å†…å­˜å‡å°‘åˆ°-Xmsæœ€å°é™åˆ¶ã€‚å› æ­¤æˆ‘ä»¬ä¸€èˆ¬è®¾ç½®-Xmså’Œ-Xmxç›¸ç­‰ï¼Œé¿å…åœ¨æ¯æ¬¡GCåè°ƒæ•´å †çš„å¤§å°ã€‚ é™¤éåº”ç”¨ç¨‹åºéœ€è¦æ¯”é»˜è®¤å€¼æ›´å¤§çš„å †ï¼Œå¦åˆ™åœ¨è¿›è¡Œè°ƒä¼˜æ—¶ï¼Œå°½é‡è€ƒè™‘é€šè¿‡GCç®—æ³•çš„æ€§èƒ½ç›®æ ‡ï¼Œè€Œéå¾®è°ƒå †çš„å¤§å°æ¥æ”¹å–„ç¨‹åºæ€§èƒ½ã€‚ å‚è€ƒæ–‡çŒ® ã€ŠJavaæ€§èƒ½æƒå¨æŒ‡å—ã€‹","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"JVMåŠå¹¶å‘ç¼–ç¨‹","slug":"JVMåŠå¹¶å‘ç¼–ç¨‹","permalink":"http://ltyeamin.github.io/tags/JVMåŠå¹¶å‘ç¼–ç¨‹/"}]},{"title":"å±€åŸŸç½‘æ–‡ä»¶å…±äº«ä¸ä¸‹è½½æœåŠ¡æ–°å§¿åŠ¿","slug":"å±€åŸŸç½‘æ–‡ä»¶å…±äº«ä¸ä¸‹è½½æœåŠ¡æ–°å§¿åŠ¿","date":"2018-06-18T13:22:13.000Z","updated":"2019-11-20T15:08:51.556Z","comments":true,"path":"2018/06/18/å±€åŸŸç½‘æ–‡ä»¶å…±äº«ä¸ä¸‹è½½æœåŠ¡æ–°å§¿åŠ¿/","link":"","permalink":"http://ltyeamin.github.io/2018/06/18/å±€åŸŸç½‘æ–‡ä»¶å…±äº«ä¸ä¸‹è½½æœåŠ¡æ–°å§¿åŠ¿/","excerpt":"","text":"åœ¨å¹³å¸¸ç”Ÿæ´»æˆ–å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä¼ è¾“æ–‡ä»¶ï¼Œæ¯”å¦‚å°†ç”µè„‘ä¸Šä¸‹è½½çš„Appä¼ é€åˆ°æ‰‹æœºæˆ–å¦ä¸€å°PCä¸Šã€åŒäº‹ä¹‹é—´ä¼ è¾“ä¸€äº›å¤§å‹çš„æ–‡ä»¶ã€‚å½“æˆ‘ä»¬é‡åˆ°æ­¤ç±»é—®é¢˜æ—¶ï¼Œé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯ä½¿ç”¨QQæˆ–è€…å¾®ä¿¡ï¼Œæ›´æ·±ä¸€å±‚ï¼Œå»ç½‘ä¸Šæœç´¢ä¸€äº›æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œå¦‚Send Anywhereï¼ŒLZå½“æ—¶åœ¨å¤§å­¦æ—¶å€™ç»å¸¸ä½¿ç”¨çš„æ˜¯FTPã€SambaæœåŠ¡ã€‚ä½†æ˜¯è¿™äº›ç¬¬ä¸‰æ–¹è¦ä¹ˆéƒ½æ˜¾å¾—å¤ªéº»çƒ¦ï¼ˆå¦‚ä¸‹å›¾ï¼‰ï¼Œè¦ä¹ˆå°±æ˜¯ä¸å®‰å…¨ï¼Œå®‰å…¨éšæ‚£ä¸»è¦åœ¨æ•°æ®ä¼ è¾“å®‰å…¨ä»¥åŠæ•°æ®å¤‡ä»½ä¸Šä½“ç°ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å°†æ–‡ä»¶ä¼ è¾“åˆ°ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ä¸Šï¼Œå†é€šè¿‡éœ€è¦æ¥æ”¶æ•°æ®çš„ç”µè„‘æˆ–æ‰‹æœºè¿›è¡Œä¸‹è½½ã€‚ é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰åŠæ³•ç›´æ¥è·å–æ–‡ä»¶ï¼Œè€Œä¸é€šè¿‡è¿™äº›ç¹ççš„æ“ä½œï¼Ÿåœ¨è¿™é‡Œå‘¢ï¼ŒLZç»™å¤§å®¶æ¨èå‡ ç§å¸¸è§çš„æ–‡ä»¶å…±äº«æ–¹æ³•ã€‚ æ–‡ä»¶å…±äº«ä¸‹è½½æ–°å§¿åŠ¿æœ€æ–¹ä¾¿çš„Windowsæ–‡ä»¶å…±äº«LZæœ¬äººä¸€å¹´å¤šæ²¡ç”¨è¿‡Windowsç”µè„‘äº†,ç°åœ¨å…¬å¸é…ç½®çš„æ˜¯Mac Proï¼Œå®¶ç”¨çš„Lenovo Y430På·²è¢«æ”¹è£…ä¸ºDeepin Linux,ç”±äºç°åœ¨æ—¥å¸¸ç”Ÿæ´»ã€å·¥ä½œéƒ½æ˜¯åœ¨éWindowsæ“ä½œ,æ‰€ä»¥è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼Œç­‰æœ‰æœºä¼šä¼šæŠŠè¯¦ç»†æ•™ç¨‹åˆ—åˆ°è¿™é‡Œã€‚ Windowsæ–‡ä»¶å…±äº« æœ€ç®€å•çš„Pythonå‘½ä»¤å…±äº«å¤§å®¶éƒ½çŸ¥é“Python2ä¸Python3ä¸å…¼å®¹,ä¸€èˆ¬Linuxå’ŒMac OS Xé»˜è®¤é›†æˆPython2,å› ä¸ºè¿™äº›ç³»ç»Ÿä¸€äº›åº”ç”¨å·¥å…·æ˜¯Python2å¼€å‘çš„ï¼Œæ‰€ä»¥ç³»ç»Ÿåªèƒ½é»˜è®¤Python2ã€‚ Python2çš„æ“ä½œå§¿åŠ¿ 1234Yeamin:book mac$ echo litonglitongYeamin:book mac$ python -m SimpleHTTPServer 8900Serving HTTP on 0.0.0.0 port 8900 ... Python3çš„æ“ä½œå§¿åŠ¿ 12Yeamin:work mac$ python3 -m http.server 8900Serving HTTP on 0.0.0.0 port 8900 (http://0.0.0.0:8900/) ... â€‹ æˆ‘åœ¨æˆ‘çš„Macæˆ–Linuxç»ˆç«¯æ‰§è¡Œç®€å•çš„ä¸Šè¿°ä»»æ„ä¸¤ä¸ªå‘½ä»¤åï¼Œå¯åŠ¨ä¸€ä¸ªHTTPæœåŠ¡å™¨ï¼Œæ‰“å¼€æµè§ˆå™¨è¾“å…¥http://127.0.0.1:8900æˆ–http://localhost:8900 åå›å‡ºç°ä¸‹å›¾æ–‡ä»¶å…±äº«çš„åˆ—è¡¨ï¼Œè‹¥å…¶ä»–äººæƒ³ä¸‹è½½å¯ä»¥å°†å±€åŸŸç½‘IPå’Œç«¯å£å·å‘ŠçŸ¥å…¶ä»–äººå³å¯ä¸‹è½½ã€‚åœ¨è¿™ä¸ä»…ä»…å¯ä»¥ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥é¢„è§ˆå¸¸è§æ–‡ä»¶ï¼Œæ¯”å¦‚éŸ³é¢‘ã€è§†é¢‘ã€å›¾ç‰‡ã€PDFã€æ–‡æœ¬æ–‡ä»¶ã€‚ æœ€ä¸“ä¸šçš„NginxæœåŠ¡å…±äº«å¤§å®¶éƒ½çŸ¥é“å•å°çš„Nginx WebæœåŠ¡å™¨å¹¶å‘æ€§èƒ½è¾ƒå¼º,ä¸€èˆ¬åŸºæœ¬éƒ½æ˜¯æ–‡ä»¶å¤šå¹¶å‘å¤§çš„æƒ…å†µä¸‹æ‰ç”¨ï¼Œä¼ä¸šé‡Œä¸€èˆ¬åšè·¯ç”±è½¬å‘ã€è´Ÿè½½å‡è¡¡ã€èµ„æºé™æ€åŒ–ï¼Œè·¯ç”±è½¬å‘æ˜¯ä¸ºäº†å¯¹å¤–ç»Ÿä¸€æš´éœ²ä¸€ä¸ªåœ°å€ï¼Œè´Ÿè½½å‡è¡¡æ˜¯æ ¹æ®æŸç§ç®—æ³•(IP_HASHç»‘å®šç­–ç•¥ã€è½®è¯¢ç­–ç•¥ã€æƒé‡)å°†ä¸åŒçš„è¯·æ±‚åˆ†æ•£åˆ°å¤šå°ä¸šåŠ¡ç›¸åŒçš„æœºå™¨ä¸Šï¼Œèµ„æºé™æ€åŒ–è¿™ä¸ªå¾ˆå¸¸è§ï¼Œä»¥å‰é¡¹ç›®å¤ªå¤§ï¼Œä¼šå°†JS/CSSå•ç‹¬åˆ†ç¦»ï¼Œä½¿å¾—åº”ç”¨ç³»ç»Ÿå‰ç«¯ç»„ä»¶åŠ è½½æ›´å¿«ã€‚ ä¸‹è½½Nginx 1234567891011litong@LT:/media/litong/è½¯ä»¶/programs/tools$ wget -c http://nginx.org/download/nginx-1.15.10.tar.gz--2019-03-31 14:03:53-- http://nginx.org/download/nginx-1.15.10.tar.gzæ­£åœ¨è§£æä¸»æœº nginx.org (nginx.org)... 62.210.92.35, 95.211.80.227, 2001:1af8:4060:a004:21::e3æ­£åœ¨è¿æ¥ nginx.org (nginx.org)|62.210.92.35|:80... å·²è¿æ¥ã€‚å·²å‘å‡º HTTP è¯·æ±‚ï¼Œæ­£åœ¨ç­‰å¾…å›åº”... 200 OKé•¿åº¦ï¼š1032228 (1008K) [application/octet-stream]æ­£åœ¨ä¿å­˜è‡³: â€œnginx-1.15.10.tar.gzâ€nginx-1.15.10.tar.gz 100%[===============================&gt;] 1008K 13.4KB/s ç”¨æ—¶ 55s 2019-03-31 14:04:48 (18.4 KB/s) - å·²ä¿å­˜ â€œnginx-1.15.10.tar.gzâ€ [1032228/1032228]) è§£å‹Nginx 1tar -zxvf nginx-1.15.10.tar.gz ç¼–è¯‘Nginx 1cd nginx-1.15.10/ 1./configure 1make 1sudo make install å¯åŠ¨Nginx 12cd /usr/local/nginx/sbin./nginx å¯åŠ¨æˆåŠŸåï¼Œè¾“å…¥localhost:80ï¼Œçœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸè¿›å…¥åˆ°index.htmlï¼Œå¦‚ä¸‹å›¾: æŸ¥çœ‹å¯åŠ¨è¿›ç¨‹ å¦‚æœæ‡’å¾—æ‰“å¼€æµè§ˆå™¨ï¼Œç›´æ¥çœ‹è¿›ç¨‹ç¡®è®¤nginxæ˜¯å¦å¯åŠ¨ 12litong@LT:usr/local/nginx/sbin$ ps -ef | grep nginxroot 7017 1 0 11:07 ? 00:00:00 nginx: master process ./nginx é‡è½½Nginx ä¿®æ”¹Nginxçš„é…ç½®æ–‡ä»¶nginx.conf,å¹¶è¿›è¡Œé‡è½½é…ç½®: 12345678910listen 80; #ç«¯å£ server_name localhost; #æœåŠ¡å charset utf-8; # é¿å…ä¸­æ–‡ä¹±ç root /home/litong/Pictures; #æ˜¾ç¤ºçš„æ ¹ç´¢å¼•ç›®å½•ï¼Œæ³¨æ„è¿™é‡Œè¦æ”¹æˆä½ è‡ªå·±çš„ï¼Œç›®å½•è¦å­˜åœ¨ location / &#123; autoindex on; #å¼€å¯ç´¢å¼•åŠŸèƒ½ autoindex_exact_size off; # å…³é—­è®¡ç®—æ–‡ä»¶ç¡®åˆ‡å¤§å°ï¼ˆå•ä½bytesï¼‰ï¼Œåªæ˜¾ç¤ºå¤§æ¦‚å¤§å°ï¼ˆå•ä½kbã€mbã€gbï¼‰ autoindex_localtime on; # æ˜¾ç¤ºæœ¬æœºæ—¶é—´è€Œé GMT æ—¶é—´ &#125; 1./nginx -s reload åœ¨æµè§ˆå™¨ç«¯è¾“å…¥localhost:80, åˆ™å‡ºç°å¦‚ä¸‹ç•Œé¢: ä¸åŒç»ˆç«¯æ•ˆæœæ¬£èµ[Pythonå…±äº«]Mac Pro / Mac OS X 10.14.1 Mojave [Nginxå…±äº«]Lenovo Y430P/ Deepin Linux [Pythonå…±äº«]XiaoMi 5X/ Android-MIUI10 [Windowså…±äº«]Lenovo ThinkPad T410/Microsoft Windows 10 å®¶åº­ç‰ˆWindowsåç»­å†ä½“éªŒï¼Œæœªå®Œå¾…ç»­ã€‚ã€‚ã€‚","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"å®ç”¨å·¥å…·åŠæŠ€å·§","slug":"å®ç”¨å·¥å…·åŠæŠ€å·§","permalink":"http://ltyeamin.github.io/tags/å®ç”¨å·¥å…·åŠæŠ€å·§/"}]},{"title":"RabbitMQå·¥ä½œæ¨¡å¼ä¹‹ç®€å•æ¨¡å¼","slug":"RabbitMQå·¥ä½œæ¨¡å¼ä¹‹ç®€å•æ¨¡å¼","date":"2018-06-12T12:15:11.000Z","updated":"2019-11-20T15:08:59.508Z","comments":true,"path":"2018/06/12/RabbitMQå·¥ä½œæ¨¡å¼ä¹‹ç®€å•æ¨¡å¼/","link":"","permalink":"http://ltyeamin.github.io/2018/06/12/RabbitMQå·¥ä½œæ¨¡å¼ä¹‹ç®€å•æ¨¡å¼/","excerpt":"","text":"ä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹RabbitMQå·¥ä½œæ¨¡å¼ä¹‹ç®€å•æ¨¡å¼ï¼Œåœ¨å­¦ä¹‹å‰æˆ‘ä»¬æ ¹æ®å®˜æ–¹æ–‡æ¡£(çº¯è‹±æ–‡æ–‡æ¡£ï¼Œå¯ä»¥è£…ä¸ªChromeæ’ä»¶é€‰ä¸­ç¿»è¯‘)å­¦ä¹ ä¸€ä¸‹RabbitMQçš„ä¸€äº›æœ¯è¯­ï¼Œè¿™æ‰èƒ½è®©æˆ‘ä»¬æ›´æ·±å…¥çš„äº†è§£ã€‚ å‡†å¤‡æ¡ä»¶æœ¬æ•™ç¨‹å‡å®šRabbitMQå·²åœ¨æ ‡å‡†ç«¯å£ï¼ˆ5672ï¼‰ä¸Šçš„localhostä¸Šå®‰è£…å¹¶è¿è¡Œã€‚å¦‚æœæ‚¨ä½¿ç”¨ä¸åŒçš„ä¸»æœºï¼Œç«¯å£æˆ–è®¤è¯ï¼Œåˆ™éœ€è¦è°ƒæ•´è¿æ¥è®¾ç½®ã€‚ æœ¯è¯­ä»‹ç»RabbitMQæ˜¯ä¸€ä¸ªæ¶ˆæ¯ä»£ç†ä¸­é—´ä»¶ï¼šå®ƒæ¥å—å’Œè½¬å‘æ¶ˆæ¯ã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºé‚®å±€ï¼šå½“æ‚¨å°†è¦å‘å¸ƒçš„é‚®ä»¶æ”¾åœ¨é‚®ç®±ä¸­æ—¶ï¼Œæ‚¨å¯ä»¥ç¡®å®šé‚®é€’å‘˜æœ€ç»ˆä¼šå°†é‚®ä»¶å‘é€ç»™æ‚¨çš„æ”¶ä»¶äººã€‚åœ¨è¿™ä¸ªæ¯”å–»ä¸­ï¼ŒRabbitMQæ˜¯ä¸€ä¸ªé‚®ç®±ï¼Œé‚®å±€å’Œé‚®é€’å‘˜åªè´Ÿè´£ä¸­è½¬è°ƒåº¦ã€‚ RabbitMQå’Œé‚®å±€ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä¸å¤„ç†çº¸å¼ ï¼Œè€Œæ˜¯æ¥å—ï¼Œå­˜å‚¨å’Œè½¬å‘äºŒè¿›åˆ¶blobæ•°æ® - æ¶ˆæ¯ã€‚ RabbitMQå’Œä¸€èˆ¬çš„æ¶ˆæ¯ä¼ é€’ä½¿ç”¨äº†ä¸€äº›æœ¯è¯­ï¼šç”Ÿäº§è€…ã€é˜Ÿåˆ—ã€æ¶ˆè´¹è€…ã€‚ ç”Ÿäº§è€… å‘é€æ¶ˆæ¯çš„ç¨‹åºæ˜¯ç”Ÿäº§è€…ã€‚ å®˜ç½‘ä¸Šé’è‰²æ¤­åœ†Påˆ™æ ‡è¯†æ¶ˆæ¯ç”Ÿäº§è€…ã€‚ é˜Ÿåˆ— é˜Ÿåˆ—æ˜¯RabbitMQä¸­çš„é‚®ç®±çš„åç§°ã€‚è™½ç„¶æ¶ˆæ¯æµç»RabbitMQå’Œæ‚¨çš„åº”ç”¨ç¨‹åºï¼Œä½†å®ƒä»¬åªèƒ½å­˜å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚é˜Ÿåˆ—åªå—ä¸»æœºçš„å†…å­˜å’Œç£ç›˜é™åˆ¶çš„çº¦æŸï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¤§çš„æ¶ˆæ¯ç¼“å†²åŒºã€‚è®¸å¤šç”Ÿäº§è€…å¯ä»¥å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”è®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°è¯•ä»ä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¶æ•°æ®ã€‚å®˜ç½‘ä¸Šçº¢è‰²å¤šæ ¼å­é•¿æ–¹å½¢åˆ™æ ‡è¯†é˜Ÿåˆ—ã€‚ æ¶ˆè´¹è€… æ¶ˆè´¹ä¸æ¥å—æœ‰ç±»ä¼¼çš„æ„ä¹‰ã€‚æ¶ˆè´¹è€…æ˜¯ä¸€ä¸ªä¸»è¦ç­‰å¾…æ¥æ”¶æ¶ˆæ¯çš„ç¨‹åºï¼š è¯·æ³¨æ„ï¼Œç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å’Œæ¶ˆæ¯ä»£ç†ä¸å¿…é©»ç•™åœ¨åŒä¸€ä¸»æœºä¸Š;å®é™…ä¸Šåœ¨å¤§å¤šæ•°åº”ç”¨ä¸­ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥æ˜¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚ æ€»ç»“ï¼šæ•´ä¸ªè¿‡ç¨‹éå¸¸ç®€å•ï¼Œç”Ÿäº§è€…åˆ›å»ºæ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ¥æ”¶è¿™äº›æ¶ˆæ¯ã€‚ä½ çš„åº”ç”¨ç¨‹åºæ—¢å¯ä»¥ä½œä¸ºç”Ÿäº§è€…å‘å…¶ä»–åº”ç”¨ç¨‹åºå‘é€æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ¶ˆè´¹è€…ï¼Œç­‰å¾…æ¥æ”¶å…¶ä»–åº”ç”¨ç¨‹åºçš„æ¶ˆæ¯ã€‚å…¶ä¸­ï¼Œå­˜å‚¨æ¶ˆæ¯çš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒç±»ä¼¼äºé‚®ç®±ï¼Œæ¶ˆæ¯é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡ŒæŠ•é€’ã€‚ æ¡ˆä¾‹å®æˆ˜åœ¨æœ¬æ•™ç¨‹çš„è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨Javaç¼–å†™ä¸¤ä¸ªç¨‹åº;å‘é€å•ä¸ªæ¶ˆæ¯çš„ç”Ÿäº§è€…ï¼Œä»¥åŠæ¥æ”¶æ¶ˆæ¯å¹¶å°†å…¶æ‰“å°å‡ºæ¥çš„æ¶ˆè´¹è€…ã€‚æˆ‘ä»¬å°†æ©ç›–Java APIä¸­çš„ä¸€äº›ç»†èŠ‚ï¼Œä¸“æ³¨äºè¿™ä¸ªéå¸¸ç®€å•çš„äº‹æƒ…ï¼Œåªæ˜¯ä¸ºäº†å¼€å§‹ã€‚è¿™æ˜¯æ¶ˆæ¯ä¼ é€’çš„â€œHello Worldâ€ã€‚ åœ¨ä¸‹å›¾ä¸­ï¼Œâ€œPâ€æ˜¯æˆ‘ä»¬çš„ç”Ÿäº§è€…ï¼Œâ€œCâ€æ˜¯æˆ‘ä»¬çš„æ¶ˆè´¹è€…ã€‚ä¸­é—´çš„çº¢æ¡†æ˜¯ä¸€ä¸ªé˜Ÿåˆ— - RabbitMQä»£è¡¨æ¶ˆè´¹è€…ä¿ç•™çš„æ¶ˆæ¯ç¼“å†²åŒºã€‚ äº†è§£åˆ°ä¸Šè¿°æ¦‚å¿µï¼Œç°åœ¨æˆ‘ä»¬å¼€å§‹åŠ¨æ‰‹å®è·µå§ï¼ å¯¼å…¥å®¢æˆ·ç«¯ä¾èµ– Maven 12345&lt;dependency&gt; &lt;groupId&gt;com.rabbitmq&lt;/groupId&gt; &lt;artifactId&gt;amqp-client&lt;/artifactId&gt; &lt;version&gt;5.6.0&lt;/version&gt;&lt;/dependency&gt; Gradle 123dependencies &#123; compile group: 'com.rabbitmq', name: 'amqp-client', version: '5.6.0'&#125; å¯¼å…¥å®Œä¾èµ–åï¼Œæˆ‘ä»¬å°†ç¼–å†™æ¶ˆæ¯å‘å¸ƒè€…ï¼ˆå‘é€è€…ï¼‰Sendå‘é€å’Œæˆ‘ä»¬çš„æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆæ¥æ”¶è€…ï¼‰Recvã€‚å‘å¸ƒè€…å°†è¿æ¥åˆ°RabbitMQï¼Œå‘é€å•ä¸ªæ¶ˆæ¯ï¼Œç„¶åé€€å‡ºã€‚ ç¼–å†™æ¶ˆæ¯ç”Ÿäº§/å‘ç”Ÿè€…123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960package cn.yeamin.actions.simple.produces;import com.rabbitmq.client.ConnectionFactory;import com.rabbitmq.client.Connection;import com.rabbitmq.client.Channel;import java.io.IOException;import java.util.concurrent.TimeoutException;/** * ç®€å•é˜Ÿåˆ—çš„æ¶ˆæ¯ç”Ÿäº§è€… */public class Send &#123; /** * è®¾ç½®é˜Ÿåˆ—åç§° */ private final static String QUEUE_NAME = \"hello\"; public static void main(String[] args) throws IOException, TimeoutException &#123; // åˆ›å»ºè¿æ¥å·¥å‚ ConnectionFactory factory = new ConnectionFactory(); // è®¾ç½®è¿æ¥ä¸»æœºå factory.setHost(\"localhost\"); //è®¾ç½®ç«¯å£å·,ä¸è®¾ç½®é»˜è®¤ä¸º5672 factory.setPort(5672); /* * å¦‚æœå¯ä»¥é€šè¿‡è¿æ¥å·¥å‚åˆ›å»ºä¸€ä¸ªè¿æ¥,åˆ™ç»§ç»­åœ¨è¿æ¥åŸºç¡€ä¸Šç»§ç»­åˆ›å»ºé€šé“. * è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨try-with-resourcesè¯­å¥ï¼Œå› ä¸ºConnectionå’ŒChanneléƒ½å®ç°äº†java.io.Closeableã€‚ * è¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦åœ¨ä»£ç ä¸­æ˜ç¡®åœ°å…³é—­å®ƒä»¬ã€‚ */ try (Connection connection = factory.newConnection(); // åˆ›å»ºé€šé“ Channel channel = connection.createChannel()) &#123; /* * ä¸ºäº†å‘é€æ¶ˆæ¯æˆåŠŸ,æˆ‘ä»¬å¿…é¡»å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ä¾›æˆ‘ä»¬å‘é€,é˜Ÿåˆ—åªå£°æ˜ä¸€æ¬¡,ä¸å¯èƒ½å­˜åœ¨é‡å¤é˜Ÿåˆ— * å‚æ•°1: queueè¡¨ç¤ºé˜Ÿåˆ—åç§° * å‚æ•°2: durableè¡¨ç¤ºæ˜¯å¦æŒä¹…åŒ– * å‚æ•°3: exclusiveè¡¨ç¤ºä»…åˆ›å»ºè€…å¯ä»¥ä½¿ç”¨çš„ç§æœ‰é˜Ÿåˆ—ï¼Œæ–­å¼€åè‡ªåŠ¨åˆ é™¤ * å‚æ•°4: autoDeleteè¡¨ç¤ºå½“æ‰€æœ‰æ¶ˆè´¹å®¢æˆ·ç«¯è¿æ¥æ–­å¼€åï¼Œæ˜¯å¦è‡ªåŠ¨åˆ é™¤é˜Ÿåˆ— * å‚æ•°5: argumentsè¡¨ç¤ºå…¶ä»–çš„æ„é€ å‚æ•°,ä¸ºé˜Ÿåˆ—æ„é€ è€Œå‡†å¤‡ */ channel.queueDeclare(QUEUE_NAME, false, false, false, null); // è¦å‘é€çš„æ¶ˆæ¯ String message = \"Hello World, lt, Welcome RabbitMQ!\"; /* * æœ€åŸºæœ¬çš„æ¶ˆæ¯å‘é€ * å‚æ•°1: exchangeè¡¨ç¤ºäº¤æ¢æœº * å‚æ•°2: routingKeyè¡¨ç¤ºè·¯ç”±Key * å‚æ•°3: propsè¡¨ç¤ºæ¯çš„å…¶ä»–å‚æ•° * å‚æ•°4: autoDeleteè¡¨ç¤ºå½“æ‰€æœ‰æ¶ˆè´¹å®¢æˆ·ç«¯è¿æ¥æ–­å¼€åï¼Œæ˜¯å¦è‡ªåŠ¨åˆ é™¤é˜Ÿåˆ— * å‚æ•°5: bodyè¡¨ç¤ºæ¯ä½“,æ˜¯ä¸ªå­—èŠ‚æ•°ç»„,æ„å‘³ç€å¯ä»¥ä¼ é€’ä»»ä½•æ•°æ® */ channel.basicPublish(\"\", QUEUE_NAME, null, message.getBytes()); //æ¶ˆæ¯å‘é€æ–¹çš„æ—¥å¿—æ‰“å° System.out.println(\" [x] Sent '\" + message + \"'\"); &#125; &#125;&#125; å£°æ˜é˜Ÿåˆ—æ˜¯å¹‚ç­‰çš„ ï¼Œåªæœ‰åœ¨å®ƒä¸å­˜åœ¨çš„æƒ…å†µä¸‹æ‰ä¼šåˆ›å»ºå®ƒã€‚æ¶ˆæ¯å†…å®¹æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œå› æ­¤æ‚¨å¯ä»¥å‘é€ä»»ä½•æ•°æ®ã€‚ ç¼–å†™æ¶ˆæ¯æ¶ˆè´¹è€…12345678910111213141516171819202122232425262728293031323334353637383940package cn.yeamin.actions.simple.consumers;import com.rabbitmq.client.*;/** * ç®€å•é˜Ÿåˆ—çš„æ¶ˆæ¯æ¶ˆè´¹è€… */public class Recv &#123; private final static String QUEUE_NAME = \"hello\"; public static void main(String[] argv) throws Exception &#123; // åˆ›å»ºè¿æ¥å·¥å‚ ConnectionFactory factory = new ConnectionFactory(); // è®¾ç½®RabbitMQä¸»æœºå factory.setHost(\"localhost\"); // æ–°å»ºè¿æ¥ Connection connection = factory.newConnection(); // æ–°å»ºé€šé“ Channel channel = connection.createChannel(); //ç»‘å®šé˜Ÿåˆ— channel.queueDeclare(QUEUE_NAME, false, false, false, null); System.out.println(\" [*] Waiting for messages. To exit press CTRL+C\"); // åˆ›å»ºæ¶ˆè´¹è€…,æ¶ˆè´¹æ¶ˆæ¯ DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; &#123; String message = new String(delivery.getBody(), \"UTF-8\"); System.out.println(\" [x] Received '\" + message + \"'\"); &#125;; /** * * æ¶ˆè´¹è€…æ¶ˆè´¹ * å‚æ•°1 ï¼šqueueé˜Ÿåˆ—å * å‚æ•°2 ï¼šautoAck æ˜¯å¦è‡ªåŠ¨ACK * å‚æ•°3 ï¼šcallbackæ¶ˆè´¹è€…å¯¹è±¡çš„ä¸€ä¸ªæ¥å£ï¼Œç”¨æ¥é…ç½®å›è°ƒ * */ channel.basicConsume(QUEUE_NAME, true, deliverCallback, consumerTag -&gt; &#123; &#125;); &#125;&#125; ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä½¿ç”¨try-with-resourceè¯­å¥æ¥è‡ªåŠ¨å…³é—­é€šé“å’Œè¿æ¥ï¼Ÿé€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬åªéœ€è®©ç¨‹åºç»§ç»­è¿è¡Œï¼Œå…³é—­æ‰€æœ‰å†…å®¹ï¼Œç„¶åé€€å‡ºï¼è¿™å°†æ˜¯å°´å°¬çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›åœ¨æ¶ˆè´¹è€…å¼‚æ­¥ç›‘å¬æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼Œè¯¥è¿›ç¨‹ä¿æŒæ´»åŠ¨çŠ¶æ€ã€‚ æˆ‘ä»¬å³å°†å‘Šè¯‰æœåŠ¡å™¨ä»é˜Ÿåˆ—ä¸­ä¼ é€’æ¶ˆæ¯ã€‚å› ä¸ºå®ƒä¼šå¼‚æ­¥åœ°å‘æˆ‘ä»¬å‘é€æ¶ˆæ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»¥å¯¹è±¡çš„å½¢å¼æä¾›ä¸€ä¸ªå›è°ƒï¼Œå®ƒå°†ç¼“å†²æ¶ˆæ¯ï¼Œç›´åˆ°æˆ‘ä»¬å‡†å¤‡å¥½ä½¿ç”¨å®ƒä»¬ã€‚è¿™å°±æ˜¯DeliverCallbackå­ç±»çš„ä½œç”¨ã€‚ æ¶ˆæ¯ç”Ÿäº§ä¸å‘é€æˆ‘ä»¬å…ˆæ‰§è¡Œæ¶ˆæ¯å‘é€è€…ï¼Œæ‰§è¡Œå®Œæˆåå¦‚ä¸‹å›¾ï¼š ç´§æ¥ç€ï¼Œæˆ‘ä»¬è¿›è¡Œæ¶ˆæ¯æ¶ˆè´¹ï¼Œæ‰§è¡Œå®Œæˆåå¦‚ä¸‹å›¾: å½“æ¶ˆæ¯ç”Ÿäº§è€…ä¸€ç›´å‘é€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹ç»“æœï¼š 1234567891011121315:17:00: Executing task 'Recv.main()'...&gt; Task :compileJava UP-TO-DATE&gt; Task :processResources NO-SOURCE&gt; Task :classes UP-TO-DATE&gt; Task :Recv.main()SLF4J: Failed to load class \"org.slf4j.impl.StaticLoggerBinder\".SLF4J: Defaulting to no-operation (NOP) logger implementationSLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.[*] Waiting for messages. To exit press CTRL+C[x] Received 'Hello World, litong, Welcome RabbitMQ!'[x] Received 'Hello World, lt, Welcome RabbitMQ!' æºç åœ°å€https://github.com/ltyeamin/RabbitMQ-Action/tree/master/patterns å‚è€ƒèµ„æ–™ RabbitMQå®˜ç½‘æ–‡æ¡£ ã€ŠRabbitMQå®æˆ˜æŒ‡å—ã€‹æœ±å¿ åè‘—","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://ltyeamin.github.io/tags/RabbitMQ/"}]},{"title":"RabbitMQæ¦‚è¿°","slug":"RabbitMQæ¦‚è¿°","date":"2018-06-11T11:45:21.000Z","updated":"2019-11-23T03:24:56.158Z","comments":true,"path":"2018/06/11/RabbitMQæ¦‚è¿°/","link":"","permalink":"http://ltyeamin.github.io/2018/06/11/RabbitMQæ¦‚è¿°/","excerpt":"","text":"ä¹‹æ‰€ä»¥ä»Šå¤©å†™RabbitMQå­¦ä¹ ä¸“æ ï¼Œä¸»è¦æ˜¯å› ä¸ºè‡ªå·±æ²¡æœ‰çœŸæ­£çš„ç³»ç»Ÿå­¦ä¹ è¿‡ã€‚ä¹‹å‰å·¥ä½œç»å†ä¸­éƒ½æ˜¯ä¸ºç”¨MQè€Œç”¨çš„MQï¼Œå¯¹MQæ•´ä¸ªå†…éƒ¨æœºåˆ¶æ²¡æœ‰ä¸€ä¸ªæ·±å…¥çš„äº†è§£å’Œç³»ç»Ÿçš„å­¦ä¹ ã€‚æ¯”å¦‚æˆ‘ä»¬ç”¨Spring Cloud Streamæˆ–Spring Cloud Busç»„ä»¶æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šç»å¸¸ç¢°åˆ°MQã€‚MQäº§å“å¸‚é¢ä¸Šæœ‰å¾ˆå¤šç§ï¼Œä¸åŒMQäº§å“æœ‰ä¸åŒçš„é€‚åº”åœºæ™¯(é¢†åŸŸ)ã€‚è¿™å°±å’Œå­¦ä»€ä¹ˆè¯­è¨€ä¸€æ ·ï¼Œä¸åˆ†ä»€ä¹ˆå¥½åã€‚ åœ¨è¿™æˆ‘è¦æ’ä¸Šä¸€å¥ï¼Œåœ¨è®¨è®ºæŠ€æœ¯é€‰å‹çš„æ—¶å€™ï¼Œæˆ‘ç»å¸¸å¬åˆ°å¾ˆå¤šäººè¯´å“ªç§æŠ€æœ¯å¥½ï¼Œå“ªç§æŠ€æœ¯åï¼Œå“ªç§æŠ€æœ¯æµè¡Œï¼Œå“ªç§æŠ€æœ¯æ·˜æ±°ã€‚å…¶å®æ­£è§£åº”è¯¥æ˜¯æ¯ç§æŠ€æœ¯æ–¹æ¡ˆæœ‰è‡ªå·±é€‚åº”é¢†åŸŸï¼Œå­˜åœ¨å³åˆç†ã€‚é¢è¯•çš„æ—¶å€™ç»å¸¸æœ‰é¢è¯•å®˜è¯¢é—®æŠ€æœ¯æ–¹æ¡ˆé€‰å‹ã€‚ä»€ä¹ˆSpring Cloudå’ŒDubboæ¯”ï¼ˆå‹æ ¹å°±ä¸æ˜¯ä¸€ä¸ªé¢†åŸŸï¼ŒSpring Cloudæ˜¯æ•´å¥—çš„å¾®æœåŠ¡è½åœ°æ–¹æ¡ˆï¼ŒDubboåªæ˜¯ä¸€ä¸ªå…·æœ‰å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„é«˜æ€§èƒ½RPCæ¡†æ¶ï¼Œè®ºåŠŸèƒ½Dubboåªæ˜¯Spring Cloudçš„ä¸€ä¸ªå­é›†ï¼‰ï¼Œä»€ä¹ˆRediså’ŒMongoDBæ¯”ï¼ŒESå’ŒSolræ¯”ï¼Œå„ç§MQçš„æ¯”è¾ƒï¼Œå…¶å®æˆ‘è§‰å¾—é—®è¿™äº›é¢è¯•é¢˜æ˜¯æœ‰å±€é™æ€§çš„ï¼Œæ²¡æœ‰å…·ä½“ä¸šåŠ¡åœºæ™¯å°±æ˜¯æ— è§£ï¼Œå…·ä½“é€‰å‹è¿˜æ˜¯è¦æ ¹æ®å½“å‰å…¬å¸çš„ç°æœ‰ä¸šåŠ¡å’Œç³»ç»Ÿç°çŠ¶æ¥é€‰å‹ã€‚æˆ‘è§‰å¾—é¢è¯•å®˜åº”è¯¥å…ˆæŠŠå…¬å¸çš„ä¸šåŠ¡åœºæ™¯è¯´å‡ºæ¥ï¼Œç„¶ååº”è˜è€…æ ¹æ®å…¬å¸çš„ä¸šåŠ¡è¿›è¡Œå®¢è§‚æ€§è¯„å®šã€‚ å¥½äº†ï¼Œè¨€å½’æ­£ä¼ ï¼Œå¸¸è§çš„é«˜çº§çš„MQäº§å“æœ‰RabbitMQã€Apache ActiveMQã€Apache RocketMQ(Alibabaæèµ )ã€Apache Kafka(LinkedInæèµ ) ã€‚é‚£ä¹ˆï¼Œä»Šå¤©æˆ‘è¿™é‡Œé€‰æ‹©RabbitMQè¿›è¡Œå­¦ä¹ ï¼Œå…¶ä»–MQå­¦ä¹ éƒ½æ˜¯ç›¸é€šçš„ï¼Œè¯»è€…å¯æ ¹æ®è‡ªèº«æƒ…å†µé˜…è¯»å®˜ç½‘æ–‡æ¡£å¹¶è¿›è¡Œå­¦ä¹ ã€‚æˆ‘è¿™é‡Œåªæ˜¯ä»‹ç»ä¸€ç§å­¦ä¹ æ–¹å¼ã€‚ä¸‹é¢ä»å®˜æ–¹æ–‡æ¡£ä»¥åŠå…¶ä»–èµ„æ–™ç»™å¤§å®¶è¿›è¡Œæ¢³ç†RabbitMQç³»åˆ—çš„çŸ¥è¯†ã€‚ MQæ¶ˆæ¯é˜Ÿåˆ—MQæ¦‚è¿°æ¶ˆæ¯é˜Ÿåˆ—æŠ€æœ¯æ˜¯åˆ†å¸ƒå¼åº”ç”¨é—´äº¤æ¢ä¿¡æ¯çš„ä¸€ç§æŠ€æœ¯ã€‚ æ¶ˆæ¯é˜Ÿåˆ—å¯é©»ç•™åœ¨å†…å­˜æˆ–ç£ç›˜ä¸Š,é˜Ÿåˆ—å­˜å‚¨æ¶ˆæ¯ç›´åˆ°å®ƒä»¬è¢«åº”ç”¨ç¨‹åºè¯»èµ°ã€‚ é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåº”ç”¨ç¨‹åºå¯ç‹¬ç«‹åœ°æ‰§è¡Œã€‚å®ƒä»¬ä¸éœ€è¦çŸ¥é“å½¼æ­¤çš„ä½ç½®ã€æˆ–åœ¨ç»§ç»­æ‰§è¡Œå‰ä¸éœ€è¦ç­‰å¾…æ¥æ”¶ç¨‹åºæ¥æ”¶æ­¤æ¶ˆæ¯ã€‚ MQä¸»è¦ä½œç”¨æ˜¯æ¥å—å’Œè½¬å‘æ¶ˆæ¯ã€‚ä½ å¯ä»¥æƒ³æƒ³åœ¨ç”Ÿæ´»ä¸­çš„ä¸€ç§åœºæ™¯ï¼šå½“ä½ æŠŠä¿¡ä»¶çš„æŠ•è¿›é‚®ç­’ï¼Œé‚®é€’å‘˜è‚¯å®šæœ€ç»ˆä¼šå°†ä¿¡ä»¶é€ç»™æ”¶ä»¶äººã€‚æˆ‘ä»¬å¯ä»¥æŠŠMQæ¯”ä½œ é‚®å±€å’Œé‚®é€’å‘˜ã€‚ MQå’Œé‚®å±€çš„ä¸»è¦åŒºåˆ«æ˜¯,å®ƒä¸å¤„ç†æ¶ˆæ¯,ä½†æ˜¯,å®ƒä¼šæ¥å—æ•°æ®ã€å­˜å‚¨æ¶ˆæ¯æ•°æ®ã€è½¬å‘æ¶ˆæ¯ã€‚ MQåº”ç”¨åœºæ™¯ åº”ç”¨è§£è€¦: ç³»ç»Ÿå¼‚æ­¥åŒ–æ”¹é€ ï¼› ç”¨æˆ·æ³¨å†Œåçš„é‚®ä»¶å‘é€ã€éªŒè¯ç çŸ­ä¿¡å‘é€ï¼› åˆ†å¸ƒå¼å»¶æ—¶é˜Ÿåˆ—åº”ç”¨ï¼Œç”¨æˆ·ä¸‹å•åï¼Œ24å°æ—¶æœªæ”¯ä»˜ï¼Œéœ€è¦å–æ¶ˆè®¢å•ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸‹å•æ—¶ç”¨MQå‘ä¸ªæ¶ˆæ¯é€šçŸ¥ä¸€ä¸‹ï¼Œå®¢æˆ·ç«¯å»¶æ—¶ï¼ˆä¸‹å•æ—¶é—´24å°æ—¶åï¼‰æ‰§è¡Œï¼Œæ¶ˆè´¹æˆåŠŸåˆ™è¯æ˜å–æ¶ˆè®¢å•æˆåŠŸã€‚ å¼‚æ­¥é€šçŸ¥åŠæ•°æ®åŒæ­¥: æå‡ç³»ç»Ÿæ€§èƒ½ï¼Œä¿è¯æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ï¼› ç”¨æˆ·åœ¨ç®¡ç†é¡µé¢æ›´æ–°æ•°æ®ï¼Œé€šè¿‡MQå¼‚æ­¥é€šçŸ¥ï¼Œæ›´æ–°ç¼“å­˜ã€æ›´æ–°ESæˆ–Solrç´¢å¼• åº”ç”¨é™æµ: å¯ä»¥ä¿è¯å¹¶å‘åœºæ™¯ä¸‹ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼› æŠ¢ç¥¨ç³»ç»Ÿï¼Œåœ¨å¹¶å‘å¤§ç³»ç»Ÿæœ‰ç“¶é¢ˆçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†è¯·æ±‚æ‰“åˆ°MQé˜Ÿåˆ—ä¾æ¬¡é™æµæ¶ˆè´¹ã€‚ åˆ†å¸ƒå¼æ—¥å¿—ç³»ç»Ÿæ•°æ®å¾ˆå¤§çš„æ—¶å€™ï¼ŒMQä½œä¸ºåˆ†å¸ƒå¼æ—¥å¿—çš„ç¼“å†²å±‚ï¼Œå…¸å‹åº”ç”¨å°±æ˜¯ELK+Kafakaã€‚ æ•°æ®åˆ†å‘: ä¸€å¯¹å¤šæˆ–å¹¿æ’­çš„æ¨¡å¼è¿›è¡Œæ•°æ®åˆ†å‘ï¼› æ”¯ä»˜å®Œæˆåï¼Œéœ€è¦åŠæ—¶çš„é€šçŸ¥å­ç³»ç»Ÿï¼ˆè¿›é”€å­˜ç³»ç»Ÿå‘è´§ï¼Œç”¨æˆ·æœåŠ¡ç§¯åˆ†ï¼Œå‘é€çŸ­ä¿¡ï¼‰ åˆ†å¸ƒå¼äº‹åŠ¡: åˆ†å¸ƒå¼æ¶æ„çš„ç³»ç»Ÿå¯ä»¥é€šè¿‡MQçš„é˜Ÿåˆ—æ•°æ®è¿›è¡Œæ•°æ®å›æ»šæ“ä½œ RabbitMQäº§å“ä»‹ç»RabbitMQäº§å“æ‰“å¼€RabbitMQå®˜ç½‘é¦–é¡µï¼Œèƒ½çœ‹åˆ°å¦‚ä¸‹çš„ä¸€å¥è¯: RabbitMQ is the most widely deployed open source message broker. ç¿»è¯‘ä¸ºï¼šRabbitMQæ˜¯éƒ¨ç½²æœ€å¹¿æ³›çš„å¼€æºæ¶ˆæ¯ä»£ç†ã€‚ RabbitMQæ˜¯ä¸€ä¸ªErlangå¼€å‘çš„AMQPï¼ˆAdvanced Message Queuing Protocol ï¼‰çš„å¼€æºå®ç°ã€‚AMQP çš„å‡ºç°å…¶å®ä¹Ÿæ˜¯åº”äº†å¹¿å¤§äººæ°‘ç¾¤ä¼—çš„éœ€æ±‚ï¼Œè™½ç„¶åœ¨åŒæ­¥æ¶ˆæ¯é€šè®¯çš„ä¸–ç•Œé‡Œæœ‰å¾ˆå¤šå…¬å¼€æ ‡å‡†ï¼ˆå¦‚ Cobarï¼‰çš„ IIOP ï¼Œæˆ–è€…æ˜¯ SOAP ç­‰ï¼‰ï¼Œä½†æ˜¯åœ¨å¼‚æ­¥æ¶ˆæ¯å¤„ç†ä¸­å´ä¸æ˜¯è¿™æ ·ï¼Œåªæœ‰å¤§ä¼ä¸šæœ‰ä¸€äº›å•†ä¸šå®ç°ï¼ˆå¦‚å¾®è½¯çš„ MSMQ ï¼ŒIBM çš„ WebSphere MQ ç­‰ï¼‰ï¼Œå› æ­¤ï¼Œåœ¨ 2006 å¹´çš„ 6 æœˆï¼ŒCisco ã€Red Hatã€iMatix ç­‰è”åˆåˆ¶å®šäº† AMQP çš„å…¬å¼€æ ‡å‡†ã€‚ RabbitMQç”±RabbitMQ Technologies Ltdå¼€å‘å¹¶ä¸”æä¾›å•†ä¸šæ”¯æŒçš„ã€‚è¯¥å…¬å¸åœ¨2010å¹´4æœˆè¢«SpringSourceï¼ˆVMwareçš„ä¸€ä¸ªéƒ¨é—¨ï¼‰æ”¶è´­ã€‚åœ¨2013å¹´5æœˆè¢«å¹¶å…¥Pivotalã€‚å…¶å®VMwareï¼ŒPivotalå’ŒEMCæœ¬è´¨ä¸Šæ˜¯ä¸€å®¶çš„ã€‚ä¸åŒçš„æ˜¯ï¼ŒVMwareæ˜¯ç‹¬ç«‹ä¸Šå¸‚å­å…¬å¸ï¼Œè€ŒPivotalæ˜¯æ•´åˆäº†EMCçš„æŸäº›èµ„æºï¼Œç°åœ¨å¹¶æ²¡æœ‰ä¸Šå¸‚ã€‚ RabbitMQäº§å“ç‰¹æ€§ å¼€æºå…è´¹ï¼› å¯ä¼¸ç¼©æ€§ï¼šé›†ç¾¤æœåŠ¡ï¼› æ¶ˆæ¯æŒä¹…åŒ–ï¼šä»å†…å­˜æŒä¹…åŒ–æ¶ˆæ¯åˆ°ç¡¬ç›˜ï¼Œå†ä»ç¡¬ç›˜åŠ è½½åˆ°å†…å­˜ï¼› å¤šè¯­è¨€å¤šå®¢æˆ·ç«¯æ”¯æŒï¼Œæ”¯æŒPythonã€Javaã€Rubyã€PHPã€C#ã€JavaScriptã€Goã€Elixirã€Objective-Cã€Swiftã€Spring AMQPã€‚ RabbitMQå¸¸ç”¨æ¨¡å¼æ‰“å¼€å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬çœ¼å‰ä¸€äº®ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹6ç§RabbitMQçš„å·¥ä½œæ¨¡å¼ï¼š 1. â€œHello World!â€ The simplest thing that does something Java Spring AMQP 2. Work queues Distributing tasks among workers (the competing consumers pattern) Java Spring AMQP 3. Publish/Subscribe Sending messages to many consumers at once Java Spring AMQP 4. RoutingReceiving messages selectively Java Spring AMQP 5. Topics The simplest thing that does something Java Spring AMQP 6. RPC Request/reply patternexample Java Spring AMQP çœ‹åˆ°ä¸Šè¿°çš„6ç§å·¥ä½œæ¨¡å¼ï¼Œå…¶ä¸­æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨æœ€å¤šçš„æ˜¯å‰5ç§æ¨¡å¼ï¼Œæˆ‘ä»¬åˆ—ä¸€ä¸ªå­¦ä¹ åˆ—è¡¨: ç®€å•æ¨¡å¼: ä¸€ä¸ªç”Ÿäº§è€…ï¼Œä¸€ä¸ªæ¶ˆè´¹è€… Workæ¨¡å¼: ä¸€ä¸ªç”Ÿäº§è€…ï¼Œå¤šä¸ªæ¶ˆè´¹è€…ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…è·å–åˆ°çš„æ¶ˆæ¯å”¯ä¸€ã€‚ è®¢é˜…æ¨¡å¼: ä¸€ä¸ªç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ä¼šè¢«å¤šä¸ªæ¶ˆè´¹è€…è·å–ã€‚ è·¯ç”±æ¨¡å¼: å‘é€æ¶ˆæ¯åˆ°äº¤æ¢æœºå¹¶ä¸”è¦æŒ‡å®šè·¯ç”±key ï¼Œæ¶ˆè´¹è€…å°†é˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœºæ—¶éœ€è¦æŒ‡å®šè·¯ç”±key Topicæ¨¡å¼: å°†è·¯ç”±é”®å’ŒæŸæ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œæ­¤æ—¶é˜Ÿåˆ—éœ€è¦ç»‘å®šåœ¨ä¸€ä¸ªæ¨¡å¼ä¸Šï¼Œâ€œ#â€åŒ¹é…ä¸€ä¸ªè¯æˆ–å¤šä¸ªè¯ï¼Œâ€œ*â€åªåŒ¹é…ä¸€ä¸ªè¯ã€‚ RPCè¿œç¨‹è°ƒç”¨ï¼šå‡ ä¹ä¸ç”¨ï¼Œæš‚æ—¶å…ˆä¸è€ƒè™‘ å‚è€ƒèµ„æ–™ RabbitMQå®˜ç½‘å¿«é€Ÿå…¥é—¨æ–‡æ¡£ ã€ŠRabbitMQå®æˆ˜æŒ‡å—ã€‹æœ±å¿ åè‘— ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"RabbitMQ","slug":"RabbitMQ","permalink":"http://ltyeamin.github.io/tags/RabbitMQ/"}]},{"title":"Dockerå®‰è£…åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶-RabbitMQ","slug":"Dockerå®‰è£…åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶-RabbitMQ","date":"2018-06-10T11:45:21.000Z","updated":"2019-11-20T15:08:54.561Z","comments":true,"path":"2018/06/10/Dockerå®‰è£…åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶-RabbitMQ/","link":"","permalink":"http://ltyeamin.github.io/2018/06/10/Dockerå®‰è£…åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶-RabbitMQ/","excerpt":"","text":"RabbitMQæ˜¯æµè¡Œçš„å¼€æºæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œé‡‡ç”¨å¤©ç”ŸæŠ—å¹¶å‘çš„erlangè¯­è¨€å¼€å‘ã€‚RabbitMQæ˜¯AMQPï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰çš„æ ‡å‡†å®ç°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡Dockerçš„æ–¹å¼å®‰è£…RabbitMQã€‚ æŸ¥çœ‹RabbitMQç‰ˆæœ¬è¿›å…¥docker hubå®˜æ–¹é•œåƒä»“åº“æˆ–é˜¿é‡Œdockeré•œåƒåº“,æœç´¢rabbitmqé•œåƒã€‚ å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å‘½ä»¤æœç´¢: 1docker search rabbitmq:management è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨webé¡µé¢æœç´¢ï¼Œæœç´¢åç‚¹å‡»è¯¦æƒ…é¡µé¢ã€‚ è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å¸¦æœ‰managementçš„ç‰ˆæœ¬ï¼Œæ­¤ç‰ˆæœ¬åŒ…å«webå¯è§†åŒ–ç®¡ç†é¡µé¢ã€‚ Dockeræ‹‰å–é•œåƒ1docker pull rabbitmq:3.7.14-management è¾“å…¥ä»¥ä¸Šå‘½ä»¤åï¼Œé•œåƒåˆ†ç‰‡å¼€å§‹ä¸‹è½½å¹¶å®Œæˆrabbitmqé•œåƒçš„åˆå¹¶ã€‚ä¸‹è½½å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢è¾“å…¥ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰æœ¬åœ°ä»“åº“æ‰€æœ‰çš„é•œåƒæ–‡ä»¶ã€‚ 1docker images å¦‚å›¾ åˆ›å»ºå¹¶å¯åŠ¨RabbitMQåº”ç”¨å®¹å™¨1docker run -d -p 5672:5672 -p 15672:15672 --name rabbitmq rabbitmq:3.7.14-management æ‰§è¡Œä¸Šè¿°å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªrabbitmqçš„dockerå®¹å™¨ï¼Œæ‰§è¡ŒæˆåŠŸåå›è¿”å›dockerå®¹å™¨IDã€‚ 12Yeamin:~ mac$ docker run -d -p 5672:5672 -p 15672:15672 --name rabbitmq rabbitmq:3.7.14-management5b2658f3fe04919883b4d0b3d2766220e1ecb983d715b5b6cbfec758634f2531 åˆ›å»ºå‚æ•°è§£é‡Š-d åå°è¿è¡Œå®¹å™¨ï¼› â€“name æŒ‡å®šå®¹å™¨åï¼› -p æŒ‡å®šæœåŠ¡è¿è¡Œçš„ç«¯å£ï¼ˆ5672ï¼šåº”ç”¨è®¿é—®ç«¯å£ï¼›15672ï¼šæ§åˆ¶å°Webç«¯å£å·ï¼‰ï¼› -v æ˜ å°„ç›®å½•æˆ–æ–‡ä»¶ï¼› â€“hostname ä¸»æœºåï¼ˆRabbitMQçš„ä¸€ä¸ªé‡è¦æ³¨æ„äº‹é¡¹æ˜¯å®ƒæ ¹æ®æ‰€è°“çš„ â€œèŠ‚ç‚¹åç§°â€ å­˜å‚¨æ•°æ®ï¼Œé»˜è®¤ä¸ºä¸»æœºåï¼‰ï¼› -e æŒ‡å®šç¯å¢ƒå˜é‡ï¼›ï¼ˆRABBITMQ_DEFAULT_VHOSTï¼šé»˜è®¤è™šæ‹Ÿæœºåï¼›RABBITMQ_DEFAULT_USERï¼šé»˜è®¤çš„ç”¨æˆ·åï¼›RABBITMQ_DEFAULT_PASSï¼šé»˜è®¤ç”¨æˆ·åçš„å¯†ç ï¼Œæˆ‘è¿™é‡Œæ²¡é…ç½®ï¼‰ å¯åŠ¨rabbitmqåº”ç”¨å®¹å™¨æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå¯åŠ¨ 1Docker start å®¹å™¨idå‰å››ä½ æˆ‘è¿™é‡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ‰§è¡Œ 1docker start 5b26 æŸ¥è¯¢è¿è¡ŒçŠ¶æ€æ‰§è¡Œdocker psæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨çŠ¶æ€ 12345Yeamin:~ mac$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES5b2658f3fe04 rabbitmq:3.7.14-management \"docker-entrypoint.sâ€¦\" 30 minutes ago Up 30 minutes 4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, 15671/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp rabbitmq RabbitMQçš„WEBæ§åˆ¶å°åœ¨æµè§ˆå™¨æ‰“å¼€http://localhost:15672,è¿›å…¥ç™»å½•é¡µé¢ï¼Œé»˜è®¤è´¦å·å’Œå¯†ç éƒ½ä¸ºguestã€‚ å‚è€ƒèµ„æ–™ Dockerå®˜ç½‘ RabbitMQå®˜ç½‘","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"http://ltyeamin.github.io/tags/Docker/"}]},{"title":"ã€ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘çº¿ç¨‹æ± åº”ç”¨ä¹‹Executorsçº¿ç¨‹æ± é™æ€å·¥å‚","slug":"ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘çº¿ç¨‹æ± åº”ç”¨ä¹‹Executorsçº¿ç¨‹æ± é™æ€å·¥å‚","date":"2018-06-09T16:12:11.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2018/06/10/ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘çº¿ç¨‹æ± åº”ç”¨ä¹‹Executorsçº¿ç¨‹æ± é™æ€å·¥å‚/","link":"","permalink":"http://ltyeamin.github.io/2018/06/10/ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘çº¿ç¨‹æ± åº”ç”¨ä¹‹Executorsçº¿ç¨‹æ± é™æ€å·¥å‚/","excerpt":"","text":"ä»Šå¤©æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹ï¼Œçº¿ç¨‹æ± çš„é™æ€å·¥å‚Executorsç±»ï¼Œå¹³æ—¶å†™æµ‹è¯•ä»£ç çš„æ—¶å€™å¯ç”¨ä¸€ç”¨ï¼Œç”Ÿäº§ä»£ç å°½é‡å°‘ç”¨ã€‚ä¸ºä»€ä¹ˆè¯´ç”Ÿäº§ä¸Šå°½é‡å°‘ç”¨å‘¢ï¼Ÿè¿™æ˜¯æœ‰åŸå› çš„ï¼Œè¯·è€å¿ƒå¬å½¤å“¥è®²è§£ã€‚ é˜¿é‡Œçš„ä»£ç è§„çº¦ä¸å»ºè®®ä½¿ç”¨è¿™æ ·çš„å·¥å‚ç±»ï¼Œè€Œå»ºè®®ä½¿ç”¨æ‰‹åŠ¨åˆ›å»ºå¹¶ç®¡ç†ThreadPoolExecutorï¼Œåœ¨é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œä¸­ï¼Œç¼–ç¨‹è§„çº¦ä¸‹çš„å¹¶å‘å¤„ç†è§„çº¦ç¬¬4ç‚¹å¦‚ä¸‹ï¼š ã€å¼ºåˆ¶ã€‘çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨Executorså»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ThreadPoolExecutorçš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚è¯´æ˜ï¼šExecutorsè¿”å›çš„çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹ï¼š 1ï¼‰FixedThreadPoolå’ŒSingleThreadPool: å…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸ºInteger.MAX_VALUEï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´OOMã€‚ 2ï¼‰CachedThreadPoolå’ŒScheduledThreadPool: å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡ä¸ºInteger.MAX_VALUEï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´OOMã€‚ æ­£ä¾‹ 1ï¼š 1234&gt; //org.apache.commons.lang3.concurrent.BasicThreadFactory&gt; ScheduledExecutorService executorService = new ScheduledThreadPoolExecutor(1,&gt; new BasicThreadFactory.Builder().namingPattern(\"example-schedule-pool-%d\").daemon(true).build());&gt; æ­£ä¾‹ 2ï¼š 123456789&gt; ThreadFactory namedThreadFactory = new ThreadFactoryBuilder()&gt; .setNameFormat(\"demo-pool-%d\").build();&gt; //Common Thread Pool&gt; ExecutorService pool = new ThreadPoolExecutor(5, 200,&gt; 0L, TimeUnit.MILLISECONDS,&gt; new LinkedBlockingQueue&lt;Runnable&gt;(1024), namedThreadFactory, new ThreadPoolExecutor.AbortPolicy());&gt; pool.execute(()-&gt; System.out.println(Thread.currentThread().getName()));&gt; pool.shutdown();//gracefully shutdown &gt; 12345678910111213&gt; æ­£ä¾‹ 3ï¼š&gt; &lt;bean id=\"userThreadPool\" class=\"org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor\"&gt;&gt; &lt;property name=\"corePoolSize\" value=\"10\" /&gt;&gt; &lt;property name=\"maxPoolSize\" value=\"100\" /&gt;&gt; &lt;property name=\"queueCapacity\" value=\"2000\" /&gt;&gt; &lt;property name=\"threadFactory\" value= threadFactory /&gt;&gt; &lt;property name=\"rejectedExecutionHandler\"&gt;&gt; &lt;ref local=\"rejectedExecutionHandler\" /&gt;&gt; &lt;/property&gt;&gt; &lt;/bean&gt;&gt; //in code&gt; userThreadPool.execute(thread);&gt; çœ‹åˆ°å¦‚ä¸‹çš„è§„çº¦ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯æ²¡å¿…è¦å¾€ä¸‹å­¦äº†ï¼Ÿç­”æ¡ˆæ˜¯å½“ç„¶ä¸è¡Œçš„ï¼Œæˆ‘ä»¬è™½ç„¶ä¸æ€ä¹ˆç”¨ï¼Œä½†æ˜¯ç ”ç©¶å…¶æºç ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ›´æ·±å…¥çº¿ç¨‹æ± åŸç†ï¼ˆå¢å¼ºå†…åŠ›ï¼‰ï¼Œä½¿å¾—æˆ‘ä»¬ä»¥åæ›´å®¹æ˜“è®¾è®¡çº¿ç¨‹æ± å¹¶èƒ½å¤Ÿé«˜æ•ˆç®¡ç†çº¿ç¨‹ï¼Œä»¥è‡³äºä¸åƒä»£ç è§„çº¦æè¿°çš„é‚£æ ·ï¼šç”¨è€Œä¸å½“å¯¼è‡´OOMçš„é—®é¢˜ã€‚ æºç åˆ†æå¥½äº†ï¼Œè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šèœ(æºç )ï¼Œå¤Ÿæˆ‘ä»¬ä»Šå¤©å–å‡ å£¶äº†ï¼Œå“ˆå“ˆã€‚ã€‚ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573package java.util.concurrent;import java.util.*;import java.util.concurrent.atomic.AtomicInteger;import java.security.AccessControlContext;import java.security.AccessController;import java.security.PrivilegedAction;import java.security.PrivilegedExceptionAction;import java.security.PrivilegedActionException;import java.security.AccessControlException;import sun.security.util.SecurityConstants;/** * Executorsçº¿ç¨‹æ± é™æ€å·¥å‚ç±» */public class Executors &#123; /** * åˆ›å»ºé‡ç”¨å›ºå®šæ•°é‡çº¿ç¨‹çš„çº¿ç¨‹æ± ,ä½¿ç”¨çš„æ˜¯å…±äº«æ— å‚æ— è¾¹ç•Œé˜Ÿåˆ—ã€‚ * åœ¨ä»»ä½•æ—¶å€™ï¼Œæœ€å¤šçº¿ç¨‹å°†æ˜¯æ´»åŠ¨çš„å¤„ç†ä»»åŠ¡ã€‚ * å¦‚æœåœ¨æ‰€æœ‰çº¿ç¨‹éƒ½å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶æäº¤äº†å…¶ä»–ä»»åŠ¡ï¼Œå®ƒä»¬å°†åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œç›´åˆ°çº¿ç¨‹å¯ç”¨ã€‚ * åœ¨å…³é—­ä¹‹å‰ï¼Œå¦‚æœä»»ä½•çº¿ç¨‹åœ¨æ‰§è¡ŒæœŸé—´å› å¤±è´¥è€Œç»ˆæ­¢,å¦‚æœéœ€è¦ï¼Œå°†æ›´æ¢ä¸€ä¸ªæ–°çš„ï¼Œæ‰§è¡Œåç»­ä»»åŠ¡ã€‚ * æ± ä¸­çš„çº¿ç¨‹å°†å­˜åœ¨ç›´åˆ°å®ƒæ˜¾å¼executerserviceå…³é—­ã€‚ */ public static ExecutorService newFixedThreadPool(int nThreads) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;()); &#125; /** * è¯¥æ–¹æ³•æ˜¯JDk8æä¾›çš„ã€‚ç‰¹æ®Šçš„çº¿ç¨‹æ± ï¼Œé‡‡ç”¨JDK1.7çš„ForkJoinPoolå®ç° * åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œä»¥ç»´æŠ¤è¶³å¤Ÿçš„çº¿ç¨‹æ¥æ”¯æŒç»™å®šçš„å¹¶è¡Œçº§åˆ«ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨å¤šä¸ªé˜Ÿåˆ—æ¥å‡å°‘äº‰ç”¨ã€‚ * å¹³è¡Œåº¦çº§åˆ«å¯¹åº”äºä¸»åŠ¨å‚ä¸æˆ–å¯ç”¨äºçš„çº¿ç¨‹çš„æœ€å¤§æ•°ç›®ä»äº‹ï¼Œä»»åŠ¡å¤„ç†ã€‚ * å®é™…çº¿ç¨‹æ•°å¯èƒ½åŠ¨æ€å¢é•¿å’Œæ”¶ç¼©ã€‚å·å·¥å‡æ–™æ˜¯ä¸è¡Œçš„ï¼Œä¿è¯æäº¤ä»»åŠ¡çš„é¡ºåºæ‰§è¡Œã€‚ * * @param å¹¶è¡Œçº§åˆ« */ public static ExecutorService newWorkStealingPool(int parallelism) &#123; return new ForkJoinPool (parallelism, ForkJoinPool.defaultForkJoinWorkerThreadFactory, null, true); &#125; /** * é‡è½½æ–¹æ³•: åªæ˜¯é»˜è®¤å‚æ•°ç”¨çš„æ˜¯å½“å‰æœºå™¨å¯åˆ©ç”¨CPUæ ¸æ•° */ public static ExecutorService newWorkStealingPool() &#123; return new ForkJoinPool (Runtime.getRuntime().availableProcessors(), ForkJoinPool.defaultForkJoinWorkerThreadFactory, null, true); &#125; /** * é‡è½½æ–¹æ³•: åˆ›å»ºé‡ç”¨å›ºå®šæ•°é‡çº¿ç¨‹çš„çº¿ç¨‹æ±  * åªä¸è¿‡å‚æ•°å¤šäº†ä¸€ä¸ªï¼Œå¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹æ± å·¥å‚ */ public static ExecutorService newFixedThreadPool(int nThreads, ThreadFactory threadFactory) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(), threadFactory); &#125; /** * åˆ›å»ºä½¿ç”¨å•ä¸ªå·¥ä½œçº¿ç¨‹æ“ä½œçš„æ‰§è¡Œå™¨ï¼Œå³å•çº¿ç¨‹å·¥ä½œæ¨¡å¼ï¼Œä¸å¯é…ç½®çº¿ç¨‹çš„å¤§å°ã€‚ * ä¹Ÿæ˜¯åœ¨ä¸€ä¸ªæ— è¾¹ç•Œçš„é˜Ÿåˆ—ä¸­è¿è¡Œçš„ã€‚ç›¸å½“äºnewFixedThreadPool(1)ï¼Œ * åœ¨ä»»ä½•æ—¶åˆ»ï¼Œå½“å‰çº¿ç¨‹æ± åªæœ‰1ä¸ªæ´»åŠ¨çº¿ç¨‹ï¼Œä¸å¯èƒ½å‡ºç°å…¶ä»–çš„å·¥ä½œçº¿ç¨‹ã€‚ */ public static ExecutorService newSingleThreadExecutor() &#123; return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;())); &#125; /** * é‡è½½æ–¹æ³•: åˆ›å»ºä½¿ç”¨å•ä¸ªå·¥ä½œçº¿ç¨‹æ“ä½œçš„æ‰§è¡Œå™¨ï¼Œå³å•çº¿ç¨‹å·¥ä½œæ¨¡å¼ï¼Œä¸å¯é…ç½®çº¿ç¨‹çš„å¤§å°ã€‚ * åªä¸è¿‡å¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹æ± å·¥å‚ */ public static ExecutorService newSingleThreadExecutor(ThreadFactory threadFactory) &#123; return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(), threadFactory)); &#125; /** * åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨çš„çº¿ç¨‹æ± : æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹ï¼Œä½†å°†é‡ç”¨ä»¥å‰æ„é€ çš„çº¿ç¨‹å¯ç”¨ã€‚ * æ‰§è¡Œè®¸å¤šçŸ­æœŸå¼‚æ­¥ä»»åŠ¡çš„ç¨‹åºï¼Œä½¿ç”¨è¿™ç±»çº¿ç¨‹æ± å¯ä»¥æå‡ç¨‹åºæ€§èƒ½ã€‚ * å¦‚æœæ²¡æœ‰çº¿ç¨‹å¯ç”¨ï¼Œåˆ™çº¿ç¨‹è¢«åˆ›å»ºå¹¶æ·»åŠ åˆ°æ± ä¸­ã€‚ * å…·æœ‰60ç§’æœªä½¿ç”¨çš„çº¿ç¨‹ï¼Œçº¿ç¨‹æ± åˆ™å›æ”¶è¯¥çº¿ç¨‹ã€‚ * å¦‚æœçº¿ç¨‹å¯ç”¨ï¼Œåˆ™é‡ç”¨ä¹‹å‰çš„æ´»åŠ¨çº¿ç¨‹ã€‚ * å¦‚æœä½¿ç”¨ä¸å½“å¯èƒ½å¯¼è‡´OOMã€‚ */ public static ExecutorService newCachedThreadPool() &#123; return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;()); &#125; /** * é‡è½½æ–¹æ³•: åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨çš„çº¿ç¨‹æ±  * åªä¸è¿‡å¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹æ± å·¥å‚ * å¦‚æœä½¿ç”¨ä¸å½“å¯èƒ½å¯¼è‡´OOMã€‚ */ public static ExecutorService newCachedThreadPool(ThreadFactory threadFactory) &#123; return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;(), threadFactory); &#125; /** * åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„å»¶è¿Ÿä»»åŠ¡çº¿ç¨‹æ± ï¼Œå¯ä»£æ›¿Timer(ä½¿ç”¨ç¹çï¼Œçº¿ç¨‹ä¸å®‰å…¨ç±»)ï¼Œ */ public static ScheduledExecutorService newSingleThreadScheduledExecutor() &#123; return new DelegatedScheduledExecutorService (new ScheduledThreadPoolExecutor(1)); &#125; /** * é‡è½½æ–¹æ³•: åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„å»¶è¿Ÿä»»åŠ¡çº¿ç¨‹æ± ï¼Œå¯ä»£æ›¿Timer(ä½¿ç”¨ç¹çï¼Œçº¿ç¨‹ä¸å®‰å…¨ç±»)ï¼Œ * åªä¸è¿‡å¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹æ± å·¥å‚ * */ public static ScheduledExecutorService newSingleThreadScheduledExecutor(ThreadFactory threadFactory) &#123; return new DelegatedScheduledExecutorService (new ScheduledThreadPoolExecutor(1, threadFactory)); &#125; /** * é‡è½½æ–¹æ³•: åˆ›å»ºä¸€ä¸ªå»¶è¿Ÿä»»åŠ¡çº¿ç¨‹æ±  * åªä¸è¿‡å¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹æ± æ ¸å¿ƒå¤§å° * */ public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) &#123; return new ScheduledThreadPoolExecutor(corePoolSize); &#125; /** * é‡è½½æ–¹æ³•: åˆ›å»ºä¸€ä¸ªå»¶è¿Ÿä»»åŠ¡çº¿ç¨‹æ±  * åªä¸è¿‡å¯ä»¥è‡ªå®šä¹‰çº¿ç¨‹æ± æ ¸å¿ƒå¤§å°å’Œæœ€å¤§çº¿ç¨‹æ•°é‡ * */ public static ScheduledExecutorService newScheduledThreadPool( int corePoolSize, ThreadFactory threadFactory) &#123; return new ScheduledThreadPoolExecutor(corePoolSize, threadFactory); &#125; /** * Returns an object that delegates all defined &#123;@link * ExecutorService&#125; methods to the given executor, but not any * other methods that might otherwise be accessible using * casts. This provides a way to safely \"freeze\" configuration and * disallow tuning of a given concrete implementation. * @param executor the underlying implementation * @return an &#123;@code ExecutorService&#125; instance * @throws NullPointerException if executor null */ public static ExecutorService unconfigurableExecutorService(ExecutorService executor) &#123; if (executor == null) throw new NullPointerException(); return new DelegatedExecutorService(executor); &#125; /** * Returns an object that delegates all defined &#123;@link * ScheduledExecutorService&#125; methods to the given executor, but * not any other methods that might otherwise be accessible using * casts. This provides a way to safely \"freeze\" configuration and * disallow tuning of a given concrete implementation. * @param executor the underlying implementation * @return a &#123;@code ScheduledExecutorService&#125; instance * @throws NullPointerException if executor null */ public static ScheduledExecutorService unconfigurableScheduledExecutorService(ScheduledExecutorService executor) &#123; if (executor == null) throw new NullPointerException(); return new DelegatedScheduledExecutorService(executor); &#125; /** * Returns a default thread factory used to create new threads. * This factory creates all new threads used by an Executor in the * same &#123;@link ThreadGroup&#125;. If there is a &#123;@link * java.lang.SecurityManager&#125;, it uses the group of &#123;@link * System#getSecurityManager&#125;, else the group of the thread * invoking this &#123;@code defaultThreadFactory&#125; method. Each new * thread is created as a non-daemon thread with priority set to * the smaller of &#123;@code Thread.NORM_PRIORITY&#125; and the maximum * priority permitted in the thread group. New threads have names * accessible via &#123;@link Thread#getName&#125; of * &lt;em&gt;pool-N-thread-M&lt;/em&gt;, where &lt;em&gt;N&lt;/em&gt; is the sequence * number of this factory, and &lt;em&gt;M&lt;/em&gt; is the sequence number * of the thread created by this factory. * @return a thread factory */ public static ThreadFactory defaultThreadFactory() &#123; return new DefaultThreadFactory(); &#125; /** * Returns a thread factory used to create new threads that * have the same permissions as the current thread. * This factory creates threads with the same settings as &#123;@link * Executors#defaultThreadFactory&#125;, additionally setting the * AccessControlContext and contextClassLoader of new threads to * be the same as the thread invoking this * &#123;@code privilegedThreadFactory&#125; method. A new * &#123;@code privilegedThreadFactory&#125; can be created within an * &#123;@link AccessController#doPrivileged AccessController.doPrivileged&#125; * action setting the current thread's access control context to * create threads with the selected permission settings holding * within that action. * * &lt;p&gt;Note that while tasks running within such threads will have * the same access control and class loader settings as the * current thread, they need not have the same &#123;@link * java.lang.ThreadLocal&#125; or &#123;@link * java.lang.InheritableThreadLocal&#125; values. If necessary, * particular values of thread locals can be set or reset before * any task runs in &#123;@link ThreadPoolExecutor&#125; subclasses using * &#123;@link ThreadPoolExecutor#beforeExecute(Thread, Runnable)&#125;. * Also, if it is necessary to initialize worker threads to have * the same InheritableThreadLocal settings as some other * designated thread, you can create a custom ThreadFactory in * which that thread waits for and services requests to create * others that will inherit its values. * * @return a thread factory * @throws AccessControlException if the current access control * context does not have permission to both get and set context * class loader */ public static ThreadFactory privilegedThreadFactory() &#123; return new PrivilegedThreadFactory(); &#125; /** * Returns a &#123;@link Callable&#125; object that, when * called, runs the given task and returns the given result. This * can be useful when applying methods requiring a * &#123;@code Callable&#125; to an otherwise resultless action. * @param task the task to run * @param result the result to return * @param &lt;T&gt; the type of the result * @return a callable object * @throws NullPointerException if task null */ public static &lt;T&gt; Callable&lt;T&gt; callable(Runnable task, T result) &#123; if (task == null) throw new NullPointerException(); return new RunnableAdapter&lt;T&gt;(task, result); &#125; /** * Returns a &#123;@link Callable&#125; object that, when * called, runs the given task and returns &#123;@code null&#125;. * @param task the task to run * @return a callable object * @throws NullPointerException if task null */ public static Callable&lt;Object&gt; callable(Runnable task) &#123; if (task == null) throw new NullPointerException(); return new RunnableAdapter&lt;Object&gt;(task, null); &#125; /** * Returns a &#123;@link Callable&#125; object that, when * called, runs the given privileged action and returns its result. * @param action the privileged action to run * @return a callable object * @throws NullPointerException if action null */ public static Callable&lt;Object&gt; callable(final PrivilegedAction&lt;?&gt; action) &#123; if (action == null) throw new NullPointerException(); return new Callable&lt;Object&gt;() &#123; public Object call() &#123; return action.run(); &#125;&#125;; &#125; /** * Returns a &#123;@link Callable&#125; object that, when * called, runs the given privileged exception action and returns * its result. * @param action the privileged exception action to run * @return a callable object * @throws NullPointerException if action null */ public static Callable&lt;Object&gt; callable(final PrivilegedExceptionAction&lt;?&gt; action) &#123; if (action == null) throw new NullPointerException(); return new Callable&lt;Object&gt;() &#123; public Object call() throws Exception &#123; return action.run(); &#125;&#125;; &#125; /** * Returns a &#123;@link Callable&#125; object that will, when called, * execute the given &#123;@code callable&#125; under the current access * control context. This method should normally be invoked within * an &#123;@link AccessController#doPrivileged AccessController.doPrivileged&#125; * action to create callables that will, if possible, execute * under the selected permission settings holding within that * action; or if not possible, throw an associated &#123;@link * AccessControlException&#125;. * @param callable the underlying task * @param &lt;T&gt; the type of the callable's result * @return a callable object * @throws NullPointerException if callable null */ public static &lt;T&gt; Callable&lt;T&gt; privilegedCallable(Callable&lt;T&gt; callable) &#123; if (callable == null) throw new NullPointerException(); return new PrivilegedCallable&lt;T&gt;(callable); &#125; public static &lt;T&gt; Callable&lt;T&gt; privilegedCallableUsingCurrentClassLoader(Callable&lt;T&gt; callable) &#123; if (callable == null) throw new NullPointerException(); return new PrivilegedCallableUsingCurrentClassLoader&lt;T&gt;(callable); &#125; // Non-public classes supporting the public methods /** * è¿è¡Œç»™å®šä»»åŠ¡å¹¶è¿”å›ç»™å®šç»“æœçš„å¯è°ƒç”¨æ–‡ä»¶ */ static final class RunnableAdapter&lt;T&gt; implements Callable&lt;T&gt; &#123; final Runnable task; final T result; RunnableAdapter(Runnable task, T result) &#123; this.task = task; this.result = result; &#125; public T call() &#123; task.run(); return result; &#125; &#125; /** * åœ¨å·²å»ºç«‹çš„è®¿é—®æ§åˆ¶è®¾ç½®ä¸‹è¿è¡Œçš„å¯è°ƒç”¨æ–‡ä»¶ */ static final class PrivilegedCallable&lt;T&gt; implements Callable&lt;T&gt; &#123; private final Callable&lt;T&gt; task; private final AccessControlContext acc; PrivilegedCallable(Callable&lt;T&gt; task) &#123; this.task = task; this.acc = AccessController.getContext(); &#125; public T call() throws Exception &#123; try &#123; return AccessController.doPrivileged( new PrivilegedExceptionAction&lt;T&gt;() &#123; public T run() throws Exception &#123; return task.call(); &#125; &#125;, acc); &#125; catch (PrivilegedActionException e) &#123; throw e.getException(); &#125; &#125; &#125; /** * åœ¨å·²å»ºç«‹çš„è®¿é—®æ§åˆ¶è®¾ç½®å’Œå½“å‰ç±»åŠ è½½å™¨ä¸‹è¿è¡Œçš„å¯è°ƒç”¨æ–‡ä»¶ã€‚ */ static final class PrivilegedCallableUsingCurrentClassLoader&lt;T&gt; implements Callable&lt;T&gt; &#123; private final Callable&lt;T&gt; task; private final AccessControlContext acc; private final ClassLoader ccl; PrivilegedCallableUsingCurrentClassLoader(Callable&lt;T&gt; task) &#123; SecurityManager sm = System.getSecurityManager(); if (sm != null) &#123; // Calls to getContextClassLoader from this class // never trigger a security check, but we check // whether our callers have this permission anyways. sm.checkPermission(SecurityConstants.GET_CLASSLOADER_PERMISSION); // Whether setContextClassLoader turns out to be necessary // or not, we fail fast if permission is not available. sm.checkPermission(new RuntimePermission(\"setContextClassLoader\")); &#125; this.task = task; this.acc = AccessController.getContext(); this.ccl = Thread.currentThread().getContextClassLoader(); &#125; public T call() throws Exception &#123; try &#123; return AccessController.doPrivileged( new PrivilegedExceptionAction&lt;T&gt;() &#123; public T run() throws Exception &#123; Thread t = Thread.currentThread(); ClassLoader cl = t.getContextClassLoader(); if (ccl == cl) &#123; return task.call(); &#125; else &#123; t.setContextClassLoader(ccl); try &#123; return task.call(); &#125; finally &#123; t.setContextClassLoader(cl); &#125; &#125; &#125; &#125;, acc); &#125; catch (PrivilegedActionException e) &#123; throw e.getException(); &#125; &#125; &#125; /** * é»˜è®¤çº¿ç¨‹å·¥å‚ */ static class DefaultThreadFactory implements ThreadFactory &#123; private static final AtomicInteger poolNumber = new AtomicInteger(1); private final ThreadGroup group; private final AtomicInteger threadNumber = new AtomicInteger(1); private final String namePrefix; DefaultThreadFactory() &#123; SecurityManager s = System.getSecurityManager(); group = (s != null) ? s.getThreadGroup() : Thread.currentThread().getThreadGroup(); namePrefix = \"pool-\" + poolNumber.getAndIncrement() + \"-thread-\"; &#125; public Thread newThread(Runnable r) &#123; Thread t = new Thread(group, r, namePrefix + threadNumber.getAndIncrement(), 0); if (t.isDaemon()) t.setDaemon(false); if (t.getPriority() != Thread.NORM_PRIORITY) t.setPriority(Thread.NORM_PRIORITY); return t; &#125; &#125; /** * çº¿ç¨‹å·¥å‚æ•è·è®¿é—®æ§åˆ¶ä¸Šä¸‹æ–‡å’Œç±»åŠ è½½å™¨ */ static class PrivilegedThreadFactory extends DefaultThreadFactory &#123; private final AccessControlContext acc; private final ClassLoader ccl; PrivilegedThreadFactory() &#123; super(); SecurityManager sm = System.getSecurityManager(); if (sm != null) &#123; // Calls to getContextClassLoader from this class // never trigger a security check, but we check // whether our callers have this permission anyways. sm.checkPermission(SecurityConstants.GET_CLASSLOADER_PERMISSION); // Fail fast sm.checkPermission(new RuntimePermission(\"setContextClassLoader\")); &#125; this.acc = AccessController.getContext(); this.ccl = Thread.currentThread().getContextClassLoader(); &#125; public Thread newThread(final Runnable r) &#123; return super.newThread(new Runnable() &#123; public void run() &#123; AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123; public Void run() &#123; Thread.currentThread().setContextClassLoader(ccl); r.run(); return null; &#125; &#125;, acc); &#125; &#125;); &#125; &#125; /** * ä»…å…¬å¼€ExecutorServiceæ–¹æ³•çš„åŒ…è£…ç±» * æ‰§è¡Œå™¨æœåŠ¡çš„å®ç°ç±» */ static class DelegatedExecutorService extends AbstractExecutorService &#123; private final ExecutorService e; DelegatedExecutorService(ExecutorService executor) &#123; e = executor; &#125; public void execute(Runnable command) &#123; e.execute(command); &#125; public void shutdown() &#123; e.shutdown(); &#125; public List&lt;Runnable&gt; shutdownNow() &#123; return e.shutdownNow(); &#125; public boolean isShutdown() &#123; return e.isShutdown(); &#125; public boolean isTerminated() &#123; return e.isTerminated(); &#125; public boolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException &#123; return e.awaitTermination(timeout, unit); &#125; public Future&lt;?&gt; submit(Runnable task) &#123; return e.submit(task); &#125; public &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task) &#123; return e.submit(task); &#125; public &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result) &#123; return e.submit(task, result); &#125; public &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException &#123; return e.invokeAll(tasks); &#125; public &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException &#123; return e.invokeAll(tasks, timeout, unit); &#125; public &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException, ExecutionException &#123; return e.invokeAny(tasks); &#125; public &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException &#123; return e.invokeAny(tasks, timeout, unit); &#125; &#125; static class FinalizableDelegatedExecutorService extends DelegatedExecutorService &#123; FinalizableDelegatedExecutorService(ExecutorService executor) &#123; super(executor); &#125; protected void finalize() &#123; super.shutdown(); &#125; &#125; /** * ä»…å…¬å¼€ScheduledExecutorServiceçš„åŒ…è£…ç±» * ScheduledExecutorServiceå®ç°çš„æ–¹æ³• */ static class DelegatedScheduledExecutorService extends DelegatedExecutorService implements ScheduledExecutorService &#123; private final ScheduledExecutorService e; DelegatedScheduledExecutorService(ScheduledExecutorService executor) &#123; super(executor); e = executor; &#125; public ScheduledFuture&lt;?&gt; schedule(Runnable command, long delay, TimeUnit unit) &#123; return e.schedule(command, delay, unit); &#125; public &lt;V&gt; ScheduledFuture&lt;V&gt; schedule(Callable&lt;V&gt; callable, long delay, TimeUnit unit) &#123; return e.schedule(callable, delay, unit); &#125; public ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command, long initialDelay, long period, TimeUnit unit) &#123; return e.scheduleAtFixedRate(command, initialDelay, period, unit); &#125; public ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command, long initialDelay, long delay, TimeUnit unit) &#123; return e.scheduleWithFixedDelay(command, initialDelay, delay, unit); &#125; &#125; /** ä¸å…è®¸å®ä¾‹åŒ– */ private Executors() &#123;&#125;&#125; å¸¸ç”¨æ–¹æ³•FixedThreadPoolFixedThreadPoolï¼Œå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ã€‚ corePoolSize å’Œ maximumPoolSizeéƒ½è®¾ç½®ä¸ºåˆ›å»ºFixedThreadPoolæ—¶æŒ‡å®šçš„å‚æ•°nThreadsï¼Œæ„å‘³ç€å½“çº¿ç¨‹æ± æ»¡æ—¶ä¸”é˜»å¡é˜Ÿåˆ—ä¹Ÿå·²ç»æ»¡æ—¶ï¼Œå¦‚æœç»§ç»­æäº¤ä»»åŠ¡ï¼Œåˆ™ä¼šç›´æ¥èµ°æ‹’ç»ç­–ç•¥ï¼Œè¯¥çº¿ç¨‹æ± ä¸ä¼šå†æ–°å»ºçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ˜¯ç›´æ¥èµ°æ‹’ç»ç­–ç•¥ã€‚FixedThreadPoolä½¿ç”¨çš„æ˜¯é»˜è®¤çš„æ‹’ç»ç­–ç•¥ï¼Œå³AbortPolicyï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚ keepAliveTimeè®¾ç½®ä¸º0Lï¼Œè¡¨ç¤ºç©ºé—²çš„çº¿ç¨‹ä¼šç«‹åˆ»ç»ˆæ­¢ã€‚ workQueueåˆ™æ˜¯ä½¿ç”¨LinkedBlockingQueueï¼Œä½†æ˜¯æ²¡æœ‰è®¾ç½®èŒƒå›´ï¼Œé‚£ä¹ˆåˆ™æ˜¯æœ€å¤§å€¼ï¼ˆInteger.MAX_VALUEï¼‰ï¼Œè¿™åŸºæœ¬å°±ç›¸å½“äºä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—äº†ã€‚ä½¿ç”¨è¯¥â€œæ— ç•Œé˜Ÿåˆ—â€åˆ™ä¼šå¸¦æ¥å“ªäº›å½±å“å‘¢ï¼Ÿå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ç­‰äºcorePoolSize æ—¶ï¼Œå¦‚æœç»§ç»­æäº¤ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡ä¼šè¢«æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—workQueueä¸­ï¼Œå½“é˜»å¡é˜Ÿåˆ—ä¹Ÿæ»¡äº†ä¹‹åï¼Œåˆ™çº¿ç¨‹æ± ä¼šæ–°å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ç›´åˆ°maximumPoolSizeã€‚ç”±äºFixedThreadPoolä½¿ç”¨çš„æ˜¯â€œæ— ç•Œé˜Ÿåˆ—â€LinkedBlockingQueueï¼Œé‚£ä¹ˆmaximumPoolSizeå‚æ•°æ— æ•ˆï¼ŒåŒæ—¶æŒ‡å®šçš„æ‹’ç»ç­–ç•¥AbortPolicyä¹Ÿå°†æ— æ•ˆã€‚è€Œä¸”è¯¥çº¿ç¨‹æ± ä¹Ÿä¸ä¼šæ‹’ç»æäº¤çš„ä»»åŠ¡ï¼Œå¦‚æœå®¢æˆ·ç«¯æäº¤ä»»åŠ¡çš„é€Ÿåº¦å¿«äºä»»åŠ¡çš„æ‰§è¡Œï¼Œé‚£ä¹ˆkeepAliveTimeä¹Ÿæ˜¯ä¸€ä¸ªæ— æ•ˆå‚æ•°ã€‚ SingleThreadExecutorSingleThreadExecutoræ˜¯ä½¿ç”¨å•ä¸ªworkerçº¿ç¨‹çš„Executorï¼Œå³å•çº¿ç¨‹å·¥ä½œæ¨¡å¼ã€‚ ä½œä¸ºå•ä¸€workerçº¿ç¨‹çš„çº¿ç¨‹æ± ï¼ŒSingleThreadExecutoræŠŠcorePoolå’ŒmaximumPoolSizeå‡è¢«è®¾ç½®ä¸º1ï¼Œå’ŒFixedThreadPoolä¸€æ ·ä½¿ç”¨çš„æ˜¯æ— ç•Œé˜Ÿåˆ—LinkedBlockingQueue,æ‰€ä»¥å¸¦æ¥çš„å½±å“å’ŒFixedThreadPoolä¸€æ ·ã€‚ CachedThreadPoolCachedThreadPoolæ˜¯ä¸€ä¸ªä¼šæ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ±  ã€‚ CachedThreadPoolçš„corePoolä¸º0ï¼ŒmaximumPoolSizeä¸ºInteger.MAX_VALUEï¼Œè¿™å°±æ„å‘³ç€æ‰€æœ‰çš„ä»»åŠ¡ä¸€æäº¤å°±ä¼šåŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ã€‚keepAliveTimeè¿™æ˜¯ä¸º60Lï¼Œunitè®¾ç½®ä¸ºTimeUnit.SECONDSï¼Œæ„å‘³ç€ç©ºé—²çº¿ç¨‹ç­‰å¾…æ–°ä»»åŠ¡çš„æœ€é•¿æ—¶é—´ä¸º60ç§’ï¼Œç©ºé—²çº¿ç¨‹è¶…è¿‡60ç§’åå°†ä¼šè¢«ç»ˆæ­¢ã€‚é˜»å¡é˜Ÿåˆ—é‡‡ç”¨çš„SynchronousQueueï¼Œæˆ‘ä»¬äº†è§£åˆ°SynchronousQueueæ˜¯ä¸€ä¸ªæ²¡æœ‰å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—(æ¦‚å¿µä¸Šçš„æ— ç•Œï¼Œå…¶å®æ˜¯æœ‰ç•Œçš„)ï¼ŒåŠ ä¸ŠcorePool = 0 ï¼ŒmaximumPoolSize = Integer.MAX_VALUEï¼Œè¿™æ ·å°±ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸»çº¿ç¨‹æäº¤ä»»åŠ¡çš„é€Ÿåº¦è¿œè¿œå¤§äºCachedThreadPoolçš„å¤„ç†é€Ÿåº¦ï¼Œåˆ™CachedThreadPoolä¼šä¸æ–­åœ°åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œè¿™æ ·æœ‰å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿè€—å°½CPUå’Œå†…å­˜èµ„æºï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨è¯¥çº¿ç¨‹æ± æ˜¯ï¼Œä¸€å®šè¦æ³¨æ„æ§åˆ¶å¹¶å‘çš„ä»»åŠ¡æ•°ï¼Œå¦åˆ™åˆ›å»ºå¤§é‡çš„çº¿ç¨‹å¯èƒ½å¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚ ScheduledThreadPoolScheduledThreadPoolï¼Œåˆ›å»ºä¸€ä¸ªå¯å»¶è¿Ÿè°ƒåº¦çš„çº¿ç¨‹æ± ã€‚ ScheduledThreadPoolçš„çº¿ç¨‹æ± å¤„ç†ç±»ä¸ºScheduledThreadPoolExecutorï¼Œé€šè¿‡æ„é€ æˆ‘ä»¬å¯ä»¥å¾—å‡ºcorePoolæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼ŒmaximumPoolSizeä¸ºInteger.MAX_VALUEï¼Œè¿™å°±æ„å‘³ç€æ‰€æœ‰çš„ä»»åŠ¡ä¸€æäº¤å°±ä¼šåŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ã€‚keepAliveTimeä¸º0ï¼Œunitè®¾ç½®ä¸ºTimeUnit.NANOSECONDSï¼Œæ„å‘³ç€æ‰§è¡Œå®Œå»¶è¿Ÿä»»åŠ¡åä¼šç«‹é©¬å›æ”¶çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—é‡‡ç”¨DelayedWorkQueue(ä¸“ä¸ºå»¶è¿Ÿé˜Ÿåˆ—è€Œç”Ÿ),DelayedWorkQueueåŸºäºå †çš„æ•°æ®ç»“æ„ï¼Œé»˜è®¤åˆå§‹åŒ–å®¹é‡ä¸º16ã€‚ æˆ‘ä»¬çŸ¥é“Timerä¸TimerTaskè™½ç„¶å¯ä»¥å®ç°çº¿ç¨‹çš„å‘¨æœŸå’Œå»¶è¿Ÿè°ƒåº¦ï¼Œä½†æ˜¯Timerä¸TimerTaskå­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œæ‰€ä»¥å¯¹äºè¿™ç§å®šæœŸã€å‘¨æœŸæ‰§è¡Œä»»åŠ¡çš„è°ƒåº¦ç­–ç•¥ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯æ¨èScheduledThreadPoolExecutoræ¥å®ç°ã€‚ å…·ä½“åˆ†æè¯·é˜…è¯»å¤§ç‰›åšæ–‡: ScheduledThreadPoolExecutorè¯¦è§£ä¸€ ScheduledThreadPoolExecutorè¯¦è§£äºŒ WorkStealingPoolWorkStealingPoolæ˜¯ä¸ªç‰¹æ®Šçš„çº¿ç¨‹æ± ï¼Œä½†ä¸é•¿ç”¨ï¼Œé¢è¯•æœ‰æ—¶å€™å¯èƒ½ä¼šé—®åˆ°ï¼Œå†…éƒ¨å®ç°åŸç†å…¶å®æ˜¯åŸºäºJDK1.7çš„ForkJoinPoolæ¡†æ¶ï¼Œå…·ä½“æ„é€ å®ç°ç»†èŠ‚å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435/** * Creates a &#123;@code ForkJoinPool&#125; with the given parameters. * * @param parallelism the parallelism level. For default value, * use &#123;@link java.lang.Runtime#availableProcessors&#125;. * @param factory the factory for creating new threads. For default value, * use &#123;@link #defaultForkJoinWorkerThreadFactory&#125;. * @param handler the handler for internal worker threads that * terminate due to unrecoverable errors encountered while executing * tasks. For default value, use &#123;@code null&#125;. * @param asyncMode if true, * establishes local first-in-first-out scheduling mode for forked * tasks that are never joined. This mode may be more appropriate * than default locally stack-based mode in applications in which * worker threads only process event-style asynchronous tasks. * For default value, use &#123;@code false&#125;. * @throws IllegalArgumentException if parallelism less than or * equal to zero, or greater than implementation limit * @throws NullPointerException if the factory is null * @throws SecurityException if a security manager exists and * the caller is not permitted to modify threads * because it does not hold &#123;@link * java.lang.RuntimePermission&#125;&#123;@code (\"modifyThread\")&#125; */public ForkJoinPool(int parallelism, ForkJoinWorkerThreadFactory factory, UncaughtExceptionHandler handler, boolean asyncMode) &#123; this(checkParallelism(parallelism), checkFactory(factory), handler, asyncMode ? FIFO_QUEUE : LIFO_QUEUE, \"ForkJoinPool-\" + nextPoolId() + \"-worker-\"); checkPermission();&#125; ForkJoinPoolæ¡†æ¶æ˜¯ä¸ªå¹¶è¡Œæ¡†æ¶ï¼Œåœ¨å¤šæ ¸CPUä¸­æœ‰ç€é«˜æ•ˆçš„æ€§èƒ½ä½“éªŒã€‚Java7 æä¾›äº†ForkJoinPoolæ¥æ”¯æŒå°†ä¸€ä¸ªä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªâ€œå°ä»»åŠ¡â€å¹¶è¡Œè®¡ç®—ï¼Œå†æŠŠå¤šä¸ªâ€œå°ä»»åŠ¡â€çš„ç»“æœåˆå¹¶æˆæ€»çš„è®¡ç®—ç»“æœã€‚æœ‰å…³äºForkJoinPoolçŸ¥è¯†ï¼Œæˆ‘ä»¬åç»­è®²è§£ã€‚ å‚è€ƒèµ„æ–™ é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ å”¯å“ä¼šJavaå¼€å‘æ‰‹å†Œ ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"JVMåŠå¹¶å‘ç¼–ç¨‹","slug":"JVMåŠå¹¶å‘ç¼–ç¨‹","permalink":"http://ltyeamin.github.io/tags/JVMåŠå¹¶å‘ç¼–ç¨‹/"}]},{"title":"ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-æ·±å…¥ThreadPoolExecutorå·¥ä½œæœºåˆ¶","slug":"ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-æ·±å…¥ThreadPoolExecutorå·¥ä½œæœºåˆ¶","date":"2018-06-09T10:45:21.000Z","updated":"2019-11-20T15:08:55.367Z","comments":true,"path":"2018/06/09/ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-æ·±å…¥ThreadPoolExecutorå·¥ä½œæœºåˆ¶/","link":"","permalink":"http://ltyeamin.github.io/2018/06/09/ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-æ·±å…¥ThreadPoolExecutorå·¥ä½œæœºåˆ¶/","excerpt":"","text":"ä¸ºäº†é«˜æ•ˆçš„ç®¡ç†çº¿ç¨‹ï¼ŒJDK1.5ç‰ˆæœ¬çš„Doug Leaå¤§ç¥ä¸ºæˆ‘ä»¬è®¾è®¡äº†å¤§åé¼é¼çš„ThreadPoolExecutorã€‚ ä½œä¸ºExecutoræ¡†æ¶ä¸­æœ€æ ¸å¿ƒçš„ç±»-ThreadPoolExecutorï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªè°ƒåº¦å·¥å…·ï¼Œä¸ºäº†é«˜æ•ˆæ‰§è¡Œæˆ–è°ƒåº¦ä»»åŠ¡ï¼Œæˆ‘ä»¬éå¸¸æœ‰å¿…è¦å¯¹è¯¥ç±»çš„å·¥ä½œåŸç†ä»¥åŠå†…éƒ¨æœºåˆ¶äº†è§£ä¸€ç•ªã€‚çº¿ç¨‹æ± çš„æ¯ä¸€ä¸ªå‚æ•°é…ç½®éƒ½æœ‰ä¸€å®šçš„è®¾è®¡åˆç†æ€§ï¼Œå„ä¸ªå‚æ•°é…ç½®ååŒèšåˆï¼Œè®©èµ„æºåˆç†è¿ç”¨æ‰æ˜¯æˆ‘ä»¬æœ€å…³æ³¨çš„ã€‚ çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸçº¿ç¨‹æœ‰äº”ç§çŠ¶æ€ï¼šæ–°å»ºï¼Œå°±ç»ªï¼Œè¿è¡Œï¼Œé˜»å¡ï¼Œæ­»äº¡ã€‚çº¿ç¨‹æ± åŒæ ·æœ‰äº”ç§çŠ¶æ€ï¼šRunning, SHUTDOWN, STOP, TIDYING, TERMINATEDã€‚ æˆ‘ä»¬ç¿»å¼€ThreadPoolExecutoræºç å¯ä»¥çœ‹åˆ°çº¿ç¨‹æ± ç”Ÿå‘½å‘¨æœŸçš„å®šä¹‰ï¼š 1234567891011121314151617181920private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));private static final int COUNT_BITS = Integer.SIZE - 3;private static final int CAPACITY = (1 &lt;&lt; COUNT_BITS) - 1;// runState is stored in the high-order bits// å¯¹åº”çš„é«˜3ä½å€¼æ˜¯111private static final int RUNNING = -1 &lt;&lt; COUNT_BITS;// å¯¹åº”çš„é«˜3ä½å€¼æ˜¯000private static final int SHUTDOWN = 0 &lt;&lt; COUNT_BITS;// å¯¹åº”çš„é«˜3ä½å€¼æ˜¯001private static final int STOP = 1 &lt;&lt; COUNT_BITS;// å¯¹åº”çš„é«˜3ä½å€¼æ˜¯010private static final int TIDYING = 2 &lt;&lt; COUNT_BITS;// å¯¹åº”çš„é«˜3ä½å€¼æ˜¯011private static final int TERMINATED = 3 &lt;&lt; COUNT_BITS;// Packing and unpacking ctlprivate static int runStateOf(int c) &#123; return c &amp; ~CAPACITY;&#125;private static int workerCountOf(int c) &#123; return c &amp; CAPACITY; &#125;private static int ctlOf(int rs, int wc) &#123; return rs | wc; &#125; å˜é‡ctlå®šä¹‰ä¸ºAtomicInteger ï¼Œå…¶åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œè®°å½•äº†â€œçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡æ•°é‡â€å’Œâ€œçº¿ç¨‹æ± çš„çŠ¶æ€â€ä¸¤ä¸ªä¿¡æ¯ã€‚å…±32ä½ï¼Œå…¶ä¸­é«˜3ä½è¡¨ç¤ºâ€çº¿ç¨‹æ± çŠ¶æ€(runState)â€ï¼Œä½29ä½è¡¨ç¤ºâ€çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡æ•°é‡(workerCnt)â€ã€‚ çº¿ç¨‹æ± æ˜¯æœ‰çŠ¶æ€çš„ï¼Œä¸åŒçŠ¶æ€ä¸‹çº¿ç¨‹æ± çš„è¡Œä¸ºæ˜¯ä¸ä¸€æ ·çš„ã€‚å…·ä½“è¿è½¬æµç¨‹å¦‚ä¸‹: çŠ¶æ€ å«ä¹‰ RUNNING è¿è¡ŒçŠ¶æ€ï¼Œè¯¥çŠ¶æ€ä¸‹çº¿ç¨‹æ± å¯ä»¥æ¥å—æ–°çš„ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ‰§è¡Œ, shutdown æ–¹æ³•å¯è¿›å…¥ SHUTDOWN çŠ¶æ€;æ‰§è¡Œ shutdownNow æ–¹æ³•å¯è¿›å…¥ STOP çŠ¶æ€ SHUTDOWN å¾…å…³é—­çŠ¶æ€ï¼Œä¸å†æ¥å—æ–°çš„ä»»åŠ¡ï¼Œç»§ç»­å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡;å½“é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¸ºç©ºï¼Œå¹¶ä¸”å·¥ä½œçº¿ç¨‹æ•°ä¸º0æ—¶ï¼Œè¿›å…¥ TIDYING çŠ¶æ€ STOP åœæ­¢çŠ¶æ€ï¼Œä¸æ¥æ”¶æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šå°è¯•ç»“æŸæ‰§è¡Œä¸­çš„ä»»åŠ¡;å½“å·¥ä½œçº¿ç¨‹æ•°ä¸º0æ—¶ï¼Œè¿›å…¥ TIDYING çŠ¶æ€ TIDYING æ•´ç†çŠ¶æ€ï¼Œæ­¤æ—¶ä»»åŠ¡éƒ½å·²ç»æ‰§è¡Œå®Œæ¯•ï¼ˆctlè®°å½•çš„â€ä»»åŠ¡æ•°é‡â€ä¸º0ï¼‰ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å·¥ä½œçº¿ç¨‹; æ‰§è¡Œ terminated æ–¹æ³•åè¿›å…¥ TERMINATED çŠ¶æ€ TERMINATED ç»ˆæ­¢çŠ¶æ€ï¼Œæ­¤æ—¶çº¿ç¨‹æ± å®Œå…¨ç»ˆæ­¢äº†ï¼Œå¹¶å®Œæˆäº†æ‰€æœ‰èµ„æºçš„é‡Šæ”¾ çº¿ç¨‹æ± çš„å†…éƒ¨æ„é€ 123456789101112131415161718192021222324public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) &#123; if (corePoolSize &lt; 0 || maximumPoolSize &lt;= 0 || maximumPoolSize &lt; corePoolSize || keepAliveTime &lt; 0) throw new IllegalArgumentException(); if (workQueue == null || threadFactory == null || handler == null) throw new NullPointerException(); this.acc = System.getSecurityManager() == null ? null : AccessController.getContext(); this.corePoolSize = corePoolSize; this.maximumPoolSize = maximumPoolSize; this.workQueue = workQueue; this.keepAliveTime = unit.toNanos(keepAliveTime); this.threadFactory = threadFactory; this.handler = handler;&#125; ä¸Šè¿°æºç æ˜¯æ‘˜è‡ªJDK1.8ä¸­ThreadPoolExecutorçš„æ„é€ æºç ï¼Œæ„é€ å™¨æœ‰7ä¸ªé‡è¦å‚æ•°ï¼Œè¿™ä¸ƒä¸ªå‚æ•°æ„ä¹‰é‡å¤§ï¼Œæˆ‘ä»¬æœ‰å¿…è¦æ·±å…¥å­¦ä¹ ã€‚ å‰æ–‡è®²åˆ°æœ‰äº†æ ‡å¿—å·¥ä½œçº¿ç¨‹çš„ä¸ªæ•°çš„å˜é‡ctlï¼Œé‚£ä¹ˆä¸åŒç¡¬ä»¶é…ç½®çš„æœºå™¨ï¼Œåˆ°åº•åº”è¯¥é…ç½®å¤šå°‘ä¸ªçº¿ç¨‹æ‰åˆé€‚å‘¢ï¼Ÿçº¿ç¨‹æ± é…ç½®çš„æ ¸å¿ƒçº¿ç¨‹æ•°å°‘äº†ï¼Œå‘æŒ¥ä¸äº†çº¿ç¨‹æ± çš„ç‰¹æ€§ï¼Œçº¿ç¨‹æ± é…ç½®çš„æ ¸å¿ƒçº¿ç¨‹æ•°å¤šäº†ï¼Œåˆé€ æˆèµ„æºè€—è´¹ã€‚ ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªç–‘é—®ï¼Œæ—¢ç„¶å·²ç»æœ‰äº†æ ‡è¯†å·¥ä½œçº¿ç¨‹çš„ä¸ªæ•°çš„å˜é‡äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°å‘¢ï¼Ÿ å…¶å®ä½ è¿™æ ·æƒ³å°±èƒ½å¤Ÿç†è§£äº†ï¼Œåˆ›å»ºçº¿ç¨‹æ˜¯æœ‰ä»£ä»·çš„ï¼Œä¸èƒ½æ¯æ¬¡è¦æ‰§è¡Œä¸€ä¸ªä»»åŠ¡æ—¶å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯ä¹Ÿä¸èƒ½åœ¨ä»»åŠ¡éå¸¸å¤šçš„æ—¶å€™ï¼Œåªæœ‰å°‘é‡çš„çº¿ç¨‹åœ¨æ‰§è¡Œï¼Œè¿™æ ·ä»»åŠ¡æ˜¯æ¥ä¸åŠå¤„ç†çš„ï¼Œè€Œæ˜¯åº”è¯¥åˆ›å»ºåˆé€‚çš„è¶³å¤Ÿå¤šçš„çº¿ç¨‹æ¥åŠæ—¶çš„å¤„ç†ä»»åŠ¡ã€‚éšç€ä»»åŠ¡æ•°é‡çš„å˜åŒ–ï¼Œå½“ä»»åŠ¡æ•°æ˜æ˜¾å¾ˆå°æ—¶ï¼ŒåŸæœ¬åˆ›å»ºçš„å¤šä½™çš„çº¿ç¨‹å°±æ²¡æœ‰å¿…è¦å†å­˜æ´»ç€äº†ï¼Œå› ä¸ºè¿™æ—¶ä½¿ç”¨å°‘é‡çš„çº¿ç¨‹å°±èƒ½å¤Ÿå¤„ç†çš„è¿‡æ¥äº†ï¼Œæ‰€ä»¥è¯´çœŸæ­£å·¥ä½œçš„çº¿ç¨‹çš„æ•°é‡ï¼Œæ˜¯éšç€ä»»åŠ¡çš„å˜åŒ–è€Œå˜åŒ–çš„ã€‚ é‚£æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ä¸å·¥ä½œçº¿ç¨‹ä¸ªæ•°çš„å…³ç³»æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ å·¥ä½œçº¿ç¨‹çš„ä¸ªæ•°å¯èƒ½ä»0åˆ°æœ€å¤§çº¿ç¨‹æ•°ä¹‹é—´å˜åŒ–ï¼Œå½“æ‰§è¡Œä¸€æ®µæ—¶é—´ä¹‹åå¯èƒ½ç»´æŒåœ¨ corePoolSizeï¼Œä½†ä¹Ÿä¸æ˜¯ç»å¯¹çš„ï¼Œå–å†³äºæ ¸å¿ƒçº¿ç¨‹æ˜¯å¦å…è®¸è¢«è¶…æ—¶å›æ”¶ã€‚ corePoolSizeæ ¸å¿ƒçº¿ç¨‹æ•°corePoolSize ç”¨æ¥è¡¨ç¤ºçº¿ç¨‹æ± ä¸­çš„æ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºå¯é—²ç½®çš„çº¿ç¨‹æ•°é‡ã€‚å½“æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹æ•°ç­‰äºcorePoolSizeã€‚å¦‚æœè°ƒç”¨äº†çº¿ç¨‹æ± çš„prestartAllCoreThreads()æ–¹æ³•ï¼Œçº¿ç¨‹æ± ä¼šæå‰åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰åŸºæœ¬çº¿ç¨‹ã€‚ maximumPoolSizeæœ€å¤§çº¿ç¨‹æ•°maximumPoolSize ç”¨æ¥è¡¨ç¤ºçº¿ç¨‹æ± ä¸­æœ€å¤šèƒ½å¤Ÿåˆ›å»ºçš„çº¿ç¨‹æ•°é‡ã€‚çº¿ç¨‹æ± çš„é˜»å¡é˜Ÿåˆ—æ»¡äº†ä¹‹åï¼Œå¦‚æœè¿˜æœ‰ä»»åŠ¡æäº¤ï¼Œå¦‚æœå½“å‰çš„çº¿ç¨‹æ•°å°äºmaximumPoolSizeï¼Œåˆ™ä¼šæ–°å»ºçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯æ— ç•Œé˜Ÿåˆ—ï¼Œè¯¥å‚æ•°ä¹Ÿå°±æ²¡æœ‰ä»€ä¹ˆæ•ˆæœäº†ã€‚ keepAliveTimeçº¿ç¨‹ç©ºé—²æ—¶é—´çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯æ˜¯éœ€è¦ä»£ä»·çš„ã€‚çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡åä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ç»§ç»­å­˜æ´»ä¸€æ®µæ—¶é—´ï¼škeepAliveTimeã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°åªæœ‰åœ¨çº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶æ‰ä¼šç”Ÿæ•ˆã€‚ å½“å·¥ä½œçº¿ç¨‹æ•°è¾¾åˆ° corePoolSize æ—¶ï¼Œçº¿ç¨‹æ± ä¼šå°†æ–°æ¥æ”¶åˆ°çš„ä»»åŠ¡å­˜æ”¾åœ¨é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œè€Œé˜»å¡é˜Ÿåˆ—åˆä¸¤ç§æƒ…å†µï¼šä¸€ç§æ˜¯æœ‰ç•Œçš„é˜Ÿåˆ—ï¼Œä¸€ç§æ˜¯æ— ç•Œçš„é˜Ÿåˆ—ã€‚ å¦‚æœæ˜¯æ— ç•Œé˜Ÿåˆ—ï¼Œé‚£ä¹ˆå½“æ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨å¿™çš„æ—¶å€™ï¼Œæ‰€æœ‰æ–°æäº¤çš„ä»»åŠ¡éƒ½ä¼šè¢«å­˜æ”¾åœ¨è¯¥æ— ç•Œé˜Ÿåˆ—ä¸­ï¼Œè¿™æ—¶æœ€å¤§çº¿ç¨‹æ•°å°†å˜å¾—æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºé˜»å¡é˜Ÿåˆ—ä¸ä¼šå­˜åœ¨è¢«è£…æ»¡çš„æƒ…å†µã€‚ å¦‚æœæ˜¯æœ‰ç•Œé˜Ÿåˆ—ï¼Œé‚£ä¹ˆå½“é˜»å¡é˜Ÿåˆ—ä¸­è£…æ»¡äº†ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿™æ—¶å†æœ‰æ–°ä»»åŠ¡æäº¤æ—¶ï¼Œçº¿ç¨‹æ± å°±éœ€è¦åˆ›å»ºæ–°çš„â€œä¸´æ—¶â€çº¿ç¨‹æ¥å¤„ç†ï¼Œç›¸å½“äºå¢æ´¾äººæ‰‹æ¥å¤„ç†ä»»åŠ¡ã€‚ ä½†æ˜¯åˆ›å»ºçš„â€œä¸´æ—¶â€çº¿ç¨‹æ˜¯æœ‰å­˜æ´»æ—¶é—´çš„ï¼Œä¸å¯èƒ½è®©ä»–ä»¬ä¸€ç›´éƒ½å­˜æ´»ç€ï¼Œå½“é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¢«æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶ä¸”åˆæ²¡æœ‰é‚£ä¹ˆå¤šæ–°ä»»åŠ¡è¢«æäº¤æ—¶ï¼Œâ€œä¸´æ—¶â€çº¿ç¨‹å°±éœ€è¦è¢«å›æ”¶é”€æ¯ï¼Œåœ¨è¢«å›æ”¶é”€æ¯ä¹‹å‰ç­‰å¾…çš„è¿™æ®µæ—¶é—´ï¼Œå°±æ˜¯éæ ¸å¿ƒçº¿ç¨‹çš„å­˜æ´»æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯ keepAliveTime å±æ€§ã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯â€œéæ ¸å¿ƒçº¿ç¨‹â€å‘¢ï¼Ÿæ˜¯ä¸æ˜¯å…ˆåˆ›å»ºçš„çº¿ç¨‹å°±æ˜¯æ ¸å¿ƒçº¿ç¨‹ï¼Œååˆ›å»ºçš„å°±æ˜¯éæ ¸å¿ƒçº¿ç¨‹å‘¢ï¼Ÿ å…¶å®æ ¸å¿ƒçº¿ç¨‹è·Ÿåˆ›å»ºçš„å…ˆåæ²¡æœ‰å…³ç³»ï¼Œè€Œæ˜¯è·Ÿå·¥ä½œçº¿ç¨‹çš„ä¸ªæ•°æœ‰å…³ï¼Œå¦‚æœå½“å‰å·¥ä½œçº¿ç¨‹çš„ä¸ªæ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„çº¿ç¨‹éƒ½å¯èƒ½æ˜¯â€œéæ ¸å¿ƒçº¿ç¨‹â€ï¼Œéƒ½æœ‰è¢«å›æ”¶çš„å¯èƒ½ã€‚ ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œäº†ä¸€ä¸ªä»»åŠ¡åï¼Œä¼šå»é˜»å¡é˜Ÿåˆ—é‡Œé¢å–æ–°çš„ä»»åŠ¡ï¼Œåœ¨å–åˆ°ä»»åŠ¡ä¹‹å‰å®ƒå°±æ˜¯ä¸€ä¸ªé—²ç½®çš„çº¿ç¨‹ã€‚ å–ä»»åŠ¡çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯é€šè¿‡ take() æ–¹æ³•ä¸€ç›´é˜»å¡ç›´åˆ°å–å‡ºä»»åŠ¡ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡ poll(keepAliveTimeï¼ŒtimeUnit) æ–¹æ³•åœ¨ä¸€å®šæ—¶é—´å†…å–å‡ºä»»åŠ¡æˆ–è€…è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶è¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«å›æ”¶ï¼Œè¯·æ³¨æ„æ ¸å¿ƒçº¿ç¨‹ä¸€èˆ¬ä¸ä¼šè¢«å›æ”¶ã€‚ é‚£ä¹ˆæ€ä¹ˆä¿è¯æ ¸å¿ƒçº¿ç¨‹ä¸ä¼šè¢«å›æ”¶å‘¢ï¼Ÿè¿˜æ˜¯è·Ÿå·¥ä½œçº¿ç¨‹çš„ä¸ªæ•°æœ‰å…³ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹åœ¨å–ä»»åŠ¡çš„æ—¶å€™ï¼Œçº¿ç¨‹æ± ä¼šæ¯”è¾ƒå½“å‰çš„å·¥ä½œçº¿ç¨‹ä¸ªæ•°ä¸æ ¸å¿ƒçº¿ç¨‹æ•°ï¼š å¦‚æœå·¥ä½œçº¿ç¨‹æ•°å°äºå½“å‰çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•å–ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è¶…æ—¶å›æ”¶ï¼Œè¿™æ—¶æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹éƒ½æ˜¯â€œæ ¸å¿ƒçº¿ç¨‹â€ï¼Œä»–ä»¬ä¸ä¼šè¢«å›æ”¶ï¼› å¦‚æœå¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•å–ä»»åŠ¡ï¼Œä¸€æ—¦è¶…æ—¶å°±å›æ”¶ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ç»å¯¹çš„æ ¸å¿ƒçº¿ç¨‹ï¼Œåªè¦è¿™ä¸ªçº¿ç¨‹æ²¡æœ‰åœ¨å­˜æ´»æ—¶é—´å†…å–åˆ°ä»»åŠ¡å»æ‰§è¡Œå°±ä¼šè¢«å›æ”¶ã€‚ æ‰€ä»¥æ¯ä¸ªçº¿ç¨‹æƒ³è¦ä¿ä½è‡ªå·±â€œæ ¸å¿ƒçº¿ç¨‹â€çš„èº«ä»½ï¼Œå¿…é¡»å……åˆ†åŠªåŠ›ï¼Œå°½å¯èƒ½å¿«çš„è·å–åˆ°ä»»åŠ¡å»æ‰§è¡Œï¼Œè¿™æ ·æ‰èƒ½é€ƒé¿è¢«å›æ”¶çš„å‘½è¿ã€‚ æ ¸å¿ƒçº¿ç¨‹ä¸€èˆ¬ä¸ä¼šè¢«å›æ”¶ï¼Œä½†æ˜¯ä¹Ÿä¸æ˜¯ç»å¯¹çš„ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®äº†å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶è¢«å›æ”¶çš„è¯ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹è¿™ç§è¯´æ³•äº†ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½ä¼šé€šè¿‡ poll(keepAliveTime, timeUnit) æ¥è·å–ä»»åŠ¡ï¼Œä¸€æ—¦è¶…æ—¶è·å–ä¸åˆ°ä»»åŠ¡ï¼Œå°±ä¼šè¢«å›æ”¶ï¼Œä¸€èˆ¬å¾ˆå°‘ä¼šè¿™æ ·æ¥ä½¿ç”¨ï¼Œé™¤éè¯¥çº¿ç¨‹æ± éœ€è¦å¤„ç†çš„ä»»åŠ¡éå¸¸å°‘ï¼Œå¹¶ä¸”é¢‘ç‡ä¹Ÿä¸é«˜ï¼Œä¸éœ€è¦å°†æ ¸å¿ƒçº¿ç¨‹ä¸€ç›´ç»´æŒç€ã€‚ unitçº¿ç¨‹ç©ºé—²æ—¶é—´å•ä½keepAliveTimeçš„å•ä½ã€‚TimeUnitï¼Œå¯è®¾ç½®æ—¶åˆ†ç§’æ¯«ç§’ workQueueä»»åŠ¡é˜Ÿåˆ—workQueueç”¨æ¥ä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ï¼Œç­‰å¾…çš„ä»»åŠ¡å¿…é¡»å®ç°Runnableæ¥å£ã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©å¦‚ä¸‹å‡ ç§ï¼š ArrayBlockingQueueï¼šåŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒFIFOã€‚ LinkedBlockingQueueï¼šåŸºäºé“¾è¡¨ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒFIFOã€‚ SynchronousQueueï¼šä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œéƒ½å¿…é¡»ç­‰å¾…ä¸€ä¸ªç§»å‡ºæ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚ PriorityBlockingQueueï¼šå…·æœ‰ä¼˜å…ˆç•Œåˆ«çš„é˜»å¡é˜Ÿåˆ—ã€‚ ä¸Šé¢æˆ‘ä»¬è¯´äº†æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¹¶ä¸”ä¹Ÿä»‹ç»äº†å·¥ä½œçº¿ç¨‹çš„ä¸ªæ•°æ˜¯åœ¨0å’Œæœ€å¤§çº¿ç¨‹æ•°ä¹‹é—´å˜åŒ–çš„ã€‚ä½†æ˜¯ä¸å¯èƒ½ä¸€ä¸‹å­å°±åˆ›å»ºäº†æ‰€æœ‰çº¿ç¨‹ï¼ŒæŠŠçº¿ç¨‹æ± è£…æ»¡ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªè¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š å½“çº¿ç¨‹æ± æ¥æ”¶åˆ°ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œå¦‚æœå·¥ä½œçº¿ç¨‹æ•°æ²¡æœ‰è¾¾åˆ°corePoolSizeï¼Œé‚£ä¹ˆå°±ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶ç»‘å®šè¯¥ä»»åŠ¡ï¼Œç›´åˆ°å·¥ä½œçº¿ç¨‹çš„æ•°é‡è¾¾åˆ° corePoolSize å‰éƒ½ä¸ä¼šé‡ç”¨ä¹‹å‰çš„çº¿ç¨‹ã€‚ å½“å·¥ä½œçº¿ç¨‹æ•°è¾¾åˆ° corePoolSize äº†ï¼Œè¿™æ—¶åˆæ¥æ”¶åˆ°æ–°ä»»åŠ¡æ—¶ï¼Œä¼šå°†ä»»åŠ¡å­˜æ”¾åœ¨ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ä¸­ç­‰å¾…æ ¸å¿ƒçº¿ç¨‹å»æ‰§è¡Œã€‚ä¸ºä»€ä¹ˆä¸ç›´æ¥åˆ›å»ºæ›´å¤šçš„çº¿ç¨‹æ¥æ‰§è¡Œæ–°ä»»åŠ¡å‘¢ï¼ŒåŸå› æ˜¯æ ¸å¿ƒçº¿ç¨‹ä¸­å¾ˆå¯èƒ½å·²ç»æœ‰çº¿ç¨‹æ‰§è¡Œå®Œè‡ªå·±çš„ä»»åŠ¡äº†ï¼Œæˆ–è€…æœ‰å…¶ä»–çº¿ç¨‹é©¬ä¸Šå°±èƒ½å¤„ç†å®Œå½“å‰çš„ä»»åŠ¡ï¼Œå¹¶ä¸”æ¥ä¸‹æ¥å°±èƒ½æŠ•å…¥åˆ°æ–°çš„ä»»åŠ¡ä¸­å»ï¼Œæ‰€ä»¥é˜»å¡é˜Ÿåˆ—æ˜¯ä¸€ç§ç¼“å†²çš„æœºåˆ¶ï¼Œç»™æ ¸å¿ƒçº¿ç¨‹ä¸€ä¸ªæœºä¼šè®©ä»–ä»¬å……åˆ†å‘æŒ¥è‡ªå·±çš„èƒ½åŠ›ã€‚å¦å¤–ä¸€ä¸ªå€¼å¾—è€ƒè™‘çš„åŸå› æ˜¯ï¼Œåˆ›å»ºçº¿ç¨‹æ¯•ç«Ÿæ˜¯æ¯”è¾ƒæ˜‚è´µçš„ï¼Œä¸å¯èƒ½ä¸€æœ‰ä»»åŠ¡è¦æ‰§è¡Œå°±å»åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸ºçº¿ç¨‹æ± é…å¤‡ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œå³ä»»åŠ¡åˆ—è¡¨ï¼Œç”¨æ¥ä¸´æ—¶ç¼“å­˜ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡å°†ç­‰å¾…å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œã€‚ threadFactoryçº¿ç¨‹å·¥å‚æ—¢ç„¶æ˜¯çº¿ç¨‹æ± ï¼Œé‚£è‡ªç„¶å°‘ä¸äº†çº¿ç¨‹ï¼Œçº¿ç¨‹è¯¥å¦‚ä½•æ¥åˆ›å»ºå‘¢ï¼Ÿè¿™ä¸ªä»»åŠ¡å°±äº¤ç»™äº†çº¿ç¨‹å·¥å‚ ThreadFactory æ¥å®Œæˆã€‚ è¯¥å¯¹è±¡å¯ä»¥é€šè¿‡Executors.defaultThreadFactory()ï¼Œå¦‚ä¸‹ï¼š 123public static ThreadFactory defaultThreadFactory() &#123; return new DefaultThreadFactory();&#125; è¿”å›çš„DefaultThreadFactoryå¯¹è±¡ï¼Œæºç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526static class DefaultThreadFactory implements ThreadFactory &#123; private static final AtomicInteger poolNumber = new AtomicInteger(1); private final ThreadGroup group; private final AtomicInteger threadNumber = new AtomicInteger(1); private final String namePrefix; DefaultThreadFactory() &#123; SecurityManager s = System.getSecurityManager(); group = (s != null) ? s.getThreadGroup() : Thread.currentThread().getThreadGroup(); namePrefix = \"pool-\" + poolNumber.getAndIncrement() + \"-thread-\"; &#125; public Thread newThread(Runnable r) &#123; Thread t = new Thread(group, r, namePrefix + threadNumber.getAndIncrement(), 0); if (t.isDaemon()) t.setDaemon(false); if (t.getPriority() != Thread.NORM_PRIORITY) t.setPriority(Thread.NORM_PRIORITY); return t; &#125; &#125; ThreadFactoryçš„é»˜è®¤å®ç°DefaultThreadFactoryå°±æ˜¯æä¾›åˆ›å»ºçº¿ç¨‹åŠŸèƒ½çš„çº¿ç¨‹å·¥å‚ã€‚ä»–æ˜¯é€šè¿‡newThread()æ–¹æ³•æä¾›åˆ›å»ºçº¿ç¨‹çš„åŠŸèƒ½ï¼ŒnewThread()æ–¹æ³•åˆ›å»ºçš„çº¿ç¨‹éƒ½æ˜¯â€œéå®ˆæŠ¤çº¿ç¨‹â€è€Œä¸”â€œçº¿ç¨‹ä¼˜å…ˆçº§éƒ½æ˜¯Thread.NORM_PRIORITYâ€ã€‚ handleræ‹’ç»ç­–ç•¥è™½ç„¶æˆ‘ä»¬æœ‰äº†é˜»å¡é˜Ÿåˆ—æ¥å¯¹ä»»åŠ¡è¿›è¡Œç¼“å­˜ï¼Œè¿™ä»ä¸€å®šç¨‹åº¦ä¸Šä¸ºçº¿ç¨‹æ± çš„æ‰§è¡Œæä¾›äº†ç¼“å†²æœŸï¼Œä½†æ˜¯å¦‚æœæ˜¯æœ‰ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œé‚£å°±å­˜åœ¨é˜Ÿåˆ—æ»¡çš„æƒ…å†µï¼Œä¹Ÿå­˜åœ¨å·¥ä½œçº¿ç¨‹çš„æ•°æ®å·²ç»è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°çš„æ—¶å€™ã€‚å¦‚æœè¿™æ—¶å€™å†æœ‰æ–°çš„ä»»åŠ¡æäº¤æ—¶ï¼Œæ˜¾ç„¶çº¿ç¨‹æ± å·²ç»å¿ƒæœ‰ä½™è€ŒåŠ›ä¸è¶³äº†ï¼Œå› ä¸ºæ—¢æ²¡æœ‰ç©ºä½™çš„é˜Ÿåˆ—ç©ºé—´æ¥å­˜æ”¾è¯¥ä»»åŠ¡ï¼Œä¹Ÿæ— æ³•åˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡äº†ï¼Œæ‰€ä»¥è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦æœ‰ä¸€ç§æ‹’ç»ç­–ç•¥ï¼Œå³ handlerã€‚ RejectedExecutionHandlerï¼Œçº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ã€‚æ‰€è°“æ‹’ç»ç­–ç•¥ï¼Œæ˜¯æŒ‡å°†ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­æ—¶ï¼Œçº¿ç¨‹æ± æ‹’ç»è¯¥ä»»åŠ¡æ‰€é‡‡å–çš„ç›¸åº”ç­–ç•¥ã€‚å½“å‘çº¿ç¨‹æ± ä¸­æäº¤ä»»åŠ¡æ—¶ï¼Œå¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å·²ç»é¥±å’Œäº†ï¼Œè€Œä¸”é˜»å¡é˜Ÿåˆ—ä¹Ÿå·²ç»æ»¡äº†ï¼Œåˆ™çº¿ç¨‹æ± ä¼šé€‰æ‹©ä¸€ç§æ‹’ç»ç­–ç•¥æ¥å¤„ç†è¯¥ä»»åŠ¡ã€‚ çº¿ç¨‹æ± æä¾›äº†å››ç§æ‹’ç»ç­–ç•¥ï¼š AbortPolicyï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤ç­–ç•¥ï¼› CallerRunsPolicyï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼› DiscardOldestPolicyï¼šä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼› DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼› å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°è‡ªå·±çš„æ‹’ç»ç­–ç•¥ï¼Œä¾‹å¦‚è®°å½•æ—¥å¿—ç­‰ç­‰ï¼Œå®ç°RejectedExecutionHandleræ¥å£å³å¯ã€‚ çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹äº†è§£äº†çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„é‡è¦å±æ€§ä¹‹åï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦æ¥äº†è§£ä¸‹çº¿ç¨‹æ± çš„å·¥ä½œæµç¨‹äº†ã€‚ ä¸Šå›¾æ˜¯ä¸€å¼ çº¿ç¨‹æ± å·¥ä½œçš„ç²¾ç®€å›¾ï¼Œå®é™…çš„è¿‡ç¨‹æ¯”è¿™ä¸ªè¦å¤æ‚çš„å¤šï¼Œä¸è¿‡è¿™äº›åº”è¯¥èƒ½å¤Ÿå®Œå…¨è¦†ç›–åˆ°çº¿ç¨‹æ± çš„æ•´ä¸ªå·¥ä½œæµç¨‹äº†ã€‚ æ•´ä¸ªè¿‡ç¨‹å¯ä»¥æ‹†åˆ†æˆä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š æäº¤ä»»åŠ¡ å½“å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªæ–°çš„ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± æœ‰ä¸‰ç§å¤„ç†æƒ…å†µï¼Œåˆ†åˆ«æ˜¯ï¼šåˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡ã€å°†ä»»åŠ¡åŠ å…¥é˜»å¡é˜Ÿåˆ—ã€æ‹’ç»è¯¥ä»»åŠ¡ã€‚ æäº¤ä»»åŠ¡çš„è¿‡ç¨‹ä¹Ÿå¯ä»¥æ‹†åˆ†æˆä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š å½“å·¥ä½œçº¿ç¨‹æ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œç›´æ¥åˆ›å»ºæ–°çš„æ ¸å¿ƒå·¥ä½œçº¿ç¨‹ å½“å·¥ä½œçº¿ç¨‹æ•°ä¸å°äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œå°±éœ€è¦å°è¯•å°†ä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­å» å¦‚æœèƒ½å¤ŸåŠ å…¥æˆåŠŸï¼Œè¯´æ˜é˜Ÿåˆ—è¿˜æ²¡æœ‰æ»¡ï¼Œé‚£ä¹ˆéœ€è¦åšä»¥ä¸‹çš„äºŒæ¬¡éªŒè¯æ¥ä¿è¯æ·»åŠ è¿›å»çš„ä»»åŠ¡èƒ½å¤ŸæˆåŠŸè¢«æ‰§è¡Œ éªŒè¯å½“å‰çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœæ˜¯éRUNNINGçŠ¶æ€ï¼Œåˆ™éœ€è¦å°†ä»»åŠ¡ä»é˜»å¡é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œç„¶åæ‹’ç»è¯¥ä»»åŠ¡ éªŒè¯å½“å‰çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹çš„ä¸ªæ•°ï¼Œå¦‚æœä¸º0ï¼Œåˆ™éœ€è¦ä¸»åŠ¨æ·»åŠ ä¸€ä¸ªç©ºå·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œåˆšåˆšæ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ å¦‚æœåŠ å…¥å¤±è´¥ï¼Œåˆ™è¯´æ˜é˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œé‚£ä¹ˆè¿™æ—¶å°±éœ€è¦åˆ›å»ºæ–°çš„â€œä¸´æ—¶â€å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ å¦‚æœåˆ›å»ºæˆåŠŸï¼Œåˆ™ç›´æ¥æ‰§è¡Œè¯¥ä»»åŠ¡ å¦‚æœåˆ›å»ºå¤±è´¥ï¼Œåˆ™è¯´æ˜å·¥ä½œçº¿ç¨‹æ•°å·²ç»ç­‰äºæœ€å¤§çº¿ç¨‹æ•°äº†ï¼Œåˆ™åªèƒ½æ‹’ç»è¯¥ä»»åŠ¡äº† æ•´ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ä¸‹é¢è¿™å¼ å›¾æ¥è¡¨ç¤ºï¼š åˆ›å»ºå·¥ä½œçº¿ç¨‹åˆ›å»ºå·¥ä½œçº¿ç¨‹éœ€è¦åšä¸€ç³»åˆ—çš„åˆ¤æ–­ï¼Œéœ€è¦ç¡®ä¿å½“å‰çº¿ç¨‹æ± å¯ä»¥åˆ›å»ºæ–°çš„çº¿ç¨‹ä¹‹åï¼Œæ‰èƒ½åˆ›å»ºã€‚ é¦–å…ˆï¼Œå½“çº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯ SHUTDOWN æˆ–è€… STOP æ—¶ï¼Œåˆ™ä¸èƒ½åˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚ å¦å¤–ï¼Œå½“çº¿ç¨‹å·¥å‚åˆ›å»ºçº¿ç¨‹å¤±è´¥æ—¶ï¼Œä¹Ÿä¸èƒ½åˆ›å»ºæ–°çš„çº¿ç¨‹ã€‚ è¿˜æœ‰å°±æ˜¯å½“å‰å·¥ä½œçº¿ç¨‹çš„æ•°é‡ä¸æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå‰è€…å¤§äºåè€…çš„è¯ï¼Œä¹Ÿä¸å…è®¸åˆ›å»ºã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œä¼šå°è¯•é€šè¿‡ CAS æ¥è‡ªå¢å·¥ä½œçº¿ç¨‹çš„ä¸ªæ•°ï¼Œå¦‚æœè‡ªå¢æˆåŠŸäº†ï¼Œåˆ™ä¼šåˆ›å»ºæ–°çš„å·¥ä½œçº¿ç¨‹ï¼Œå³ Worker å¯¹è±¡ã€‚ ç„¶ååŠ é”è¿›è¡ŒäºŒæ¬¡éªŒè¯æ˜¯å¦èƒ½å¤Ÿåˆ›å»ºå·¥ä½œçº¿ç¨‹ï¼Œæœ€åå¦‚æœåˆ›å»ºæˆåŠŸï¼Œåˆ™ä¼šå¯åŠ¨è¯¥å·¥ä½œçº¿ç¨‹ã€‚ å¯åŠ¨å·¥ä½œçº¿ç¨‹å½“å·¥ä½œçº¿ç¨‹åˆ›å»ºæˆåŠŸåï¼Œä¹Ÿå°±æ˜¯ Worker å¯¹è±¡å·²ç»åˆ›å»ºå¥½äº†ï¼Œè¿™æ—¶å°±éœ€è¦å¯åŠ¨è¯¥å·¥ä½œçº¿ç¨‹ï¼Œè®©çº¿ç¨‹å¼€å§‹å¹²æ´»äº†ï¼ŒWorker å¯¹è±¡ä¸­å…³è”ç€ä¸€ä¸ª Threadï¼Œæ‰€ä»¥è¦å¯åŠ¨å·¥ä½œçº¿ç¨‹çš„è¯ï¼Œåªè¦é€šè¿‡ worker.thread.start() æ¥å¯åŠ¨è¯¥çº¿ç¨‹å³å¯ã€‚ å¯åŠ¨å®Œäº†ä¹‹åï¼Œå°±ä¼šæ‰§è¡Œ Worker å¯¹è±¡çš„ run æ–¹æ³•ï¼Œå› ä¸º Worker å®ç°äº† Runnable æ¥å£ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Š Worker ä¹Ÿæ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚ é€šè¿‡çº¿ç¨‹ start å¼€å¯ä¹‹åå°±ä¼šè°ƒç”¨åˆ° Runnable çš„ run æ–¹æ³•ï¼Œåœ¨ worker å¯¹è±¡çš„ run æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº† runWorker(this) æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æŠŠå½“å‰å¯¹è±¡ä¼ é€’ç»™äº† runWorker æ–¹æ³•ï¼Œè®©ä»–æ¥æ‰§è¡Œã€‚ è·å–ä»»åŠ¡å¹¶æ‰§è¡Œåœ¨ runWorker æ–¹æ³•è¢«è°ƒç”¨ä¹‹åï¼Œå°±æ˜¯æ‰§è¡Œå…·ä½“çš„ä»»åŠ¡äº†ï¼Œé¦–å…ˆéœ€è¦æ‹¿åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè€Œ Worker å¯¹è±¡ä¸­é»˜è®¤ç»‘å®šäº†ä¸€ä¸ªä»»åŠ¡ï¼Œå¦‚æœè¯¥ä»»åŠ¡ä¸ä¸ºç©ºçš„è¯ï¼Œé‚£ä¹ˆå°±æ˜¯ç›´æ¥æ‰§è¡Œã€‚ æ‰§è¡Œå®Œäº†ä¹‹åï¼Œå°±ä¼šå»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡æ¥æ‰§è¡Œï¼Œè€Œè·å–ä»»åŠ¡çš„è¿‡ç¨‹ï¼Œéœ€è¦è€ƒè™‘å½“å‰å·¥ä½œçº¿ç¨‹çš„ä¸ªæ•°ã€‚ å¦‚æœå·¥ä½œçº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆå°±éœ€è¦é€šè¿‡ poll æ¥è·å–ï¼Œå› ä¸ºè¿™æ—¶éœ€è¦å¯¹é—²ç½®çš„çº¿ç¨‹è¿›è¡Œå›æ”¶ï¼› å¦‚æœå·¥ä½œçº¿ç¨‹æ•°å°äºç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ take æ¥è·å–äº†ï¼Œå› æ­¤è¿™æ—¶æ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯æ ¸å¿ƒçº¿ç¨‹ï¼Œä¸éœ€è¦è¿›è¡Œå›æ”¶ï¼Œå‰ææ˜¯æ²¡æœ‰è®¾ç½® allowCoreThreadTimeOut æœ¬ç¯‡åŸºæœ¬ç¬”è€…éƒ½æ˜¯å¯¹çº¿ç¨‹æ± çš„åŸºæœ¬æ¨¡å‹ä»¥åŠå†…éƒ¨æ¦‚å¿µè¿›è¡Œåˆ†æï¼Œè¯´å®è¯ï¼Œå†™å®Œä¹‹åè¯»äº†ä¸€éï¼Œæ¯”è¾ƒæŠ½è±¡éš¾ç†è§£ï¼Œä¸‹ç¯‡æˆ‘å°†ä»¥JDKæºç è¿›è¡Œå¯¼è¯»ï¼Œç»§ç»­æ¢ç©¶çº¿ç¨‹æ± çš„å·¥ä½œåŸç†ï¼Œæ•¬è¯·æœŸå¾…ã€‚ã€‚ã€‚ å‚è€ƒèµ„æ–™ ã€æ­»ç£•Javaå¹¶å‘ã€‘â€”â€“J.U.Cä¹‹çº¿ç¨‹æ± ï¼šThreadPoolExecutor","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"JVMåŠå¹¶å‘ç¼–ç¨‹","slug":"JVMåŠå¹¶å‘ç¼–ç¨‹","permalink":"http://ltyeamin.github.io/tags/JVMåŠå¹¶å‘ç¼–ç¨‹/"}]},{"title":"ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-Javaçº¿ç¨‹æ± åŸºç¡€","slug":"ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-Javaçº¿ç¨‹æ± åŸºç¡€","date":"2018-06-08T14:45:07.000Z","updated":"2019-11-20T15:08:57.568Z","comments":true,"path":"2018/06/08/ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-Javaçº¿ç¨‹æ± åŸºç¡€/","link":"","permalink":"http://ltyeamin.github.io/2018/06/08/ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-Javaçº¿ç¨‹æ± åŸºç¡€/","excerpt":"","text":"çº¿ç¨‹æ± æ˜¯é™åˆ¶ç³»ç»Ÿä¸­æ‰§è¡Œçº¿ç¨‹çš„æ•°é‡ï¼Œå¹¶èƒ½å¤Ÿæ ¹æ®ä¸€å®šçš„ç­–ç•¥å›æ”¶çº¿ç¨‹å¹¶é‡å¤ä½¿ç”¨ã€‚JDK1.5ä¹‹ååŠ å…¥äº†java.util.concurrentåŒ…ï¼Œæˆ‘ä»¬æ—¥å¸¸ç§°ä¹‹ä¸ºJ.U.Cå¹¶å‘åŒ…ï¼Œè¿™ä¸ªåŒ…å¯¹æˆ‘ä»¬æ—¥å¸¸è§£å†³å¹¶å‘æä¾›äº†éå¸¸å¤§çš„å¸®åŠ©ã€‚ æ ¹æ®ç³»ç»Ÿçš„ç¯å¢ƒæƒ…å†µï¼Œå¯ä»¥è‡ªåŠ¨æˆ–æ‰‹åŠ¨è®¾ç½®çº¿ç¨‹æ•°é‡ï¼Œè¾¾åˆ°è¿è¡Œçš„æœ€ä½³æ•ˆæœï¼›å°‘äº†æµªè´¹äº†ç³»ç»Ÿèµ„æºï¼Œå¤šäº†é€ æˆç³»ç»Ÿæ‹¥æŒ¤æ•ˆç‡ä¸é«˜ã€‚ç”¨çº¿ç¨‹æ± æ§åˆ¶çº¿ç¨‹æ•°é‡ï¼Œå…¶ä»–çº¿ç¨‹æ’é˜Ÿç­‰å€™ã€‚ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå†ä»é˜Ÿåˆ—çš„ä¸­å–æœ€å‰é¢çš„ä»»åŠ¡å¼€å§‹æ‰§è¡Œã€‚è‹¥é˜Ÿåˆ—ä¸­æ²¡æœ‰ç­‰å¾…è¿›ç¨‹ï¼Œçº¿ç¨‹æ± çš„è¿™ä¸€èµ„æºå¤„äºç­‰å¾…ã€‚å½“ä¸€ä¸ªæ–°ä»»åŠ¡éœ€è¦è¿è¡Œæ—¶ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­æœ‰ç­‰å¾…çš„å·¥ä½œçº¿ç¨‹ï¼Œå°±å¯ä»¥å¼€å§‹è¿è¡Œäº†ï¼›å¦åˆ™è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚ ä¸“ä¸šè§£é‡Š:çº¿ç¨‹æ± ç®¡ç†ä¸€ä¸ªå·¥ä½œè€…çº¿ç¨‹çš„åŒæ„æ± ï¼Œçº¿ç¨‹æ± æ˜¯ä¸å·¥ä½œé˜Ÿåˆ—ç´§å¯†ç»‘å®šã€‚æ‰€è°“å·¥ä½œé˜Ÿåˆ—ï¼Œå…¶ä½œç”¨æ˜¯æŒæœ‰æ‰€æœ‰ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚å·¥ä½œè€…çº¿ç¨‹çš„ç”Ÿæ´»ä»æ­¤è½»æ¾èµ·æ¥:å®ƒä»å·¥ä½œé˜Ÿåˆ—ä¸­è·å–ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œå®ƒï¼Œç„¶åå›æ¥ç»§ç»­ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ã€‚ æ˜¾ç¤ºåˆ›å»ºçº¿ç¨‹å¼Šç«¯åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ¯æ¬¡æ˜¾ç¤ºçš„new Thread().start()ï¼Œä¼šå­˜åœ¨å¾ˆå¤§çš„æ€§èƒ½ç¼ºé™·: çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçš„å¼€é”€æ¯”è¾ƒå¤§ã€‚çº¿ç¨‹çš„åˆ›å»ºä¸å…³é—­éƒ½å¾ˆè€—æ—¶ï¼Œå¯¹äºè®¡ç®—æœºæ¥è®²ï¼Œæ˜¯ä¸ªä¸å®¹æ˜“çš„äº‹æƒ…ã€‚ æ´»åŠ¨çº¿ç¨‹ä¼šå¾ˆæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œå°¤å…¶æ˜¯å†…å­˜ã€‚å¦‚æœå¯è¿è¡Œçš„çº¿ç¨‹æ•°å¤šäºå¯ç”¨çš„å¤„ç†å™¨å†…æ ¸æ•°é‡ã€‚å¦‚æœå¤§é‡çº¿ç¨‹ç©ºé—²ï¼Œä¼šå ç”¨æ›´å¤šçš„å†…å­˜ï¼Œç»™åƒåœ¾å›æ”¶å¸¦æ¥å‹åŠ›ã€‚å¦‚æœå¤§é‡çº¿ç¨‹ç¹å¿™ï¼Œå¯¼è‡´å¤§é‡çº¿ç¨‹åŒæ—¶ç«äº‰CPUèµ„æºï¼Œæ€§èƒ½å¼€é”€å¤šï¼Œé€ æˆç¨‹åºå‡æ­»ï¼Œè®¡ç®—æœºæ­»æœºç­‰å±å®³ã€‚ ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§å·®ã€‚åˆ†æ•£çš„çº¿ç¨‹å¤šäº†æ— æ³•é›†ä¸­å¼ç®¡ç†ï¼Œä»è€Œå¯¼è‡´æ„æƒ³ä¸åˆ°çš„BUGï¼Œæ¯”å¦‚ä¸€ç›´åˆ›å»ºçº¿ç¨‹é€ æˆçš„OOMé—®é¢˜ã€‚ Executoræ¡†æ¶ä½œä¸ºçº¿ç¨‹æ± çš„ä¸€éƒ¨åˆ†ï¼ŒJDK1.5ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—é˜²æ­¢åº”ç”¨ç¨‹åºè¿‡è½½è€Œè€—å°½å†…å­˜çš„Executoræ¡†æ¶ï¼Œè¯¥çº¿ç¨‹æ± å®ç°ç»†èŠ‚åœ¨java.util.comcurrentåŒ…ä¸‹ï¼ˆç®€ç§°å¹¶å‘åŒ…/J.U.CåŒ…ï¼‰ã€‚åœ¨Javaç±»åº“ä¸­ï¼Œä»»åŠ¡æ‰§è¡Œçš„é¦–è¦æŠ½è±¡ä¸æ˜¯Threadï¼Œè€Œæ˜¯Executorï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ˜¯ç®€å•Executoræ¡†æ¶æŠ½è±¡ä¾èµ–: Executoråªæ˜¯ç®€å•çš„æ¥å£ï¼Œè¿™ä¸ªæ¡†æ¶å¯ä»¥ç”¨äºå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œï¼Œè€Œä¸”æ”¯æŒå¤šç§ç±»å‹çš„ä»»åŠ¡æ‰§è¡Œç­–ç•¥ã€‚å®ƒä¸ºä»»åŠ¡æäº¤å’Œä»»åŠ¡æ‰§è¡Œä¹‹é—´çš„è§£è€¦æä¾›äº†æ ‡å‡†çš„æ–¹æ³•ï¼Œä¸ºä½¿ç”¨Runnableæè¿°ä»»åŠ¡æä¾›äº†é€šç”¨æ–¹å¼ã€‚Executorçš„å®ç°è¿˜æä¾›äº†å¯¹ç”Ÿå‘½å‘¨æœŸçš„æ”¯æŒä»¥åŠé’©å­å‡½æ•°ï¼Œå¯ä»¥æ·»åŠ è¯¸å¦‚ç»Ÿè®¡æ”¶é›†ã€åº”ç”¨ç¨‹åºç®¡ç†æœºåˆ¶å’Œç›‘è§†å™¨ç­‰æ‰©å±•ã€‚ ExecutoråŸºäºç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ã€‚æäº¤ä»»åŠ¡çš„æ‰§è¡Œè€…æ˜¯ç”Ÿäº§è€…(äº§ç”Ÿå¾…å®Œæˆçš„å·¥ä½œå•å…ƒ)ï¼Œæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ˜¯æ¶ˆè´¹è€…(æ¶ˆè€—æ‰è¿™äº›å·¥ä½œå•å…ƒ)ã€‚Executorï¼Œä»»åŠ¡çš„æ‰§è¡Œè€…ï¼Œçº¿ç¨‹æ± æ¡†æ¶ä¸­å‡ ä¹æ‰€æœ‰ç±»éƒ½ç›´æ¥æˆ–è€…é—´æ¥å®ç°Executoræ¥å£ï¼Œå®ƒæ˜¯çº¿ç¨‹æ± æ¡†æ¶çš„åŸºç¡€ã€‚Executoræä¾›äº†ä¸€ç§å°†â€œä»»åŠ¡æäº¤â€ä¸â€œä»»åŠ¡æ‰§è¡Œâ€åˆ†ç¦»å¼€æ¥çš„æœºåˆ¶ï¼Œå®ƒä»…æä¾›äº†ä¸€ä¸ªExecute()æ–¹æ³•ç”¨æ¥æ‰§è¡Œå·²ç»æäº¤çš„Runnableä»»åŠ¡ã€‚ Executoræ¥å£æ¦‚è¿°12345678package java.util.concurrent;public interface Executor &#123; /** * æ–¹æ³•æè¿°ï¼šæŠ½è±¡å‡ºæ¥çš„ä»»åŠ¡æ‰§è¡Œæ–¹æ³•ï¼Œæ–¹ä¾¿åç»­ä¸åŒç±»å‹çš„çº¿ç¨‹æ± çš„æ‰§è¡Œ * å‚æ•°æè¿°ï¼šRunnableçº¿ç¨‹ä»»åŠ¡å¯¹è±¡ */ void execute(Runnable command);&#125; ExcutorServiceæ¥å£æ¦‚è¿°ç»§æ‰¿Executorï¼Œå®ƒæ˜¯â€œæ‰§è¡Œè€…æœåŠ¡â€æ¥å£ï¼Œå®ƒæ˜¯ä¸ºâ€æ‰§è¡Œè€…æ¥å£Executorâ€æœåŠ¡è€Œå­˜åœ¨çš„ã€‚å‡†ç¡®çš„åœ°è¯´ï¼ŒExecutorServiceæä¾›äº†â€å°†ä»»åŠ¡æäº¤ç»™æ‰§è¡Œè€…çš„æ¥å£(submitæ–¹æ³•)â€ï¼Œâ€è®©æ‰§è¡Œè€…æ‰§è¡Œä»»åŠ¡(invokeAll, invokeAnyæ–¹æ³•)â€çš„æ¥å£ç­‰ç­‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778package java.util.concurrent;import java.util.List;import java.util.Collection;public interface ExecutorService extends Executor &#123; /** * å¯åŠ¨ä¸€æ¬¡é¡ºåºå…³é—­ï¼Œæ‰§è¡Œä»¥å‰æäº¤çš„ä»»åŠ¡ï¼Œä½†ä¸æ¥å—æ–°ä»»åŠ¡ */ void shutdown(); /** * è¯•å›¾åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„æ´»åŠ¨ä»»åŠ¡ï¼Œæš‚åœå¤„ç†æ­£åœ¨ç­‰å¾…çš„ä»»åŠ¡ï¼Œå¹¶è¿”å›ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ */ List&lt;Runnable&gt; shutdownNow(); /** * å¦‚æœæ­¤æ‰§è¡Œç¨‹åºå·²å…³é—­ï¼Œåˆ™è¿”å› trueã€‚ */ boolean isShutdown(); /** * å¦‚æœå…³é—­åæ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆï¼Œåˆ™è¿”å› true */ boolean isTerminated(); /** * è¯·æ±‚å…³é—­ã€å‘ç”Ÿè¶…æ—¶æˆ–è€…å½“å‰çº¿ç¨‹ä¸­æ–­ï¼Œæ— è®ºå“ªä¸€ä¸ªé¦–å…ˆå‘ç”Ÿä¹‹åï¼Œéƒ½å°†å¯¼è‡´é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆæ‰§è¡Œ */ boolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException; /** * æäº¤ä¸€ä¸ªè¿”å›å€¼çš„ä»»åŠ¡ç”¨äºæ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ªè¡¨ç¤ºä»»åŠ¡çš„æœªå†³ç»“æœçš„ Future */ &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task); /** * æäº¤ä¸€ä¸ª Runnable ä»»åŠ¡ç”¨äºæ‰§è¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä»»åŠ¡çš„ Future */ &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result); /** * æäº¤å¯è¿è¡Œçš„ä»»åŠ¡ä»¥ä¾›æ‰§è¡Œï¼Œå¹¶è¿”å›æœªæ¥çš„ç»“æœï¼Œå¹¶è¿”å›ç»™ç»™å®šç»“æœ */ &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result); /** * æäº¤ä¸€ä¸ª Runnable ä»»åŠ¡ç”¨äºæ‰§è¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä»»åŠ¡çš„ Future */ Future&lt;?&gt; submit(Runnable task); /** * æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå½“æ‰€æœ‰ä»»åŠ¡å®Œæˆæ—¶ï¼Œè¿”å›ä¿æŒä»»åŠ¡çŠ¶æ€å’Œç»“æœçš„ Future åˆ—è¡¨ */ &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException; /** * æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå½“æ‰€æœ‰ä»»åŠ¡å®Œæˆæˆ–è¶…æ—¶æœŸæ»¡æ—¶ï¼ˆæ— è®ºå“ªä¸ªé¦–å…ˆå‘ç”Ÿï¼‰ï¼Œè¿”å›ä¿æŒä»»åŠ¡çŠ¶æ€å’Œç»“æœçš„ Future åˆ—è¡¨ */ &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException; /** * æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå¦‚æœæŸä¸ªä»»åŠ¡å·²æˆåŠŸå®Œæˆï¼ˆä¹Ÿå°±æ˜¯æœªæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œåˆ™è¿”å›å…¶ç»“æœ */ &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException, ExecutionException; /** * æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå¦‚æœåœ¨ç»™å®šçš„è¶…æ—¶æœŸæ»¡å‰æŸä¸ªä»»åŠ¡å·²æˆåŠŸå®Œæˆï¼ˆä¹Ÿå°±æ˜¯æœªæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œåˆ™è¿”å›å…¶ç»“æœ */ &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;&#125; ExecutorServiceæ¥å£æ¦‚è¿°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172package java.util.concurrent;import java.util.List;import java.util.Collection;public interface ExecutorService extends Executor &#123;/** * å¯åŠ¨ä¸€æ¬¡é¡ºåºå…³é—­ï¼Œæ‰§è¡Œä»¥å‰æäº¤çš„ä»»åŠ¡ï¼Œä½†ä¸æ¥å—æ–°ä»»åŠ¡ */void shutdown();/** * è¯•å›¾åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„æ´»åŠ¨ä»»åŠ¡ï¼Œæš‚åœå¤„ç†æ­£åœ¨ç­‰å¾…çš„ä»»åŠ¡ï¼Œå¹¶è¿”å›ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ */List&lt;Runnable&gt; shutdownNow();/** * å¦‚æœæ­¤æ‰§è¡Œç¨‹åºå·²å…³é—­ï¼Œåˆ™è¿”å› trueã€‚ */boolean isShutdown();/** * å¦‚æœå…³é—­åæ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆï¼Œåˆ™è¿”å› true. */boolean isTerminated();/** * è¯·æ±‚å…³é—­ã€å‘ç”Ÿè¶…æ—¶æˆ–è€…å½“å‰çº¿ç¨‹ä¸­æ–­ï¼Œæ— è®ºå“ªä¸€ä¸ªé¦–å…ˆå‘ç”Ÿä¹‹åï¼Œéƒ½å°†å¯¼è‡´é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆæ‰§è¡Œ */boolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException;/** * æäº¤ä¸€ä¸ªè¿”å›å€¼çš„ä»»åŠ¡ç”¨äºæ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ªè¡¨ç¤ºä»»åŠ¡çš„æœªå†³ç»“æœçš„ Future */&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task);/** * æäº¤ä¸€ä¸ª Runnable ä»»åŠ¡ç”¨äºæ‰§è¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä»»åŠ¡çš„ Future */&lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result);/** * æäº¤ä¸€ä¸ª Runnable ä»»åŠ¡ç”¨äºæ‰§è¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä»»åŠ¡çš„ Future */Future&lt;?&gt; submit(Runnable task);/** * æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå½“æ‰€æœ‰ä»»åŠ¡å®Œæˆæ—¶ï¼Œè¿”å›ä¿æŒä»»åŠ¡çŠ¶æ€å’Œç»“æœçš„ Future åˆ—è¡¨ */&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException;/** * æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå½“æ‰€æœ‰ä»»åŠ¡å®Œæˆæˆ–è¶…æ—¶æœŸæ»¡æ—¶ï¼ˆæ— è®ºå“ªä¸ªé¦–å…ˆå‘ç”Ÿï¼‰ï¼Œè¿”å›ä¿æŒä»»åŠ¡çŠ¶æ€å’Œç»“æœçš„ Future åˆ—è¡¨ */&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException;/** * æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå¦‚æœæŸä¸ªä»»åŠ¡å·²æˆåŠŸå®Œæˆï¼ˆä¹Ÿå°±æ˜¯æœªæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œåˆ™è¿”å›å…¶ç»“æœ */&lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException, ExecutionException;/** * æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œå¦‚æœåœ¨ç»™å®šçš„è¶…æ—¶æœŸæ»¡å‰æŸä¸ªä»»åŠ¡å·²æˆåŠŸå®Œæˆï¼ˆä¹Ÿå°±æ˜¯æœªæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œåˆ™è¿”å›å…¶ç»“æœ */&lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;&#125; AbstractExecutorServiceç±»æ¦‚è¿°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196package java.util.concurrent;import java.util.*;public abstract class AbstractExecutorService implements ExecutorService &#123; protected &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Runnable runnable, T value) &#123; return new FutureTask&lt;T&gt;(runnable, value); &#125; protected &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Callable&lt;T&gt; callable) &#123; return new FutureTask&lt;T&gt;(callable); &#125; public Future&lt;?&gt; submit(Runnable task) &#123; if (task == null) throw new NullPointerException(); RunnableFuture&lt;Void&gt; ftask = newTaskFor(task, null); execute(ftask); return ftask; &#125; public &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result) &#123; if (task == null) throw new NullPointerException(); RunnableFuture&lt;T&gt; ftask = newTaskFor(task, result); execute(ftask); return ftask; &#125; public &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task) &#123; if (task == null) throw new NullPointerException(); RunnableFuture&lt;T&gt; ftask = newTaskFor(task); execute(ftask); return ftask; &#125; private &lt;T&gt; T doInvokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, boolean timed, long nanos) throws InterruptedException, ExecutionException, TimeoutException &#123; if (tasks == null) throw new NullPointerException(); int ntasks = tasks.size(); if (ntasks == 0) throw new IllegalArgumentException(); ArrayList&lt;Future&lt;T&gt;&gt; futures = new ArrayList&lt;Future&lt;T&gt;&gt;(ntasks); ExecutorCompletionService&lt;T&gt; ecs = new ExecutorCompletionService&lt;T&gt;(this); try &#123; // Record exceptions so that if we fail to obtain any // result, we can throw the last exception we got. ExecutionException ee = null; final long deadline = timed ? System.nanoTime() + nanos : 0L; Iterator&lt;? extends Callable&lt;T&gt;&gt; it = tasks.iterator(); // Start one task for sure; the rest incrementally futures.add(ecs.submit(it.next())); --ntasks; int active = 1; for (;;) &#123; Future&lt;T&gt; f = ecs.poll(); if (f == null) &#123; if (ntasks &gt; 0) &#123; --ntasks; futures.add(ecs.submit(it.next())); ++active; &#125; else if (active == 0) break; else if (timed) &#123; f = ecs.poll(nanos, TimeUnit.NANOSECONDS); if (f == null) throw new TimeoutException(); nanos = deadline - System.nanoTime(); &#125; else f = ecs.take(); &#125; if (f != null) &#123; --active; try &#123; return f.get(); &#125; catch (ExecutionException eex) &#123; ee = eex; &#125; catch (RuntimeException rex) &#123; ee = new ExecutionException(rex); &#125; &#125; &#125; if (ee == null) ee = new ExecutionException(); throw ee; &#125; finally &#123; for (int i = 0, size = futures.size(); i &lt; size; i++) futures.get(i).cancel(true); &#125; &#125; public &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException, ExecutionException &#123; try &#123; return doInvokeAny(tasks, false, 0); &#125; catch (TimeoutException cannotHappen) &#123; assert false; return null; &#125; &#125; public &lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException &#123; return doInvokeAny(tasks, true, unit.toNanos(timeout)); &#125; public &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException &#123; if (tasks == null) throw new NullPointerException(); ArrayList&lt;Future&lt;T&gt;&gt; futures = new ArrayList&lt;Future&lt;T&gt;&gt;(tasks.size()); boolean done = false; try &#123; for (Callable&lt;T&gt; t : tasks) &#123; RunnableFuture&lt;T&gt; f = newTaskFor(t); futures.add(f); execute(f); &#125; for (int i = 0, size = futures.size(); i &lt; size; i++) &#123; Future&lt;T&gt; f = futures.get(i); if (!f.isDone()) &#123; try &#123; f.get(); &#125; catch (CancellationException ignore) &#123; &#125; catch (ExecutionException ignore) &#123; &#125; &#125; &#125; done = true; return futures; &#125; finally &#123; if (!done) for (int i = 0, size = futures.size(); i &lt; size; i++) futures.get(i).cancel(true); &#125; &#125; public &lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException &#123; if (tasks == null) throw new NullPointerException(); long nanos = unit.toNanos(timeout); ArrayList&lt;Future&lt;T&gt;&gt; futures = new ArrayList&lt;Future&lt;T&gt;&gt;(tasks.size()); boolean done = false; try &#123; for (Callable&lt;T&gt; t : tasks) futures.add(newTaskFor(t)); final long deadline = System.nanoTime() + nanos; final int size = futures.size(); // Interleave time checks and calls to execute in case // executor doesn't have any/much parallelism. for (int i = 0; i &lt; size; i++) &#123; execute((Runnable)futures.get(i)); nanos = deadline - System.nanoTime(); if (nanos &lt;= 0L) return futures; &#125; for (int i = 0; i &lt; size; i++) &#123; Future&lt;T&gt; f = futures.get(i); if (!f.isDone()) &#123; if (nanos &lt;= 0L) return futures; try &#123; f.get(nanos, TimeUnit.NANOSECONDS); &#125; catch (CancellationException ignore) &#123; &#125; catch (ExecutionException ignore) &#123; &#125; catch (TimeoutException toe) &#123; return futures; &#125; nanos = deadline - System.nanoTime(); &#125; &#125; done = true; return futures; &#125; finally &#123; if (!done) for (int i = 0, size = futures.size(); i &lt; size; i++) futures.get(i).cancel(true); &#125; &#125;&#125; æŠ½è±¡ç±»ï¼Œå®ç°ExecutorServiceæ¥å£ï¼Œä¸ºå…¶æä¾›é»˜è®¤å®ç°ã€‚AbstractExecutorServiceé™¤äº†å®ç°ExecutorServiceæ¥å£å¤–ï¼Œè¿˜æä¾›äº†ä¸¤ä¸ªnewTaskFor()é‡è½½æ–¹æ³•ï¼Œä¸€ä¸ªæ”¯æŒRunnableä»»åŠ¡ï¼Œä¸€ä¸ªæ”¯æŒå¸¦æœ‰æ‰§è¡Œç»“æœçš„Callableä»»åŠ¡ï¼Œæ‰§è¡Œåè¿”å›ä¸€ä¸ªRunnableFutureï¼Œåœ¨è¿è¡Œçš„æ—¶å€™ï¼Œå®ƒå°†è°ƒç”¨åº•å±‚å¯è°ƒç”¨ä»»åŠ¡ï¼Œä½œä¸º Future ä»»åŠ¡ï¼Œå®ƒå°†ç”Ÿæˆå¯è°ƒç”¨çš„ç»“æœä½œä¸ºå…¶ç»“æœï¼Œå¹¶ä¸ºåº•å±‚ä»»åŠ¡æä¾›å–æ¶ˆæ“ä½œã€‚ åŒæ—¶è¯¥æŠ½è±¡ç±»ä¹Ÿæä¾›äº†ä¸¤ä¸ªsubmit()æ–¹æ³•ï¼Œä¸€ä¸ªåªæäº¤Runnableä»»åŠ¡ï¼Œä¸€ä¸ªæäº¤Runnableçš„ä»»åŠ¡å¹¶å°†è¿”å›çš„æœªæ¥çš„é»˜è®¤å€¼å°è£…åˆ°ç¬¬äºŒä¸ªè¿”å›å‚æ•°ä¸­ã€‚ ScheduledExecutorServiceæ¥å£æ¦‚è¿°1234567891011121314151617181920212223242526package java.util.concurrent;public interface ScheduledExecutorService extends ExecutorService &#123; /** * åˆ›å»ºå¹¶æ‰§è¡Œåœ¨ç»™å®šå»¶è¿Ÿåå¯ç”¨çš„ ScheduledFutureã€‚ */ public ScheduledFuture&lt;?&gt; schedule(Runnable command, long delay, TimeUnit unit); /** * åˆ›å»ºå¹¶æ‰§è¡Œåœ¨ç»™å®šå»¶è¿Ÿåå¯ç”¨çš„ä¸€æ¬¡æ€§æ“ä½œã€‚ */ public &lt;V&gt; ScheduledFuture&lt;V&gt; schedule(Callable&lt;V&gt; callable,long delay, TimeUnit unit); /** * åˆ›å»ºå¹¶æ‰§è¡Œä¸€ä¸ªåœ¨ç»™å®šåˆå§‹å»¶è¿Ÿåé¦–æ¬¡å¯ç”¨çš„å®šæœŸæ“ä½œï¼Œåç»­æ“ä½œå…·æœ‰ç»™å®šçš„å‘¨æœŸï¼› * ä¹Ÿå°±æ˜¯å°†åœ¨ initialDelay åå¼€å§‹æ‰§è¡Œï¼Œç„¶ååœ¨ initialDelay+period åæ‰§è¡Œï¼Œæ¥ç€åœ¨ initialDelay+2* period åæ‰§è¡Œï¼Œä¾æ­¤ç±»æ¨ã€‚ */ public ScheduledFuture&lt;?&gt; scheduleAtFixedRate(Runnable command,long initialDelay, long period,TimeUnit unit); /** * åˆ›å»ºå¹¶æ‰§è¡Œä¸€ä¸ªåœ¨ç»™å®šåˆå§‹å»¶è¿Ÿåé¦–æ¬¡å¯ç”¨çš„å®šæœŸæ“ä½œï¼Œéšåï¼Œåœ¨æ¯ä¸€æ¬¡æ‰§è¡Œç»ˆæ­¢å’Œä¸‹ä¸€æ¬¡æ‰§è¡Œå¼€å§‹ä¹‹é—´éƒ½å­˜åœ¨ç»™å®šçš„å»¶è¿Ÿã€‚ */ public ScheduledFuture&lt;?&gt; scheduleWithFixedDelay(Runnable command,long initialDelay,long delay, TimeUnit unit);&#125; ThreadPoolExecutorç±»æ¦‚è¿°æˆ‘ä»¬Javaçº¿ç¨‹æ± ä¸»è¦æ˜¯å›´ç»•ThreadPoolExecutorç±»å±•å¼€çš„ï¼Œåç»­ä¼šå¯¹ThreadPoolExecutorè¯¦è§£ã€‚ Executorsç±»æ¦‚è¿°å’ŒThreadPoolExecutorä¸€æ ·åç»­ä¼šè¯¦è§£ï¼Œè¯¥ç±»æ˜¯çº¿ç¨‹æ± çš„é™æ€å·¥å‚ç±»ï¼Œæä¾›äº†Executorã€ExecutorServiceã€ScheduledExecutorServiceã€ThreadFactory ã€Callable ç­‰ç±»çš„é™æ€å·¥å‚æ–¹æ³•ï¼Œé€šè¿‡è¿™äº›å·¥å‚æ–¹æ³•æˆ‘ä»¬å¯ä»¥å¾—åˆ°ç›¸å¯¹åº”çš„å¯¹è±¡ã€‚ åˆ›å»ºå¹¶è¿”å›è®¾ç½®æœ‰å¸¸ç”¨é…ç½®å­—ç¬¦ä¸²çš„ ExecutorService çš„æ–¹æ³•ã€‚ åˆ›å»ºå¹¶è¿”å›è®¾ç½®æœ‰å¸¸ç”¨é…ç½®å­—ç¬¦ä¸²çš„ ScheduledExecutorService çš„æ–¹æ³•ã€‚ åˆ›å»ºå¹¶è¿”å›â€œåŒ…è£…çš„â€ExecutorService æ–¹æ³•ï¼Œå®ƒé€šè¿‡ä½¿ç‰¹å®šäºå®ç°çš„æ–¹æ³•ä¸å¯è®¿é—®æ¥ç¦ç”¨é‡æ–°é…ç½®ã€‚ åˆ›å»ºå¹¶è¿”å› ThreadFactory çš„æ–¹æ³•ï¼Œå®ƒå¯å°†æ–°åˆ›å»ºçš„çº¿ç¨‹è®¾ç½®ä¸ºå·²çŸ¥çš„çŠ¶æ€ã€‚ åˆ›å»ºå¹¶è¿”å›éé—­åŒ…å½¢å¼çš„ Callable çš„æ–¹æ³•ï¼Œè¿™æ ·å¯å°†å…¶ç”¨äºéœ€è¦ Callable çš„æ‰§è¡Œæ–¹æ³•ä¸­ã€‚ Futureæ¥å£Futureæ¥å£å’Œå®ç°Futureæ¥å£çš„FutureTaskä»£è¡¨äº†çº¿ç¨‹æ± çš„å¼‚æ­¥è®¡ç®—ç»“æœã€‚ AbstractExecutorServiceæä¾›äº†newTaskFor()æ–¹æ³•è¿”å›ä¸€ä¸ªRunnableFutureï¼Œé™¤æ­¤ä¹‹å¤–å½“æˆ‘ä»¬æŠŠä¸€ä¸ªRunnableæˆ–è€…Callableæäº¤ç»™ï¼ˆsubmit()ï¼‰ThreadPoolExecutoræˆ–è€…ScheduledThreadPoolExecutoræ—¶ï¼Œä»–ä»¬åˆ™ä¼šå‘æˆ‘ä»¬è¿”å›ä¸€ä¸ªFutureTaskå¯¹è±¡ã€‚å¦‚ä¸‹ï¼š 1234567891011protected &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Runnable runnable, T value) &#123; return new FutureTask&lt;T&gt;(runnable, value);&#125;protected &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Callable&lt;T&gt; callable) &#123; return new FutureTask&lt;T&gt;(callable);&#125;&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task) &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result) Future&lt;&gt; submit(Runnable task) Futureæ¥å£æ¦‚è¿°ä½œä¸ºå¼‚æ­¥è®¡ç®—çš„é¡¶å±‚æ¥å£ï¼ŒFutureå¯¹å…·ä½“çš„Runnableæˆ–è€…Callableä»»åŠ¡æä¾›äº†ä¸‰ç§æ“ä½œï¼šæ‰§è¡Œä»»åŠ¡çš„å–æ¶ˆã€æŸ¥è¯¢ä»»åŠ¡æ˜¯å¦å®Œæˆã€è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚å…¶æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233package java.util.concurrent;public interface Future&lt;V&gt; &#123; /** * è¯•å›¾å–æ¶ˆå¯¹æ­¤ä»»åŠ¡çš„æ‰§è¡Œ * å¦‚æœä»»åŠ¡å·²å®Œæˆã€æˆ–å·²å–æ¶ˆï¼Œæˆ–è€…ç”±äºæŸäº›å…¶ä»–åŸå› è€Œæ— æ³•å–æ¶ˆï¼Œåˆ™æ­¤å°è¯•å°†å¤±è´¥ã€‚ * å½“è°ƒç”¨ cancel æ—¶ï¼Œå¦‚æœè°ƒç”¨æˆåŠŸï¼Œè€Œæ­¤ä»»åŠ¡å°šæœªå¯åŠ¨ï¼Œåˆ™æ­¤ä»»åŠ¡å°†æ°¸ä¸è¿è¡Œã€‚ * å¦‚æœä»»åŠ¡å·²ç»å¯åŠ¨ï¼Œåˆ™ mayInterruptIfRunning å‚æ•°ç¡®å®šæ˜¯å¦åº”è¯¥ä»¥è¯•å›¾åœæ­¢ä»»åŠ¡çš„æ–¹å¼æ¥ä¸­æ–­æ‰§è¡Œæ­¤ä»»åŠ¡çš„çº¿ç¨‹ */ boolean cancel(boolean mayInterruptIfRunning); /** * å¦‚æœåœ¨ä»»åŠ¡æ­£å¸¸å®Œæˆå‰å°†å…¶å–æ¶ˆï¼Œåˆ™è¿”å› true */ boolean isCancelled(); /** * å¦‚æœä»»åŠ¡å·²å®Œæˆï¼Œåˆ™è¿”å› true */ boolean isDone(); /** * å¦‚æœ‰å¿…è¦ï¼Œç­‰å¾…è®¡ç®—å®Œæˆï¼Œç„¶åè·å–å…¶ç»“æœ */ V get() throws InterruptedException, ExecutionException; /** * å¦‚æœ‰å¿…è¦ï¼Œæœ€å¤šç­‰å¾…ä¸ºä½¿è®¡ç®—å®Œæˆæ‰€ç»™å®šçš„æ—¶é—´ä¹‹åï¼Œè·å–å…¶ç»“æœï¼ˆå¦‚æœç»“æœå¯ç”¨ï¼‰ */ V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;&#125; RunnableFutureæ¥å£æ¦‚è¿°ç»§æ‰¿Futureã€Runnableä¸¤ä¸ªæ¥å£ï¼Œä¸ºä¸¤è€…çš„åˆä½“ï¼Œå³æ‰€è°“çš„Runnableçš„Futureã€‚æä¾›äº†ä¸€ä¸ªrun()æ–¹æ³•å¯ä»¥å®ŒæˆFutureå¹¶å…è®¸è®¿é—®å…¶ç»“æœï¼Œå…¶æºç å¦‚ä¸‹ï¼š 123456package java.util.concurrent;public interface RunnableFuture&lt;V&gt; extends Runnable, Future&lt;V&gt; &#123; //åœ¨æœªè¢«å–æ¶ˆçš„æƒ…å†µä¸‹ï¼Œå°†æ­¤ Future è®¾ç½®ä¸ºè®¡ç®—çš„ç»“æœ void run();&#125; FutureTaskæ¥å£æ¦‚è¿°å®ç°RunnableFutureæ¥å£ï¼Œæ—¢å¯ä»¥ä½œä¸ºRunnableè¢«æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä½œä¸ºFutureå¾—åˆ°Callableçš„è¿”å›å€¼ã€‚ å‚è€ƒèµ„æ–™ ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾ J.U.Cä¹‹çº¿ç¨‹æ± ï¼šçº¿ç¨‹æ± çš„åŸºç¡€æ¶æ„","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"JVMåŠå¹¶å‘ç¼–ç¨‹","slug":"JVMåŠå¹¶å‘ç¼–ç¨‹","permalink":"http://ltyeamin.github.io/tags/JVMåŠå¹¶å‘ç¼–ç¨‹/"}]},{"title":"ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-æµ…è°ˆvolatileå†…å­˜å¯è§æ€§","slug":"ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-æµ…è°ˆvolatileå†…å­˜å¯è§æ€§","date":"2018-06-03T02:11:44.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2018/06/03/ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-æµ…è°ˆvolatileå†…å­˜å¯è§æ€§/","link":"","permalink":"http://ltyeamin.github.io/2018/06/03/ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-æµ…è°ˆvolatileå†…å­˜å¯è§æ€§/","excerpt":"","text":"volatileè¿™ä¸ªå…³é”®å­—å¤§å®¶éƒ½å¬è¿‡ï¼Œçœ‹è¿‡è®¸å¤šæºç ä¹Ÿç”¨è¿‡ï¼Œè¿™ä¸ªå…³é”®å­—å¤‡å—äº‰è®®ï¼Œå¾ˆå¤šäººåŸºäºè¡¨é¢ç†è§£è€Œå¯¼è‡´åœ¨å®é™…å¼€å‘è¿‡ç”Ÿä¸­å¤§è‚†è¯¯ç”¨ï¼Œæš´éœ²å‡ºå„å¼å„æ ·çš„é—®é¢˜ï¼Œè®©äººæ‘¸ä¸ç€å¤´è„‘ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å¥½å¥½ç†è§£ä¸€ä¸‹volatileã€‚ ç™¾åº¦ç™¾ç§‘:volatileæ˜¯ä¸€ä¸ªç±»å‹ä¿®é¥°ç¬¦.volatileçš„ä½œç”¨æ˜¯ä½œä¸ºæŒ‡ä»¤å…³é”®å­—ï¼Œç¡®ä¿æœ¬æ¡æŒ‡ä»¤ä¸ä¼šå› ç¼–è¯‘å™¨çš„ä¼˜åŒ–è€Œçœç•¥ï¼Œä¸”è¦æ±‚æ¯æ¬¡ç›´æ¥è¯»å€¼; volatileæ˜¯Javaè™šæ‹Ÿæœºæä¾›çš„è½»é‡çº§åŒæ­¥æœºåˆ¶çš„å…³é”®å­—ï¼Œä½¿è¢«ä¿®é¥°çš„å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹å¯è§ï¼› volatileå˜é‡å…·æœ‰ synchronized çš„å¯è§æ€§ç‰¹æ€§ï¼Œä¸synchronizeæœ‰ç›¸ä¼¼çš„åŒæ­¥åŠŸèƒ½ï¼Œä½†ä¸å…·å¤‡åŸå­ç‰¹æ€§ï¼Œåœ¨å¤šçº¿ç¨‹å¹¶å‘ä¸‹æ˜¯ä¸å®‰å…¨çš„ã€‚ ä¸¤ç§ç‰¹æ€§ç‰¹æ€§å½’çº³å½“ä¸€ä¸ªå˜é‡è¢«å®šä¹‰æˆvolatileä¹‹åï¼Œå®ƒå°†å…·å¤‡å¦‚ä¸‹ä¸¤ç§ç‰¹æ€§: ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ã€‚å³æŒ‡å½“ä¸€æ¡çº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œæ–°å€¼å¯¹äºå…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯å¯ä»¥ç«‹å³æ„ŸçŸ¥çš„ï¼Œè€Œç›¸æ¯”ä¹‹ä¸‹ï¼Œæ™®é€šå˜é‡ä¸èƒ½åšåˆ°è¿™ç‚¹ï¼Œå˜é‡å€¼åœ¨çº¿ç¨‹é—´ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚æ¯”å¦‚çº¿ç¨‹1ä¿®æ”¹açš„å€¼ï¼Œç„¶åå‘ä¸»å†…å­˜è¿›è¡Œå›å†™ï¼Œå¦å¤–ä¸€æ¡çº¿ç¨‹2åœ¨çº¿ç¨‹1å›å†™å®Œæˆäº†ä¹‹åå†ä»ä¸»å†…å­˜è¿›è¡Œè¯»å–æ“ä½œï¼Œæ–°å˜é‡çš„å€¼æ‰ä¼šå¯¹çº¿ç¨‹2å¯è§ã€‚ ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ã€‚æ™®é€šå˜é‡ä»…ä»…ä¼šä¿è¯åœ¨è¯¥æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰ä¾èµ–èµ‹å€¼ç»“æœçš„åœ°æ–¹éƒ½èƒ½è·å–åˆ°æ­£ç¡®çš„ç»“æœï¼Œè€Œä¸èƒ½ä¿è¯å˜é‡èµ‹å€¼æ“ä½œçš„é¡ºåºä¸ç¨‹åºä»£ç ä¸­çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚å› ä¸ºåœ¨ä¸€ä¸ªçº¿ç¨‹çš„æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­æ— æ³•æ„ŸçŸ¥åˆ°è¿™ç‚¹ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œçº¿ç¨‹å†…è¡¨ç°ä¸ºä¸²è¡Œçš„è¯­ä¹‰â€(Within-Thread As-If-Serial Semantics)ã€‚ ä»£ç ç¤ºä¾‹å¤šçº¿ç¨‹å¹¶å‘å®‰å…¨12345678910111213141516171819202122232425262728293031323334353637383940/** * @author tong.li * @description: volatileåªä¿è¯å†…å­˜é—´çº¿ç¨‹å¯è§æ€§,å¹¶ä¸ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ * @date 2018-06-12 11:11:23 */public class VolatileTest &#123; //å…±äº«å˜é‡ public volatile int num = 0; //çº¿ç¨‹æ•°é‡ public static final int THREAD_COUNT = 20; public void add() &#123; //numè¿›è¡ŒéåŸå­æ“ä½œ num++; &#125; public static void main(String[] args) &#123; final VolatileTest test = new VolatileTest(); //åˆ›å»º20ä¸ªçº¿ç¨‹ Thread[] threads = new Thread[THREAD_COUNT]; for (int i = 0; i &lt; THREAD_COUNT ; i++) &#123; threads[i] = new Thread(() -&gt; &#123; //å½“å‰çº¿ç¨‹æ“ä½œ10000æ¬¡å¯¹å…±äº«å˜é‡numè¿›è¡Œè‡ªåŠ æ“ä½œ for (int j = 0; j &lt; 10000; j++) &#123; test.add(); &#125; &#125;); //å¯åŠ¨å½“å‰çº¿ç¨‹ threads[i].start(); &#125; //æ´»åŠ¨çº¿ç¨‹çš„å½“å‰çº¿ç¨‹çš„çº¿ç¨‹ç»„ä¸­çš„æ•°é‡å¤§äº1æ—¶,æ‰§è¡Œçº¿ç¨‹è®©æ­¥,è®©æ´»åŠ¨çš„çº¿ç¨‹å°½å¯èƒ½æ‰§è¡Œå®Œ // while (Thread.activeCount() &gt; 1) &#123; // Thread.yield(); //&#125; //æ‰“å°æœ€ç»ˆç»“æœ,ç»“æœå¤šæ•°å°äº200000,ä¸ºä»€ä¹ˆå‘¢? System.out.println(\"num = \" + test.num); &#125;&#125; è¿è¡Œç»“æœå¦‚ä¸‹: ç¬¬1æ¬¡ 1num = 132203 ç¬¬2æ¬¡ 1num = 160740 ç¬¬3æ¬¡ 1num = 187482 ä¸Šè¿°ä»£ç åˆ›å»º20ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹numè¿›è¡Œ10000æ¬¡è‡ªå¢æ“ä½œï¼Œå¦‚æœä¸Šè¿°ä»£ç æ­£ç¡®å¹¶å‘ï¼ˆä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼‰çš„æƒ…å†µä¸‹ï¼Œæœ€åçš„ç»“æœåº”è¯¥æ˜¯200000ï¼Œä½†æ˜¯ä¸ºå®é™…ä¸‰æ¬¡è¿è¡Œç»“æœä»¤äººåŒªå¤·æ‰€æ€ï¼Œå¤šæ¬¡çš„è¿è¡Œç»“æœå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯å°äº200000ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘ä»¬éƒ½çŸ¥é“num++æ˜¯éåŸå­æ€§æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è¿›è¡Œjavapåç¼–è¯‘ä¸Šè¿°ä»£ç ä¸€æ¢ç©¶ç«Ÿï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137Yeamin:java mac$ javap -c VolatileTestCompiled from \"VolatileTest.java\"public class VolatileTest &#123; public volatile int num; public static final int THREAD_COUNT; public VolatileTest(); Code: 0: aload_0 1: invokespecial #1 // Method java/lang/Object.\"&lt;init&gt;\":()V 4: aload_0 5: iconst_0 6: putfield #2 // Field num:I 9: return public void add(); Code: 0: aload_0 1: dup 2: getfield #2 // Field num:I 5: iconst_1 6: iadd 7: putfield #2 // Field num:I 10: return public static void main(java.lang.String[]); Code: 0: new #3 // class VolatileTest 3: dup 4: invokespecial #4 // Method \"&lt;init&gt;\":()V 7: astore_1 8: bipush 20 10: anewarray #5 // class java/lang/Thread 13: astore_2 14: iconst_0 15: istore_3 16: iload_3 17: bipush 20 19: if_icmpge 52 22: aload_2 23: iload_3 24: new #5 // class java/lang/Thread 27: dup 28: new #6 // class VolatileTest$1 31: dup 32: aload_1 33: invokespecial #7 // Method VolatileTest$1.\"&lt;init&gt;\":(LVolatileTest;)V 36: invokespecial #8 // Method java/lang/Thread.\"&lt;init&gt;\":(Ljava/lang/Runnable;)V 39: aastore 40: aload_2 41: iload_3 42: aaload 43: invokevirtual #9 // Method java/lang/Thread.start:()V 46: iinc 3, 1 49: goto 16 52: invokestatic #10 // Method java/lang/Thread.activeCount:()I 55: iconst_1 56: if_icmple 65 59: invokestatic #11 // Method java/lang/Thread.yield:()V 62: goto 52 65: getstatic #12 // Field java/lang/System.out:Ljava/io/PrintStream; 68: new #13 // class java/lang/StringBuilder 71: dup 72: invokespecial #14 // Method java/lang/StringBuilder.\"&lt;init&gt;\":()V 75: ldc #15 // String num = 77: invokevirtual #16 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder; 80: aload_1 81: getfield #2 // Field num:I 84: invokevirtual #17 // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder; 87: invokevirtual #18 // Method java/lang/StringBuilder.toString:()Ljava/lang/String; 90: invokevirtual #19 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 93: return&#125; åœ¨ä¸Šè¿°åç¼–è¯‘çš„å­—èŠ‚ç åˆ†æå¾—çŸ¥ï¼Œnum++ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå³çº¿ç¨‹ä¸å®‰å…¨ï¼Œå¯ä»¥å°†num++ç®€å•åˆ†è§£æˆä»¥ä¸‹å‡ ä¸ªæ­¥éª¤: ä»å†…å­˜ä¸­å–å‡ºnumçš„å€¼ï¼› è®¡ç®—numçš„å€¼ï¼› å°†numçš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ add()æ–¹æ³•æœ‰6æ¡æŒ‡ä»¤ï¼ˆæ¯ä¸ªæŒ‡ä»¤å¯èƒ½å«æœ‰å¤šä¸ªåº•å±‚æŒ‡ä»¤æ“ä½œï¼Œåªä¸ºç ”ç©¶ï¼Œå¹¶ä¸å‡†ç¡®ï¼Œè¦æƒ³å‡†ç¡®ç ”ç©¶å»ºè®®ä½¿ç”¨-XX:+PrintAssemblyå‚æ•°è¾“å‡ºåæ±‡ç¼–ï¼‰ï¼Œå…¶ä¸­returnæŒ‡ä»¤å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå› ä¸ºä¸æ˜¯num++äº§ç”Ÿçš„ã€‚ aload_0ï¼šåœ¨éé™æ€æ–¹æ³•ä¸­ï¼Œaload_0 è¡¨ç¤ºå¯¹thisçš„æ“ä½œï¼Œåœ¨static æ–¹æ³•ä¸­ï¼Œaload_0è¡¨ç¤ºå¯¹æ–¹æ³•çš„ç¬¬ä¸€å‚æ•°çš„æ“ä½œï¼› dupï¼šå¤åˆ¶æ“ä½œæ•°æ ˆé¡¶å€¼ï¼Œå¹¶å°†å…¶å‹å…¥æ ˆé¡¶ï¼Œåœ¨è¿™é‡Œæ˜¯å°†å½“å‰VolatileTestä¸‹newå¯¹è±¡å‹å…¥æ ˆé¡¶ï¼› getfield/getstaticï¼šå°†æ ˆé¡¶çš„å¯¹è±¡ç¬¬äºŒä¸ªå®ä¾‹å­—æ®µå‹å…¥æ ˆé¡¶ï¼Œå³å°†numçš„å€¼å‹å…¥æ ˆé¡¶ï¼Œæ­¤æ—¶numçš„å€¼æ˜¯æœ€æ–°çš„ï¼› iconst_1ï¼šå°†intå‹(1)æ¨é€è‡³æ ˆé¡¶ï¼Œå³æŠŠå¸¸é‡1å‹å…¥æ ˆé¡¶ï¼› iaddï¼šæŠŠæ“ä½œæ•°æ ˆä¸­çš„å‰ä¸¤ä¸ªintå€¼å‡ºæ ˆå¹¶ç›¸åŠ ,æ“ä½œè¿‡ååªåœ¨stackä¸­ä¿ç•™ç»“æœï¼Œå³ä½¿numå½“å‰å€¼+1ä¿ç•™åœ¨æ ˆä¸­ï¼Œè¿™é‡Œå¤šçº¿ç¨‹æ—¶å€™å¯èƒ½å‡ºç°é—®é¢˜ï¼Œå…¶ä»–çº¿ç¨‹ç›¸åŠ çš„ç»“æœä¼šè¦†ç›–å½“å‰æ ˆé¡¶çš„ç»“æœï¼Œå› è€Œè¿”å›è¾ƒå°çš„ç»“æœã€‚ putfieldï¼šå°†æœ€ç»ˆçš„æ ˆé¡¶ç»“æœçš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼› returnï¼šæ ˆä¸­çš„æ•°æ®è¿”å›åï¼Œç»“æŸæ–¹æ³• ç¦æ­¢æŒ‡ä»¤é‡æ’åºvolatileå…³é”®å­—ç¦æ­¢æŒ‡ä»¤é‡æ’åºæœ‰ä¸¤å±‚æ„æ€ï¼š å½“ç¨‹åºæ‰§è¡Œåˆ°volatileå˜é‡çš„è¯»æ“ä½œæˆ–è€…å†™æ“ä½œæ—¶ï¼Œåœ¨å…¶å‰é¢çš„æ“ä½œçš„æ›´æ”¹è‚¯å®šå…¨éƒ¨å·²ç»è¿›è¡Œï¼Œä¸”ç»“æœå·²ç»å¯¹åé¢çš„æ“ä½œå¯è§ï¼›åœ¨å…¶åé¢çš„æ“ä½œè‚¯å®šè¿˜æ²¡æœ‰è¿›è¡Œï¼› åœ¨è¿›è¡ŒæŒ‡ä»¤ä¼˜åŒ–æ—¶ï¼Œä¸èƒ½å°†åœ¨å¯¹volatileå˜é‡è®¿é—®çš„è¯­å¥æ”¾åœ¨å…¶åé¢æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½æŠŠvolatileå˜é‡åé¢çš„è¯­å¥æ”¾åˆ°å…¶å‰é¢æ‰§è¡Œã€‚ ä¸¾ä¸ªå®ä¾‹ï¼Œè¯·çœ‹ä¸‹é¢çš„ä»£ç : 1234567//xã€yä¸ºévolatileå˜é‡//flagä¸ºvolatileå˜é‡int x = 2; //è¯­å¥1int y = 0; //è¯­å¥2volatile boolean flag = true; //è¯­å¥3int x = 4; //è¯­å¥4int y = -1; //è¯­å¥5 ç”±äºflagå˜é‡ä¸ºvolatileå˜é‡ï¼Œé‚£ä¹ˆåœ¨è¿›è¡ŒæŒ‡ä»¤é‡æ’åºçš„è¿‡ç¨‹çš„æ—¶å€™ï¼Œä¸ä¼šå°†è¯­å¥3æ”¾åˆ°è¯­å¥1ã€è¯­å¥2å‰é¢ï¼Œä¹Ÿä¸ä¼šè®²è¯­å¥3æ”¾åˆ°è¯­å¥4ã€è¯­å¥5åé¢ã€‚ä½†æ˜¯è¦æ³¨æ„è¯­å¥1å’Œè¯­å¥2çš„é¡ºåºã€è¯­å¥4å’Œè¯­å¥5çš„é¡ºåºæ˜¯ä¸ä½œä»»ä½•ä¿è¯çš„ã€‚ å¹¶ä¸”volatileå…³é”®å­—èƒ½ä¿è¯ï¼Œæ‰§è¡Œåˆ°è¯­å¥3æ—¶ï¼Œè¯­å¥1å’Œè¯­å¥2å¿…å®šæ˜¯æ‰§è¡Œå®Œæ¯•äº†çš„ï¼Œä¸”è¯­å¥1å’Œè¯­å¥2çš„æ‰§è¡Œç»“æœå¯¹è¯­å¥3ã€è¯­å¥4ã€è¯­å¥5æ˜¯å¯è§çš„ã€‚ æˆ‘ä»¬åœ¨çœ‹çœ‹ä¸€ä¸ªä¾‹å­: 12345678//çº¿ç¨‹1:ApplicationConext context = loadContext(); //è¯­å¥1boolean inited = true; //è¯­å¥2//çº¿ç¨‹2:while(!inited )&#123; sleep()&#125;doSomethingwithconfig(context); ä¸Šè¿°ä»£ç æœ‰å¯èƒ½è¯­å¥2ä¼šåœ¨è¯­å¥1ä¹‹å‰æ‰§è¡Œï¼Œå› ä¸ºè¯­å¥2å¹¶ä¸ä¾èµ–ä¾èµ–è¯­å¥2ï¼Œå¯èƒ½ä¼šé‡æ’åºä¼˜åŒ–ï¼Œé‚£ä¹ˆä¹…å¯èƒ½å¯¼è‡´contextè¿˜æ²¡è¢«åˆå§‹åŒ–ï¼Œè€Œçº¿ç¨‹2ä¸­å°±ä½¿ç”¨æœªåˆå§‹åŒ–çš„contextå»è¿›è¡Œæ“ä½œï¼Œå¯¼è‡´ç¨‹åºå‡ºé”™ã€‚ è¿™é‡Œå¦‚æœç”¨volatileå…³é”®å­—å¯¹initedå˜é‡è¿›è¡Œä¿®é¥°ï¼Œå°±ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜äº†ï¼Œå› ä¸ºå½“æ‰§è¡Œåˆ°è¯­å¥2æ—¶ï¼Œå¿…å®šèƒ½ä¿è¯contextå·²ç»åˆå§‹åŒ–å®Œæ¯•ã€‚ å¯¹å˜é‡ç‰¹æ®Šçš„å®šä¹‰è§„åˆ™å‡è®¾Tè¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹ï¼ŒVå’ŒWè¡¨ç¤ºä¸¤ä¸ªvolatileå˜é‡ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œreadã€loadã€useã€assignã€storeå’Œwriteæ“ä½œæ—¶éœ€è¦æ»¡è¶³å¦‚ä¸‹çš„è§„åˆ™: åªæœ‰ä¸€ä¸ªå½“çº¿ç¨‹Tå¯¹å˜é‡Væ‰§è¡Œçš„å‰ä¸€ä¸ªåŠ¨ä½œæ˜¯loadçš„æ—¶å€™ï¼ŒTæ‰èƒ½å¯¹å˜é‡Væ‰§è¡ŒuseåŠ¨ä½œï¼Œå¹¶ä¸”å½“å¯¹Vçš„åä¸€ä¸ªæ‰§è¡Œæ˜¯useåŠ¨ä½œæ—¶ï¼ŒTæ‰èƒ½å¯¹Væ‰§è¡ŒloadåŠ¨ä½œã€‚Tå¯¹Vçš„useåŠ¨ä½œå…¶å®æ˜¯è¡”æ¥Tå¯¹Vçš„loadå’ŒreadåŠ¨ä½œï¼Œloadã€readå¿…é¡»ä¸€èµ·è¿ç»­å‡ºç°ï¼ˆè¿™æ¡è§„åˆ™è¦æ±‚åœ¨å·¥ä½œå†…å­˜æ¯æ¬¡ä½¿ç”¨Vå‰éƒ½å¿…é¡»å…ˆä»ä¸»å†…å­˜åˆ·æ–°æœ€æ–°å€¼ï¼Œä½¿å¾—ä¿è¯èƒ½çœ‹è§å…¶ä»–çº¿ç¨‹å¯¹å˜é‡Vçš„æœ€æ–°æ›´æ”¹ï¼‰ã€‚ åªæœ‰ä¸€ä¸ªå½“çº¿ç¨‹Tå¯¹å˜é‡Væ‰§è¡Œçš„å‰ä¸€ä¸ªåŠ¨ä½œæ˜¯assignçš„æ—¶å€™ï¼ŒTæ‰èƒ½å¯¹å˜é‡Væ‰§è¡ŒstoreåŠ¨ä½œï¼Œå¹¶ä¸”å½“å¯¹Vçš„åä¸€ä¸ªæ‰§è¡Œæ˜¯storeåŠ¨ä½œæ—¶ï¼ŒTæ‰èƒ½å¯¹Væ‰§è¡ŒassignåŠ¨ä½œã€‚Tå¯¹Vçš„assignåŠ¨ä½œå…¶å®æ˜¯è¡”æ¥Tå¯¹Vçš„storeå’ŒwriteåŠ¨ä½œï¼Œstoreã€writeå¿…é¡»ä¸€èµ·è¿ç»­å‡ºç°ï¼ˆè¿™æ¡è§„åˆ™è¦æ±‚åœ¨å·¥ä½œå†…å­˜æ¯æ¬¡ä¿®æ”¹Våéƒ½å¿…é¡»å…ˆå¿…é¡»åŒæ­¥åˆ°ä¸»å†…ä¸­ï¼Œä½¿å¾—ä¿è¯å…¶ä»–çº¿ç¨‹èƒ½çœ‹è§TTå¯¹å˜é‡Vçš„æœ€æ–°æ›´æ”¹ï¼‰ã€‚ å‡è®¾åŠ¨ä½œAæ˜¯çº¿ç¨‹Tå¯¹å˜é‡VVå®æ–½çš„useæˆ–assignåŠ¨ä½œï¼Œå‡å®šåŠ¨ä½œFæ˜¯ä¸åŠ¨ä½œAç›¸å…³è”çš„loadå’ŒstoreåŠ¨ä½œï¼Œå‡å®šåŠ¨ä½œPPæ˜¯ä¸åŠ¨ä½œFFç›¸åº”çš„å¯¹Vçš„readå’ŒloadåŠ¨ä½œï¼›ç±»ä¼¼åœ°ï¼Œå‡å®šåŠ¨ä½œBæ˜¯çº¿ç¨‹TTå¯¹å˜é‡Wå®æ–½çš„useå’ŒassignåŠ¨ä½œï¼Œå‡å®šåŠ¨ä½œGGæ˜¯å’ŒåŠ¨ä½œBBç›¸å…³è”çš„loadæˆ–storeåŠ¨ä½œï¼Œå‡å®šåŠ¨ä½œQæ˜¯ä¸åŠ¨ä½œGç›¸åº”çš„å¯¹å˜é‡Wçš„readå’ŒwriteåŠ¨ä½œã€‚å¦‚æœAå…ˆäºBï¼Œé‚£ä¹ˆPå…ˆäºQï¼ˆè¿™æ¡è§„åˆ™è¦æ±‚volatileä¿®é¥°çš„å˜é‡ä¸ä¼šè¢«æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œä¿è¯ä»£ç çš„æ‰§è¡Œé¡ºåºä¸ç¨‹åºçš„é¡ºåºç›¸åŒï¼‰ï¼Œå³æ˜¯Happen-beforeåŸåˆ™ã€‚ å†…å­˜å±éšœå…¶volatileåŸç†å†…å­˜å±éšœå®šä¹‰åœ¨ç ”ç©¶volatileåŸç†æ—¶å€™ï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆå†…å­˜å±éšœæˆ–è€…å†…å­˜æ …æ ã€‚ å†…å­˜å±éšœ/å†…å­˜æ …æ (Memory Barrieræˆ–Menory Fence):é‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤é‡æ’åºåˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼ŒæŒ‡ä»¤é‡æ’åºæ— æ³•è¶Šè¿‡å†…å­˜å±éšœï¼Œå•ä¾‹æ¨¡å¼çš„DCLåŒé”æ£€æŸ¥å¯ä»¥ä½“ç°å‡ºæ¥ã€‚ åªæœ‰ä¸€ä¸ªCPUè®¿é—®å†…å­˜æ—¶ï¼Œå¹¶ä¸éœ€è¦å†…å­˜å±éšœï¼Œä½†å¦‚æœæœ‰å¤šä¸ªCPUè®¿é—®åŒä¸€å—å†…å­˜ï¼Œä¸”å…¶ä¸­æœ‰ä¸€ä¸ªåœ¨è§‚æµ‹å¦ä¸€ä¸ªï¼Œå°±éœ€è¦å†…å­˜å±éšœæ¥ä¿è¯ä¸€è‡´ã€‚ ä»ç¡¬ä»¶æ¶æ„ä¸Šè®²ï¼ŒæŒ‡ä»¤é‡æ’åºæ˜¯æŒ‡CPUé‡‡å–å¯å…è®¸å°†å¤šæ¡æŒ‡ä»¤ä¸æŒ‰ç¨‹åºè§„å®šçš„é¡ºåºåˆ†å¼€å‘é€ç»™å„ç›¸åº”å•è·¯å¤„ç†å•å…ƒã€‚ä½†å¹¶ä¸æ˜¯æŒ‡ä»¤ä»»æ„é‡æ’ï¼ŒCPUéœ€è¦èƒ½æ­£ç¡®å¤„ç†æŒ‡ä»¤ä¾èµ–æƒ…å†µä»¥ä¿éšœç¨‹åºèƒ½å¤Ÿå¾—å‡ºæ­£ç¡®çš„æ‰§è¡Œç»“æœã€‚ ç”±äºç°ä»£çš„æ“ä½œç³»ç»Ÿéƒ½æ˜¯å¤šå¤„ç†å™¨.è€Œæ¯ä¸€ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±çš„ç¼“å­˜,å¹¶ä¸”è¿™äº›ç¼“å­˜å¹¶ä¸æ˜¯å®æ—¶éƒ½ä¸å†…å­˜å‘ç”Ÿä¿¡æ¯äº¤æ¢.è¿™æ ·å°±å¯èƒ½å‡ºç°ä¸€ä¸ªcpuä¸Šçš„ç¼“å­˜æ•°æ®ä¸å¦ä¸€ä¸ªcpuä¸Šçš„ç¼“å­˜æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚è€Œè¿™æ ·åœ¨å¤šçº¿ç¨‹å¼€å‘ä¸­ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´å‡ºç°ä¸€äº›å¼‚å¸¸è¡Œä¸ºã€‚è€Œæ“ä½œç³»ç»Ÿåº•å±‚ä¸ºäº†è¿™äº›é—®é¢˜ï¼Œæä¾›äº†ä¸€äº›å†…å­˜å±éšœç”¨ä»¥è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œç›®å‰æœ‰4ç§å±éšœï¼š LoadLoadå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadLoad; Load2ï¼Œåœ¨Load2åŠåç»­è¯»å–æ“ä½œè¦è¯»å–çš„æ•°æ®è¢«è®¿é—®å‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚ StoreStoreå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥æ“ä½œå¯¹å…¶å®ƒå¤„ç†å™¨å¯è§ã€‚ LoadStoreå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œè¢«åˆ·å‡ºå‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚ StoreLoadå±éšœï¼šå¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreLoad; Load2ï¼Œåœ¨Load2åŠåç»­æ‰€æœ‰è¯»å–æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥å¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§ã€‚å®ƒçš„å¼€é”€æ˜¯å››ç§å±éšœä¸­æœ€å¤§çš„ã€‚åœ¨å¤§å¤šæ•°å¤„ç†å™¨çš„å®ç°ä¸­ï¼Œè¿™ä¸ªå±éšœæ˜¯ä¸ªä¸‡èƒ½å±éšœï¼Œå…¼å…·å…¶å®ƒä¸‰ç§å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚ å†…å­˜å±éšœJAVAåº”ç”¨ é€šè¿‡ Synchronizedå…³é”®å­—åŒ…ä½çš„ä»£ç åŒºåŸŸ,å½“çº¿ç¨‹è¿›å…¥åˆ°è¯¥åŒºåŸŸè¯»å–å˜é‡ä¿¡æ¯æ—¶ï¼Œä¿è¯è¯»åˆ°çš„æ˜¯æœ€æ–°çš„å€¼ã€‚è¿™æ˜¯å› ä¸ºåœ¨åŒæ­¥åŒºå†…å¯¹å˜é‡çš„å†™å…¥æ“ä½œï¼Œåœ¨ç¦»å¼€åŒæ­¥åŒºæ—¶å°±å°†å½“å‰çº¿ç¨‹å†…çš„æ•°æ®åˆ·æ–°åˆ°å†…å­˜ä¸­,è€Œå¯¹æ•°æ®çš„è¯»å–ä¹Ÿä¸èƒ½ä»ç¼“å­˜è¯»å–,åªèƒ½ä»å†…å­˜ä¸­è¯»å–,ä¿è¯äº†æ•°æ®çš„è¯»æœ‰æ•ˆæ€§ï¼Œè¿™å°±æ˜¯æ’å…¥äº†StoreStoreå±éšœã€‚ ä½¿ç”¨äº†volatileä¿®é¥°å˜é‡,åˆ™å¯¹å˜é‡çš„å†™æ“ä½œï¼Œä¼šæ’å…¥StoreLoadå±éšœã€‚ å…¶ä½™çš„æ“ä½œ,åˆ™éœ€è¦é€šè¿‡Unsafeè¿™ä¸ªç±»æ¥æ‰§è¡Œã€‚UNSAFE.putOrderedObjectç±»ä¼¼è¿™æ ·çš„æ–¹æ³•,ä¼šæ’å…¥StoreStoreå†…å­˜å±éšœï¼ŒUnsafe.putVolatiObject åˆ™æ˜¯æ’å…¥äº†StoreLoadå±éšœ é€‚ç”¨åœºæ™¯ ç”±äºvolatileå˜é‡åªä¿è¯å¯è§æ€§,åœ¨ä¸ç¬¦åˆä»¥ä¸‹ä¸¤ç‚¹ï¼Œæˆ‘ä»¬ä»ç„¶è¦é€šè¿‡åŠ é”(ä½¿ç”¨åŒæ­¥é”synchronizeæˆ–java.util.concurrentä¸­çš„åŸå­ç±»)æ¥ä¿è¯åŸå­æ€§ã€‚ è¿ç®—ç»“æœä»¥åŠå¯¹å˜é‡çš„å†™æ“ä½œå¹¶ä¸ä¾èµ–å˜é‡çš„å½“å‰å€¼ï¼Œæˆ–èƒ½å¤Ÿç¡®ä¿åªæœ‰å•ä¸€çš„çº¿ç¨‹ä¿®æ”¹å˜é‡çš„å€¼ï¼› å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çš„çŠ¶æ€å˜é‡å…±äº«å‚ä¸ä¸å˜çº¦æŸï¼› é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯; å¯ç”¨ä½œçŠ¶æ€æ ‡å¿—ã€‚ JDKä¸­volatieåº”ç”¨ï¼šJDKä¸­ConcurrentHashMapçš„Nodeçš„valå’Œnextè¢«å£°æ˜ä¸ºvolatileï¼ŒAtomicIntegerç­‰åŸå­ç±»ä¸­çš„valueè¢«å£°æ˜ä¸ºvolatileã€‚AtomicIntegeré€šè¿‡CASåŸç†(æš‚å¯ç†è§£ä¸ºä¹è§‚é”)ä¿è¯äº†åŸå­æ€§ã€‚è¿™äº›åº”ç”¨åæ–‡è®²è§£ã€‚ volatileä¸synchronizedä¸Šè¿°è¯´åˆ°çš„volatileçš„è¯­ä¹‰é—®é¢˜ï¼Œå…¶å®volatileå˜é‡è¯»æ“ä½œçš„æ€§èƒ½ä¸æ™®é€šå˜é‡å‡ ä¹æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ï¼Œä½†æ˜¯å†™æ“ä½œä¼šç¨æ…¢ç‚¹ï¼Œå› ä¸ºvolatileéœ€è¦åœ¨æ‰§è¡Œä¸­æ’å…¥è®¸å¤šå†…å­˜å±éšœæŒ‡ä»¤æ¥ä¿è¯å¤„ç†å™¨ä¸å‘ç”Ÿä¹±åºæ‰§è¡Œã€‚ åœ¨æŸäº›æƒ…å†µä¸‹volatileçš„åŒæ­¥æœºåˆ¶çš„æ€§èƒ½çš„ç¡®è¦ä¼˜äºé”(synchronizeåŒæ­¥é”æˆ–J.U.CåŒ…çš„é”)ï¼Œä½†æ˜¯JDK1.6ä»¥åå¯¹é”å®è¡Œäº†è®¸å¤šæ¶ˆé™¤å’Œä¼˜åŒ–ï¼Œä½¿å¾—æˆ‘ä»¬å¾ˆéš¾é‡åŒ–è®¤ä¸ºvolatileæ¯”é”å¿«å¤šå°‘ã€‚ å¤šçº¿ç¨‹è®¿é—®volatileä¸ä¼šå‘ç”Ÿé˜»å¡ï¼Œè€Œsynchronizedä¼šé˜»å¡ï¼› volatileåªèƒ½ä¿è¯æ•°æ®çš„å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œè€Œsynchronizedä¸¤è€…éƒ½å¯ä»¥ä¿è¯ï¼Œå› ä¸ºå®ƒä¼šå°†ç§æœ‰å†…å­˜å’Œå…¬å…±å†…å­˜ä¸­çš„æ•°æ®åšåŒæ­¥ å¯¹longå’Œdoubleå‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™å†…å­˜çš„å…«ä¸ªæ“ä½œè™½ç„¶è¯´éƒ½æ˜¯åŸå­æ€§çš„ï¼Œä½†æ˜¯å¯¹äº64ä½çš„æ•°æ®ç±»å‹ï¼šlongå’Œdoubleæ¥è®²ï¼Œå…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢«volatileä¿®é¥°çš„64ä½æ•°æ®çš„è¯»å†™æ“ä½œåˆ’åˆ†ä¸ºä¸¤æ¬¡32ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œè¿™å°±æ˜¯æ‰€è°“çš„longå’Œdoubleçš„éåŸå­æ€§åå®šã€‚è™½ç„¶è§„å®šä¸ºè§„å®šï¼Œä½†æ˜¯ç›®å‰å¤§éƒ¨åˆ†å•†ä¸šè™šæ‹Ÿæœºå°†è¿™ä¸¤ç§æ•°æ®ç±»å‹ä½œ64ä½çš„åŸå­æ€§æ“ä½œå¯¹å¾…ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦å°†longå’Œdoubleç±»å‹çš„å˜é‡ä¸“é—¨ä»€ä¹ˆä¸ºvolatileå˜é‡ã€‚ å‚è€ƒèµ„æ–™ ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬2ç‰ˆï¼‰ã€‹å‘¨å¿—æ˜è‘— ã€ŠJavaå¤šçº¿ç¨‹ç¼–ç¨‹æ ¸å¿ƒæŠ€æœ¯ã€‹é«˜æ´ªå²©è‘—","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"JVMåŠå¹¶å‘ç¼–ç¨‹","slug":"JVMåŠå¹¶å‘ç¼–ç¨‹","permalink":"http://ltyeamin.github.io/tags/JVMåŠå¹¶å‘ç¼–ç¨‹/"}]},{"title":"ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-Javaå†…å­˜æ¨¡å‹","slug":"ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-Javaå†…å­˜æ¨¡å‹","date":"2018-06-01T10:09:51.000Z","updated":"2019-11-20T15:08:57.693Z","comments":true,"path":"2018/06/01/ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-Javaå†…å­˜æ¨¡å‹/","link":"","permalink":"http://ltyeamin.github.io/2018/06/01/ã€Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‘-Javaå†…å­˜æ¨¡å‹/","excerpt":"","text":"ç¡¬ä»¶çš„æ•ˆç‡ä¸ä¸€è‡´æ€§è®¡ç®—æœºå†…éƒ¨è¿ç®—æµç¨‹ è®¡ç®—æœºæ‰§è¡Œè‹¥å¹²ä¸ªè¿ç®—ä»»åŠ¡ï¼Œæ‰€æœ‰çš„è®¡ç®—ä»»åŠ¡ä¸å¯èƒ½ä»…ä»…é å¤„ç†å™¨â€œè®¡ç®—â€æ¥å®Œæˆï¼Œè®¡ç®—å™¨å­˜å‚¨è®¾å¤‡ä¸å¤„ç†å™¨çš„è¿ç®—é€Ÿåº¦æœ‰å‡ ä¸ªæ•°é‡çº§çš„å·®è·ï¼› è‡³å°‘è¦ä¸å†…å­˜è¿›è¡Œäº¤äº’ï¼Œå¦‚è¯»å–è¿ç®—æ•°æ®ã€å­˜å‚¨è¿ç®—ç»“æœï¼Œä¸èƒ½ä»…ä»…é CPUå¯„å­˜å™¨æ¥å®Œæˆ éšç€è®¡ç®—æœºç¡¬ä»¶çš„å¿«é€Ÿå‘å±•ï¼Œä»»ä½•è®¾å¤‡çš„è¯»å†™é€Ÿåº¦è¦å°½å¯èƒ½æ¥è¿‘å¤„ç†å™¨è¿ç®—é€Ÿåº¦çš„é«˜é€Ÿç¼“å­˜ï¼ˆCacheï¼‰æ¥ä½œä¸ºå†…å­˜ä¸å¤„ç†å™¨ä¹‹é—´çš„ç¼“å†²ï¼› è¿ç®—æ—¶å…ˆä»å†…å­˜è¯»å–ï¼Œç„¶åå°†æ•°æ®ç¼“å­˜åˆ°é«˜é€Ÿç¼“å­˜åŒºï¼Œè®©CPUèƒ½å¤Ÿé«˜æ•ˆè¿ç®—ï¼Œå½“è¿ç®—ç»“æŸåï¼Œå°†è¿ç®—ç»“æœä»ç¼“å­˜ä¸­åŒæ­¥åˆ°å†…å­˜ä¸­ã€‚ ç¼“å­˜ä¸€è‡´æ€§é«˜é€Ÿç¼“å­˜å¾ˆå¥½çš„è§£å†³äº†å¤„ç†å™¨ä¸å†…å­˜çš„é€Ÿåº¦çŸ›ç›¾ï¼Œå¦‚å›¾1,ä½†æ˜¯å­˜åœ¨é—®é¢˜:ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ å¤šå¤„ç†å™¨ä¸­ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±çš„é«˜é€Ÿç¼“å­˜ï¼Œä½†æ˜¯åˆå…±äº«ä¸€ä¸ªä¸»å†…å­˜ï¼Œå¯èƒ½å­˜åœ¨ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ï¼ŒåŒæ­¥åˆ°ä¸»å†…å­˜ä¸çŸ¥é“ä»¥å“ªä¸ªç¼“å­˜æ•°æ®ä¸ºå‡†ï¼› ä¸ºäº†è§£å†³ä¸€è‡´æ€§é—®é¢˜ï¼Œå„ä¸ªå¤„ç†å™¨è®¿é—®è¦éµå¾ªæŸäº›åè®®ï¼Œåœ¨è¯»å†™æ—¶è¦æ ¹æ®åè®®æ¥è¿›è¡Œæ“ä½œï¼Œå¸¸è§åè®®æœ‰:MSIã€MESIã€MOSIã€Synapseã€FireflyåŠDragon Protocolç­‰ï¼› é™¤äº†å¢åŠ é«˜é€Ÿç¼“å­˜ä¹‹å¤–ï¼Œä¸ºäº†ä½¿å¾—å¤„ç†å™¨å†…éƒ¨çš„è¿ç®—å•å…ƒå°½é‡è¢«å……åˆ†åˆ©ç”¨ï¼Œå¤„ç†å™¨ä¼šåœ¨ä¸å½±å“æ‰§è¡Œç»“æœçš„æ¡ä»¶ä¸‹å¯¹è¾“å…¥çš„ä»£ç è¿›è¡Œä¹±åºæ‰§è¡Œï¼ŒJavaè™šæ‹Ÿæœºå®šä¹‰ä¸ºæŒ‡ä»¤é‡æ’åºã€‚ Javaå†…å­˜æ¨¡å‹Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰æ¥å±è”½æ‰å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°Javaç¨‹åºåœ¨å„ç§ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å¹¶å‘æ•ˆæœï¼Œåœ¨JDK1.5ï¼ˆå®ç°äº†JSR-133ï¼‰å‘å¸ƒåï¼ŒJMMå·²ç»æˆç†Ÿå’Œå®Œå–„èµ·æ¥ã€‚ Javaå†…å­˜çš„ä¸»è¦ç›®æ ‡æ˜¯å®šä¹‰ç¨‹åºä¸­çš„å„ä¸ªå˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå³è™šæ‹Ÿæœºä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­å–å‡ºå˜é‡ä¸»è¦çš„åº•å±‚å®ç°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ­¤å˜é‡éå½¼å˜é‡ï¼Œè¿™é‡Œçš„å˜é‡åŒ…æ‹¬å®ä¾‹å­—æ®µã€é™æ€å­—æ®µã€æ„æˆæ•°ç»„å¯¹è±¡çš„å…ƒç´ ï¼Œä¸åŒ…æ‹¬å±€éƒ¨å˜é‡ä¸æ–¹æ³•å‚æ•°ï¼Œå› ä¸ºåè€…æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¸ä¼šè¢«å…±äº«ï¼Œè‡ªç„¶ä¸å­˜åœ¨ç«äº‰é—®é¢˜ã€‚ ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜ ä¸»å†…å­˜: JMMè§„å®šæ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼› å·¥ä½œå†…å­˜ï¼šæ¯æ¡çº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¿å­˜äº†è¢«è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼› å·¥ä½œå†…å­˜ï¼šçº¿ç¨‹å¯¹å˜é‡çš„æ‰€ä»¥æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œä¸èƒ½ç›´æ¥è¯»å†™åˆ°ä¸»å†…å­˜ä¸­ï¼› å·¥ä½œå†…å­˜ï¼šçº¿ç¨‹é—´å„è‡ªçš„å·¥ä½œå†…å­˜ä¸å¯è§ï¼Œæ•°æ®ä¼ é€’æ“ä½œåœ¨ä¸»å†…å­˜æ¥å®Œæˆï¼Œå¦‚å›¾2ï¼Œçº¿ç¨‹ã€ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜ä¸‰è€…ä¹‹é—´çš„äº¤äº’å…³ç³»ã€‚ å†…å­˜é—´åŸå­æ“ä½œ é”å®šï¼ˆlockï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ï¼› è§£é”ï¼ˆunlockï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šï¼› è¯»å–ï¼ˆreadï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨ï¼› è½½å…¥ï¼ˆloadï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ï¼› ä½¿ç”¨ï¼ˆuseï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡çš„å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œï¼› èµ‹å€¼ï¼ˆassignï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä»æ‰§è¡Œå¼•æ“æ¥å—åˆ°çš„å€¼èµ‹å€¼ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œï¼› å­˜å‚¨ï¼ˆstoreï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„writeæ“ä½œä½¿ç”¨ï¼› å†™å…¥ï¼ˆwriteï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ã€‚ å¦‚æœè¦æŠŠä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜å¤åˆ¶åˆ°å·¥ä½œå†…å­˜ï¼Œé‚£å°±è¦æŒ‰ç…§é¡ºåºåœ°æ‰§è¡Œreadå’Œloadæ“ä½œï¼Œå¦‚æœè¦æŠŠå˜é‡ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å­˜ï¼Œå°±è¦æŒ‰é¡ºåºåœ°æ‰§è¡Œstoreå’Œwriteæ“ä½œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJMMåªè¦æ±‚ä¸Šè¿°ä¸¤ä¸ªæ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œè€Œæ²¡æœ‰ä¿è¯å¿…é¡»æ˜¯è¿ç»­æ‰§è¡Œçš„ã€‚ä¹Ÿå°±è¯´è¯´readä¸loadä¹‹é—´ã€storeå’Œwriteä¹‹é—´æ˜¯å¯æ’å…¥å…¶ä»–æŒ‡ä»¤çš„ï¼Œå¦‚å¯¹ä¸»å†…å­˜ä¸­çš„å˜é‡aã€bè¿›è¡Œè®¿é—®æ—¶ï¼Œå¾ˆå¯èƒ½å‡ºç°read aã€read bã€load bã€load aï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒJMMè¿˜è§„å®šåœ¨æ‰§è¡Œä¸Šè¿°å…«ç§æ“ä½œæ—¶å¿…é¡»æ»¡è¶³å¦‚ä¸‹è§„åˆ™ï¼š ä¸å…è®¸readå’Œloadã€storeå’Œwriteæ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°ï¼Œå³ä¸å…è®¸ä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜è¯»å–äº†ä½†å·¥ä½œå†…å­˜ä¸æ¥å—ï¼Œæˆ–è€…ä»å·¥ä½œå†…å­˜å‘èµ·å›å†™ä½†ä¸»å†…å­˜ä¸æ¥å—çš„æƒ…å†µå‡ºç°ï¼› ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒçš„æœ€è¿‘çš„assignæ“ä½œï¼Œå³å˜é‡åœ¨å·¥ä½œå†…å­˜ä¸­æ”¹å˜äº†ä¹‹åå¿…é¡»æŠŠè¯¥å˜åŒ–çš„ç»“æœå›å†™åˆ°ä¸»å†…å­˜ä¸­ï¼› ä¸å…è®¸ä»»ä½•ä¸€ä¸ªçº¿ç¨‹æ— åŸå› åœ°ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•çš„assignæ“ä½œï¼‰æŠŠæ•°æ®ä»çº¿ç¨‹çš„å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼› ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­â€œè¯ç”Ÿâ€ï¼Œä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆloadæˆ–assignï¼‰çš„å˜é‡ã€‚å³å¯¹ä¸€ä¸ªå˜é‡å®æ–½useå’Œstoreæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œè¿‡assignå’Œloadæ“ä½œï¼› ä¸€ä¸ªå˜é‡åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œï¼Œä½†lockæ“ä½œå¯ä»¥è¢«åŒä¸€æ¡çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œå¤šæ¬¡æ‰§è¡Œlockåï¼Œåªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„unlockæ“ä½œï¼Œå˜é‡æ‰ä¼šè§£é”ï¼› å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œlockæ“ä½œï¼Œå°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰éœ€è¦é‡æ–°æ‰§è¡Œloadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼ï¼› å¦‚æœä¸€ä¸ªå˜é‡äº‹å…ˆæ²¡æœ‰è¢«locké”å®šæ“ä½œï¼Œåˆ™ä¸å…è®¸å¯¹å®ƒæ‰§è¡Œunlockæ“ä½œï¼›ä¹Ÿä¸å…è®¸å»unlockä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”ä½çš„å˜é‡ï¼› å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œunlockä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼ˆæ‰§è¡Œstoreå’Œwriteæ“ä½œï¼‰ï¼› happens-before åŸåˆ™è¿™ä¸ªåŸåˆ™éå¸¸é‡è¦ï¼Œå®ƒæ˜¯åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ç«äº‰ã€çº¿ç¨‹æ˜¯å¦å®‰å…¨çš„ä¸»è¦ä¾æ®ï¼Œä¾é è¿™ä¸ªåŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‡ æ¡è§„åˆ™ä¸€æ½å­åœ° è§£å†³å¹¶å‘ç¯å¢ƒä¸‹ä¸¤ä¸ªæ“ä½œä¹‹é—´æ˜¯å¦å¯èƒ½å­˜åœ¨å†²çªçš„æ‰€æœ‰é—®é¢˜ã€‚ ç°åœ¨å°±æ¥çœ‹çœ‹â€œå…ˆè¡Œå‘ç”Ÿâ€åŸåˆ™æŒ‡çš„æ˜¯ä»€ä¹ˆã€‚å…ˆè¡Œå‘ç”Ÿæ˜¯Javaå†…å­˜æ¨¡å‹ä¸­å®šä¹‰çš„ä¸¤é¡¹æ“ä½œä¹‹é—´çš„ååºå…³ç³»ï¼Œå¦‚æœè¯´æ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œBï¼Œå…¶å®å°±æ˜¯è¯´åœ¨å‘ç”Ÿæ“ä½œBä¹‹å‰ï¼Œæ“ä½œAäº§ç”Ÿçš„å½±å“èƒ½è¢«æ“ä½œBè§‚å¯Ÿåˆ°ï¼Œâ€œå½±å“â€åŒ…æ‹¬ä¿®æ”¹äº†å†…å­˜ä¸­å…±äº«å˜é‡çš„å€¼ã€å‘é€äº†æ¶ˆæ¯ã€è°ƒç”¨äº†æ–¹æ³•ç­‰ã€‚ 123456//ä»¥ä¸‹æ“ä½œåœ¨çº¿ç¨‹Aä¸­æ‰§è¡Œint i=1;//ä»¥ä¸‹æ“ä½œåœ¨çº¿ç¨‹Bä¸­æ‰§è¡Œ int j=i;//ä»¥ä¸‹æ“ä½œåœ¨çº¿ç¨‹Cä¸­æ‰§è¡Œint i=2; é€šè¿‡ä¸Šè¿°ä»£ç åˆ†æ:å‡è®¾çº¿ç¨‹Aä¸­çš„æ“ä½œâ€œi=1â€å…ˆè¡Œå‘ç”Ÿäºçº¿ç¨‹Bçš„æ“ä½œâ€œj=iâ€ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®å®šåœ¨çº¿ç¨‹Bçš„æ“ä½œæ‰§è¡Œåï¼Œå˜é‡jçš„å€¼ä¸€å®šç­‰äº1ï¼Œå¾—å‡ºè¿™ä¸ªç»“è®ºçš„ä¾æ®æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯æ ¹æ®å…ˆè¡Œå‘ç”ŸåŸ åˆ™ï¼Œâ€œi=1â€çš„ç»“æœå¯ä»¥è¢«è§‚å¯Ÿåˆ°ï¼›äºŒæ˜¯çº¿ç¨‹Cè¿˜æ²¡â€œç™»åœºâ€ï¼Œçº¿ç¨‹Aæ“ä½œç»“æŸä¹‹åæ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¼šä¿®æ”¹å˜é‡içš„å€¼ã€‚ç°åœ¨å†æ¥è€ƒè™‘çº¿ç¨‹Cï¼Œæˆ‘ä»¬ä¾ç„¶ä¿æŒçº¿ç¨‹Aå’Œçº¿ç¨‹Bä¹‹é—´çš„å…ˆè¡Œå‘ç”Ÿå…³ ç³»ï¼Œè€Œçº¿ç¨‹Cå‡ºç°åœ¨çº¿ç¨‹Aå’Œçº¿ç¨‹Bçš„æ“ä½œä¹‹é—´ï¼Œä½†æ˜¯çº¿ç¨‹Cä¸çº¿ç¨‹Bæ²¡æœ‰å…ˆè¡Œå‘ç”Ÿå…³ç³»ï¼Œé‚£jçš„å€¼ä¼šæ˜¯å¤šå°‘å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸ç¡®å®šï¼1å’Œ2éƒ½æœ‰å¯èƒ½ï¼Œå› ä¸ºçº¿ç¨‹Cå¯¹å˜é‡içš„å½±å“å¯èƒ½ä¼šè¢«çº¿ç¨‹Bè§‚å¯Ÿåˆ°ï¼Œä¹Ÿå¯èƒ½ä¸ä¼šï¼Œè¿™æ—¶å€™çº¿ç¨‹Bå°±å­˜åœ¨è¯»å–åˆ°è¿‡æœŸæ•°æ®çš„é£é™©ï¼Œä¸å…·å¤‡å¤šçº¿ç¨‹å®‰å…¨æ€§ã€‚ Java å†…å­˜æ¨¡å‹å®šä¹‰åŸºäºä¸€äº›æ“ä½œï¼Œæ¯”å¦‚è¯»å†™å­—æ®µã€ Monitor åŒæ­¥ç­‰ã€‚è¿™äº›æ“ä½œå¯ä»¥æŒ‰ç…§ happens-before å…³ç³»è¿›è¡Œæ’åºã€‚è¿™ç§å…³ç³»å¯ç”¨æ¥æ¨æ–­ä¸€ä¸ªçº¿ç¨‹ä½•æ—¶çœ‹åˆ°å¦ä¸€ä¸ªçº¿ç¨‹çš„æ“ä½œç»“æœï¼Œä»¥åŠæ„æˆä¸€ä¸ªç¨‹åºåŒæ­¥åçš„æ‰€æœ‰ä¿¡æ¯ã€‚ å¤©ç„¶çš„å…ˆè¡Œå‘ç”Ÿå…³ç³»: ç¨‹åºæ¬¡åºè§„åˆ™ï¼ˆProgram Order Ruleï¼‰ï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ç¨‹åºä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºä¹¦å†™åœ¨åé¢çš„æ“ä½œã€‚å‡†ç¡®åœ°è¯´ï¼Œåº”è¯¥æ˜¯æ§åˆ¶æµé¡ºåºè€Œä¸æ˜¯ç¨‹åºä»£ç é¡ºåºï¼Œ å› ä¸ºè¦è€ƒè™‘åˆ†æ”¯ã€å¾ªç¯ç­‰ç»“æ„ã€‚ ç®¡ç¨‹é”å®šè§„åˆ™ï¼ˆMonitor Lock Ruleï¼‰ï¼šä¸€ä¸ªunlockæ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„lock æ“ä½œã€‚å³åœ¨è·å– Monitor å‰ï¼Œé‡Šæ”¾è¯¥ Monitorã€‚è¿™é‡Œå¿…é¡»å¼ºè°ƒçš„æ˜¯åŒä¸€ä¸ªé”ï¼Œè€Œâ€œåé¢â€æ˜¯æŒ‡æ—¶é—´ä¸Šçš„å…ˆåé¡ºåºã€‚ volatileå˜é‡è§„åˆ™ï¼ˆVolatile Variable Ruleï¼‰ï¼šå¯¹ä¸€ä¸ªvolatileå˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œï¼Œå³åœ¨è¯»å– volatile å˜é‡å‰ï¼Œå¯¹è¯¥å˜é‡æ‰§è¡Œä¸€æ¬¡å†™æ“ä½œï¼Œè¿™é‡Œçš„â€œåé¢â€åŒæ ·æ˜¯æŒ‡æ—¶é—´ä¸Šçš„å…ˆåé¡ºåºã€‚ çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼ˆThread Start Ruleï¼‰ï¼šThreadå¯¹è±¡çš„start()æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œã€‚å³åœ¨çº¿ç¨‹å¼€å§‹æ‰€æœ‰æ“ä½œå‰è°ƒç”¨ Thread#startã€‚ çº¿ç¨‹ç»ˆæ­¢è§„åˆ™ï¼ˆThread Termination Ruleï¼‰ï¼šçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºå¯¹æ­¤çº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Thread.join()æ–¹æ³•ç»“æŸã€Thread.isAlive()çš„è¿”å›å€¼ç­‰æ‰‹æ®µæ£€æµ‹åˆ°çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œã€‚ çº¿ç¨‹ä¸­æ–­è§„åˆ™ï¼ˆThread Interruption Ruleï¼‰ï¼šå¯¹çº¿ç¨‹interrupt()æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡Thread.interrupted()æ–¹æ³•æ£€æµ‹åˆ°æ˜¯å¦æœ‰ ä¸­æ–­å‘ç”Ÿã€‚ å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼ˆFinalizer Ruleï¼‰ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆï¼ˆæ„é€ å‡½æ•°æ‰§è¡Œç»“æŸï¼‰å…ˆè¡Œå‘ ç”Ÿäºå®ƒçš„finalize()æ–¹æ³•çš„å¼€å§‹ã€‚ ä¼ é€’æ€§ï¼ˆTransitivityï¼‰ï¼šå¦‚æœæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œBï¼Œæ“ä½œBå…ˆè¡Œå‘ç”Ÿäºæ“ä½œCï¼Œé‚£å°±å¯ä»¥å¾—å‡ºæ“ä½œAå…ˆè¡Œå‘ç”Ÿäºæ“ä½œCçš„ç»“è®ºã€‚ æ€»ç»“:ï¼šæ—¶é—´å…ˆåé¡ºåºä¸å…ˆè¡Œå‘ç”ŸåŸåˆ™ä¹‹é—´åŸºæœ¬æ²¡æœ‰å¤ªå¤§çš„å…³ç³»ï¼Œæ‰€ä»¥æˆ‘ä»¬è¡¡é‡å¹¶å‘å®‰å…¨é—®é¢˜çš„æ—¶å€™ä¸è¦å—åˆ°æ—¶é—´é¡ºåºçš„å¹²æ‰°ï¼Œä¸€åˆ‡å¿…é¡»ä»¥å…ˆè¡Œå‘ç”ŸåŸåˆ™ä¸ºå‡†ã€‚ åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šæˆ‘ä»¬å¤§è‡´å¯ä»¥è®¤ä¸ºåŸºæœ¬æ•°æ®ç±»å‹çš„è®¿é—®è¯»å†™æ˜¯å…·å¤‡åŸå­æ€§çš„ï¼ˆä¾‹å¤–å°±æ˜¯longå’Œdoubleçš„éåŸå­æ€§åå®šï¼‰ã€‚åŸå­æ“ä½œçš„ç‰¹ç‚¹æ˜¯è¦ä¹ˆå…¨éƒ¨æ“ä½œæˆåŠŸè¦ä¹ˆå…¨éƒ¨æ“ä½œå¤±è´¥ï¼Œä¸å…è®¸éƒ¨åˆ†æˆåŠŸï¼Œéƒ¨åˆ†å¤±è´¥ã€‚å°½ç®¡è™šæ‹ŸæœºæœªæŠŠlockå’Œunlockæ“ä½œç›´æ¥å¼€æ”¾ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œ ä½†æ˜¯å´æä¾›äº†æ›´é«˜å±‚æ¬¡çš„å­—èŠ‚ç æŒ‡ä»¤monitorenterå’Œmonitorexitæ¥éšå¼åœ°ä½¿ç”¨è¿™ä¸¤ä¸ªæ“ä½œï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤åæ˜ åˆ°Javaä»£ç ä¸­å°±æ˜¯åŒæ­¥å—synchronizedå…³é”®å­—ï¼Œå› æ­¤åœ¨synchronizedå—ä¹‹é—´çš„æ“ä½œä¹Ÿå…·å¤‡åŸå­æ€§ã€‚ å¯è§æ€§ï¼ˆVisibilityï¼‰ï¼šå¯è§æ€§æ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³ å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚Javaå†…å­˜æ¨¡å‹æ˜¯é€šè¿‡åœ¨å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥å›ä¸»å†…å­˜ï¼Œåœ¨å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼è¿™ç§ä¾èµ–ä¸»å†…å­˜ä½œä¸ºä¼ é€’åª’ä»‹çš„æ–¹å¼æ¥å®ç°å¯è§æ€§çš„ã€‚ç®€å•è¯´å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹çœ‹åˆ°å¦ä¸€ä¸ªçº¿ç¨‹å‘ç”Ÿæ›´æ”¹æ‰€éœ€çš„æ¡ä»¶ï¼Œå³synchronizedå’Œfinalå®ç°äº†å¯è§æ€§çš„æ¡ä»¶ã€‚ æœ‰åºæ€§ï¼ˆOrderingï¼‰ï¼šå¦‚æœåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚å‰åŠå¥æ˜¯æŒ‡â€œçº¿ç¨‹å†…è¡¨ ç°ä¸ºä¸²è¡Œçš„è¯­ä¹‰â€ï¼ˆWithin-Thread As-If-Serial Semanticsï¼‰ï¼ŒååŠå¥æ˜¯æŒ‡â€œæŒ‡ä»¤é‡æ’åºâ€ç°è±¡ å’Œâ€œå·¥ä½œå†…å­˜ä¸ä¸»å†…å­˜åŒæ­¥å»¶è¿Ÿâ€ç°è±¡ã€‚ å‚è€ƒèµ„æ–™ ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬2ç‰ˆï¼‰ã€‹å‘¨å¿—æ˜è‘—","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"JVMåŠå¹¶å‘ç¼–ç¨‹","slug":"JVMåŠå¹¶å‘ç¼–ç¨‹","permalink":"http://ltyeamin.github.io/tags/JVMåŠå¹¶å‘ç¼–ç¨‹/"}]},{"title":"é¡¹ç›®å›¢é˜Ÿåä½œæµç¨‹","slug":"é¡¹ç›®å›¢é˜Ÿåä½œæµç¨‹","date":"2018-05-24T12:41:18.000Z","updated":"2019-11-20T15:08:58.973Z","comments":true,"path":"2018/05/24/é¡¹ç›®å›¢é˜Ÿåä½œæµç¨‹/","link":"","permalink":"http://ltyeamin.github.io/2018/05/24/é¡¹ç›®å›¢é˜Ÿåä½œæµç¨‹/","excerpt":"","text":"åœ¨å…¬å¸ITéƒ¨é—¨é‡Œ,å„ä¸ªå›¢é˜Ÿ(äº§å“è®¾è®¡å›¢é˜Ÿ-UI/UEè®¾è®¡å¸ˆ-å‰ç«¯å·¥ç¨‹å¸ˆ-ç§»åŠ¨ç«¯å·¥ç¨‹å¸ˆ-åç«¯å·¥ç¨‹å¸ˆ-æµ‹è¯•å·¥ç¨‹å¸ˆ-è¿ç»´å·¥ç¨‹å¸ˆ)äº’ç›¸åä½œ,å…±åŒè¾¾åˆ°é¡¹ç›®ä¸Šçº¿çš„ç›®çš„.å¦‚æœä¸€ä¸ªå…¬å¸çš„ITéƒ¨é—¨äººå‘˜ç®¡ç†ä»¥åŠé¡¹ç›®å¼€å‘æµç¨‹ä¸å¤ªå®Œå–„,å°±ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜,æ¯”å¦‚æ‰¯çš®æ— ç•Œå’Œæ²Ÿé€šä½æ•ˆç­‰é—®é¢˜,è¿™äº›ä¸¥é‡å½±å“åˆ°å·¥ä½œæ•ˆç‡,æ‰“ç ´äº†é¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸ.é‚£ä¹ˆçœŸæ­£çš„å›¢é˜Ÿåä½œåº”è¯¥æ˜¯æ€ä¹ˆæ ·çš„å‘¢?æˆ‘ä»¬ä¸å¦¨çœ‹ä¸‹å›¾:é’ˆå¯¹ä¸Šè¿°çš„æµç¨‹å›¾,è¯»è€…å¯æ ¹æ®è‡ªå·±å…¬å¸çš„å®é™…æƒ…å†µ,æ¥å‘è¡¨ç•™è¨€è¯„è®º,ç¬”è€…å¾ˆé«˜å…´ä¸å„ä½å°ä¼™ä¼´æ¥æ¢è®¨æ­¤äº‹.","categories":[{"name":"pm","slug":"pm","permalink":"http://ltyeamin.github.io/categories/pm/"}],"tags":[{"name":"Team Building","slug":"Team-Building","permalink":"http://ltyeamin.github.io/tags/Team-Building/"}]},{"title":"Spring Cloud-Zuulæ ¸å¿ƒè¿‡æ»¤å™¨åŠå¼‚å¸¸å¤„ç†","slug":"Spring Cloud-Zuulæ ¸å¿ƒè¿‡æ»¤å™¨åŠå¼‚å¸¸å¤„ç†","date":"2018-05-24T02:18:00.000Z","updated":"2019-11-20T15:08:57.398Z","comments":true,"path":"2018/05/24/Spring Cloud-Zuulæ ¸å¿ƒè¿‡æ»¤å™¨åŠå¼‚å¸¸å¤„ç†/","link":"","permalink":"http://ltyeamin.github.io/2018/05/24/Spring Cloud-Zuulæ ¸å¿ƒè¿‡æ»¤å™¨åŠå¼‚å¸¸å¤„ç†/","excerpt":"","text":"ç™¾å®¶æŠ€æœ¯,è°ˆç¬‘å¤ä»Š.ä»Šå¤©æˆ‘ä»¬ä¸è®²ä¸‰å›½,æˆ‘ä»¬è®²ä¸€è®²å¾®æœåŠ¡ç½‘å…³ä¸­çš„ä¸€äº›ç»†èŠ‚:Zuulè¿‡æ»¤å™¨. Zuulè¿‡æ»¤å™¨Spring Cloudä¸­çš„Zuulä¸ºæˆ‘ä»¬æä¾›äº†ç»Ÿä¸€å¯¹å¤–,è·¯ç”±è½¬å‘å’Œè¿‡æ»¤æ‹¦æˆªçš„å¼ºå¤§åŠŸèƒ½.åœ¨Spring Cloud Zuulä¸­å®ç°çš„è¿‡æ»¤å™¨å¿…é¡»åŒ…å«4ä¸ªåŸºæœ¬ç‰¹å¾:è¿‡æ»¤ç±»å‹,æ‰§è¡Œé¡ºåº,æ‰§è¡Œæ¡ä»¶,å…·ä½“æ“ä½œ.è¿™äº›ç‰¹å¾å°±æ˜¯ZuulFilteræŠ½è±¡ç±»ä¸­çš„4ä¸ªæŠ½è±¡æ–¹æ³•.è¯ä¸å¤šè¯´,ç›´æ¥ç”¨ZuulFilteræºç è¯´äº‹:12345678public abstract class ZuulFilter implements IZuulFilter, Comparable&amp;lt;ZuulFilter&amp;gt; &#123; abstract public String filterType(); abstract public int filterOrder(); /**IZuulFilteræ¥å£ä¸­çš„æ–¹æ³•*/ boolean shouldFilter(); /**IZuulFilteræ¥å£ä¸­çš„æ–¹æ³•*/ Object run();&#125; ä»¥ä¸Šæ–¹æ³•ä¸åŠŸèƒ½è§£è¯´: filterType: è¿‡æ»¤å™¨ç±»å‹,å°±æ˜¯ç‰¹æ®Šçš„å­—ç¬¦ä¸²(å¯åœ¨FilterConstantsæ¥å£å¸¸é‡ä¸­æ‰¾åˆ°).Zuulä¸­å®šä¹‰äº†4ä¸ªä¸åŒç”Ÿå‘½å‘¨æœŸçš„è¿‡æ»¤å™¨ç±»å‹,å…·ä½“å¦‚ä¸‹: pre: å¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰è°ƒç”¨ routing: åœ¨è·¯ç”±è¯·æ±‚æ—¶å€™è¢«è°ƒç”¨ post: åœ¨routingå’Œerrorè¿‡æ»¤å™¨ä¹‹åè¢«è°ƒç”¨ error: å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯æ—¶è¢«è°ƒç”¨ filterOrder: é€šè¿‡intå€¼æ¥å®šä¹‰è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåº,æ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ shouldFilter: è¿”å›ä¸€ä¸ªbooleanç±»å‹æ¥åˆ¤æ–­è¯¥è¿‡æ»¤å™¨æ˜¯å¦è¦æ‰§è¡Œ,æˆ‘ä»¬å¯ä»¥é€šè¿‡æ­¤æ–¹æ³•æ¥æŒ‡å®šè¿‡æ»¤å™¨çš„æœ‰æ•ˆèŒƒå›´. run: è¿‡æ»¤å™¨çš„å…·ä½“é€»è¾‘,åœ¨è¯¥å‡½æ•°ä¸­,æˆ‘ä»¬å¯ä»¥å®ç°è‡ªå®šä¹‰çš„è¿‡æ»¤é€»è¾‘,æ¥ç¡®å®šæ˜¯å¦è¦æ‹¦æˆªå½“å‰çš„è¯·æ±‚,ä¸å¯¹å…¶è¿›è¡Œåç»­çš„è·¯ç”±,æˆ–æ˜¯åœ¨è¯·æ±‚è·¯ç”±è¿”å›ç»“æœä¹‹å,å¯¹å¤„ç†ç»“æœåšä¸€äº›åŠ å·¥ç­‰.è¯·æ±‚ç”Ÿå‘½å‘¨æœŸZuulé»˜è®¤å®šä¹‰äº†å››ä¸ªä¸åŒçš„è¿‡æ»¤å™¨ç±»å‹,å®ƒä»¬è¦†ç›–äº†ä¸€ä¸ªå¤–éƒ¨HTTPè¯·æ±‚åˆ°è¾¾APIç½‘å…³,ç›´åˆ°è¿”å›è¯·æ±‚ç»“æœçš„å…¨éƒ¨ç”Ÿå‘½å‘¨æœŸ.ä¸‹å›¾æºè‡ªZuulçš„å®˜æ–¹WIKIä¸­å…³äºè¯·æ±‚ç”Ÿå‘½å‘¨æœŸçš„å›¾è§£,å®ƒæè¿°äº†ä¸€ä¸ªHTTPè¯·æ±‚åˆ°è¾¾APIç½‘å…³ä¹‹å,åœ¨ä¸åŒç±»å‹è¿‡æ»¤å™¨ä¹‹é—´çš„å¤„ç†è¿‡ç¨‹. å½“å¤–éƒ¨HTTPè¯·æ±‚åˆ°è¾¾APIç½‘å…³æœåŠ¡æ—¶,ä¼šè¿›å…¥ç¬¬ä¸€ä¸ªé˜¶æ®µpre,æ­¤æ—¶æ‰§è¡Œpreç±»å‹çš„è¿‡æ»¤å™¨,è¯¥ç±»å‹çš„è¿‡æ»¤å™¨ä¸»è¦è¿›è¡Œå‰ç½®åŠ å·¥,æ¯”å¦‚è¯·æ±‚æ ¡éªŒç­‰. å½“preé˜¶æ®µæ‰§è¡Œå®Œæ¯•åè¿›å…¥routingè¯·æ±‚è½¬å‘é˜¶æ®µ,æ­¤æ—¶æ‰§è¡Œroutingç±»å‹çš„è¿‡æ»¤å™¨,è¯¥ç±»å‹çš„è¿‡æ»¤å™¨ä¸»è¦å¤„ç†å°†å¤–éƒ¨çš„è¯·æ±‚è½¬å‘åˆ°å…·ä½“æœåŠ¡å®ä¾‹çš„è¿‡ç¨‹,å½“æœåŠ¡å°†è¯·æ±‚ç»“æœéƒ½è¿”å›å,routingé˜¶æ®µæ‰ç®—å®Œæˆ. å½“routingé˜¶æ®µæ‰§è¡Œå®Œæ¯•åè¿›å…¥posté˜¶æ®µ,æ­¤æ—¶æ‰§è¡Œpostç±»å‹çš„è¿‡æ»¤å™¨,è¯¥ç±»å‹çš„è¿‡æ»¤å™¨ä¸ä»…å¯ä»¥è·å–åˆ°è¯·æ±‚ä¿¡æ¯,ä¹Ÿå¯ä»¥è·å–æœåŠ¡å®ä¾‹è¿”å›çš„å“åº”ä¿¡æ¯,è¿™æ ·æˆ‘ä»¬å¯ä»¥å¯¹ç»“æœè¿›è¡ŒåŠ å·¥è½¬åŒ–. å½“ä»¥ä¸Š3ä¸ªè¿‡æ»¤å™¨ä¸­å‘ç”Ÿå¼‚å¸¸æ—¶æ‰è§¦å‘,æœ€åè¿˜æ˜¯æµå‘postç±»å‹çš„è¿‡æ»¤å™¨,å› ä¸ºå®ƒéœ€è¦å°†æœ€ç»ˆç»“æœè¿”å›ç»™å®¢æˆ·ç«¯. æ ¸å¿ƒè¿‡æ»¤å™¨åœ¨Spring Cloud Zuulä¸­,ä¸ºäº†æˆ‘ä»¬æ–¹ä¾¿,å®ƒåœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ç»™æˆ‘ä»¬é»˜è®¤å®ç°äº†ä¸€å¤§å †ä¸åŒç±»å‹çš„æ ¸å¿ƒè¿‡æ»¤å™¨,å®ƒåœ¨GateWayæœåŠ¡å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨åŠ è½½å¯ç”¨.ä»spring-cloud-netflix-core-1.3.1æ¨¡å—ä¸‹çš„org.springframework.cloud.netflix.zuul.filtersåŒ…ä¸‹:å¦‚ä¸Šå›¾,å®˜æ–¹æä¾›äº†ä¸‰ä¸ªä¸åŒç”Ÿå‘½å‘¨æœŸçš„è¿‡æ»¤å™¨,ç†è§£è¿™äº›è¿‡æ»¤å™¨å¤„ç†æµç¨‹æœ‰åŠ©äºæˆ‘ä»¬æ›´åŠ æ·±å…¥åœ°å®šåˆ¶è‡ªèº«ç³»ç»Ÿè¿‡æ»¤å™¨. preè¿‡æ»¤å™¨ ServletDetectionFilter: å®ƒçš„æ‰§è¡Œé¡ºåºä¸º-3,æ˜¯æœ€å…ˆè¢«æ‰§è¡Œçš„è¿‡æ»¤å™¨.è¯¥è¿‡æ»¤å™¨æ€»æ˜¯ä¼šè¢«æ‰§è¡Œ,ä¸»è¦ç”¨æ¥æ£€æµ‹å½“å‰è¯·æ±‚æ˜¯é€šè¿‡Springçš„DispatcherServletå¤„ç†è¿è¡Œ,è¿˜æ˜¯é€šè¿‡ZuulServletæ¥å¤„ç†è¿è¡Œçš„.å®ƒçš„æ£€æµ‹ç»“æœä¼šä»¥å¸ƒå°”ç±»å‹ä¿å­˜åœ¨å½“å‰è¯·æ±‚ä¸Šä¸‹æ–‡çš„isDispatcherServletRequestå‚æ•°ä¸­,è¿™æ ·åœ¨åç»­çš„è¿‡æ»¤å™¨ä¸­,æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡RequestUtils.isDispatcherServletRequest()å’ŒRequestUtils.isZuulServletRequest()æ–¹æ³•åˆ¤æ–­å®ƒä»¥å®ç°åšä¸åŒçš„å¤„ç†.ä¸€èˆ¬æƒ…å†µä¸‹,å‘é€åˆ°APIç½‘å…³çš„å¤–éƒ¨è¯·æ±‚éƒ½ä¼šè¢«Springçš„DispatcherServletå¤„ç†,é™¤äº†é€šè¿‡/zuul/è·¯å¾„è®¿é—®çš„è¯·æ±‚ä¼šç»•è¿‡DispatcherServlet,è¢«ZuulServletå¤„ç†,ä¸»è¦ç”¨æ¥åº”å¯¹å¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ çš„æƒ…å†µ.å¦å¤–,å¯¹äºZuulServletçš„è®¿é—®è·¯å¾„/zuul/,æˆ‘ä»¬å¯ä»¥é€šè¿‡zuul.servletPathå‚æ•°æ¥è¿›è¡Œä¿®æ”¹. Servlet30WrapperFilter: å®ƒçš„æ‰§è¡Œé¡ºåºä¸º-2,æ˜¯ç¬¬äºŒä¸ªæ‰§è¡Œçš„è¿‡æ»¤å™¨.ç›®å‰çš„å®ç°ä¼šå¯¹æ‰€æœ‰è¯·æ±‚ç”Ÿæ•ˆ,ä¸»è¦ä¸ºäº†å°†åŸå§‹çš„HttpServletRequeståŒ…è£…æˆServlet30RequestWrapperå¯¹è±¡. FormBodyWrapperFilter: å®ƒçš„æ‰§è¡Œé¡ºåºä¸º-1,æ˜¯ç¬¬ä¸‰ä¸ªæ‰§è¡Œçš„è¿‡æ»¤å™¨.è¯¥è¿‡æ»¤å™¨ä»…å¯¹ä¸¤ç§ç±»è¯·æ±‚ç”Ÿæ•ˆ,ç¬¬ä¸€ç±»æ˜¯Content-Typeä¸ºapplication/x-www-form-urlencodedçš„è¯·æ±‚,ç¬¬äºŒç±»æ˜¯Content-Typeä¸ºmultipart/form-dataå¹¶ä¸”æ˜¯ç”±Springçš„DispatcherServletå¤„ç†çš„è¯·æ±‚(ç”¨åˆ°äº†ServletDetectionFilterçš„å¤„ç†ç»“æœ).è€Œè¯¥è¿‡æ»¤å™¨çš„ä¸»è¦ç›®çš„æ˜¯å°†ç¬¦åˆè¦æ±‚çš„è¯·æ±‚ä½“åŒ…è£…æˆFormBodyRequestWrapperå¯¹è±¡. DebugFilter: å®ƒçš„æ‰§è¡Œé¡ºåºä¸º1,æ˜¯ç¬¬å››ä¸ªæ‰§è¡Œçš„è¿‡æ»¤å™¨.è¯¥è¿‡æ»¤å™¨ä¼šæ ¹æ®é…ç½®å‚æ•°zuul.debug.requestå’Œè¯·æ±‚ä¸­çš„debugå‚æ•°æ¥å†³å®šæ˜¯å¦æ‰§è¡Œè¿‡æ»¤å™¨ä¸­çš„æ“ä½œ.è€Œå®ƒçš„å…·ä½“æ“ä½œå†…å®¹åˆ™æ˜¯å°†å½“å‰çš„è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­çš„debugRoutingå’ŒdebugRequestå‚æ•°è®¾ç½®ä¸ºtrue.ç”±äºåœ¨åŒä¸€ä¸ªè¯·æ±‚çš„ä¸åŒç”Ÿå‘½å‘¨æœŸä¸­,éƒ½å¯ä»¥è®¿é—®åˆ°è¿™ä¸¤ä¸ªå€¼,æ‰€ä»¥æˆ‘ä»¬åœ¨åç»­çš„å„ä¸ªè¿‡æ»¤å™¨ä¸­å¯ä»¥åˆ©ç”¨è¿™ä¸¤å€¼æ¥å®šä¹‰ä¸€äº›debugä¿¡æ¯,è¿™æ ·å½“çº¿ä¸Šç¯å¢ƒå‡ºç°é—®é¢˜çš„æ—¶å€™,å¯ä»¥é€šè¿‡è¯·æ±‚å‚æ•°çš„æ–¹å¼æ¥æ¿€æ´»è¿™äº›debugä¿¡æ¯ä»¥å¸®åŠ©åˆ†æé—®é¢˜.å¦å¤–,å¯¹äºè¯·æ±‚å‚æ•°ä¸­çš„debugå‚æ•°,æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡zuul.debug.parameteræ¥è¿›è¡Œè‡ªå®šä¹‰. PreDecorationFilter: å®ƒçš„æ‰§è¡Œé¡ºåºä¸º5,æ˜¯preé˜¶æ®µæœ€åè¢«æ‰§è¡Œçš„è¿‡æ»¤å™¨.è¯¥è¿‡æ»¤å™¨ä¼šåˆ¤æ–­å½“å‰è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­æ˜¯å¦å­˜åœ¨forward.toå’ŒserviceIdå‚æ•°,å¦‚æœéƒ½ä¸å­˜åœ¨,é‚£ä¹ˆå®ƒå°±ä¼šæ‰§è¡Œå…·ä½“è¿‡æ»¤å™¨çš„æ“ä½œ(å¦‚æœæœ‰ä¸€ä¸ªå­˜åœ¨çš„è¯,è¯´æ˜å½“å‰è¯·æ±‚å·²ç»è¢«å¤„ç†è¿‡äº†,å› ä¸ºè¿™ä¸¤ä¸ªä¿¡æ¯å°±æ˜¯æ ¹æ®å½“å‰è¯·æ±‚çš„è·¯ç”±ä¿¡æ¯åŠ è½½è¿›æ¥çš„).è€Œå®ƒçš„å…·ä½“æ“ä½œå†…å®¹å°±æ˜¯ä¸ºå½“å‰è¯·æ±‚åšä¸€äº›é¢„å¤„ç†,æ¯”å¦‚: è¿›è¡Œè·¯ç”±è§„åˆ™çš„åŒ¹é…,åœ¨è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­è®¾ç½®è¯¥è¯·æ±‚çš„åŸºæœ¬ä¿¡æ¯ä»¥åŠå°†è·¯ç”±åŒ¹é…ç»“æœç­‰ä¸€äº›è®¾ç½®ä¿¡æ¯ç­‰,è¿™äº›ä¿¡æ¯å°†æ˜¯åç»­è¿‡æ»¤å™¨è¿›è¡Œå¤„ç†çš„é‡è¦ä¾æ®,æˆ‘ä»¬å¯ä»¥é€šè¿‡RequestContext.getCurrentContext()æ¥è®¿é—®è¿™äº›ä¿¡æ¯.å¦å¤–,æˆ‘ä»¬è¿˜å¯ä»¥åœ¨è¯¥å®ç°ä¸­æ‰¾åˆ°ä¸€äº›å¯¹HTTPå¤´è¯·æ±‚è¿›è¡Œå¤„ç†çš„é€»è¾‘,å…¶ä¸­åŒ…å«äº†ä¸€äº›è€³ç†Ÿèƒ½è¯¦çš„å¤´åŸŸ,æ¯”å¦‚: X-Forwarded-Host,X-Forwarded-Port.å¦å¤–,å¯¹äºè¿™äº›å¤´åŸŸçš„è®°å½•æ˜¯é€šè¿‡zuul.addProxyHeaderså‚æ•°è¿›è¡Œæ§åˆ¶çš„,è€Œè¿™ä¸ªå‚æ•°é»˜è®¤å€¼ä¸ºtrue,æ‰€ä»¥Zuulåœ¨è¯·æ±‚è·³è½¬æ—¶é»˜è®¤åœ°ä¼šä¸ºè¯·æ±‚å¢åŠ X-Forwarded-*å¤´åŸŸ,åŒ…æ‹¬: X-Forwarded-Host,X-Forwarded-Port,X-Forwarded-For,X-Forwarded-Prefix,X-Forwarded-Proto.æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®zuul.addProxyHeaders=falseå…³é—­å¯¹è¿™äº›å¤´åŸŸçš„æ·»åŠ åŠ¨ä½œ. routeè¿‡æ»¤å™¨ RibbonRoutingFilterï¼šå®ƒçš„æ‰§è¡Œé¡ºåºä¸º10,æ˜¯routeé˜¶æ®µç¬¬ä¸€ä¸ªæ‰§è¡Œçš„è¿‡æ»¤å™¨.è¯¥è¿‡æ»¤å™¨åªå¯¹è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨serviceIdå‚æ•°çš„è¯·æ±‚è¿›è¡Œå¤„ç†,å³åªå¯¹é€šè¿‡serviceIdé…ç½®è·¯ç”±è§„åˆ™çš„è¯·æ±‚ç”Ÿæ•ˆ.è€Œè¯¥è¿‡æ»¤å™¨çš„æ‰§è¡Œé€»è¾‘å°±æ˜¯é¢å‘æœåŠ¡è·¯ç”±çš„æ ¸å¿ƒ,å®ƒé€šè¿‡ä½¿ç”¨Ribbonå’ŒHystrixæ¥å‘æœåŠ¡å®ä¾‹å‘èµ·è¯·æ±‚,å¹¶å°†æœåŠ¡å®ä¾‹çš„è¯·æ±‚ç»“æœè¿”å›. SimpleHostRoutingFilterï¼šå®ƒçš„æ‰§è¡Œé¡ºåºä¸º100,æ˜¯routeé˜¶æ®µç¬¬äºŒä¸ªæ‰§è¡Œçš„è¿‡æ»¤å™¨.è¯¥è¿‡æ»¤å™¨åªå¯¹è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨routeHostå‚æ•°çš„è¯·æ±‚è¿›è¡Œå¤„ç†,å³åªå¯¹é€šè¿‡urlé…ç½®è·¯ç”±è§„åˆ™çš„è¯·æ±‚ç”Ÿæ•ˆ.è€Œè¯¥è¿‡æ»¤å™¨çš„æ‰§è¡Œé€»è¾‘å°±æ˜¯ç›´æ¥å‘routeHostå‚æ•°çš„ç‰©ç†åœ°å€å‘èµ·è¯·æ±‚,ä»æºç ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“è¯¥è¯·æ±‚æ˜¯ç›´æ¥é€šè¿‡httpclientåŒ…å®ç°çš„,è€Œæ²¡æœ‰ä½¿ç”¨Hystrixå‘½ä»¤è¿›è¡ŒåŒ…è£…,æ‰€ä»¥è¿™ç±»è¯·æ±‚å¹¶æ²¡æœ‰çº¿ç¨‹éš”ç¦»å’Œæ–­è·¯å™¨çš„ä¿æŠ¤. SendForwardFilterï¼šå®ƒçš„æ‰§è¡Œé¡ºåºä¸º500,æ˜¯routeé˜¶æ®µç¬¬ä¸‰ä¸ªæ‰§è¡Œçš„è¿‡æ»¤å™¨.è¯¥è¿‡æ»¤å™¨åªå¯¹è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨forward.toå‚æ•°çš„è¯·æ±‚è¿›è¡Œå¤„ç†,å³ç”¨æ¥å¤„ç†è·¯ç”±è§„åˆ™ä¸­çš„forwardæœ¬åœ°è·³è½¬é…ç½®. postè¿‡æ»¤å™¨ SendErrorFilterï¼šå®ƒçš„æ‰§è¡Œé¡ºåºä¸º0,æ˜¯posté˜¶æ®µç¬¬ä¸€ä¸ªæ‰§è¡Œçš„è¿‡æ»¤å™¨.è¯¥è¿‡æ»¤å™¨ä»…åœ¨è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­åŒ…å«error.status_codeå‚æ•°(ç”±ä¹‹å‰æ‰§è¡Œçš„è¿‡æ»¤å™¨è®¾ç½®çš„é”™è¯¯ç¼–ç )å¹¶ä¸”è¿˜æ²¡æœ‰è¢«è¯¥è¿‡æ»¤å™¨å¤„ç†è¿‡çš„æ—¶å€™æ‰§è¡Œ.è€Œè¯¥è¿‡æ»¤å™¨çš„å…·ä½“é€»è¾‘å°±æ˜¯åˆ©ç”¨è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­çš„é”™è¯¯ä¿¡æ¯æ¥ç»„ç»‡æˆä¸€ä¸ªforwardåˆ°APIç½‘å…³/erroré”™è¯¯ç«¯ç‚¹çš„è¯·æ±‚æ¥äº§ç”Ÿé”™è¯¯å“åº”. SendResponseFilterï¼šå®ƒçš„æ‰§è¡Œé¡ºåºä¸º1000,æ˜¯posté˜¶æ®µæœ€åæ‰§è¡Œçš„è¿‡æ»¤å™¨.è¯¥è¿‡æ»¤å™¨ä¼šæ£€æŸ¥è¯·æ±‚ä¸Šä¸‹æ–‡ä¸­æ˜¯å¦åŒ…å«è¯·æ±‚å“åº”ç›¸å…³çš„å¤´ä¿¡æ¯,å“åº”æ•°æ®æµæˆ–æ˜¯å“åº”ä½“,åªæœ‰åœ¨åŒ…å«å®ƒä»¬å…¶ä¸­ä¸€ä¸ªçš„æ—¶å€™å°±ä¼šæ‰§è¡Œå¤„ç†é€»è¾‘.è€Œè¯¥è¿‡æ»¤å™¨çš„å¤„ç†é€»è¾‘å°±æ˜¯åˆ©ç”¨è¯·æ±‚ä¸Šä¸‹æ–‡çš„å“åº”ä¿¡æ¯æ¥ç»„ç»‡éœ€è¦å‘é€å›å®¢æˆ·ç«¯çš„å“åº”å†…å®¹. è‡ªå®šä¹‰filteråŠå¼‚å¸¸å¤„ç†1234567891011121314151617181920212223242526272829303132package cn.yeamin.gateway.filter;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.cloud.netflix.zuul.filters.support.FilterConstants;import org.springframework.stereotype.Component;import com.netflix.zuul.ZuulFilter;@Componentpublic class ThrowExceptionFilter extends ZuulFilter &#123; private static final Logger log = LoggerFactory.getLogger(ThrowExceptionFilter.class); @Override public boolean shouldFilter() &#123; return true; &#125; @Override public Object run() &#123; log.info(\"æˆ‘åœ¨è¿™å°±æ˜¯è¦ä¸ºéš¾ä½ ,ç»™ä½ æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸,çœ‹ä½ èƒ½æ‹¿æˆ‘èƒ½æ€ä¹ˆæ ·,å“ˆå“ˆ......\"); doSomething(); return null; &#125; @Override public String filterType() &#123; return FilterConstants.PRE_TYPE; &#125; @Override public int filterOrder() &#123; return 0; &#125; private void doSomething() &#123; throw new RuntimeException(\"ä¼™è®¡,å¯¹ä¸ä½äº†,ç»™ä½ åˆ¶é€ ä¸€äº›éº»çƒ¦......\"); &#125;&#125; æ³¨é‡Šæ‰run()æ–¹æ³•ä¸­çš„doSomething();è¿™ä¸€è¡Œ,è¿›è¡Œè¯·æ±‚,ä»¥å‰æ­£å¸¸1234567891011Administrator@EZ-20161212OKBJ MINGW64 ~/Desktop$ curl -i http://127.0.0.1:9005/item-service/item/2 % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed100 91 0 91 0 0 91 0 --:--:-- --:--:-- --:--:-- 91000HTTP/1.1 200X-Application-Context: api-gateway:9005date: Thu, 24 May 2018 06:16:41 GMTContent-Type: application/json;charset=UTF-8Transfer-Encoding: chunked&#123;&quot;id&quot;:2,&quot;title&quot;:&quot;å•†å“æ ‡é¢˜2&quot;,&quot;pic&quot;:&quot;http://å›¾ç‰‡2&quot;,&quot;desc&quot;:&quot;å•†å“æè¿°2&quot;,&quot;price&quot;:2000&#125; æ‰“å¼€æ³¨é‡Šå,è¿›è¡Œè¯·æ±‚,è¿”å›500é”™è¯¯,å¦‚ä¸‹ç»“æœ:12345678Administrator@EZ-20161212OKBJ MINGW64 ~/Desktop$ curl -v http://127.0.0.1:9005/item-service/item/2* Trying 127.0.0.1...* TCP_NODELAY set % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0* Connected to 127.0.0.1 (127.0.0.1) port 9005 (#0)&#123;&quot;timestamp&quot;:1527143000184,&quot;status&quot;:500,&quot;error&quot;:&quot;Internal Server Error&quot;,&quot;exception&quot;:&quot;com.netflix.zuul.exception.ZuulException&quot;,&quot;message&quot;:&quot;pre:ThrowExceptionFilter&quot;&#125; ç”±ä¸Šå¯è§,æˆ‘ä»¬è™½ç„¶èƒ½å¤Ÿæ¸…æ™°çœ‹åˆ°statusä¸º500,errorçš„æè¿°,exceptionçš„classä¿¡æ¯,messageä¿¡æ¯,ä½†æ˜¯ä½œä¸ºæˆ‘ä»¬å¼€å‘äººå‘˜å¹¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆè€Œå¼‚å¸¸,å‡†ç¡®æ¥è¯´,å¼‚å¸¸ä¿¡æ¯ä¸å¤Ÿå‡†ç¡®.é’ˆå¯¹ä»¥ä¸Šæ–¹æ¡ˆæœ‰ä¸¤ç§æ–¹æ¡ˆ:ä¸¥æ ¼çš„try-catchå¤„ç†å’ŒErrorFilterå¤„ç†1.æ–¹å¼ä¸€: ä¸¥æ ¼çš„try-catchå¤„ç†å›æƒ³ä¸€ä¸‹,æˆ‘ä»¬æœ‰ä¸€ä¸ªpostè¿‡æ»¤å™¨SendErrorFilter,å®ƒæ˜¯ç”¨æ¥å¤„ç†å¼‚å¸¸ä¿¡æ¯çš„.æ ¹æ®æ­£å¸¸æµç¨‹,è¯¥è¿‡æ»¤å™¨ä¼šå¤„ç†å¼‚å¸¸ä¿¡æ¯,é‚£ä¹ˆåœ¨è¿™é‡Œæ²¡æœ‰å‡ºç°è¾ƒä¸ºæ˜ç¡®çš„å¼‚å¸¸ä¿¡æ¯å¾ˆæœ‰å¯èƒ½æ˜¯è¿™ä¸ªè¿‡æ»¤å™¨æ²¡æœ‰æ‰§è¡Œ.æ‰€ä»¥æˆ‘ä»¬ä¸å¦¨æ¥çœ‹çœ‹SendErrorFilterçš„æºç :12345678910public class SendErrorFilter extends ZuulFilter &#123; @Override public boolean shouldFilter() &#123; RequestContext ctx = RequestContext.getCurrentContext(); // only forward to errorPath if it hasn't been forwarded to already return ctx.getThrowable() != null &amp;&amp; !ctx.getBoolean(SEND_ERROR_FILTER_RAN, false); &#125;&#125; ä»ä¸Šé¢æºç åˆ†æ,shouldFilter()æ–¹æ³•ä¸­,å¯å¾—çŸ¥:ctx.getThrowable() != nullè¯´æ˜è¯·æ±‚ä¸Šä¸‹æ–‡å¿…é¡»æœ‰ä¸ªThrowableå­ç±»çš„å¼‚å¸¸å¯¹è±¡,æˆ‘ä»¬è‡ªå·±å®ç°çš„æ—¶å€™å¹¶æ²¡æœ‰å°†å¼‚å¸¸å¯¹è±¡æ”¾å…¥ä¸Šä¸‹æ–‡,SendErrorFilterè‡ªç„¶ä¸ä¼šæ‰§è¡Œ.åˆ†æè¿‡åæˆ‘ä»¬å°±æ˜ç™½äº†,å…·ä½“æ€ä¹ˆè§£å†³å¯ä»¥å‚è€ƒRibbonRoutingFilterä¸­runæ–¹æ³•å¼‚å¸¸å¤„ç†é€»è¾‘å®ç°:1234567891011121314151617@Overridepublic Object run() &#123; RequestContext context = RequestContext.getCurrentContext(); this.helper.addIgnoredHeaders(); try &#123; RibbonCommandContext commandContext = buildCommandContext(context); ClientHttpResponse response = forward(commandContext); setResponse(response); return response; &#125; catch (ZuulException ex) &#123; throw new ZuulRuntimeException(ex); &#125; catch (Exception ex) &#123; throw new ZuulRuntimeException(ex); &#125;&#125; å‚è€ƒä¹‹å,æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¿ç…§ä»¥ä¸Šä»£ç è§£å†³æˆ‘ä»¬çš„é—®é¢˜:12345678910@Overridepublic Object run() &#123; try &#123; log.info(\"æˆ‘åœ¨è¿™å°±æ˜¯è¦ä¸ºéš¾ä½ ,ç»™ä½ æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸,çœ‹ä½ èƒ½æ‹¿æˆ‘èƒ½æ€ä¹ˆæ ·,å“ˆå“ˆ......\"); doSomething(); &#125;catch (Exception ex) &#123; throw new ZuulRuntimeException(ex); &#125; return null;&#125; æ”¹å¥½ä»£ç æˆ‘ä»¬è®¿é—®ä¸€ä¸‹,å°±æœ‰äº†è¯¦ç»†çš„å¼‚å¸¸ä¿¡æ¯:12345678Administrator@EZ-20161212OKBJ MINGW64 ~/Desktop$ curl -v http://127.0.0.1:9005/item-service/item/2* Trying 127.0.0.1...* TCP_NODELAY set % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0* Connected to 127.0.0.1 (127.0.0.1) port 9005 (#0)&#123;&quot;timestamp&quot;:1527145922072,&quot;status&quot;:500,&quot;error&quot;:&quot;Internal Server Error&quot;,&quot;exception&quot;:&quot;com.netflix.zuul.exception.ZuulException&quot;,&quot;message&quot;:&quot;ä¼™è®¡,å¯¹ä¸ä½äº†,ç»™ä½ åˆ¶é€ ä¸€äº›éº»çƒ¦......&quot;&#125; 2.æ–¹å¼äºŒ: ErrorFilterå¤„ç†12345678910111213141516171819202122232425262728293031323334353637383940package cn.yeamin.gateway.filter;import org.springframework.cloud.netflix.zuul.filters.support.FilterConstants;import org.springframework.stereotype.Component;import com.netflix.zuul.ZuulFilter;import com.netflix.zuul.context.RequestContext;/** * Zuulè¿‡æ»¤å™¨ç»Ÿä¸€å¼‚å¸¸å¤„ç† * * @author tong.li * */@Componentpublic class ErrorFilter extends ZuulFilter &#123; @Override public boolean shouldFilter() &#123; return true; &#125; @Override public Object run() &#123; RequestContext ctx = RequestContext.getCurrentContext(); Throwable throwable = ctx.getThrowable(); Throwable ex = throwable.getCause(); ctx.setThrowable(ex); return null; &#125; @Override public String filterType() &#123; return FilterConstants.ERROR_TYPE; &#125; @Override public int filterOrder() &#123; return -1; &#125;&#125; æ³¨é‡Šæ‰ä¹‹å‰çš„try-catchçš„å¤„ç†æ–¹å¼,ç„¶åæˆ‘ä»¬å†è®¿é—®:123456Administrator@EZ-20161212OKBJ MINGW64 ~/Desktop$ curl http://127.0.0.1:9005/item-service/item/2 % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed100 190 0 190 0 0 63 0 --:--:-- 0:00:03 --:--:-- 57&#123;&quot;timestamp&quot;:1527148417550,&quot;status&quot;:500,&quot;error&quot;:&quot;Internal Server Error&quot;,&quot;exception&quot;:&quot;com.netflix.zuul.exception.ZuulException&quot;,&quot;message&quot;:&quot;ä¼™è®¡,å¯¹ä¸ä½äº†,ç»™ä½ åˆ¶é€ ä¸€äº›éº»çƒ¦......&quot;&#125;","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://ltyeamin.github.io/tags/Spring-Cloud/"}]},{"title":"LinuxåŸºç¡€-æ­£åˆ™è¡¨è¾¾å¼ä¹‹ä¸‰å‰‘å®¢","slug":"LinuxåŸºç¡€-æ­£åˆ™è¡¨è¾¾å¼ä¹‹ä¸‰å‰‘å®¢","date":"2018-05-22T13:27:23.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2018/05/22/LinuxåŸºç¡€-æ­£åˆ™è¡¨è¾¾å¼ä¹‹ä¸‰å‰‘å®¢/","link":"","permalink":"http://ltyeamin.github.io/2018/05/22/LinuxåŸºç¡€-æ­£åˆ™è¡¨è¾¾å¼ä¹‹ä¸‰å‰‘å®¢/","excerpt":"","text":"Linuxçš„ä¸–ç•Œé‡Œä¸€åˆ‡çš†æ–‡ä»¶,å¯¹Linuxçš„æ“ä½œå°±æ˜¯å¯¹æ–‡ä»¶çš„å¤„ç†.è¢«ä¸šç•Œç§°ä¸ºâ€ä¸‰å‰‘å®¢â€çš„awk,sed,grepå°±èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´æ–¹ä¾¿æ›´é«˜æ•ˆçš„å¤„ç†æ–‡ä»¶.â€œä¸‰å‰‘å®¢â€ä¸­grepæ“…é•¿æŸ¥æ‰¾åŠŸèƒ½,sedæ“…é•¿å–è¡Œå’Œæ›¿æ¢,awkæ“…é•¿å–åˆ—.â€œä¸‰å‰‘å®¢â€å°±æ˜¯æ™®é€šçš„Linuxå‘½ä»¤,è€Œæ­£åˆ™è¡¨è¾¾å¼å¥½æ¯”ä¸€ä¸ªæ¨¡æ¿,ä¸¤è€…ç»“åˆä½¿ç”¨,èƒ½å¤Ÿå‘æŒ¥å·¨å¤§çš„ä½œç”¨,å°¤å…¶æ˜¯åœ¨Shellè„šæœ¬ä¸­,ä½¿æˆ‘ä»¬çš„ä»£ç çŸ­å°ç²¾æ‚.æ€»ä¹‹å°±æ˜¯ä¸€å¥è¯:æé«˜å·¥ä½œæ•ˆç‡. æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²:â€abcaxcâ€,æ­£åˆ™è¡¨è¾¾å¼ä¸º:ab.*c è´ªå©ªæ¨¡å¼: ç¼–ç¨‹ä¸­é»˜è®¤æ¨¡å¼,æ­£åˆ™è¡¨è¾¾å¼ä¸€èˆ¬è¶‹å‘äºæœ€å¤§é•¿åº¦[åŒ¹é….å¦‚æ­£åˆ™ab.*cæœ€å¤§åŒ¹é…ä¸º:abcaxc éè´ªå©ªæ¨¡å¼: æ­£åˆ™åŒ¹é…åˆ°ç»“æœå°±å¥½,è¯´ç™½äº†å°±æ˜¯æœ€å°‘åŒ¹é….å¦‚æ­£åˆ™ab.*cæœ€å¤§åŒ¹é…ä¸º:abc grepå‘½ä»¤grepå‘½ä»¤æ˜¯ä¸€ç§å¼ºå¤§çš„æ–‡æœ¬æœç´¢å·¥å…·,å®ƒèƒ½ä½¿ç”¨ç‰¹å®šæ¨¡å¼åŒ¹é…(åŒ…æ‹¬æ­£åˆ™è¡¨è¾¾å¼)æœç´¢æ–‡æœ¬,å¹¶é»˜è®¤è¾“å‡ºåŒ¹é…è¡Œ.unixçš„grepå®¶æ—åŒ…æ‹¬grep,egrepå’Œfgrep,ç¬”è€…åœ¨è¿™ä¸ä¸€ä¸€åˆ—ä¸¾äº†,è¯»è€…å¯è‡ªè¡Œç ”ç©¶.å¸¸ç”¨é€‰é¡¹ -c : è®¡ç®—æ‰¾åˆ°â€™æœå¯»å­—ç¬¦ä¸²â€™çš„æ¬¡æ•° -i : å¿½ç•¥å¤§å°å†™è¿›è¡Œæœç´¢ -n : é¡ºä¾¿è¾“å‡ºè¡Œå· -v : åå‘é€‰æ‹©,å–åæœç´¢ -color=auto : å¯ä»¥æ‰¾åˆ°çš„æœç´¢å…³é”®å­—åŠ ä¸Šé¢œè‰²æ˜¾ç¤º å®æˆ˜ç¤ºä¾‹1.é€šè¿‡ç®¡é“æŸ¥æ‰¾é…ç½®æ–‡ä»¶é‡Œçš„å­—ç¬¦12[root@litong ~]# cat server.conf | grep portport : 9001 2.é€šè¿‡ç®¡é“æŸ¥æ‰¾ä»¥*.confç»“å°¾çš„æ–‡ä»¶12[root@litong ~]# ll | grep *.conf-rw-r--r-- 1 root root 22 May 18 14:51 server.conf 3.æ ¹æ®å…³é”®å­—æŸ¥æ‰¾è¿›ç¨‹ä¿¡æ¯123[root@litong ~]# ps -ef | grep pptpdroot 29510 1 0 14:55 ? 00:00:00 /usr/sbin/pptpd -froot 30061 25475 0 14:58 pts/2 00:00:00 grep --color=auto pptpd sedå‘½ä»¤sedæ˜¯ä¸€é¡¹LinuxæŒ‡ä»¤,åŠŸèƒ½åŒawkç±»ä¼¼,å·®åˆ«åœ¨äº,sedç®€å•,æ“…é•¿å–è¡Œå’Œæ›¿æ¢,å¯¹åˆ—å¤„ç†çš„åŠŸèƒ½è¦å·®ä¸€äº›,awkçš„åŠŸèƒ½å¤æ‚,å¯¹åˆ—å¤„ç†çš„åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§. å‘½ä»¤æ ¼å¼ sed [options] â€˜commandâ€™ file(s) sed [options] -f scriptfile file(s)å–è¡Œé€‰é¡¹ a\\ åœ¨å½“å‰è¡Œä¸‹é¢æ’å…¥æ–‡æœ¬. i\\ åœ¨å½“å‰è¡Œä¸Šé¢æ’å…¥æ–‡æœ¬. c\\ æŠŠé€‰å®šçš„è¡Œæ”¹ä¸ºæ–°çš„æ–‡æœ¬. d åˆ é™¤,åˆ é™¤é€‰æ‹©çš„è¡Œ. D åˆ é™¤æ¨¡æ¿å—çš„ç¬¬ä¸€è¡Œ. s æ›¿æ¢æŒ‡å®šå­—ç¬¦ h æ‹·è´æ¨¡æ¿å—çš„å†…å®¹åˆ°å†…å­˜ä¸­çš„ç¼“å†²åŒº. H è¿½åŠ æ¨¡æ¿å—çš„å†…å®¹åˆ°å†…å­˜ä¸­çš„ç¼“å†²åŒº. g è·å¾—å†…å­˜ç¼“å†²åŒºçš„å†…å®¹,å¹¶æ›¿ä»£å½“å‰æ¨¡æ¿å—ä¸­çš„æ–‡æœ¬. G è·å¾—å†…å­˜ç¼“å†²åŒºçš„å†…å®¹,å¹¶è¿½åŠ åˆ°å½“å‰æ¨¡æ¿å—æ–‡æœ¬çš„åé¢. l åˆ—è¡¨ä¸èƒ½æ‰“å°å­—ç¬¦çš„æ¸…å•. n è¯»å–ä¸‹ä¸€ä¸ªè¾“å…¥è¡Œ,ç”¨ä¸‹ä¸€ä¸ªå‘½ä»¤å¤„ç†æ–°çš„è¡Œè€Œä¸æ˜¯ç”¨ç¬¬ä¸€ä¸ªå‘½ä»¤. N è¿½åŠ ä¸‹ä¸€ä¸ªè¾“å…¥è¡Œåˆ°æ¨¡æ¿å—åé¢å¹¶åœ¨äºŒè€…é—´åµŒå…¥ä¸€ä¸ªæ–°è¡Œ,æ”¹å˜å½“å‰è¡Œå·ç . p æ‰“å°æ¨¡æ¿å—çš„è¡Œ. P(å¤§å†™) æ‰“å°æ¨¡æ¿å—çš„ç¬¬ä¸€è¡Œ. q é€€å‡ºSed. b lable åˆ†æ”¯åˆ°è„šæœ¬ä¸­å¸¦æœ‰æ ‡è®°çš„åœ°æ–¹,å¦‚æœåˆ†æ”¯ä¸å­˜åœ¨åˆ™åˆ†æ”¯åˆ°è„šæœ¬çš„æœ«å°¾. r file ä»fileä¸­è¯»è¡Œ. t label ifåˆ†æ”¯,ä»æœ€åä¸€è¡Œå¼€å§‹,æ¡ä»¶ä¸€æ—¦æ»¡è¶³æˆ–è€…T,tå‘½ä»¤,å°†å¯¼è‡´åˆ†æ”¯åˆ°å¸¦æœ‰æ ‡å·çš„å‘½ä»¤å¤„,æˆ–è€…åˆ°è„šæœ¬çš„æœ«å°¾. T label é”™è¯¯åˆ†æ”¯,ä»æœ€åä¸€è¡Œå¼€å§‹,ä¸€æ—¦å‘ç”Ÿé”™è¯¯æˆ–è€…T,tå‘½ä»¤,å°†å¯¼è‡´åˆ†æ”¯åˆ°å¸¦æœ‰æ ‡å·çš„å‘½ä»¤å¤„,æˆ–è€…åˆ°è„šæœ¬çš„æœ«å°¾. w file å†™å¹¶è¿½åŠ æ¨¡æ¿å—åˆ°fileæœ«å°¾. W file å†™å¹¶è¿½åŠ æ¨¡æ¿å—çš„ç¬¬ä¸€è¡Œåˆ°fileæœ«å°¾. ! è¡¨ç¤ºåé¢çš„å‘½ä»¤å¯¹æ‰€æœ‰æ²¡æœ‰è¢«é€‰å®šçš„è¡Œå‘ç”Ÿä½œç”¨. = æ‰“å°å½“å‰è¡Œå·ç . # æŠŠæ³¨é‡Šæ‰©å±•åˆ°ä¸‹ä¸€ä¸ªæ¢è¡Œç¬¦ä»¥å‰. æ›¿æ¢é€‰é¡¹ g è¡¨ç¤ºè¡Œå†…å…¨é¢æ›¿æ¢. p è¡¨ç¤ºæ‰“å°è¡Œ. w è¡¨ç¤ºæŠŠè¡Œå†™å…¥ä¸€ä¸ªæ–‡ä»¶. x è¡¨ç¤ºäº’æ¢æ¨¡æ¿å—ä¸­çš„æ–‡æœ¬å’Œç¼“å†²åŒºä¸­çš„æ–‡æœ¬. y è¡¨ç¤ºæŠŠä¸€ä¸ªå­—ç¬¦ç¿»è¯‘ä¸ºå¦å¤–çš„å­—ç¬¦ï¼ˆä½†æ˜¯ä¸ç”¨äºæ­£åˆ™è¡¨è¾¾å¼ï¼‰ \\1 å­ä¸²åŒ¹é…æ ‡è®° &amp; å·²åŒ¹é…å­—ç¬¦ä¸²æ ‡è®°å®æˆ˜ç¤ºä¾‹ è·å–æ–‡ä»¶çš„è¡Œå†…å®¹123456789[root@litong ~]# sed -n 2p /etc/passwd # è·å–/ect/passwdç¬¬äºŒè¡Œbin:x:1:1:bin:/bin:/sbin/nologin[root@litong ~]# sed -n 2,7p /etc/passwd # è·å–/ect/passwdç¬¬äºŒè¡Œåˆ°ç¬¬ä¸ƒè¡Œbin:x:1:1:bin:/bin:/sbin/nologindaemon:x:2:2:daemon:/sbin:/sbin/nologinadm:x:3:4:adm:/var/adm:/sbin/nologinlp:x:4:7:lp:/var/spool/lpd:/sbin/nologinsync:x:5:0:sync:/sbin:/bin/syncshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown 2.æ›¿æ¢æ–‡æœ¬123456[root@litong ~]# sed -i &apos;s/port/pp/g&apos; server.conf # æ–‡ä»¶ä¸­å«æœ‰portä¸ºå…¨å±€æ›¿æ¢pp,,å¹¶ä¸ä¼šçœŸæ­£è¿›è¡Œæ–‡ä»¶æ›¿æ¢,è€Œåªæ˜¯æŠŠæ“ä½œåçš„æ–‡æœ¬è¿”å›[root@litong ~]# cat server.conf serverserver pp : 9001 pp : 9001 3.åˆ é™¤æ–‡æœ¬12345[root@litong ~]# sed &apos;2d&apos; server.conf # åˆ é™¤æ–‡ä»¶çš„ç¬¬äºŒè¡Œ,å¹¶ä¸ä¼šçœŸæ­£åˆ é™¤æ–‡ä»¶è¡Œ,è€Œåªæ˜¯æŠŠæ“ä½œåçš„æ–‡æœ¬è¿”å›server pp : 9001 pp : 9001[root@litong ~]# sed &apos;1,$d&apos; server.conf #æ–‡ä»¶æ¸…ç©º,,å¹¶ä¸ä¼šçœŸæ­£åˆ é™¤æ–‡ä»¶è¡Œ,è€Œåªæ˜¯æŠŠæ“ä½œåçš„æ–‡æœ¬è¿”å› awkå‘½ä»¤awkæ˜¯ä¸€ä¸ªä¼˜è‰¯çš„æ–‡æœ¬å¤„ç†å·¥å…·,LinuxåŠUnixç¯å¢ƒä¸­ç°æœ‰çš„åŠŸèƒ½æœ€å¼ºå¤§çš„æ•°æ®å¤„ç†å¼•æ“ä¹‹ä¸€.è¿™ä¸ªå‘½ä»¤æ“…é•¿å–åˆ—.awkç»è¿‡æ”¹è¿›ç”Ÿæˆæ–°çš„ç‰ˆæœ¬nawkå’Œgawk,ç°åœ¨é»˜è®¤linuxç³»ç»Ÿä¸‹æ—¥å¸¸ä½¿ç”¨gawk. å‘½ä»¤æ ¼å¼ awk [é€‰é¡¹å‚æ•°] â€˜scriptâ€™ var=value file(s) awk [é€‰é¡¹å‚æ•°] -f scriptfile var=value file(s) é€‰é¡¹å‚æ•° -F fs or â€“field-separator fs :æŒ‡å®šè¾“å…¥æ–‡ä»¶æŠ˜åˆ†éš”ç¬¦,fsæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼,å¦‚-F:. -v var=value or â€“asign var=valueèµ‹å€¼ä¸€ä¸ªç”¨æˆ·å®šä¹‰å˜é‡. -f scripfile or â€“file scriptfile,ä»è„šæœ¬æ–‡ä»¶ä¸­è¯»å–awkå‘½ä»¤. -mf nnn and -mr nnn,å¯¹nnnå€¼è®¾ç½®å†…åœ¨é™åˆ¶,-mfé€‰é¡¹é™åˆ¶åˆ†é…ç»™nnnçš„æœ€å¤§å—æ•°ç›®;-mré€‰é¡¹é™åˆ¶è®°å½•çš„æœ€å¤§æ•°ç›®.è¿™ä¸¤ä¸ªåŠŸèƒ½æ˜¯Bellå®éªŒå®¤ç‰ˆawkçš„æ‰©å±•åŠŸèƒ½,åœ¨æ ‡å‡†awkä¸­ä¸é€‚ç”¨. -W compact or â€“compat, -W traditional or â€“traditional,åœ¨å…¼å®¹æ¨¡å¼ä¸‹è¿è¡Œawk.æ‰€ä»¥gawkçš„è¡Œä¸ºå’Œæ ‡å‡†çš„awkå®Œå…¨ä¸€æ ·,æ‰€æœ‰çš„awkæ‰©å±•éƒ½è¢«å¿½ç•¥. -W copyleft or â€“copyleft, -W copyright or â€“copyright,æ‰“å°ç®€çŸ­çš„ç‰ˆæƒä¿¡æ¯. -W help or â€“help, -W usage or â€“usage,æ‰“å°å…¨éƒ¨awké€‰é¡¹å’Œæ¯ä¸ªé€‰é¡¹çš„ç®€çŸ­è¯´æ˜. -W lint or â€“lint,æ‰“å°ä¸èƒ½å‘ä¼ ç»Ÿunixå¹³å°ç§»æ¤çš„ç»“æ„çš„è­¦å‘Š. -W lint-old or â€“lint-old,æ‰“å°å…³äºä¸èƒ½å‘ä¼ ç»Ÿunixå¹³å°ç§»æ¤çš„ç»“æ„çš„è­¦å‘Š. -W posix,æ‰“å¼€å…¼å®¹æ¨¡å¼.ä½†æœ‰ä»¥ä¸‹é™åˆ¶,ä¸è¯†åˆ«ï¼š/x,å‡½æ•°å…³é”®å­—,func,æ¢ç åºåˆ—ä»¥åŠå½“fsæ˜¯ä¸€ä¸ªç©ºæ ¼æ—¶,å°†æ–°è¡Œä½œä¸ºä¸€ä¸ªåŸŸåˆ†éš”ç¬¦;æ“ä½œç¬¦å’Œ=ä¸èƒ½ä»£æ›¿^å’Œ^=;fflushæ— æ•ˆ. -W re-interval or â€“re-inerval,å…è®¸é—´éš”æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨,å‚è€ƒ(grepä¸­çš„Posixå­—ç¬¦ç±»),å¦‚æ‹¬å·è¡¨è¾¾å¼[[:alpha:]]. -W source program-text or â€“source program-text,ä½¿ç”¨program-textä½œä¸ºæºä»£ç ,å¯ä¸-få‘½ä»¤æ··ç”¨. -W version or â€“version,æ‰“å°bugæŠ¥å‘Šä¿¡æ¯çš„ç‰ˆæœ¬. å®æˆ˜ç¤ºä¾‹1.æŒ‰ç…§æŒ‡å®šçš„åˆ†éš”ç¬¦å–åˆ— 1234567891011121314151617181920[root@litong ~]# cut -d: -f 1 /etc/passwd # cutå‘½ä»¤ä¹Ÿå¯ä»¥å–åˆ—rootbindaemonadmlpsyncshutdownhaltmail[root@litong ~]# awk -F: &apos;&#123;print $1&#125;&apos; /etc/passwd # awkå‘½ä»¤å–åˆ—rootbindaemonadmlpsyncshutdownhaltmail ä¼ä¸šå®æˆ˜-ç”¨ä¸‰å‰‘å®¢å–IP1234567891011121314151617181920[root@litong ~]# ifconfig eth0 #æŸ¥çœ‹eth0è¿™å—ç½‘å¡çš„ipeth0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500 inet 172.21.205.254 netmask 255.255.240.0 broadcast 172.21.207.255 ether 00:16:3e:00:a1:e1 txqueuelen 1000 (Ethernet) RX packets 599643 bytes 144572651 (137.8 MiB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 590688 bytes 161445142 (153.9 MiB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0[root@litong ~]# ifconfig eth0 | grep -Po '(?&amp;lt;=inet )\\S+' # grepå–IPæ–¹å¼ä¸€172.21.205.254[root@litong ~]# ifconfig eth0 | grep -o \"inet [0-9.]*\" | grep -o \"[0-9.]*\" # grepå–IPæ–¹å¼äºŒ172.21.205.254[root@litong ~]# ifconfig eth0 | awk -F \"[ ]+\" 'NR==2 &#123;print $3&#125;' # awkå–IP172.21.205.254[root@litong ~]# ifconfig eth0 | sed -nr '2s#^[^0-9]*([0-9.]*).*$#\\1#gp' # sedå–IPæ–¹å¼ä¸€172.21.205.254[root@litong ~]# ifconfig eth0 | sed -nr '2s#^.*inet (.*) net.*$#\\1#gp' # sedå–IPæ–¹å¼äºŒ172.21.205.254 [root@litong ~]# ifconfig eth0 | sed -n '2p' | sed 's#^.*inet ##g' | sed 's# netmask.*$##g' # sedå–IPæ–¹å¼ä¸‰172.21.205.254 ç›¸å…³æ–‡æ¡£èœé¸Ÿæ•™ç¨‹ä¸‰å‰‘å®¢å–IP","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://ltyeamin.github.io/tags/Linux/"}]},{"title":"LinuxåŸºç¡€-wgetä¸curlå‘½ä»¤","slug":"LinuxåŸºç¡€-wgetä¸curlå‘½ä»¤","date":"2018-05-22T09:21:31.000Z","updated":"2019-05-29T14:03:53.000Z","comments":true,"path":"2018/05/22/LinuxåŸºç¡€-wgetä¸curlå‘½ä»¤/","link":"","permalink":"http://ltyeamin.github.io/2018/05/22/LinuxåŸºç¡€-wgetä¸curlå‘½ä»¤/","excerpt":"","text":"Linuxç³»ç»Ÿä¸‹çš„ä¸‹è½½å·¥å…·wget æ˜¯ä¸€ä¸ªä»ç½‘ç»œä¸Šè‡ªåŠ¨ä¸‹è½½æ–‡ä»¶çš„è‡ªç”±å·¥å…·,æ”¯æŒé€šè¿‡ HTTP,HTTPS,FTP ä¸‰ä¸ªæœ€å¸¸è§çš„ TCP/IPåè®® ä¸‹è½½,å¹¶å¯ä»¥ä½¿ç”¨ HTTP ä»£ç†.â€wgetâ€ è¿™ä¸ªåç§°æ¥æºäº â€œWorld Wide Webâ€ ä¸ â€œgetâ€ çš„ç»“åˆ.æ‰€è°“è‡ªåŠ¨ä¸‹è½½,æ˜¯æŒ‡ wget å¯ä»¥åœ¨ç”¨æˆ·é€€å‡ºç³»ç»Ÿçš„ä¹‹ååœ¨ç»§ç»­åå°æ‰§è¡Œ,ç›´åˆ°ä¸‹è½½ä»»åŠ¡å®Œæˆ. å‘½ä»¤é€‰é¡¹ -a&lt;æ—¥å¿—æ–‡ä»¶&gt;:åœ¨æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•èµ„æ–™çš„æ‰§è¡Œè¿‡ç¨‹; -A&lt;åç¼€å&gt;:æŒ‡å®šè¦ä¸‹è½½æ–‡ä»¶çš„åç¼€å,å¤šä¸ªåç¼€åä¹‹é—´ä½¿ç”¨é€—å·è¿›è¡Œåˆ†éš”; -b:è¿›è¡Œåå°çš„æ–¹å¼è¿è¡Œwget; -B&lt;è¿æ¥åœ°å€&gt;:è®¾ç½®å‚è€ƒçš„è¿æ¥åœ°å€çš„åŸºåœ°åœ°å€; -c:ç»§ç»­æ‰§è¡Œä¸Šæ¬¡ç»ˆç«¯çš„ä»»åŠ¡,æ–­ç‚¹ç»­ä¼ ; -C&lt;æ ‡å¿—&gt;:è®¾ç½®æœåŠ¡å™¨æ•°æ®å—åŠŸèƒ½æ ‡å¿—onä¸ºæ¿€æ´»,offä¸ºå…³é—­,é»˜è®¤å€¼ä¸ºon; -d:è°ƒè¯•æ¨¡å¼è¿è¡ŒæŒ‡ä»¤; -D&lt;åŸŸååˆ—è¡¨&gt;:è®¾ç½®é¡ºç€çš„åŸŸååˆ—è¡¨,åŸŸåä¹‹é—´ç”¨â€,â€åˆ†éš”; -e&lt;æŒ‡ä»¤&gt;:ä½œä¸ºæ–‡ä»¶â€.wgetrcâ€ä¸­çš„ä¸€éƒ¨åˆ†æ‰§è¡ŒæŒ‡å®šçš„æŒ‡ä»¤; -h:æ˜¾ç¤ºæŒ‡ä»¤å¸®åŠ©ä¿¡æ¯; -i&lt;æ–‡ä»¶&gt;:ä»æŒ‡å®šæ–‡ä»¶è·å–è¦ä¸‹è½½çš„URLåœ°å€; -l&lt;ç›®å½•åˆ—è¡¨&gt;:è®¾ç½®é¡ºç€çš„ç›®å½•åˆ—è¡¨,å¤šä¸ªç›®å½•ç”¨â€,â€åˆ†éš”; -L:ä»…é¡ºç€å…³è”çš„è¿æ¥; -O: å°†è¦ä¸‹è½½çš„æ–‡ä»¶è¿›è¡Œé‡å‘½å -r:é€’å½’ä¸‹è½½æ–¹å¼; -nc:æ–‡ä»¶å­˜åœ¨æ—¶,ä¸‹è½½æ–‡ä»¶ä¸è¦†ç›–åŸæœ‰æ–‡ä»¶; -nv:ä¸‹è½½æ—¶åªæ˜¾ç¤ºæ›´æ–°å’Œå‡ºé”™ä¿¡æ¯,ä¸æ˜¾ç¤ºæŒ‡ä»¤çš„è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹; -q:ä¸æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹; -nh:ä¸æŸ¥è¯¢ä¸»æœºåç§°; -v:æ˜¾ç¤ºè¯¦ç»†æ‰§è¡Œè¿‡ç¨‹; -V:æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯; â€“passive-ftp:ä½¿ç”¨è¢«åŠ¨æ¨¡å¼PASVè¿æ¥FTPæœåŠ¡å™¨; â€“follow-ftp:ä»HTMLæ–‡ä»¶ä¸­ä¸‹è½½FTPè¿æ¥æ–‡ä»¶. å‚è€ƒç¤ºä¾‹1234567891011121314151.ä¸‹è½½ç½‘ç»œèµ„æº[root@litong ~]# wget https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tgz #ä½¿ç”¨wgetä¸‹è½½Pythonå®‰è£…åŒ…--2018-05-22 16:57:49-- https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tgzResolving www.python.org (www.python.org)... 151.101.8.223, 2a04:4e42:2::223Connecting to www.python.org (www.python.org)|151.101.8.223|:443... connected.HTTP request sent, awaiting response... 200 OKLength: 22994617 (22M) [application/octet-stream]Saving to: â€˜Python-3.6.5.tgzâ€™100%[=============================================================================================================&amp;gt;] 22,994,617 27.6MB/s in 0.8s 2018-05-22 16:57:50 (27.6 MB/s) - â€˜Python-3.6.5.tgzâ€™ saved [22994617/22994617][root@litong ~]# ll | grep Python-rw-r--r-- 1 root root 22994617 Mar 28 18:24 Python-3.6.5.tgz 2.æ–­ç‚¹ç»­ä¼ 123456789101112131415161718[root@litong ~]# wget -c http://d1.music.126.net/dmusic/netease-cloud-music_1.1.0_amd64_ubuntu.deb #ä¸‹è½½Linuxç‰ˆæœ¬çš„ç½‘æ˜“äº‘éŸ³ä¹--2018-05-22 17:04:04-- http://d1.music.126.net/dmusic/netease-cloud-music_1.1.0_amd64_ubuntu.debResolving d1.music.126.net (d1.music.126.net)... 157.185.168.24Connecting to d1.music.126.net (d1.music.126.net)|157.185.168.24|:80... connected.HTTP request sent, awaiting response... 200 OKLength: 68515076 (65M) [application/octet-stream]Saving to: â€˜netease-cloud-music_1.1.0_amd64_ubuntu.debâ€™46% [====================================================================&amp;gt; ] 31,560,638 15.2MB/s ^C #æŒ‰ä¸‹Ctrl+Cç»ˆæ­¢ä¸‹è½½[root@litong ~]# wget -c http://d1.music.126.net/dmusic/netease-cloud-music_1.1.0_amd64_ubuntu.deb #ç«¯ç‚¹ç»­ä¼ ,ç»§ç»­ä¸‹è½½,ä¸ä¼šé‡æ–°ä¸‹è½½--2018-05-22 17:04:09-- http://d1.music.126.net/dmusic/netease-cloud-music_1.1.0_amd64_ubuntu.debResolving d1.music.126.net (d1.music.126.net)... 157.185.168.24Connecting to d1.music.126.net (d1.music.126.net)|157.185.168.24|:80... connected.HTTP request sent, awaiting response... 206 Partial ContentLength: 68515076 (65M), 33805218 (32M) remaining [application/octet-stream]Saving to: â€˜netease-cloud-music_1.1.0_amd64_ubuntu.debâ€™100%[+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++==========================================================================&amp;gt;] 68,515,076 14.7MB/s in 2.2s Last-modified header invalid -- time-stamp ignored.2018-05-22 17:04:12 (14.7 MB/s) - â€˜netease-cloud-music_1.1.0_amd64_ubuntu.debâ€™ saved [68515076/68515076] 3.åå°ä¸‹è½½12345678910111213141516171819202122[root@litong ~]# wget -b https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tgz &amp;&amp; tail -50f wget-log #åå°ä¸‹è½½å¹¶æŸ¥çœ‹ä¸‹è½½æ—¥å¿—.ä¸‹è½½å¹¶ä¸é˜»å¡Shelläº¤äº’Continuing in background, pid 301.Output will be written to â€˜wget-logâ€™.--2018-05-22 17:14:55-- https://www.python.org/ftp/python/3.6.5/Python-3.6.5.tgzResolving www.python.org (www.python.org)... 151.101.8.223, 2a04:4e42:2::223Connecting to www.python.org (www.python.org)|151.101.8.223|:443... connected.HTTP request sent, awaiting response... 200 OKLength: 22994617 (22M) [application/octet-stream]Saving to: â€˜Python-3.6.5.tgzâ€™0K .......... .......... .......... .......... .......... 0% 17.2M 1s50K .......... .......... .......... .......... .......... 0% 23.7M 1s100K .......... .......... .......... .......... .......... 0% 33.3M 1s150K .......... .......... .......... .......... .......... 0% 22.4M 1s200K .......... .......... .......... .......... .......... 1% 34.5M 1s250K .......... .......... .......... .......... .......... 1% 32.9M 1s .......... .......... .......... .......... ..........22250K .......... .......... .......... .......... .......... 99% 13.2M 0s22300K .......... .......... .......... .......... .......... 99% 10.7M 0s22350K .......... .......... .......... .......... .......... 99% 12.4M 0s22400K .......... .......... .......... .......... .......... 99% 14.3M 0s22450K ..... 100% 129M=0.8s2018-05-22 17:14:56 (27.7 MB/s) - â€˜Python-3.6.5.tgzâ€™ saved [22994617/22994617] æµ‹è¯•æ¥å£å¸¸ç”¨çš„curlcurlæ˜¯åˆ©ç”¨URLè¯­æ³•åœ¨å‘½ä»¤è¡Œæ–¹å¼ä¸‹å·¥ä½œçš„å¼€æºæ–‡ä»¶ä¼ è¾“å·¥å…·.å®ƒæ”¯æŒæ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½,æ‰€ä»¥æ˜¯ç»¼åˆä¼ è¾“å·¥å…·.curlæ”¯æŒåŒ…æ‹¬HTTP,HTTPS,ftpç­‰ä¼—å¤šåè®®,è¿˜æ”¯æŒPOST,cookiesè®¤è¯,ä»æŒ‡å®šåç§»å¤„ä¸‹è½½éƒ¨åˆ†æ–‡ä»¶,ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²,é™é€Ÿ,æ–‡ä»¶å¤§å°,è¿›åº¦æ¡ç­‰ç‰¹å¾.åšç½‘é¡µå¤„ç†æµç¨‹å’Œæ•°æ®æ£€ç´¢è‡ªåŠ¨åŒ–,curlå¯ä»¥ç¥ä¸€è‡‚ä¹‹åŠ›. å‚è€ƒç¤ºä¾‹1.ç®€å•è¯·æ±‚1234[root@litong ~]# curl https://www.baidu.com #ç®€å•GETè¯·æ±‚è¯·æ±‚ç™¾åº¦&amp;lt;!DOCTYPE html&amp;gt;&amp;lt;!--STATUS OK--&amp;gt;&amp;lt;html&amp;gt; &amp;lt;head&amp;gt;&amp;lt;meta http-equiv=content-type content=text/html;charset=utf-8&amp;gt;&amp;lt;meta http-equiv=X-UA-Compatible content=IE=Edge&amp;gt;&amp;lt;meta content=always name=referrer&amp;gt;&amp;lt;link rel=stylesheet type=text/css href=https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/bdorz/baidu.min.css&amp;gt;&amp;lt;title&amp;gt;ç™¾åº¦ä¸€ä¸‹,ä½ å°±çŸ¥é“&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt; &amp;lt;body link=#0000cc&amp;gt; &amp;lt;div id=wrapper&amp;gt; &amp;lt;div id=head&amp;gt; &amp;lt;div class=head_wrapper&amp;gt; &amp;lt;div class=s_form&amp;gt; &amp;lt;div class=s_form_wrapper&amp;gt; &amp;lt;div id=lg&amp;gt; &amp;lt;img hidefocus=true src=//www.baidu.com/img/bd_logo1.png width=270 height=129&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;form id=form name=f action=//www.baidu.com/s class=fm&amp;gt; &amp;lt;input type=hidden name=bdorz_come value=1&amp;gt; &amp;lt;input type=hidden name=ie value=utf-8&amp;gt; &amp;lt;input type=hidden name=f value=8&amp;gt; &amp;lt;input type=hidden name=rsv_bp value=1&amp;gt; &amp;lt;input type=hidden name=rsv_idx value=1&amp;gt; &amp;lt;input type=hidden name=tn value=baidu&amp;gt;&amp;lt;span class=\"bg s_ipt_wr\"&amp;gt;&amp;lt;input id=kw name=wd class=s_ipt value maxlength=255 autocomplete=off autofocus=autofocus&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span class=\"bg s_btn_wr\"&amp;gt;&amp;lt;input type=submit id=su value=ç™¾åº¦ä¸€ä¸‹ class=\"bg s_btn\" autofocus&amp;gt;&amp;lt;/span&amp;gt; &amp;lt;/form&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;div id=u1&amp;gt; &amp;lt;a href=http://news.baidu.com name=tj_trnews class=mnav&amp;gt;æ–°é—»&amp;lt;/a&amp;gt; &amp;lt;a href=https://www.hao123.com name=tj_trhao123 class=mnav&amp;gt;hao123&amp;lt;/a&amp;gt; &amp;lt;a href=http://map.baidu.com name=tj_trmap class=mnav&amp;gt;åœ°å›¾&amp;lt;/a&amp;gt; &amp;lt;a href=http://v.baidu.com name=tj_trvideo class=mnav&amp;gt;è§†é¢‘&amp;lt;/a&amp;gt; &amp;lt;a href=http://tieba.baidu.com name=tj_trtieba class=mnav&amp;gt;è´´å§&amp;lt;/a&amp;gt; &amp;lt;noscript&amp;gt; &amp;lt;a href=http://www.baidu.com/bdorz/login.gif?login&amp;amp;tpl=mn&amp;amp;u=http%3A%2F%2Fwww.baidu.com%2f%3fbdorz_come%3d1 name=tj_login class=lb&amp;gt;ç™»å½•&amp;lt;/a&amp;gt; &amp;lt;/noscript&amp;gt; &amp;lt;script&amp;gt;document.write('&amp;lt;a href=\"http://www.baidu.com/bdorz/login.gif?login&amp;tpl=mn&amp;u='+ encodeURIComponent(window.location.href+ (window.location.search === \"\" ? \"?\" : \"&amp;\")+ \"bdorz_come=1\")+ '\" name=\"tj_login\" class=\"lb\"&amp;gt;ç™»å½•&amp;lt;/a&amp;gt;'); &amp;lt;/script&amp;gt; &amp;lt;a href=//www.baidu.com/more/ name=tj_briicon class=bri style=\"display: block;\"&amp;gt;æ›´å¤šäº§å“&amp;lt;/a&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;div id=ftCon&amp;gt; &amp;lt;div id=ftConw&amp;gt; &amp;lt;p id=lh&amp;gt; &amp;lt;a href=http://home.baidu.com&amp;gt;å…³äºç™¾åº¦&amp;lt;/a&amp;gt; &amp;lt;a href=http://ir.baidu.com&amp;gt;About Baidu&amp;lt;/a&amp;gt; &amp;lt;/p&amp;gt; &amp;lt;p id=cp&amp;gt;&amp;copy;2017&amp;nbsp;Baidu&amp;nbsp;&amp;lt;a href=http://www.baidu.com/duty/&amp;gt;ä½¿ç”¨ç™¾åº¦å‰å¿…è¯»&amp;lt;/a&amp;gt;&amp;nbsp; &amp;lt;a href=http://jianyi.baidu.com/ class=cp-feedback&amp;gt;æ„è§åé¦ˆ&amp;lt;/a&amp;gt;&amp;nbsp;äº¬ICPè¯030173å·&amp;nbsp; &amp;lt;img src=//www.baidu.com/img/gs.gif&amp;gt; &amp;lt;/p&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/body&amp;gt; &amp;lt;/html&amp;gt; 2.ç¼“å­˜(ä¸‹è½½)1234567891011121314[root@litong ~]# curl -o baidu.html https://www.baidu.com #å°†ç™¾åº¦é¦–é¡µä¿å­˜æˆhtmlæœ¬åœ°æ–‡ä»¶ % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed100 2443 100 2443 0 0 10319 0 --:--:-- --:--:-- --:--:-- 10351[root@litong ~]# cat baidu.html &amp;lt;!DOCTYPE html&amp;gt;&amp;lt;!--STATUS OK--&amp;gt;&amp;lt;html&amp;gt; &amp;lt;head&amp;gt;&amp;lt;meta http-equiv=content-type content=text/html;charset=utf-8&amp;gt;&amp;lt;meta http-equiv=X-UA-Compatible content=IE=Edge&amp;gt;&amp;lt;meta content=always name=referrer&amp;gt;&amp;lt;link rel=stylesheet type=text/css href=https://ss1.bdstatic.com/5eN1bjq8AAUYm2zgoY3K/r/www/cache/bdorz/baidu.min.css&amp;gt;&amp;lt;title&amp;gt;ç™¾åº¦ä¸€ä¸‹,ä½ å°±çŸ¥é“&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt; &amp;lt;body link=#0000cc&amp;gt; &amp;lt;div id=wrapper&amp;gt; &amp;lt;div id=head&amp;gt; &amp;lt;div class=head_wrapper&amp;gt; &amp;lt;div class=s_form&amp;gt; &amp;lt;div class=s_form_wrapper&amp;gt; &amp;lt;div id=lg&amp;gt; &amp;lt;img hidefocus=true src=//www.baidu.com/img/bd_logo1.png width=270 height=129&amp;gt; &amp;lt;/div&amp;gt; ... #çœç•¥ç‰‡æ®µ[root@litong ~]# curl -o Python-3.5.5.tgz https://www.python.org/ftp/python/3.5.5/Python-3.5.5.tgz #æ›¿æ¢wgetå‘½ä»¤ä¸‹è½½Python,æ–­ç‚¹ç»­ä¼ -C % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed100 19.8M 100 19.8M 0 0 29.0M 0 --:--:-- --:--:-- --:--:-- 29.0M[root@litong ~]# ll | grep Python-rw-r--r-- 1 root root 20766931 May 22 17:38 Python-3.5.5.tgz 3.è¯·æ±‚æ–¹å¼è®¾ç½®12345[root@litong ~]# curl -H &quot;Content-Type:application/json&quot; -X POST -d &apos;&#123; &quot;arg&quot;: 125086 &#125;&apos; http://47.67.44.121:9130/learning-path/tree/queryPhaseAndSubject #ä»¥jsonçš„æ–¹å¼è¿›è¡Œè¯·æ±‚% Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed100 231 0 214 100 17 214 17 0:00:01 --:--:-- 0:00:01 14437&#123;&quot;message&quot;:null,&quot;result&quot;:&quot;success&quot;,&quot;data&quot;:[&#123;&quot;subjectId&quot;:&quot;4267aa39-6ecb-40b7-8e10-7b309d022aec&quot;,&quot;subjectName&quot;:&quot;è¯­æ–‡&quot;,&quot;phaseId&quot;:&quot;c7241629-1ec4-4035-b04c-ef17f7866688&quot;,&quot;phaseName&quot;:&quot;é«˜ä¸­&quot;&#125;],&quot;code&quot;:0,&quot;success&quot;:true&#125; 4.è®¾ç½®referer1[root@litong ~]# curl --referer http://www.google.com http://www.baidu.com 5.è®¾ç½®User-Agent1[root@litong ~]# curl -A \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.162 Safari/537.36\" http://www.baidu.com 6.è®¾ç½®cookie1[root@litong ~]# curl --cookie \"user=litong\" http://www.baidu.com 7.è®¾ç½®è¯·æ±‚å¤´1[root@litong ~]# curl -H \"accept-language:zh-cn\" http://www.baidu.com 8.è¿›è¡Œè®¤è¯12345678910111213[root@litong ~]# curl -u litong:0517108 http://www.gitlab.com/users/sign_in % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0&amp;lt;! DOCTYPE html&amp;gt;&amp;lt;html class=\"devise-layout-html\"&amp;gt;&amp;lt;head prefix=\"og: http://ogp.me/ns#\"&amp;gt;&amp;lt;meta charset=\"utf-8\"&amp;gt;&amp;lt;meta content=\"IE=edge\" http-equiv=\"X-UA-Compatible\"&amp;gt;&amp;lt;meta content=\"object\" property=\"og:type\"&amp;gt;&amp;lt;meta content=\"GitLab\" property=\"og:site_name\"&amp;gt;&amp;lt;meta content=\"Sign in\" property=\"og:title\"&amp;gt;&amp;lt;meta content=\"GitLab Community Edition\" property=\"og:description\"&amp;gt;...çœç•¥ç‰‡æ®µ 9.ä¸Šä¼ æ–‡ä»¶1234 [root@litong ~]# curl http://127.0.0.1/up -F \"file=@logo.png\" % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed100 4616 0 76 100 4540 76 4540 0:00:01 --:--:-- 0:00:01 8213&#123;\"hash\":\"FmP639IPMcunQpiXidRPNisi2lDp\",\"key\":\"FmP639IPMcunQpiXidRPNisi2lDp\"&#125;","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"http://ltyeamin.github.io/tags/Linux/"}]},{"title":"è‡ªå®šä¹‰ä¸€ä¸ªSpring Boot Starter","slug":"è‡ªå®šä¹‰ä¸€ä¸ªSpring Boot Starter","date":"2018-05-18T08:58:10.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2018/05/18/è‡ªå®šä¹‰ä¸€ä¸ªSpring Boot Starter/","link":"","permalink":"http://ltyeamin.github.io/2018/05/18/è‡ªå®šä¹‰ä¸€ä¸ªSpring Boot Starter/","excerpt":"","text":"æˆ‘ä»¬å¯ä»¥æ¨¡ä»¿ä¹‹å‰httpç¼–ç è‡ªåŠ¨é…ç½®çš„ä¾‹å­ä¹Ÿåè®®ä¸€ä¸ªstarter,ç›®çš„æ˜¯ä¸ºäº†é™ä½è€¦åˆæ€§.è™½è¯´å¯ä»¥é™ä½ç¨‹åºä¾èµ–ä¹‹é—´çš„è€¦åˆæ€§,ä½†æ˜¯æˆ‘ä»¬ä¸å»ºè®®è‡ªå·±å®šä¹‰starter,å› ä¸ºSpring Bootæˆ–å…¶ä»–ç¤¾åŒºå·²ç»æä¾›äº†å¤§éƒ¨åˆ†çš„starter,å¯ä»¥æ»¡è¶³æˆ‘ä»¬æ—¥å¸¸çš„éœ€æ±‚.æœ¬ç¯‡åšæ–‡ä¸»è¦ä¸ºäº†è®©å¤§å®¶æ›´å¥½çš„ç†è§£Spring Bootçš„è‡ªåŠ¨é…ç½®åŸç†è€Œå†™çš„,æ€»ä¹‹,éµå¾ªâ€ä¸è¦é‡å¤é€ è½®å­â€çš„å®—æ—¨.åŠ¨èµ·æ¥è‡ªå·±é€ è½®å­,è®©æˆ‘ä»¬ä»ç°åœ¨å¼€å§‹: 1.æ–°å»ºä¸€ä¸ªMavené¡¹ç›®,pomæ–‡ä»¶ä¸­å¯¼å…¥ä¾èµ–1234567891011121314151617181920212223242526272829&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.yeamin.boot&lt;/groupId&gt; &lt;artifactId&gt;yeamin-boot-start&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;description&gt;è‡ªå®šä¹‰çš„start&lt;/description&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- è‡ªåŠ¨é…ç½®ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt; &lt;version&gt;2.0.0.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;version&gt;2.0.0.RELEASE&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; 2.å®‰å…¨çš„é…ç½®ç±»1234567891011121314151617181920212223package cn.yeamin.boot.conf;import org.springframework.boot.context.properties.ConfigurationProperties;/** * å®‰å…¨çš„é…ç½®ç±» * @author Administrator */@ConfigurationProperties(prefix = \"yeamin.boot\")public class HelloServiceProperties &#123; private static final String MSG = \"world\"; private String msg = MSG; public String getMsg() &#123; return msg; &#125; public void setMsg(String msg) &#123; this.msg = msg; &#125; &#125; 3.åˆ¤æ–­ä¾æ®ç±»123456789101112131415161718192021/** * åˆ¤æ–­ä¾æ®ç±»:å¯æ ¹æ®æ­¤ç±»çš„å­˜åœ¨ä¸å¦åˆ¤æ–­æ˜¯å¦åˆ›å»ºè¿™ä¸ªç±»çš„Bean * @author Administrator */public class HelloService &#123; private String msg; public String sayHello() &#123; return \"Hello: \" + msg; &#125; public String getMsg() &#123; return msg; &#125; public void setMsg(String msg) &#123; this.msg = msg; &#125; &#125; 4.è‡ªåŠ¨é…ç½®ç±»12345678910111213141516171819202122232425262728293031package cn.yeamin.boot.conf;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;import org.springframework.boot.context.properties.EnableConfigurationProperties;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import cn.yeamin.boot.service.HelloService;@Configuration@EnableConfigurationProperties(HelloServiceProperties.class)@ConditionalOnClass(&#123;HelloService.class&#125;)@ConditionalOnProperty(prefix = \"yeamin.boot\", value = \"enable\", matchIfMissing = true)public class HelloAutoConfiguration &#123; @Autowired private HelloServiceProperties properties; @Bean //åˆ¤æ–­HelloServiceæ˜¯å¦åœ¨classpathå­˜åœ¨ @ConditionalOnMissingBean(HelloService.class) public HelloService helloService() &#123; HelloService helloService = new HelloService(); helloService.setMsg(properties.getMsg()); return helloService; &#125;&#125; 5.æ³¨å†Œé…ç½®åœ¨src/main/resourceæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºMETA-INF/spring.factoriesæ–‡ä»¶123# Auto Configure è‹¥æœ‰å¤šä¸ªè‡ªåŠ¨é…ç½®,åˆ™ç”¨&quot;,&quot;éš”å¼€,æ­¤å¤„&quot;\\&quot;æ˜¯ä¸ºäº†æ¢è¡Œåè¿˜èƒ½å¤Ÿè¯»å–åˆ°valueorg.springframework.boot.autoconfigure.EnableAutoConfiguration=\\cn.yeamin.boot.conf.HelloAutoConfiguration 6.æ–°å»ºä¸€ä¸ªSpring Booté¡¹ç›®,ä½¿ç”¨starter,å¯¼å…¥pomé…ç½®12345&lt;dependency&gt; &lt;groupId&gt;com.yeamin.boot&lt;/groupId&gt; &lt;artifactId&gt;yeamin-boot-start&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&lt;/dependency&gt; 7.ç¼–å†™controller123456789101112@RestControllerpublic class HelloController &#123; @Autowired private HelloService helloService; @GetMapping(&quot;/hello&quot;) public String index() &#123; return helloService.sayHello(); &#125;&#125; 8.è¿›è¡Œymlé…ç½®12345server: port: 80yeamin: boot: msg: litong 9.æµè§ˆå™¨è¯·æ±‚http://localhost/hello,æŸ¥çœ‹ç»“æœ1litong","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://ltyeamin.github.io/tags/Spring-Boot/"}]},{"title":"Spring Bootè‡ªåŠ¨é…ç½®åŸç†å‰–æ","slug":"Spring Bootè‡ªåŠ¨åŸç†å‰–æ","date":"2018-05-17T08:01:40.000Z","updated":"2019-11-20T15:08:58.637Z","comments":true,"path":"2018/05/17/Spring Bootè‡ªåŠ¨åŸç†å‰–æ/","link":"","permalink":"http://ltyeamin.github.io/2018/05/17/Spring Bootè‡ªåŠ¨åŸç†å‰–æ/","excerpt":"","text":"ç¥å¥‡é­”æ³•-è‡ªåŠ¨é…ç½®å‰ç¯‡æ–‡ç« è®²è¿°äº†Spring 4 æ¡ä»¶æ³¨è§£,å…¶å®Spring Bootè‡ªåŠ¨é…ç½®ç¥å¥‡å®ç°ä¹Ÿæ˜¯åŸºäºè¿™ä¸€åŸç†çš„.è‹¥æƒ³çŸ¥é“Spring Bootä¸ºæˆ‘ä»¬åšäº†å“ªäº›çš„è‡ªåŠ¨é…ç½®,å¯ä»¥æŸ¥çœ‹è¿™é‡Œçš„æºç .å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼æŸ¥çœ‹é¡¹ç›®ä¸­å·²å¯ç”¨å’Œæœªå¯ç”¨çš„è‡ªåŠ¨é…ç½®æŠ¥å‘Š. è¿è¡Œjaræ—¶å¢åŠ â€“debugå‚æ•°: java -jar xxx.jar â€“debug åœ¨application.propertiesä¸­è®¾ç½®å±æ€§: debug=true è¿è¡Œé¡¹ç›®æ—¶é€šè¿‡IDEè®¾ç½®JVMå‚æ•°: -Ddebug å¯åŠ¨å,å¯åœ¨æ§åˆ¶å°è¾“å‡ºç›¸å…³è‡ªåŠ¨é…ç½®æŠ¥å‘Š.å·²å¯ç”¨çš„è‡ªåŠ¨é…ç½®ä¸º:123456789101112131415161718192021222324============================CONDITIONS EVALUATION REPORT============================Positive matches:----------------- CodecsAutoConfiguration matched: - @ConditionalOnClass found required class &apos;org.springframework.http.codec.CodecConfigurer&apos;; @ConditionalOnMissingClass did not find unwanted class (OnClassCondition) CodecsAutoConfiguration.JacksonCodecConfiguration matched: - @ConditionalOnClass found required class &apos;com.fasterxml.jackson.databind.ObjectMapper&apos;; @ConditionalOnMissingClass did not find unwanted class (OnClassCondition) CodecsAutoConfiguration.JacksonCodecConfiguration#jacksonCodecCustomizer matched: - @ConditionalOnBean (types: com.fasterxml.jackson.databind.ObjectMapper; SearchStrategy: all) found bean &apos;jacksonObjectMapper&apos; (OnBeanCondition) DispatcherServletAutoConfiguration matched: - @ConditionalOnClass found required class &apos;org.springframework.web.servlet.DispatcherServlet&apos;; @ConditionalOnMissingClass did not find unwanted class (OnClassCondition) - found ConfigurableWebEnvironment (OnWebApplicationCondition) ...... ...... ...... æœªå¯ç”¨çš„è‡ªåŠ¨é…ç½®ä¸º:123456789101112131415161718Negative matches:----------------- ActiveMQAutoConfiguration: Did not match: - @ConditionalOnClass did not find required classes &apos;javax.jms.ConnectionFactory&apos;, &apos;org.apache.activemq.ActiveMQConnectionFactory&apos; (OnClassCondition) AopAutoConfiguration: Did not match: - @ConditionalOnClass did not find required classes &apos;org.aspectj.lang.annotation.Aspect&apos;, &apos;org.aspectj.lang.reflect.Advice&apos;, &apos;org.aspectj.weaver.AnnotatedElement&apos; (OnClassCondition) ArtemisAutoConfiguration: Did not match: - @ConditionalOnClass did not find required classes &apos;javax.jms.ConnectionFactory&apos;, &apos;org.apache.activemq.artemis.jms.client.ActiveMQConnectionFactory&apos; (OnClassCondition) ...... ...... ...... Spring Bootå…³äºè‡ªåŠ¨é…ç½®çš„æºç ä¹Ÿæ˜¯åœ¨spring-boot-autoconfigure-1.5.9.RELEASE.jarå†…,åŒ…å«çš„æ¨¡å—é…ç½®,å¦‚ä¸‹å›¾: Spring Bootæ¡ä»¶æ³¨è§£åœ¨spring-boot-autoconfigure-1.5.9.RELEASE.jarçš„org.springframework.boot.autoconfigure.conditionåŒ…ä¸‹,æœ‰è®¸å¤šæ³¨è§£ç»„åˆäº†@Conditionalçš„å…ƒæ³¨è§£,åªæ˜¯ä½¿ç”¨äº†ä¸åŒçš„æ¡ä»¶,å½¢æˆäº†æ–°çš„æ¡ä»¶æ³¨è§£: @ConditionalOnBean: å½“å®¹å™¨é‡Œæœ‰æŒ‡å®šçš„Beançš„æ¡ä»¶ä¸‹. @ConditionalOnClass: å½“classpathä¸‹æœ‰æŒ‡å®šçš„ç±»çš„æ¡ä»¶ä¸‹. @ConditionalOnExpression: åŸºäºSpELè¡¨è¾¾å¼ä½œä¸ºåˆ¤æ–­æ¡ä»¶. @ConditionalOnJava: åŸºäºJVMç‰ˆæœ¬ä½œä¸ºåˆ¤æ–­æ¡ä»¶. @ConditionalOnJndi: åœ¨JNDIæ‘é•¿çš„æ¡ä»¶ä¸‹æŸ¥æ‰¾æŒ‡å®šçš„ä½ç½®. @ConditionalOnMissingBean:å½“å®¹å™¨é‡Œæ²¡æœ‰æŒ‡å®šçš„Beançš„æ¡ä»¶ä¸‹. @ConditionalOnMissingClass: å½“classpathä¸‹æ²¡æœ‰æŒ‡å®šçš„ç±»çš„æ¡ä»¶ä¸‹. @ConditionalOnNotWebApplication: å½“å‰é¡¹ç›®ä¸æ˜¯Webé¡¹ç›®çš„æ¡ä»¶ä¸‹. @ConditionalOnProperty: æŒ‡å®šçš„å±æ€§æ˜¯å¦æœ‰æŒ‡å®šå€¼çš„æƒ…å†µä¸‹. @ConditionalOnResource: classpathä¸‹æ˜¯å¦æœ‰æŒ‡å®šèµ„æºçš„æƒ…å†µä¸‹. @ConditionalOnSingleCandidate: å½“æŒ‡å®šçš„Beanåœ¨å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ª,æˆ–è™½ç„¶æœ‰å¤šä¸ªä½†æ˜¯æœ‰æŒ‡å®šçš„é¦–é€‰(@Primary)çš„Bean @ConditionalOnWebApplication: å½“å‰é¡¹ç›®æ˜¯Webé¡¹ç›®çš„æ¡ä»¶ä¸‹. @Enable*æ³¨è§£çš„å·¥ä½œåŸç†åœ¨Springä½“ç³»ä¸­,æœ‰å¤§é‡çš„@Enable*çš„æ³¨è§£: @EnableAspectAutoProxy:ç”¨äºå¼€å¯å¯¹Aspectè‡ªåŠ¨ä»£ç†çš„æ”¯æŒ. @EnableAsync:ç”¨äºå¼€å¯å¼‚æ­¥æ–¹æ³•çš„æ”¯æŒ. @EnableScheduling:ç”¨äºå¼€å¯å®šæ—¶ä»»åŠ¡çš„æ”¯æŒ. @EnableWebMvc:ç”¨äºå¼€å¯WebMvcé…ç½®çš„æ”¯æŒ. @EnableConfigurationProperties:ç”¨äºå¼€å¯å¯¹@ConfigurationPropertiesæ³¨è§£é…ç½®Beançš„çš„æ”¯æŒ. @EnableJpaRepositories:ç”¨äºå¼€å¯å¯¹Spring Data Jpaçš„çš„æ”¯æŒ. @EnableTransactionManagement:ç”¨äºå¼€å¯å¯¹æ³¨è§£å¼äº‹åŠ¡çš„çš„æ”¯æŒ. @EnableCaching:ç”¨äºå¼€å¯å¯¹æ³¨è§£å¼ç¼“å­˜çš„çš„æ”¯æŒ. è¿™äº›æ³¨è§£ç”¨äºå¼€å¯æŸé¡¹åŠŸèƒ½çš„æ”¯æŒ,ä»è€Œé¿å…è‡ªå·±é…ç½®å¤§é‡çš„ä»£ç .é‚£ä¹ˆè¿™ä¸ªç¥å¥‡çš„åŠŸèƒ½çš„ä¸Šçº¿åŸç†æ˜¯ä»€ä¹ˆå‘¢?æˆ‘ä»¬æ¥çœ‹çœ‹. é€šè¿‡è§‚å¯Ÿè¿™äº›@Enable*æ³¨è§£çš„æºç ,æˆ‘ä»¬å‘ç°æ‰€æœ‰çš„æ³¨è§£éƒ½æœ‰ä¸€ä¸ª@importæ³¨è§£,@importæ˜¯ç”¨æ¥å¯¼å…¥é…ç½®ç±»çš„,è¿™ä¹Ÿå°±æ„å‘³ç€è¿™äº›è‡ªåŠ¨å¼€å¯çš„å®ç°æ˜¯å¯¼å…¥äº†ä¸€äº›è‡ªåŠ¨é…ç½®çš„Bean.è¿™äº›å¯¼å…¥çš„é…ç½®æ–¹å¼ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ç±»å‹. ç¬¬ä¸€ç±»:ç›´æ¥å¯¼å…¥é…ç½®ç±» 1234567@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Import(SchedulingConfiguration.class)@Documentedpublic @interface EnableScheduling &#123;&#125; ç›´æ¥å¯¼å…¥é…ç½®ç±»SchedulingConfiguration.class,è¿™ä¸ªç±»æ³¨è§£äº†@Condition,ä¸”æ³¨å†Œäº†ä¸€ä¸ªScheduledAnnotationBeanPostProcessorçš„Bean,æºç å¦‚ä¸‹:1234567891011@Configuration@Role(BeanDefinition.ROLE_INFRASTRUCTURE)public class SchedulingConfiguration &#123; @Bean(name = TaskManagementConfigUtils.SCHEDULED_ANNOTATION_PROCESSOR_BEAN_NAME) @Role(BeanDefinition.ROLE_INFRASTRUCTURE) public ScheduledAnnotationBeanPostProcessor scheduledAnnotationProcessor() &#123; return new ScheduledAnnotationBeanPostProcessor(); &#125;&#125; ç¬¬äºŒç±»:ä¾æ®æ¡ä»¶é€‰æ‹©é…ç½®ç±»12345678910@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Import(AsyncConfigurationSelector.class)public @interface EnableAsync &#123; Class&lt;? extends Annotation&gt; annotation() default Annotation.class; boolean proxyTargetClass() default false; AdviceMode mode() default AdviceMode.PROXY; int order() default Ordered.LOWEST_PRECEDENCE;&#125; AsyncConfigurationSelectoré€šè¿‡æ¡ä»¶æ¥é€‰æ‹©éœ€è¦å¯¼å…¥çš„é…ç½®ç±»,AsyncConfigurationSelectorçš„æ ¹æ¥å£ä¸ºImportSelector1234567891011121314151617public class AsyncConfigurationSelector extends AdviceModeImportSelector&lt;EnableAsync&gt; &#123; private static final String ASYNC_EXECUTION_ASPECT_CONFIGURATION_CLASS_NAME = \"org.springframework.scheduling.aspectj.AspectJAsyncConfiguration\"; @Override public String[] selectImports(AdviceMode adviceMode) &#123; switch (adviceMode) &#123; case PROXY: return new String[] &#123; ProxyAsyncConfiguration.class.getName() &#125;; case ASPECTJ: return new String[] &#123; ASYNC_EXECUTION_ASPECT_CONFIGURATION_CLASS_NAME &#125;; default: return null; &#125; &#125;&#125; è‡ªåŠ¨é…ç½®åŸç†å…³äºSpring Bootçš„è¿ä½œåŸç†,æˆ‘ä»¬è¿˜æ˜¯å›å½’åˆ°@SpringBootApplicationæ³¨è§£ä¸Š,æ”¹æ³¨è§£æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£.å®ƒæ˜¯ç”±@SpringBootConfiguration,@EnableAutoConfigurationå’Œ@ComponentScanç»„æˆçš„.@SpringBootConfigurationä¹Ÿæ˜¯ç»„åˆäº†@Configurationæ³¨è§£,@ComponentScanæ˜¯ç»„ä»¶æ‰«æ,è€Œ@EnableAutoConfigurationæ˜¯è‡ªåŠ¨é…ç½®åŠŸèƒ½çš„æ ¸å¿ƒæ³¨è§£.æˆ‘ä»¬æ¥çœ‹çœ‹@EnableAutoConfigurationæ³¨è§£æºç :123456789101112@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documented@Inherited@AutoConfigurationPackage@Import(EnableAutoConfigurationImportSelector.class)public @interface EnableAutoConfiguration &#123; String ENABLED_OVERRIDE_PROPERTY = \"spring.boot.enableautoconfiguration\"; Class&lt;?&gt;[] exclude() default &#123;&#125;; String[] excludeName() default &#123;&#125;;&#125; è¿™é‡Œçš„å…³é”®åŠŸèƒ½æ˜¯@Importæ³¨è§£å¯¼å…¥çš„é…ç½®åŠŸèƒ½,EnableAutoConfigurationImportSelectorä½¿ç”¨SpringFactoriesLoader.loadFactoryNames()æ–¹æ³•æ¥æ‰«æå…·æœ‰META-INF/spring.factoriesæ–‡ä»¶çš„jaråŒ….è€Œæˆ‘ä»¬çš„spring-boot-autoconfigure-1.5.9.RELEASE.jarå°±æœ‰ä¸€ä¸ªspring.factoriesæ–‡ä»¶.æ­¤æ–‡ä»¶ä¸­å£°æ˜äº†æœ‰å“ªäº›è‡ªåŠ¨é…ç½®,å¦‚ä¸‹å›¾: å®ä¾‹åˆ†æåœ¨äº†è§£Spring Bootçš„è¿ä½œåŸç†å’Œä¸»è¦æ¡ä»¶æ³¨è§£å,ç°åœ¨æˆ‘ä»¬æ¥åˆ†æä¸€ä¸ªç®€å•çš„Spring Bootå†…ç½®çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½:httpçš„ç¼–ç é…ç½®.åœ¨å¸¸è§„webçš„waré¡¹ç›®ä¸­,æˆ‘ä»¬è¦è§£å†³httpç¼–ç çš„æ—¶å€™æ˜¯åœ¨web.xmlé‡Œé…ç½®ä¸€ä¸ªfilter,å¦‚:1234567891011121314151617&lt;!-- ç¼–ç Filter åŠ è½½é…ç½® Start --&gt; &lt;filter&gt; &lt;filter-name&gt;CharacterEncoding&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt; &lt;init-param&gt; &lt;param-name&gt;encoding&lt;/param-name&gt; &lt;param-value&gt;UTF-8&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;forceEncoding&lt;/param-name&gt; &lt;param-value&gt;true&lt;/param-value&gt; &lt;/init-param&gt; &lt;/filter&gt; &lt;filter-mapping&gt; &lt;filter-name&gt;CharacterEncoding&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt; &lt;/filter-mapping&gt; è‡ªåŠ¨é…ç½®è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶: èƒ½é…ç½®CharacterEncodingFilterè¿™ä¸ªBean; èƒ½é…ç½®encodingå’ŒforceEncodingè¿™ä¸¤ä¸ªå‚æ•°. æºç ä¸­å®šä¹‰çš„HttpEncodingPropertiesé…ç½®ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475package org.springframework.boot.autoconfigure.http;import java.nio.charset.Charset;import java.nio.charset.StandardCharsets;import java.util.Locale;import java.util.Map;import org.springframework.boot.context.properties.ConfigurationProperties; // åœ¨application.propertiesæˆ–application.ynlæ–‡ä»¶é…ç½®æ—¶å‰ç¼€å¿…é¡»æ˜¯spring.http.encoding@ConfigurationProperties(prefix = \"spring.http.encoding\")public class HttpEncodingProperties &#123; public static final Charset DEFAULT_CHARSET = StandardCharsets.UTF_8; /** é»˜è®¤ç¼–ç æ–¹å¼ä¸ºUTF-8,è‹¥ä¿®æ”¹å¯ä½¿ç”¨spring.http.encoding.charset=ç¼–ç  */ private Charset charset = DEFAULT_CHARSET; private Boolean force; private Boolean forceRequest; private Boolean forceResponse; private Map&lt;Locale, Charset&gt; mapping; public Charset getCharset() &#123; return this.charset; &#125; public void setCharset(Charset charset) &#123; this.charset = charset; &#125; public boolean isForce() &#123; return Boolean.TRUE.equals(this.force); &#125; public void setForce(boolean force) &#123; this.force = force; &#125; public boolean isForceRequest() &#123; return Boolean.TRUE.equals(this.forceRequest); &#125; public void setForceRequest(boolean forceRequest) &#123; this.forceRequest = forceRequest; &#125; public boolean isForceResponse() &#123; return Boolean.TRUE.equals(this.forceResponse); &#125; public void setForceResponse(boolean forceResponse) &#123; this.forceResponse = forceResponse; &#125; public Map&lt;Locale, Charset&gt; getMapping() &#123; return this.mapping; &#125; public void setMapping(Map&lt;Locale, Charset&gt; mapping) &#123; this.mapping = mapping; &#125; public boolean shouldForce(Type type) &#123; Boolean force = (type == Type.REQUEST ? this.forceRequest : this.forceResponse); if (force == null) &#123; force = this.force; &#125; if (force == null) &#123; force = (type == Type.REQUEST); &#125; return force; &#125; public enum Type &#123; REQUEST, RESPONSE &#125;&#125; æºç :HttpEncodingAutoConfigurationè‡ªåŠ¨é…ç½®ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172package org.springframework.boot.autoconfigure.web;import org.springframework.boot.autoconfigure.EnableAutoConfiguration;import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;import org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;import org.springframework.boot.autoconfigure.web.HttpEncodingProperties.Type;import org.springframework.boot.context.embedded.ConfigurableEmbeddedServletContainer;import org.springframework.boot.context.embedded.EmbeddedServletContainerCustomizer;import org.springframework.boot.context.properties.EnableConfigurationProperties;import org.springframework.boot.web.filter.OrderedCharacterEncodingFilter;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.core.Ordered;import org.springframework.web.filter.CharacterEncodingFilter;@Configuration@EnableConfigurationProperties(HttpEncodingProperties.class) //å¼€å¯å±æ€§æ³¨å…¥@ConditionalOnWebApplication //å½“å‰é¡¹ç›®æ˜¯Webåº”ç”¨è§¦å‘@ConditionalOnClass(CharacterEncodingFilter.class) //å½“classpathä¸‹å­˜åœ¨CharacterEncodingFilter.classæ—¶åŠ è½½è¯¥ç±»@ConditionalOnProperty(prefix = \"spring.http.encoding\", value = \"enabled\", matchIfMissing = true) //å½“spring.http.encoding=enableçš„æƒ…å†µä¸‹,å¦‚æœæ²¡æœ‰è®¾ç½®åˆ™é»˜è®¤ä¸ºtrue,å³æ¡ä»¶ç¬¦åˆpublic class HttpEncodingAutoConfiguration &#123; private final HttpEncodingProperties properties; /** é€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥ */ public HttpEncodingAutoConfiguration(HttpEncodingProperties properties) &#123; this.properties = properties; &#125; @Bean //ä½¿ç”¨Javaçš„æ–¹å¼å£°æ˜Bean @ConditionalOnMissingBean(CharacterEncodingFilter.class) //å½“Springå®¹å™¨ä¸­æ²¡æœ‰è¿™ä¸ªBeançš„æ—¶å€™æ–°å»ºBean. public CharacterEncodingFilter characterEncodingFilter() &#123; CharacterEncodingFilter filter = new OrderedCharacterEncodingFilter(); //è®¾ç½®ç¼–ç  filter.setEncoding(this.properties.getCharset().name()); filter.setForceRequestEncoding(this.properties.shouldForce(Type.REQUEST)); filter.setForceResponseEncoding(this.properties.shouldForce(Type.RESPONSE)); return filter; &#125; @Bean public LocaleCharsetMappingsCustomizer localeCharsetMappingsCustomizer() &#123; return new LocaleCharsetMappingsCustomizer(this.properties); &#125; private static class LocaleCharsetMappingsCustomizer implements EmbeddedServletContainerCustomizer, Ordered &#123; private final HttpEncodingProperties properties; LocaleCharsetMappingsCustomizer(HttpEncodingProperties properties) &#123; this.properties = properties; &#125; @Override public void customize(ConfigurableEmbeddedServletContainer container) &#123; if (this.properties.getMapping() != null) &#123; container.setLocaleCharsetMappings(this.properties.getMapping()); &#125; &#125; @Override public int getOrder() &#123; return 0; &#125; &#125;&#125;","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Spring Boot","slug":"Spring-Boot","permalink":"http://ltyeamin.github.io/tags/Spring-Boot/"}]},{"title":"Springæ¡ä»¶æ³¨è§£@Conditional","slug":"Springæ¡ä»¶æ³¨è§£@Conditional","date":"2018-05-17T06:20:15.000Z","updated":"2019-05-29T14:03:53.000Z","comments":true,"path":"2018/05/17/Springæ¡ä»¶æ³¨è§£@Conditional/","link":"","permalink":"http://ltyeamin.github.io/2018/05/17/Springæ¡ä»¶æ³¨è§£@Conditional/","excerpt":"","text":"@Conditionalæ³¨è§£Spring 4æä¾›äº†ä¸€ä¸ªåŸºäºæ¡ä»¶çš„Beançš„åˆ›å»º,å³ä½¿ç”¨@Conditionalæ³¨è§£.@Conditionalæ ¹æ®æ»¡è¶³æŸä¸€ä¸ªç‰¹å®šæ¡ä»¶åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„Bean.æ¯”å¦‚è¯´,å½“æŸä¸€ä¸ªjaråŒ…åœ¨ä¸€ä¸ªç±»è·¯å¾„ä¸‹çš„æ—¶å€™,è‡ªåŠ¨é…ç½®ä¸€ä¸ªæˆ–å¤šä¸ªBean;æˆ–è€…åªæœ‰æŸä¸ªBeanè¢«åˆ›å»ºæ‰ä¼šåˆ›å»ºå¦å¤–ä¸€ä¸ªBean.æ€»çš„æ¥è¯´,å°±æ˜¯æ ¹æ®ç‰¹å®šæ¡ä»¶æ¥æ§åˆ¶Beançš„åˆ›å»ºè¡Œä¸º,è¿™æ ·æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥è¿›è¡Œä¸€äº›è‡ªåŠ¨çš„é…ç½®. Conditionæ¥å£è®¾ç½®ç»™ @Conditionalæ³¨è§£çš„ç±»å¯ä»¥æ˜¯ä»»æ„å®ç°äº†Conditionæ¥å£çš„ç±»å‹.å¯ä»¥çœ‹å‡º,è¿™äº›æ¥å£å®ç°èµ·æ¥ç®€å•ç›´æ¥.åªéœ€è¦æä¾›matches()æ–¹æ³•çš„å®ç°å³å¯.å¦‚æœmatches()æ–¹æ³•è¿”å›true,é‚£ä¹ˆå°±ä¼šåˆ›å»ºå¸¦æœ‰@Conditionalæ³¨è§£çš„bean.åä¹‹åˆ™ä¸ä¼šåˆ›å»ºBean.matches()æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°:ConditionContextç±»å‹å’ŒAnnotatedTypeMetadataç±»å‹: ConditionContextæ¥å£èƒ½æä¾›åº”ç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯: getRegistry()è¿”å›BeanDefinitionRegistryæ³¨å†Œè¡¨,å¯ä»¥åˆ¤æ–­Beançš„å®šä¹‰ getBeanFactory()è¿”å›ConfigurableListableBeanFactory,å¯ä»¥æ£€æŸ¥Beanæ˜¯å¦å·²ç»å­˜åœ¨,ç”šè‡³æ¢æŸ¥Beançš„å±æ€§. getEnvironment()è¿”å›Environment,å¯ä»¥è·å–å½“å‰åº”ç”¨ç¯å¢ƒå˜é‡,ä¹Ÿå¯ä»¥æ£€æµ‹å½“å‰ç¯å¢ƒå˜é‡æ˜¯å¦å­˜åœ¨. getResourceLoader()è¿”å›ResourceLoader,ç”¨äºè¯»å–æˆ–æ¢æŸ¥æ‰€åŠ è½½çš„èµ„æº. getClassLoader()è¿”å›ClassLoader,ç”¨äºæ£€æŸ¥ç±»æ˜¯å¦å­˜åœ¨. AnnotatedTypeMetadataæ¥å£èƒ½å¤Ÿè®©æˆ‘ä»¬æ£€æŸ¥å¸¦æœ‰@Beanæ³¨è§£çš„æ–¹æ³•ä¸Šè¿˜æœ‰æ²¡æœ‰å…¶ä»–æ³¨è§£: isAnnotated()å¯ä»¥åˆ¤æ–­é™¤@Beanæ³¨è§£å¤–æ˜¯å¦è¿˜æœ‰å…¶ä»–æ³¨è§£. getAllAnnotationAttributes()è·å–å…¶ä»–æ‰€æœ‰çš„æ³¨è§£å±æ€§ä¸‹é¢æˆ‘ä»¬æ¥åšä¸€ä¸ªä»¥ä¸åŒçš„æ“ä½œç³»ç»Ÿæ¥ä½œä¸ºæ¡ä»¶,é€šè¿‡å®ç°Conditionæ¥å£,å¹¶é‡å†™å…¶matchesæ–¹æ³•æ¥æ„é€ åˆ¤æ–­æ¡ä»¶.è‹¥åœ¨Windowsç³»ç»Ÿä¸‹è¿è¡Œç¨‹åº,åˆ™è¾“å‡ºåˆ—è¡¨å‘½ä»¤ä¸ºdirï¼›è‹¥åœ¨Linuxæ“ä½œç³»ç»Ÿä¸‹è¿è¡Œç¨‹åº,åˆ™è¾“å‡ºåˆ—è¡¨å‘½ä»¤ä¸ºlsã€‚ä»£ç æ¼”ç¤º1.å¯¼å…¥POMä¾èµ–12345&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context&lt;/artifactId&gt; &lt;version&gt;4.3.13.RELEASE&lt;/version&gt;&lt;/dependency&gt; 2.å®šä¹‰åˆ¤æ–­æ¡ä»¶1234567891011121314151617181920package cn.yeamin.spring.constant;/** * OSå¸¸é‡ * @author tong.li * */public final class Constants &#123; /** * ç§æœ‰æ„é€ ,ä¸è®©å¤–éƒ¨åˆ›å»ºæœ¬ç±»çš„å®ä¾‹å¯¹è±¡ */ private Constants() &#123;&#125; public final static String OS_KEY = \"os.name\"; public final static String OS_TYPE_WINDOWS = \"Windows\"; public final static String OS_TYPE_LINUX = \"Linux\";&#125; 123456789101112131415161718package cn.yeamin.spring.condition;import org.springframework.context.annotation.Condition;import org.springframework.context.annotation.ConditionContext;import org.springframework.core.type.AnnotatedTypeMetadata;import cn.yeamin.spring.constant.Constants;/*** * åˆ¤æ–­Linuxçš„æ¡ä»¶ç±» * @author tong.li */public class LinuxCondition implements Condition &#123; @Override public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) &#123; return context.getEnvironment().getProperty(Constants.OS_KEY).contains(Constants.OS_TYPE_LINUX); &#125;&#125; 1234567891011121314151617181920package cn.yeamin.spring.condition;import org.springframework.context.annotation.Condition;import org.springframework.context.annotation.ConditionContext;import org.springframework.core.type.AnnotatedTypeMetadata;import cn.yeamin.spring.constant.Constants;/*** * åˆ¤æ–­Windowsçš„æ¡ä»¶ç±» * @author tong.li */public class WindowsCondition implements Condition &#123; @Override public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) &#123; return context.getEnvironment().getProperty(Constants.OS_KEY).contains(Constants.OS_TYPE_WINDOWS); &#125;&#125; 3.ä¸šåŠ¡å®ç°:ä¸åŒç³»ç»Ÿä¸‹ä¸åŒçš„å‘½ä»¤1234567891011121314package cn.yeamin.spring.service;/** * å‘½ä»¤æœåŠ¡æ¥å£ * @author tong.li */public interface CommandService &#123; /** * æŠ½è±¡æ–¹æ³•,æ˜¾ç¤ºæ“ä½œç³»ç»Ÿçš„showListå‘½ä»¤ * @return cmd */ String showListCommand();&#125; 1234567891011package cn.yeamin.spring.service.impl;import cn.yeamin.spring.service.CommandService;public class LinuxCommandService implements CommandService &#123; @Override public String showListCommand() &#123; return \"ls\"; &#125;&#125; 123456789101112package cn.yeamin.spring.service.impl;import cn.yeamin.spring.service.CommandService;public class WindowsCommandService implements CommandService &#123; @Override public String showListCommand() &#123; return \"dir\"; &#125;&#125; 4.å®šä¹‰é…ç½®ç±»123456789101112131415161718192021222324252627282930313233343536373839404142434445package cn.yeamin.spring.conf;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Conditional;import org.springframework.context.annotation.Configuration;import org.springframework.context.annotation.Primary;import cn.yeamin.spring.condition.LinuxCondition;import cn.yeamin.spring.condition.WindowsCondition;import cn.yeamin.spring.service.CommandService;import cn.yeamin.spring.service.impl.LinuxCommandService;import cn.yeamin.spring.service.impl.WindowsCommandService;/** * é…ç½®ç±» * @author tong.li * */@Configurationpublic class ConditionConfig &#123; /** * å£°æ˜ä¸€ä¸ªBean,å¹¶äº¤ç»™Springå®¹å™¨å»ç®¡ç† * é€šè¿‡@Conditionalæ³¨è§£,æ“ä½œç³»ç»Ÿä¸ºWindowsåˆ™è¾“å‡ºWindowsä¸‹çš„dirå‘½ä»¤ * @return */ @Bean @Conditional(WindowsCondition.class) public CommandService windowsCMD() &#123; return new WindowsCommandService(); &#125; /** * å£°æ˜ä¸€ä¸ªBean,å¹¶äº¤ç»™Springå®¹å™¨å»ç®¡ç† * é€šè¿‡@Conditionalæ³¨è§£,æ“ä½œç³»ç»Ÿä¸ºWindowsåˆ™è¾“å‡ºWindowsä¸‹çš„lså‘½ä»¤ * @return */ @Bean @Conditional(LinuxCondition.class) public CommandService linuxCMD() &#123; return new LinuxCommandService(); &#125;&#125; 5.æ‰§è¡Œæµ‹è¯•123456789101112131415161718192021222324252627package cn.yeamin.spring;import org.springframework.context.annotation.AnnotationConfigApplicationContext;import cn.yeamin.spring.conf.ConditionConfig;import cn.yeamin.spring.constant.Constants;import cn.yeamin.spring.service.CommandService;/** * å¯åŠ¨ç±» * @author tong.li * */@SuppressWarnings(\"all\")public class Bootstrap &#123; /** * æ‰§è¡Œæµ‹è¯•åŸºäºä¸åŒæ“ä½œç³»ç»Ÿæ˜¾ç¤ºä¸åŒçš„å‘½ä»¤ * @param args */ public static void main(String[] args) &#123; // åŠ è½½é…ç½®ç±»,åˆ›å»ºåŸºäºæ³¨è§£å¼çš„åº”ç”¨ä¸Šä¸‹æ–‡ AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(ConditionConfig.class); //è·å–Bean CommandService commandService = context.getBean(CommandService.class); System.out.println(context.getEnvironment().getProperty(Constants.OS_KEY) + \"ç³»ç»Ÿä¸‹çš„æ˜¾ç¤ºåˆ—è¡¨å‘½ä»¤ä¸º: \" + commandService.showListCommand()); &#125;&#125; 6.æ‰§è¡Œç»“æœ1Windows 7ç³»ç»Ÿä¸‹çš„æ˜¾ç¤ºåˆ—è¡¨å‘½ä»¤ä¸º: dir 1linuxç³»ç»Ÿä¸‹çš„æ˜¾ç¤ºåˆ—è¡¨å‘½ä»¤ä¸º: ls","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"http://ltyeamin.github.io/tags/Spring/"}]},{"title":"Springå®¹å™¨ä»¥åŠBeançš„ç”Ÿå‘½å‘¨æœŸ","slug":"Springå®¹å™¨ä»¥åŠBeançš„ç”Ÿå‘½å‘¨æœŸ","date":"2018-05-15T03:51:07.000Z","updated":"2019-11-20T15:08:53.568Z","comments":true,"path":"2018/05/15/Springå®¹å™¨ä»¥åŠBeançš„ç”Ÿå‘½å‘¨æœŸ/","link":"","permalink":"http://ltyeamin.github.io/2018/05/15/Springå®¹å™¨ä»¥åŠBeançš„ç”Ÿå‘½å‘¨æœŸ/","excerpt":"","text":"Springå®¹å™¨å®¹å™¨æ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒ.Springå®¹å™¨ä½¿ç”¨DIç®¡ç†æ„æˆåº”ç”¨çš„ç»„ä»¶,ä»–ä¼šåˆ›å»ºç›¸äº’åä½œçš„ç»„ä»¶ä¹‹é—´çš„å…³è”.Springå®¹å™¨å¹¶ä¸æ˜¯åªæœ‰ä¸€ä¸ª.Springè‡ªå¸¦å¤šä¸ªå®¹å™¨å®ç°,å¯å½’çº³ä¸ºä¸¤ç§ä¸åŒçš„ç±»å‹: Beanå·¥å‚(ç”±BeanFactoryæ¥å£å®šä¹‰)æ˜¯æœ€ç®€å•çš„åŒæœŸ,æä¾›åŸºæœ¬çš„DIæ”¯æŒ. åº”ç”¨ä¸Šä¸‹æ–‡(ç”±ApplicationContextæ¥å£å®šä¹‰)åŸºäºBeanFactoryæ„å»º,å¹¶æä¾›åº”ç”¨æ¡†æ¶çº§åˆ«çš„æœåŠ¡. è™½ç„¶æˆ‘ä»¬å¯ä»¥åœ¨Beanå·¥å‚å’Œåº”ç”¨ä¸Šä¸‹æ–‡ä»»é€‰ä¸€ç§ä½œä¸ºæˆ‘ä»¬çš„å®¹å™¨,ä½†BeanFactoryæ˜¯ApplicationContextçš„é¡¶å±‚æ¥å£,åŠŸèƒ½æ¯”è¾ƒå°‘,ä¸èƒ½æ»¡è¶³æˆ‘ä»¬æ—¥å¸¸åº”ç”¨çš„éœ€æ±‚.å› æ­¤åº”ç”¨ä¸Šä¸‹æ–‡æ›´å—å¤§å®¶çš„æ¬¢è¿. Springè‡ªå¸¦äº†å¤šç§ç±»å‹çš„åº”ç”¨ä¸Šä¸‹æ–‡,ä¸‹é¢ç½—åˆ—å‡ ä¸ªå¸¸ç”¨çš„: AnnotationConfigApplicationContext:ä»ä¸€ä¸ªæˆ–å¤šä¸ªåŸºäºJavaçš„é…ç½®ç±»ä¸­åŠ è½½Springåº”ç”¨ä¸Šä¸‹æ–‡.Spring4ä¹‹åæ¨èä½¿ç”¨,Spring Boot,Spring Cloudç­‰è‡ªåŠ¨é…ç½®éƒ½æ˜¯åŸºäºJava Config. AnnotationConfigWebApplicationContext:ä»ä¸€ä¸ªæˆ–å¤šä¸ªåŸºäºJavaçš„é…ç½®ç±»ä¸­åŠ è½½Spring Webä¸Šä¸‹æ–‡. ClassPathXmlApplicationContext: ä»classpathè·¯å¾„ä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªXMLé…ç½®åŠ è½½ä¸Šä¸‹æ–‡.Spring 4ä¹‹å‰å¸¸å¸¸ä»¥classpathä¸‹æ–‡ä»¶æ–¹å¼è¿›è¡ŒåŠ è½½. FileSystemXmlApplicationContext: ä»æ–‡ä»¶ç³»ç»Ÿä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªXMLé…ç½®æ–‡ä»¶ä¸­åŠ è½½ä¸Šä¸‹æ–‡å®šä¹‰.ä¸€èˆ¬ä¸ç”¨ XmlWebApplicationContext: ä»Webåº”ç”¨ä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªXMLé…ç½®åŠ è½½ä¸Šä¸‹æ–‡.ä»¥å‰è€çš„Webé¡¹ç›®å¸¸ç”¨çš„åŠ è½½æ–¹å¼. Beançš„ç”Ÿå‘½å‘¨æœŸåœ¨ä¼ ç»Ÿçš„Javaç¼–ç¨‹æ¨¡å¼ä¸­,ä½¿ç”¨Javaå¯¹è±¡å…³é”®å­—newæˆ–è€…åˆ©ç”¨åå°„æœºåˆ¶è¿›è¡Œå¯¹è±¡å®ä¾‹åŒ–,è¿™äº›â€Beanâ€å®ä¾‹åŒ–åæ–¹å¯ä½¿ç”¨.åˆ°äº†æŸä¸ªæ—¶æœŸè¿™äº›å¯¹è±¡ä¸å†è¢«ä½¿ç”¨äº†,åˆ™JVMä¼šè‡ªåŠ¨è¿›è¡Œåƒåœ¾å›æ”¶. ç›¸æ¯”ä¼ ç»ŸJavaå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ,Springå®¹å™¨ä¸­Beançš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¾å¾—ç›¸å¯¹å¤æ‚å¤šäº†.æ­£ç¡®ç†è§£Spring Beançš„ç”Ÿå‘½å‘¨æœŸéå¸¸é‡è¦,å› ä¸ºä½ æˆ–è®¸è¦åˆ©ç”¨Springæä¾›çš„æ‰©å±•ç‚¹æ¥è‡ªåŠ¨é¬¼Beançš„åˆ›å»ºè¿‡ç¨‹. å¦‚ä¸Šå›¾,Beanåœ¨Springå®¹å™¨ä¸­ä»åˆ›å»ºåˆ°é”€æ¯ç»å†äº†è‹¥å¹²é˜¶æ®µ: Springé€šè¿‡åå°„æœºåˆ¶å¯¹Beanè¿›è¡Œå®ä¾‹åŒ–; Springå°†å€¼å’ŒBeançš„å¼•ç”¨æ³¨å…¥åˆ°Beanå¯¹åº”çš„å±æ€§ä¸­. å¦‚æœBeanå®ç°äº†BeanNameAwareæ¥å£,Springå°†Beançš„idä¼ é€’ç»™setBeanName()æ–¹æ³•. å¦‚æœBeanå®ç°äº†BeanFactoryAwareæ¥å£,Springå°†è°ƒç”¨setBeanFactory()æ–¹æ³•,å°†BeanFactoryå®¹å™¨å®ä¾‹ä¼ å…¥. å¦‚æœBeanå®ç°äº†ApplicationContextAwareæ¥å£,Springå°†è°ƒç”¨setApplicationContext()æ–¹æ³•,å°†Beanæ‰€åœ¨çš„åº”ç”¨ä¸Šä¸‹æ–‡çš„å¼•ç”¨ä¼ å…¥è¿›æ¥. å¦‚æœBeanå®ç°äº†BeanPostProcessoræ¥å£,Springå°†è°ƒç”¨postProcessBeforeInitialization()æ–¹æ³•. å¦‚æœBeanå®ç°äº†InitializingBeanæ¥å£,Springå°†è°ƒç”¨afterPropertiesSet()æ–¹æ³•.ç±»ä¼¼åœ¨xmlä½¿ç”¨äº†init-methodçš„æ–¹æ³•,è¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨. å¦‚æœBeanå®ç°äº†BeanPostProcessoræ¥å£,Springå°†è°ƒç”¨postProcessAfterInitialization()æ–¹æ³•. Beanå·²ç»å‡†å¤‡å°±ç»ª,å¯ä»¥è¢«åº”ç”¨ç¨‹åºä½¿ç”¨äº†,å®ƒä»¬ä¸€ç›´é©»ç•™åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­,ç›´åˆ°è¯¥åº”ç”¨ä¸Šä¸‹æ–‡è¢«é”€æ¯. å¦‚æœBeanå®ç°äº†DisposableBeanæ¥å£,Springå°†è°ƒç”¨å®ƒçš„destroy()æ–¹æ³•.ç±»ä¼¼åœ°,å¦‚æœåœ¨xmlä½¿ç”¨äº†destroy-methodå£°æ˜äº†é”€æ¯æ–¹æ³•,è¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨.","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"http://ltyeamin.github.io/tags/Spring/"}]},{"title":"æ•°æ®ç»“æ„ä¹‹æ’åº","slug":"æ•°æ®ç»“æ„ä¹‹æ’åº","date":"2018-05-10T02:36:55.000Z","updated":"2019-05-29T14:03:47.000Z","comments":true,"path":"2018/05/10/æ•°æ®ç»“æ„ä¹‹æ’åº/","link":"","permalink":"http://ltyeamin.github.io/2018/05/10/æ•°æ®ç»“æ„ä¹‹æ’åº/","excerpt":"","text":"æ•°æ®ç»“æ„å’Œç®—æ³•æ˜¯æ•´ä¸ªè®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯é¢†åŸŸæ°¸è¿œé€ƒé¿ä¸äº†çš„è¯é¢˜,åšä¸»å¤§å­¦æœ‰è¿‡æ•°æ®ç»“æ„è¿™é—¨å­¦ç§‘,ä¸è¿‡ç‰¹åˆ«åæ‚”å½“æ—¶æ²¡æœ‰å¥½å¥½å­¦ä¹ .ä»…å­¦çš„é‚£ä¹ˆç‚¹ä¸œè¥¿ç°åœ¨å‡ ä¹å¿˜å¾—ä¸€å¹²äºŒå‡€.è™½è¯´å­¦çš„æµ…è–„,ä½†å¯¹æ•´ä¸ªç¼–ç¨‹æ€æƒ³è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„. åç§å¸¸è§æ’åºç®—æ³•åç§å¸¸è§æ’åºç®—æ³•å¯åˆ†ä¸ºä¸¤å¤§ç±»: éçº¿æ€§æ—¶é—´æ¯”è¾ƒç±»æ’åºï¼šé€šè¿‡æ¯”è¾ƒæ¥å†³å®šå…ƒç´ é—´çš„ç›¸å¯¹æ¬¡åº,ç”±äºå…¶æ—¶é—´å¤æ‚åº¦ä¸èƒ½çªç ´O(nlogn),å› æ­¤ç§°ä¸ºéçº¿æ€§æ—¶é—´æ¯”è¾ƒç±»æ’åº. çº¿æ€§æ—¶é—´éæ¯”è¾ƒç±»æ’åºï¼šä¸é€šè¿‡æ¯”è¾ƒæ¥å†³å®šå…ƒç´ é—´çš„ç›¸å¯¹æ¬¡åº,å®ƒå¯ä»¥çªç ´åŸºäºæ¯”è¾ƒæ’åºçš„æ—¶é—´ä¸‹ç•Œ,ä»¥çº¿æ€§æ—¶é—´è¿è¡Œ,å› æ­¤ç§°ä¸ºçº¿æ€§æ—¶é—´éæ¯”è¾ƒç±»æ’åº. å†’æ³¡æ’åºå†’æ³¡æ’åº(Bubble Sort),æ˜¯ä¸€ç§è®¡ç®—æœºç§‘å­¦é¢†åŸŸçš„è¾ƒç®€å•çš„æ’åºç®—æ³•.å®ƒé‡å¤åœ°èµ°è®¿è¿‡è¦æ’åºçš„æ•°åˆ—,ä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ,å¦‚æœä»–ä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠä»–ä»¬äº¤æ¢è¿‡æ¥.èµ°è®¿æ•°åˆ—çš„å·¥ä½œæ˜¯é‡å¤åœ°è¿›è¡Œç›´åˆ°æ²¡æœ‰å†éœ€è¦äº¤æ¢,ä¹Ÿå°±æ˜¯è¯´è¯¥æ•°åˆ—å·²ç»æ’åºå®Œæˆ.è¿™ä¸ªç®—æ³•çš„åå­—ç”±æ¥æ˜¯å› ä¸ºè¶Šå¤§çš„å…ƒç´ ä¼šç»ç”±äº¤æ¢æ…¢æ…¢â€œæµ®â€åˆ°æ•°åˆ—çš„é¡¶ç«¯,æ•…åâ€œå†’æ³¡æ’åºâ€. ç®—æ³•æè¿° æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§,å°±äº¤æ¢å®ƒä»¬ä¸¤ä¸ª; å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œ,ä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹,è¿™æ ·åœ¨æœ€åçš„å…ƒç´ åº”è¯¥ä¼šæ˜¯æœ€å¤§çš„æ•°; é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤,é™¤äº†æœ€åä¸€ä¸ª;åŠ¨å›¾æ¼”ç¤ºä»£ç æ¼”ç¤º1234567891011121314151617181920212223242526272829303132/** * * å†’æ³¡æ’åº * * @author tong.li * @param arr = &#123;6,3,8,2,9,1&#125; * * ç¬¬0è¶Ÿæ¯”è¾ƒ5æ¬¡: 3,6,8,2,9,1 =&gt; 3,6,8,2,9,1 =&gt; 3,6,2,8,9,1 =&gt; 3,6,2,8,9,1 =&gt; 3,6,2,8,1,9 * ç¬¬1è¶Ÿæ¯”è¾ƒ4æ¬¡: 3,6,2,8,1,9 =&gt; 3,2,6,8,1,9 =&gt; 3,2,6,8,1,9 =&gt; 3,2,6,1,8,9 * ç¬¬2è¶Ÿæ¯”è¾ƒ3æ¬¡: 2,3,6,1,8,9 =&gt; 2,3,6,1,8,9 =&gt; 2,3,1,6,8,9 * ç¬¬3è¶Ÿæ¯”è¾ƒ2æ¬¡: 2,3,1,6,8,9 =&gt; 2,1,3,6,8,9 * ç¬¬4è¶Ÿæ¯”è¾ƒ1æ¬¡: 1,2,3,6,8,9 */public static void bubbleSort(int ... arr) &#123; if ( arr==null || arr.length &lt;= 0) &#123; return; &#125; // å¤–å¾ªç¯æ§åˆ¶è¶Ÿæ•° for (int i = 0; i &lt; arr.length; i++) &#123; // å†…å¾ªç¯æ§åˆ¶æ¬¡æ•° // for(int j=1;j&lt;arr.length-i;j++)&#123; for (int j = 0; j &lt; arr.length - 1 - i; j++) &#123; //ç›¸é‚»ä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒ if( arr[j] &gt; arr[j + 1]) &#123; // é‡‡ç”¨å¼‚æˆ–æ–¹å¼è¿›è¡Œå˜é‡äº’æ¢ arr[j] = arr[j] ^ arr[j + 1]; arr[j + 1] = arr[j] ^ arr[j + 1]; arr[j] = arr[j] ^ arr[j + 1]; &#125; &#125; &#125;&#125; å¿«é€Ÿæ’åº(é¢è¯•å®˜æœ€çˆ±é—®çš„æ’åºç®—æ³•)å¿«é€Ÿæ’åº(Quicksort)æ˜¯å¯¹å†’æ³¡æ’åºçš„ä¸€ç§æ”¹è¿›.å¿«é€Ÿæ’åºç”±C.A.R.Hoareåœ¨1962å¹´æå‡º.åŸºæœ¬æ€æƒ³æ˜¯:é€šè¿‡ä¸€è¶Ÿæ’åºå°†è¦æ’åºçš„æ•°æ®åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†,å…¶ä¸­ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½æ¯”å¦å¤–ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½è¦å°,ç„¶åå†æŒ‰æ­¤æ–¹æ³•å¯¹è¿™ä¸¤éƒ¨åˆ†æ•°æ®åˆ†åˆ«è¿›è¡Œå¿«é€Ÿæ’åº,æ•´ä¸ªæ’åºè¿‡ç¨‹å¯ä»¥é€’å½’è¿›è¡Œ,ä»¥æ­¤è¾¾åˆ°æ•´ä¸ªæ•°æ®å˜æˆæœ‰åºåºåˆ—.æœ€åæƒ…å†µçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n^2).æœ€å¥½æƒ…å†µæ—¶é—´å¤æ‚åº¦ä¸ºO(nlog2n). ç®—æ³•æè¿°å¿«é€Ÿæ’åºä½¿ç”¨åˆ†æ²»æ³•æ¥æŠŠä¸€ä¸ªä¸²ï¼ˆlistï¼‰åˆ†ä¸ºä¸¤ä¸ªå­ä¸²ï¼ˆsub-listsï¼‰ã€‚å…·ä½“ç®—æ³•æè¿°å¦‚ä¸‹: ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ .ç§°ä¸ºâ€åŸºå‡†â€ï¼ˆpivotï¼‰; é‡æ–°æ’åºæ•°åˆ—.æ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢.æ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹å.è¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œ; é€’å½’åœ°ï¼ˆrecursiveï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºã€‚åŠ¨å›¾æ¼”ç¤ºä»£ç æ¼”ç¤º123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * * å¿«é€Ÿæ’åº * * @param arr = &#123;6,3,8,2,9,1&#125; * @author tong.li * * åˆ†æ: * a. ä¸€èˆ¬ä»¥é¦–å…ƒç´ æˆ–å°¾å…ƒç´ ä¸ºåŸºå‡†,è¿™é‡Œä»¥é¦–å…ƒç´ 6ä¸ºåŸºå‡†,æœ‰æ¯”åŸºå‡†æ•°å¤§çš„æ•°æ”¾åœ¨6çš„å³è¾¹,æ¯”åŸºå‡†æ•°å°çš„æ•°æ”¾åœ¨6çš„å·¦è¾¹,æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†6æŒªåˆ°åºåˆ—ä¸­é—´çš„æŸä¸ªä½ç½®. * b. å‡è®¾è¿™ä¸ªä½ç½®æ˜¯k,ç°åœ¨éœ€è¦å¯»æ‰¾è¿™ä¸ªkçš„ä½ç½®.åˆ†åˆ«ä»æ•°ç»„çš„ä¸¤ç«¯å¼€å§‹æ¢æµ‹,å…ˆä»å³å¾€å·¦æ‰¾ä¸€ä¸ªå°äº6çš„æ•°(æ€»æ˜¯å¦‚æ­¤),å†ä»å·¦åˆ°å³æ‰¾ä¸€ä¸ªå¤§äº6çš„æ•°,ä¸¤ç«¯åœä¸‹æ¥åäº¤æ¢å®ƒä»¬. * c. è¿™é‡Œå¯ä»¥ç”¨ä¸¤ä¸ªå˜é‡iå’Œj,åˆ†å¸ƒæŒ‡å‘æ•°ç»„æœ€å·¦è¾¹å’Œæœ€å³è¾¹.è¿™ä¸¤ä¸ªå˜é‡æœ‰ä¸ªå¥½å¬çš„åå­—:å“¨å…µiå’Œå“¨å…µj,å“¨å…µiåˆå§‹æŒ‡å‘ç´¢å¼•ä¸º0çš„6,å“¨å…µjåˆå§‹æŒ‡å‘ç´¢å¼•ä¸º5çš„1 * æ­¥éª¤: * 1. å…ˆè®©å“¨å…µjåŠ¨èµ·æ¥å‘å·¦(j--)æ‰¾å°äº6çš„å€¼,ç¬¬ä¸€æ¬¡æ‰¾åˆ°ä¸º1åœä¸‹æ¥. * 2. ç´§æ¥ç€å“¨å…µiå‘å³ç§»åŠ¨(i++)æ‰¾å¤§äº6çš„å€¼,ç¬¬ä¸€æ¬¡æ‰¾åˆ°ä¸º8åœä¸‹æ¥. * 3. è¿›è¡Œäº¤æ¢åœä¸‹æ¥çš„å€¼,å³1å’Œ8è¿›è¡Œäº¤æ¢.äº¤æ¢åçš„æ•°ç»„ä¸º:6,3,1,2,9,8 * 4. åœ¨3äº¤æ¢åçš„åŸºç¡€ä¸Šç»§ç»­1,2æ­¥éª¤,å“¨å…µjä¸€ç›´å¾€å·¦ç§»é‡åˆ°2,å“¨å…µiä¸€ç›´å¾€å³ç§»é‡åˆ°9,ä¸¤ä¸ªå“¨å…µåœ¨2å·²ç»ç›¸é‡äº†,æˆ‘ä»¬åº”è¯¥å°†åŸºå‡†6ä¸å’Œ2è¿›è¡Œäº¤æ¢,å³äº¤æ¢åçš„æ•°ç»„ä¸º:2,3,1,6,9,8,æ­¤æ—¶ç¬¬ä¸€è½®æ¢æµ‹çœŸæ­£ç»“æŸ * æ­¤æ—¶æ—§åŸºå‡†æ•°6å·²ç»å½’ä½,æ–°åŸºå‡†æ•°ä¸º2,ä»¥6ä½åˆ†ç•Œç‚¹æŠŠæ•°ç»„æ‹†æˆäº†ä¸¤ä¸ªå°æ•°ç»„,å·¦æ•°ç»„ä¸ºå°äº6çš„,å³è¾¹æ•°ç»„éƒ½æ˜¯å¤§äº6çš„,ç›®å‰ä¸¤ä¸ªæ•°ç»„çš„é¡ºåºéƒ½æ˜¯æ··ä¹±çš„,ä¸è¿‡ä¸è¦ç´§,ç»§ç»­æŒ‰1,2,3æ­¥éª¤åˆ†åˆ«å¯¹ä¸¤ä¸ªæ•°ç»„è€å¿ƒå¤„ç† * 5. å…ˆå¤„ç†6å·¦è¾¹çš„å°æ•°ç»„2,3,1,ä»¥2ä¸ºåŸºå‡†æ•°,æ‰¾åˆ°1å’Œ3,äº¤æ¢å2,1,3,ç»§ç»­æ‰¾åœ¨1ç›¸é‡,äº¤æ¢åä¸º1,2,3 * 6. å†æ¥å¤„ç†6å³è¾¹çš„å°æ•°ç»„9,8,ä»¥9ä¸ºåŸºå‡†æ•°,ä¸¤è€…åœ¨8ç›¸é‡,äº¤æ¢åä¸º8,9 * 7. åˆ°æ­¤å®Œå…¨ç»“æŸ,æ’åºåä¸º1,2,3,6,8,9.å¿«é€Ÿæ’åºçš„æ¯ä¸€è½®å¤„ç†å…¶å®å°±æ˜¯å°†è¿™ä¸€è½®çš„åŸºå‡†æ•°å½’ä½,ç›´åˆ°æ‰€æœ‰çš„æ•°éƒ½å½’ä½ä¸ºæ­¢,æ’åºå°±ç»“æŸäº†. * */public static void quickSort(int[] arr, int low, int high) &#123; int i, j, temp, t; if (low &gt; high) &#123; return; &#125; i = low; j = high; // tempå°±æ˜¯åŸºå‡†ä½ temp = arr[low]; while (i &lt; j) &#123; // å…ˆçœ‹å³è¾¹.ä¾æ¬¡å¾€å·¦é€’å‡ while (temp &lt;= arr[j] &amp;&amp; i &lt; j) &#123; j--; &#125; // å†çœ‹å·¦è¾¹.ä¾æ¬¡å¾€å³é€’å¢ while (temp &gt;= arr[i] &amp;&amp; i &lt; j) &#123; i++; &#125; // å¦‚æœæ»¡è¶³æ¡ä»¶åˆ™äº¤æ¢ if (i &lt; j) &#123; t = arr[j]; arr[j] = arr[i]; arr[i] = t; &#125; &#125; // æœ€åå°†åŸºå‡†ä¸ºä¸iå’Œjç›¸ç­‰ä½ç½®çš„æ•°å­—äº¤æ¢ arr[low] = arr[i]; arr[i] = temp; // é€’å½’è°ƒç”¨å·¦åŠæ•°ç»„ quickSort(arr, low, j - 1); // é€’å½’è°ƒç”¨å³åŠæ•°ç»„ quickSort(arr, j + 1, high);&#125; é€‰æ‹©æ’åºé€‰æ‹©æ’åº(Selection sort)æ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•.å®ƒçš„å·¥ä½œåŸç†æ˜¯æ¯ä¸€æ¬¡ä»å¾…æ’åºçš„æ•°æ®å…ƒç´ ä¸­é€‰å‡ºæœ€å°(æˆ–æœ€å¤§)çš„ä¸€ä¸ªå…ƒç´ ,å­˜æ”¾åœ¨åºåˆ—çš„èµ·å§‹ä½ç½®,ç›´åˆ°å…¨éƒ¨å¾…æ’åºçš„æ•°æ®å…ƒç´ æ’å®Œ. ç®—æ³•æè¿°nä¸ªè®°å½•çš„ç›´æ¥é€‰æ‹©æ’åºå¯ç»è¿‡n-1è¶Ÿç›´æ¥é€‰æ‹©æ’åºå¾—åˆ°æœ‰åºç»“æœã€‚å…·ä½“ç®—æ³•æè¿°å¦‚ä¸‹: åˆå§‹çŠ¶æ€ï¼šæ— åºåŒºä¸ºR[1..n],æœ‰åºåŒºä¸ºç©º; ç¬¬iè¶Ÿæ’åº(i=1,2,3â€¦n-1)å¼€å§‹æ—¶,å½“å‰æœ‰åºåŒºå’Œæ— åºåŒºåˆ†åˆ«ä¸ºR[1..i-1]å’ŒR(i..nï¼‰ã€‚è¯¥è¶Ÿæ’åºä»å½“å‰æ— åºåŒºä¸­-é€‰å‡ºå…³é”®å­—æœ€å°çš„è®°å½• R[k],å°†å®ƒä¸æ— åºåŒºçš„ç¬¬1ä¸ªè®°å½•Räº¤æ¢,ä½¿R[1..i]å’ŒR[i+1..n)åˆ†åˆ«å˜ä¸ºè®°å½•ä¸ªæ•°å¢åŠ 1ä¸ªçš„æ–°æœ‰åºåŒºå’Œè®°å½•ä¸ªæ•°å‡å°‘1ä¸ªçš„æ–°æ— åºåŒº; n-1è¶Ÿç»“æŸ,æ•°ç»„æœ‰åºåŒ–äº†;åŠ¨å›¾æ¼”ç¤ºä»£ç æ¼”ç¤º12345678910111213141516171819202122232425262728293031/** * * é€‰æ‹©æ’åº * * @author tong.li * @param arr = &#123;6,3,8,2,9,1&#125; * *ç¬¬0è¶Ÿæ¯”è¾ƒ5æ¬¡: 3,6,8,2,9,1 =&gt; 3,6,8,2,9,1 =&gt; 2,6,8,3,9,1 =&gt; 2,6,8,3,9,1 =&gt; 1,6,8,3,9,2 *ç¬¬1è¶Ÿæ¯”è¾ƒ4æ¬¡: 1,6,8,3,9,2 =&gt; 1,3,8,6,9,2 =&gt; 1,3,8,6,9,2 =&gt; 1,2,8,6,9,3 *ç¬¬2è¶Ÿæ¯”è¾ƒ3æ¬¡: 1,2,6,8,9,3 =&gt; 1,2,6,8,9,3 =&gt; 1,2,3,8,9,6 *ç¬¬3è¶Ÿæ¯”è¾ƒ2æ¬¡: 1,2,3,8,9,6 =&gt; 1,2,3,6,9,8 *ç¬¬4è¶Ÿæ¯”è¾ƒ1æ¬¡: 1,2,3,6,8,9 */public static void selectionSort(int... arr) &#123; if ( arr==null || arr.length &lt;= 0) &#123; return; &#125; // å¤–å¾ªç¯æ§åˆ¶è¶Ÿæ•° for (int i = 0; i &lt; arr.length - 1; i++) &#123; // å†…å¾ªç¯æ§åˆ¶æ¬¡æ•° for (int j = i + 1; j &lt; arr.length; j++) &#123; // ç›¸é‚»ä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒ if (arr[i] &gt; arr[j]) &#123; // é‡‡ç”¨å¼‚æˆ–æ–¹å¼è¿›è¡Œå˜é‡äº’æ¢ arr[i] = arr[i] ^ arr[j]; arr[j] = arr[i] ^ arr[j]; arr[i] = arr[i] ^ arr[j]; &#125; &#125; &#125;&#125; å…¶ä»–æ’åºç®—æ³•åç»­æ›´æ–°,è¯·è¯»è€…æŒç»­å…³æ³¨. å‚è€ƒæ–‡çŒ®:åå¤§ç»å…¸æ’åºç®—æ³•-åŠ¨å›¾æ¼”ç¤º å †æ’åº,å½’å¹¶æ’åº,å¿«æ’-æ’åºç‹è€…ä¹‹äº‰ä¸€ å †æ’åº,å½’å¹¶æ’åº,å¿«æ’-æ’åºç‹è€…ä¹‹äº‰äºŒ","categories":[{"name":"algorithm","slug":"algorithm","permalink":"http://ltyeamin.github.io/categories/algorithm/"}],"tags":[{"name":"æ’åºç®—æ³•","slug":"æ’åºç®—æ³•","permalink":"http://ltyeamin.github.io/tags/æ’åºç®—æ³•/"}]},{"title":"å†…ç½‘ç©¿é€ç¥å™¨-Ngrok","slug":"å†…ç½‘ç©¿é€ç¥å™¨-Ngrok","date":"2018-04-04T01:27:55.000Z","updated":"2019-11-20T15:08:53.128Z","comments":true,"path":"2018/04/04/å†…ç½‘ç©¿é€ç¥å™¨-Ngrok/","link":"","permalink":"http://ltyeamin.github.io/2018/04/04/å†…ç½‘ç©¿é€ç¥å™¨-Ngrok/","excerpt":"","text":"ä½œä¸ºä¸€ä¸ªWebå¼€å‘è€…,æˆ‘ä»¬æœ‰æ—¶å€™ä¼šéœ€è¦ä¸´æ—¶åœ°å°†ä¸€ä¸ªæœ¬åœ°çš„Webç½‘ç«™éƒ¨ç½²åˆ°å¤–ç½‘,ä»¥ä¾›ä»–äººä½“éªŒè¯„ä»·æˆ–ååŠ©è°ƒè¯•ç­‰ç­‰,é€šå¸¸æˆ‘ä»¬ä¼šè¿™ä¹ˆåš: æ‰¾åˆ°ä¸€å°è¿è¡Œäºå¤–ç½‘çš„WebæœåŠ¡å™¨; æœåŠ¡å™¨ä¸Šæ­å»ºç½‘ç«™è¿è¡Œæ—¶çš„ç¯å¢ƒ; éƒ¨ç½²ç½‘ç«™ è°ƒè¯•ç»“æŸå,å†å°†ç½‘ç«™ä»æœåŠ¡å™¨ä¸Šåˆ é™¤ æˆ‘ä»¬éƒ¨ç½²é™æ€çš„ç½‘ç«™ä»…ä»…åªæ˜¯éœ€è¦å±•ç¤ºç»™æœ‹å‹,ä½•å¿…é‚£ä¹ˆéº»çƒ¦???é™¤æ­¤ä¹‹å¤–,ç¬”è€…æœ€è¿‘è¿›è¡Œå¾®ä¿¡æœºå™¨äººå¼€å‘,ç»å¸¸åœ¨æœ¬åœ°å¼€å‘å’Œå¾®ä¿¡æœåŠ¡ç«¯è¿›è¡Œè”è°ƒ.ç”±äºå¾®ä¿¡ç«¯å£å’Œç½‘ç»œçš„é™åˆ¶(å¾®ä¿¡å…¬ä¼—å¹³å°å¼€å‘å¯¹æ¥å¿…é¡»ä»¥http://æˆ–https://å¼€å¤´,åˆ†åˆ«æ”¯æŒ80ç«¯å£å’Œ443ç«¯å£),æˆ‘ä¸å¾—ä¸å°†æˆ‘çš„å†…ç½‘æ˜ å°„åˆ°å…¬ç½‘åœ°å€åšæ˜ å°„è°ƒè¯•.æœ‰äº†Ngrokä¹‹å,ä¸–ç•Œæ˜¯å¦‚æ­¤çš„ç¾å¥½,æ‰€ä»¥å¼€å§‹å­¦ä¹ ä¹‹æ—…å§! Ngrokä»‹ç»ä¸ä½¿ç”¨Ngrokæ˜¯ä¸€ä¸ªåå‘ä»£ç†,é€šè¿‡åœ¨å…¬å…±çš„ç«¯ç‚¹å’Œæœ¬åœ°è¿è¡Œçš„ Web æœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªå®‰å…¨çš„é€šé“.Ngrokå¯æ•è·å’Œåˆ†ææ‰€æœ‰é€šé“ä¸Šçš„æµé‡,ä¾¿äºåæœŸåˆ†æå’Œé‡æ”¾. ä¸‹è½½åœ°å€: https://ngrok.com/downloadæˆ‘æ˜¯ä¸‹è½½Windowsç‰ˆæœ¬çš„,è¯»è€…å¯æ ¹æ®è‡ªå·±çš„ç³»ç»Ÿé€‰æ‹©è¿›è¡Œä¸‹è½½. Windowsç‰ˆæœ¬ä½¿ç”¨æ–¹æ³• åŒå‡»æ‰“å¼€ngrok.exe,ä¼šå‡ºç°å¦‚ä¸‹å¸®åŠ©ä¿¡æ¯. å¯åŠ¨æœ¬åœ°é¡¹ç›®,æˆ‘çš„æ˜¯Javaçš„Spring Booté¡¹ç›®,é¡¹ç›®ç«¯å£ä¸º80,è¯»è€…å¯æ ¹æ®æŠ€æœ¯æ ˆé€‰æ‹©ä¸åŒçš„Webé¡¹ç›®. é€šè¿‡æŸ¥çœ‹ä¸Šè¿°å¸®åŠ©æ–‡æ¡£åè¿›è¡Œç«¯å£æœ¬åœ°æ˜ å°„åˆ°å…¬ç½‘,è¾“å…¥å‘½ä»¤:ngrok åè®®å æœ¬åœ°è¦æ˜ å°„çš„ç«¯å£å·,å¦‚è¾“å…¥ngrok http 80å‘½ä»¤å¯è¿›å…¥å¦‚ä¸‹é€šé“è¿æ¥. ä»ä¸Šå›¾å¯çŸ¥æ˜ å°„çš„ä¿¡æ¯,è¦æƒ³è¿›è¡Œå¯è§†åŒ–æµè§ˆ,å¯åœ¨æµè§ˆå™¨è¾“å…¥:http://127.0.0.1:4040 ä¸Šé¢æœ‰ä¸¤ä¸ªæ˜ å°„åˆ°å…¬ç½‘çš„åœ°å€,é€šè¿‡å¤–ç½‘(æ‰‹æœºæµé‡)è¿›è¡Œè®¿é—®çœ‹æ˜¯å¦æˆåŠŸ. è®¿é—®æˆåŠŸå,å¯æŸ¥çœ‹è¯·æ±‚ä¸ç›¸åº”ä¿¡æ¯.","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"å®ç”¨å·¥å…·åŠæŠ€å·§","slug":"å®ç”¨å·¥å…·åŠæŠ€å·§","permalink":"http://ltyeamin.github.io/tags/å®ç”¨å·¥å…·åŠæŠ€å·§/"}]},{"title":"å•ä¾‹æ¨¡å¼-Springå•ä¾‹å®ç°åŸç†åˆ†æ","slug":"å•ä¾‹æ¨¡å¼-Springå•ä¾‹å®ç°åŸç†åˆ†æ","date":"2018-03-27T02:01:55.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2018/03/27/å•ä¾‹æ¨¡å¼-Springå•ä¾‹å®ç°åŸç†åˆ†æ/","link":"","permalink":"http://ltyeamin.github.io/2018/03/27/å•ä¾‹æ¨¡å¼-Springå•ä¾‹å®ç°åŸç†åˆ†æ/","excerpt":"","text":"åœ¨Springä¸­,è¢«@Scopeæ³¨è§£ä¿®é¥°Beané»˜è®¤æ˜¯å•ä¾‹æ¨¡å¼çš„,å³åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡,å¤šæ¬¡è·å–Beanä¼šæ‹¿åˆ°åŒä¸€ä¸ªå¯¹è±¡. å•ä¾‹æ³¨å†Œè¡¨Springé‡‡ç”¨å•ä¾‹æ³¨å†Œè¡¨çš„ç‰¹æ®Šæ–¹å¼å®ç°å•ä¾‹æ¨¡å¼.é¦–å…ˆè‡ªå·±å†™ä¸ªå•ä¾‹æ³¨å†Œè¡¨.æˆ‘ä»¬å¯ä»¥é€šè¿‡Mapç¼“å­˜å•ä¾‹å¯¹è±¡,å®ç°å•ä¾‹æ³¨å†Œè¡¨.å€¼å¾—æ³¨æ„çš„æ˜¯,é‡‡ç”¨ConcurrentHashMapæ˜¯å‡ºäºçº¿ç¨‹å®‰å…¨çš„è€ƒè™‘. 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647/** * @author tong.li * @Description: ä¸€ä¸ªç®€å•çš„å•ä¾‹å®ç°,è®¾è®¡å•ä¾‹æ³¨å†Œè¡¨ * @packagename: com.yimi.yts.learningpath * @date 2018-03-27 10:04 */public class SingletonReg &#123; //æ„å»ºé‡‡ç”¨ConcurrentHashMap,ç”¨äºå……å½“ç¼“å­˜æ³¨å†Œè¡¨ private final static Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;&gt;(16); // é™æ€ä»£ç å—åªåŠ è½½æ‰§è¡Œä¸€æ¬¡ static &#123; // å®ä¾‹åŒ–Bean SingletonReg singletonReg = new SingletonReg(); //å¹¶æ³¨å†Œåˆ°æ³¨å†Œè¡¨ä¸­,keyä¸ºç±»çš„å®Œå…¨é™å®šå,valueä¸ºå®ä¾‹åŒ–å¯¹è±¡ singletonObjects.put(singletonReg.getClass().getName(),singletonReg); &#125; /** * ç§æœ‰åŒ–æ„é€ æ–¹æ³•,é¿å…å¤–éƒ¨åˆ›å»ºæœ¬ç±»å®ä¾‹ */ private SingletonReg() &#123;&#125; /** * å¯¹å¤–æš´éœ²è·å¾—è¯¥beançš„æ–¹æ³•,Springæ¡†æ¶ä¸€èˆ¬ä¼šè¿”å›Object * @return */ public static SingletonReg getInstance(String className) &#123; if (StringUtils.isEmpty(className)) &#123; return null; &#125; //ä»æ³¨å†Œè¡¨è·å–,å¦‚æœæ²¡æœ‰ç›´æ¥åˆ›å»º if (singletonObjects.get(className) == null) &#123; try &#123; //å¦‚æœä¸ºç©º,é€šè¿‡åå°„è¿›è¡Œå®ä¾‹åŒ– singletonObjects.put(className, Class.forName(className).newInstance()); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; //ä»ç¼“å­˜è¡¨ä¸­å›å»,å¦‚æœç¼“å­˜å‘½ä¸­ç›´æ¥è¿”å› return (SingletonReg)singletonObjects.get(className); &#125; &#125; åŒè¿‡ä»¥ä¸Šå•ä¾‹å®ç°,getInstance()æ–¹æ³•é€šè¿‡ä¼ å…¥ç±»åè¿›è¡Œåˆ¤æ–­,å¦‚æœå‚æ•°ä¸ºnull,é‚£å°±æ— æ³•è·å–bean,å¦‚æœå‚æ•°ä¸ä¸ºç©º,å…ˆä»ç¼“å­˜æ³¨å†Œè¡¨å‘½ä¸­,å¦‚æœå‘½ä¸­å°±returnæ‰,æ²¡æœ‰å‘½ä¸­é€šè¿‡åå°„æœºåˆ¶å®ä¾‹åŒ–ä¸€ä¸ªreturn.è¿™æ ·å¤šæ¬¡è·å¾—è°ƒç”¨getInstance()æ–¹æ³•éƒ½æ˜¯è·å¾—åŒä¸€ä¸ªå¯¹è±¡.æµ‹è¯•å¦‚ä¸‹:123456789 public static void main(String[] args) &#123; /* * è¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ * com.yimi.yts.learningpath.SingletonReg@3d82c5f3 * com.yimi.yts.learningpath.SingletonReg@3d82c5f3 */ System.out.println( SingletonReg.getInstance(&quot;com.yimi.yts.learningpath.SingletonReg&quot;)); System.out.println( SingletonReg.getInstance(&quot;com.yimi.yts.learningpath.SingletonReg&quot;));&#125; Springæºç åˆ†æé€šè¿‡ä¸Šè¿°å®ç°,Springå°±æ˜¯é‡‡ç”¨äº†è¿™ç§å•ä¾‹æ³¨å†Œè¡¨çš„ç‰¹æ®Šæ–¹å¼å®ç°å•ä¾‹æ¨¡å¼çš„.123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596public abstract class AbstractBeanFactory extends FactoryBeanRegistrySupport implements ConfigurableBeanFactory &#123; @SuppressWarnings(&quot;unchecked&quot;) protected &lt;T&gt; T doGetBean( final String name, final Class&lt;T&gt; requiredType, final Object[] args, boolean typeCheckOnly) throws BeansException &#123; //å¯¹Beançš„nameè¿›è¡Œå¤„ç†,é˜²æ­¢éæ³•å­—ç¬¦ final String beanName = transformedBeanName(name); Object bean; // Eagerly check singleton cache for manually registered singletons. //ä»å•ä¾‹æ³¨å†Œè¡¨ä¸­æ£€æŸ¥æ˜¯å¦å­˜åœ¨å•ä¾‹ç¼“å­˜ Object sharedInstance = getSingleton(beanName); if (sharedInstance != null &amp;&amp; args == null) &#123; //çœç•¥éƒ¨åˆ†ä»£ç ... // è¿”å›ç¼“å­˜å®ä¾‹ bean = getObjectForBeanInstance(sharedInstance, name, beanName, null); &#125; else &#123; //çœç•¥ä»£ç ... try &#123; // ...å¿½ç•¥ä»£ç  // å•ä¾‹æ¨¡å¼,å®ä¾‹åŒ–bean,å¤„ç†åˆ†æ”¯ // Create bean instance. if (mbd.isSingleton()) &#123; sharedInstance = getSingleton(beanName, new ObjectFactory&lt;Object&gt;() &#123; @Override public Object getObject() throws BeansException &#123; try &#123; return createBean(beanName, mbd, args); &#125; catch (BeansException ex) &#123; destroySingleton(beanName); throw ex; &#125; &#125; &#125;); bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd); &#125; //åŸå‹é­”å…½,å¤„ç†åˆ†æ”¯ else if (mbd.isPrototype()) &#123; //çœç•¥ä»£ç  &#125; else &#123; String scopeName = mbd.getScope(); final Scope scope = this.scopes.get(scopeName); if (scope == null) &#123; throw new IllegalStateException(&quot;No Scope registered for scope name &apos;&quot; + scopeName + &quot;&apos;&quot;); &#125; try &#123; Object scopedInstance = scope.get(beanName, new ObjectFactory&lt;Object&gt;() &#123; @Override public Object getObject() throws BeansException &#123; beforePrototypeCreation(beanName); try &#123; return createBean(beanName, mbd, args); &#125; finally &#123; afterPrototypeCreation(beanName); &#125; &#125; &#125;); bean = getObjectForBeanInstance(scopedInstance, name, beanName, mbd); &#125; catch (IllegalStateException ex) &#123; throw new BeanCreationException(beanName, &quot;Scope &apos;&quot; + scopeName + &quot;&apos; is not active for the current thread; consider &quot; + &quot;defining a scoped proxy for this bean if you intend to refer to it from a singleton&quot;, ex); &#125; &#125; &#125; catch (BeansException ex) &#123; cleanupAfterBeanCreationFailure(beanName); throw ex; &#125; &#125; // Check if required type matches the type of the actual bean instance. if (requiredType != null &amp;&amp; bean != null &amp;&amp; !requiredType.isInstance(bean)) &#123; try &#123; return getTypeConverter().convertIfNecessary(bean, requiredType); &#125; catch (TypeMismatchException ex) &#123; if (logger.isDebugEnabled()) &#123; logger.debug(&quot;Failed to convert bean &apos;&quot; + name + &quot;&apos; to required type &apos;&quot; + ClassUtils.getQualifiedName(requiredType) + &quot;&apos;&quot;, ex); &#125; throw new BeanNotOfRequiredTypeException(name, requiredType, bean.getClass()); &#125; &#125; return (T) bean; &#125;&#125; å…¶ä¸­ä¸­é‡è¦çš„ä»£ç æ˜¯getSingleton()æ–¹æ³•,ä¸‹é¢æ·±å…¥åˆ†æè¯¥æ–¹æ³•:1234567891011121314151617181920212223242526272829303132333435public class DefaultSingletonBeanRegistry extends SimpleAliasRegistry implements SingletonBeanRegistry &#123; // é€šè¿‡ Map å®ç°å•ä¾‹æ³¨å†Œè¡¨ private final Map&lt;String, Object&gt; singletonObjects = new ConcurrentHashMap&lt;String, Object&gt;(64); public Object getSingleton(String beanName, ObjectFactory&lt;?&gt; singletonFactory) &#123; Assert.notNull(beanName, &quot;&apos;beanName&apos; must not be null&quot;); synchronized (this.singletonObjects) &#123; // æ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨å®ä¾‹ Object singletonObject = this.singletonObjects.get(beanName); if (singletonObject == null) &#123; // ...å¿½ç•¥ä»£ç  try &#123; singletonObject = singletonFactory.getObject(); &#125; catch (BeanCreationException ex) &#123; // ...å¿½ç•¥ä»£ç  &#125; finally &#123; // ...å¿½ç•¥ä»£ç  &#125; // å¦‚æœå®ä¾‹å¯¹è±¡åœ¨ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ³¨å†Œåˆ°å•ä¾‹æ³¨å†Œè¡¨ä¸­ã€‚ addSingleton(beanName, singletonObject); &#125; return (singletonObject != NULL_OBJECT ? singletonObject : null); &#125; &#125; protected void addSingleton(String beanName, Object singletonObject) &#123; synchronized (this.singletonObjects) &#123; this.singletonObjects.put(beanName, (singletonObject != null ? singletonObject : NULL_OBJECT)); &#125; &#125;&#125; æ€»ç»“ç»¼ä¸Šè¿°åˆ†æ.æˆ‘ä»¬å¯ä»¥å¾—å‡º:Springå¯¹Beanå®ä¾‹çš„åˆ›å»ºæ˜¯é‡‡ç”¨å•ä¾‹æ³¨å†Œè¡¨çš„æ–¹å¼è¿›è¡Œå®ç°çš„ï¼Œè€Œè¿™ä¸ªæ³¨å†Œè¡¨çš„ç¼“å­˜æ˜¯ ConcurrentHashMapå¯¹è±¡ã€‚","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"http://ltyeamin.github.io/tags/Spring/"}]},{"title":"çº¿ç¨‹åˆ‡æ¢å¯¼è‡´ThreadLocalæ•°æ®ä¸¢å¤±åˆ†æ","slug":"çº¿ç¨‹åˆ‡æ¢å¯¼è‡´ThreadLocalæ•°æ®ä¸¢å¤±åˆ†æ","date":"2018-03-15T12:51:07.000Z","updated":"2019-05-29T14:03:51.000Z","comments":true,"path":"2018/03/15/çº¿ç¨‹åˆ‡æ¢å¯¼è‡´ThreadLocalæ•°æ®ä¸¢å¤±åˆ†æ/","link":"","permalink":"http://ltyeamin.github.io/2018/03/15/çº¿ç¨‹åˆ‡æ¢å¯¼è‡´ThreadLocalæ•°æ®ä¸¢å¤±åˆ†æ/","excerpt":"","text":"æœ€è¿‘åœ¨ä½¿ç”¨Spring Cloudè¿‡ç¨‹ä¸­,ç»å¸¸ä¼šé‡è§çº¿ç¨‹éš”ç¦»(åˆ‡æ¢).å¯¼è‡´ThreadLocalæ•°æ®ä¸¢å¤±.ä¾‹å¦‚è°ƒç”¨å…¶ä»–æœåŠ¡è·å–ä¸åˆ°Threadlocalæ²¡æœ‰æ•°æ®,æœåŠ¡ä¹‹é—´ä¼ é€’è¯·æ±‚å¤´ä¼ é€’å¤±è´¥.é€šè¿‡æŸ¥é˜…ç›¸å…³æ–‡æ¡£æ‰å‘ç°:ç”¨Hystrixå®ç°æ–­è·¯å™¨,Zuulä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯ä¿¡å·é‡,å…¶ä»–é»˜è®¤éƒ½æ˜¯çº¿ç¨‹éš”ç¦».å…·ä½“æ–‡æ¡£å¦‚ä¸‹(å¯å‚è€ƒHystrix WIKI)ï¼š Thread or Semaphore The default, and the recommended setting, is to run HystrixCommands using thread isolation (THREAD) and HystrixObservableCommands using semaphore isolation (SEMAPHORE). Commands executed in threads have an extra layer of protection against latencies beyond what network timeouts can offer. Generally the only time you should use semaphore isolation for HystrixCommands is when the call is so high volume (hundreds per second, per instance) that the overhead of separate threads is too high; this typically only applies to non-network calls. åœ¨ä½¿ç”¨çº¿ç¨‹éš”ç¦»çš„æ—¶å€™ï¼Œæœ‰ä¸ªé—®é¢˜æ˜¯å¿…é¡»è¦è§£å†³çš„ï¼Œé‚£å°±æ˜¯åœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸‹é€šè¿‡ThreadLocalæ¥åœ¨çº¿ç¨‹é‡Œä¼ é€’æ•°æ®ï¼Œç”¨ä¿¡å·é‡æ˜¯æ²¡é—®é¢˜çš„ï¼Œä»è¯·æ±‚è¿›æ¥ï¼Œä½†åç»­çš„æµç¨‹éƒ½æ˜¯é€šä¸€ä¸ªçº¿ç¨‹ã€‚å½“éš”ç¦»æ¨¡å¼ä¸ºçº¿ç¨‹æ—¶ï¼ŒHystrixä¼šå°†è¯·æ±‚æ”¾å…¥Hystrixçš„çº¿ç¨‹æ± ä¸­å»æ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™æŸä¸ªè¯·æ±‚å°±æœ‰Açº¿ç¨‹å˜æˆBçº¿ç¨‹äº†ï¼ŒThreadLocalå¿…ç„¶æ¶ˆå¤±äº†. æ¨¡æ‹Ÿå®ç° 123456789101112131415161718192021222324252627282930313233public class CustomThreadLocal &#123; static ThreadLocal&lt;String&gt; threadLocal = new ThreadLocal&lt;&gt;(); public static void main(String[] args) &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; CustomThreadLocal.threadLocal.set(&quot;å½¤å“¥å“¥&quot;); new Service().call(); &#125; &#125;).start(); &#125;&#125;class Service &#123; public void call() &#123; System.out.println(&quot;Service:&quot; + Thread.currentThread().getName()); System.out.println(&quot;Service:&quot; + CustomThreadLocal.threadLocal.get()); new Dao().call(); &#125;&#125;class Dao &#123; public void call() &#123; System.out.println(&quot;==========================&quot;); System.out.println(&quot;Dao:&quot; + Thread.currentThread().getName()); System.out.println(&quot;Dao:&quot; + CustomThreadLocal.threadLocal.get()); &#125;&#125; æˆ‘ä»¬åœ¨ä¸»ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªThreadLocalç”¨æ¥ä¼ é€’æ•°æ®ï¼Œç„¶åèµ·äº†ä¸€ä¸ªçº¿ç¨‹ï¼Œåœ¨çº¿ç¨‹ä¸­è°ƒç”¨Serviceä¸­çš„callæ–¹æ³•ï¼Œå¹¶ä¸”å¾€Threadlocalä¸­è®¾ç½®äº†ä¸€ä¸ªå€¼ï¼Œåœ¨Serviceä¸­è·å–ThreadLocalä¸­çš„å€¼ï¼Œç„¶åå†è°ƒç”¨Daoä¸­çš„callæ–¹æ³•ï¼Œä¹Ÿæ˜¯è·å–ThreadLocalä¸­çš„å€¼ï¼Œæˆ‘ä»¬è¿è¡Œä¸‹çœ‹æ•ˆæœï¼š12345Service:Thread-0Service:å½¤å“¥å“¥==========================Dao:Thread-0Dao:å½¤å“¥å“¥ ä»è¿è¡Œç»“æœæ¥çœ‹,åŒä¸€ä¸ªçº¿ç¨‹ä¸­èƒ½å¤Ÿè·å¾—ThreadLocalçš„å€¼.è¿™ä¸ªæ²¡é”™,æ¥ä¸‹æ¥,å°†Sericeç±»ä¸­çš„call()æ–¹æ³•ç¨å¾®æ”¹é€ ä¸€ä¸‹:1234567891011public void call() &#123; System.out.println(&quot;Service:&quot; + Thread.currentThread().getName()); System.out.println(&quot;Service:&quot; + CustomThreadLocal.threadLocal.get()); //new Dao().call(); new Thread(new Runnable() &#123; @Override public void run() &#123; new Dao().call(); &#125; &#125;).start();&#125; å†æ¬¡è¿è¡Œç»“æœå¦‚ä¸‹:12345Service:Thread-0Service:å½¤å“¥å“¥==========================Dao:Thread-1Dao:null ç”±æ­¤å¯è§æ˜¯ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹,åœ¨è¿è¡ŒDaoä¸­çš„call()æ–¹æ³•è¿›è¡Œäº†çº¿ç¨‹åˆ‡æ¢,æ‰€ä»¥ThreadLocalè·å–åˆ°çš„æ•°æ®æœªnull. InheritableThreadLocalå¼•å…¥æ—¢ç„¶é‡åˆ°é—®é¢˜å°±è¯¥è§£å†³,é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢?å…¶å®è§£å†³èµ·æ¥å¾ˆç®€å•,åªéœ€è¦æ”¹ä¸€è¡Œä»£ç å³å¯.1static ThreadLocal&lt;String&gt; threadLocal = new InheritableThreadLocal&lt;&gt;(); å°†Threadlocalæ”¹æˆå­ç±»InheritableThreadLocalåè¿è¡Œç»“æœ:12345Service:Thread-0Service:å½¤å“¥å“¥==========================Dao:Thread-1Dao:å½¤å“¥å“¥ éå¸¸å®Œç¾çš„è§£å†³äº†çº¿ç¨‹åˆ‡æ¢å¯¼è‡´ThreadLocalæ‹¿ä¸åˆ°å€¼è€Œäº§ç”Ÿçš„é—®é¢˜. æ·±å…¥InheritableThreadLocalåŸç†è¦å…ˆäº†è§£InheritableThreadLocalåŸç†,é¦–å…ˆæ¸…æ¥šThreadLocalçš„åŸç†.è¯ä¸å¤šè¯´,å…ˆåˆ†æä¸€ä¸‹ThreadLocalçš„åŸç†: æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªThreadLocalMapç±»å‹çš„threadLocalså±æ€§,ThreadLocalMapç±»ç›¸å½“äºä¸€ä¸ªMap,key æ˜¯ ThreadLocalæœ¬èº«,valueå°±æ˜¯æˆ‘ä»¬è®¾ç½®çš„å€¼. 123public class Thread implements Runnable &#123; ThreadLocal.ThreadLocalMap threadLocals = null;&#125; å½“æˆ‘ä»¬é€šè¿‡threadLocal.set(â€œå½¤å“¥å“¥â€)çš„æ—¶å€™,å°±æ˜¯åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­çš„threadLocalså±æ€§ä¸­æ”¾å…¥ä¸€ä¸ªé”®å€¼å¯¹,keyæ˜¯ å½“å‰çº¿ç¨‹,valueå°±æ˜¯ä½ è®¾ç½®çš„å€¼ã€‚ å½“æˆ‘ä»¬é€šè¿‡ threadlocal.get()æ–¹æ³•çš„æ—¶å€™,å°±æ˜¯æ ¹æ®å½“å‰çº¿ç¨‹ä½œä¸ºkeyæ¥è·å–è¿™ä¸ªçº¿ç¨‹è®¾ç½®çš„å€¼.12345678910111213141516171819202122232425262728293031public class ThreadLocal&lt;T&gt; &#123; public void set(T value) &#123; //è·å–å½“å‰çš„çº¿ç¨‹å¯¹è±¡ Thread t = Thread.currentThread(); //è·å–å½“å‰çº¿ç¨‹å¯¹è±¡ä¸­çš„threadLocalså±æ€§ ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); &#125; ThreadLocalMap getMap(Thread t) &#123; return t.threadLocals; &#125; public T get() &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) &#123; @SuppressWarnings(&quot;unchecked&quot;) T result = (T)e.value; return result; &#125; &#125; return setInitialValue(); &#125;&#125; é€šè¿‡ä¸Šé¢çš„ä»‹ç»æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°threadlocalèƒ½å¤Ÿä¼ é€’æ•°æ®æ˜¯ç”¨Thread.currentThread()å½“å‰çº¿ç¨‹æ¥è·å–,ä¹Ÿå°±æ˜¯åªè¦åœ¨ç›¸åŒçš„çº¿ç¨‹ä¸­å°±å¯ä»¥è·å–åˆ°å‰é¢è®¾ç½®è¿›å»çš„å€¼.å¦‚æœåœ¨threadlocalè®¾ç½®å®Œå€¼ä¹‹å,ä¸‹æ­¥çš„æ“ä½œé‡æ–°åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹,è¿™ä¸ªæ—¶å€™Thread.currentThread()å°±å·²ç»å˜äº†,é‚£ä¹ˆè‚¯å®šæ˜¯æ‹¿ä¸åˆ°ä¹‹å‰è®¾ç½®çš„å€¼.å…·ä½“çš„é—®é¢˜å¤ç°å¯ä»¥å‚è€ƒä¸Šé¢æˆ‘çš„ä»£ç .é‚£ä¸ºä»€ä¹ˆInheritableThreadLocalå°±å¯ä»¥å‘¢?InheritableThreadLocalè¿™ä¸ªç±»ç»§æ‰¿äº†ThreadLocal,é‡å†™äº†3ä¸ªæ–¹æ³•,åœ¨å½“å‰çº¿ç¨‹ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å®ä¾‹Threadæ—¶,ä¼šæŠŠè¿™äº›çº¿ç¨‹å˜é‡ä»å½“å‰çº¿ç¨‹ä¼ é€’ç»™æ–°çš„çº¿ç¨‹å®ä¾‹.12345678910111213141516public class InheritableThreadLocal&lt;T&gt; extends ThreadLocal&lt;T&gt; &#123; protected T childValue(T parentValue) &#123; return parentValue; &#125; ThreadLocalMap getMap(Thread t) &#123; return t.inheritableThreadLocals; &#125; void createMap(Thread t, T firstValue) &#123; t.inheritableThreadLocals = new ThreadLocalMap(this, firstValue); &#125;&#125; é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°InheritableThreadLocal é‡å†™äº†childValue, getMap,createMapä¸‰ä¸ªæ–¹æ³•,æˆ‘ä»¬å¾€é‡Œé¢setå€¼çš„æ—¶å€™,å€¼ä¿å­˜åˆ°äº†inheritableThreadLocalsé‡Œé¢,è€Œä¸æ˜¯ä¹‹å‰çš„threadLocalsé‚£ä¹ˆå…³é”®çš„ç‚¹æ¥äº†,ä¸ºä»€ä¹ˆå½“åˆ›å»ºæ–°çš„çº¿ç¨‹æ± ,å¯ä»¥è·å–åˆ°ä¸Šä¸ªçº¿ç¨‹é‡Œçš„threadLocalä¸­çš„å€¼å‘¢?åŸå› å°±æ˜¯åœ¨æ–°åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™,ä¼šæŠŠä¹‹å‰çº¿ç¨‹çš„inheritableThreadLocalsèµ‹å€¼ç»™æ–°çº¿ç¨‹çš„inheritableThreadLocals,é€šè¿‡è¿™ç§æ–¹å¼å®ç°äº†æ•°æ®çš„ä¼ é€’.æºç æœ€å¼€å§‹åœ¨Threadçš„init()æ–¹æ³•ä¸­,å¦‚ä¸‹:1234567891011121314151617181920212223242526272829303132333435363738394041424344publicclass Thread implements Runnable &#123; private void init(ThreadGroup g, Runnable target, String name, long stackSize, AccessControlContext acc, boolean inheritThreadLocals) &#123; //ä»£ç çœç•¥...... if (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != null) //åˆ›å»ºæ–°çš„ThreadLocalMapå¹¶å¤åˆ¶ç»™å½“å‰çº¿ç¨‹çš„inheritableThreadLocalså¯¹è±¡ this.inheritableThreadLocals = ThreadLocal.createInheritedMap(parent.inheritableThreadLocals); //ä»£ç çœç•¥...... &#125; static ThreadLocalMap createInheritedMap(ThreadLocalMap parentMap) &#123; return new ThreadLocalMap(parentMap); &#125; /** * èµ‹å€¼ä»£ç  */ private ThreadLocalMap(ThreadLocalMap parentMap) &#123; Entry[] parentTable = parentMap.table; int len = parentTable.length; setThreshold(len); table = new Entry[len]; for (int j = 0; j &lt; len; j++) &#123; Entry e = parentTable[j]; if (e != null) &#123; @SuppressWarnings(&quot;unchecked&quot;) ThreadLocal&lt;Object&gt; key = (ThreadLocal&lt;Object&gt;) e.get(); if (key != null) &#123; Object value = key.childValue(e.value); Entry c = new Entry(key, value); int h = key.threadLocalHashCode &amp; (len - 1); while (table[h] != null) h = nextIndex(h, len); table[h] = c; size++; &#125; &#125; &#125; &#125;&#125; åˆ°æ­¤ä¸ºæ­¢,é€šè¿‡inheritableThreadLocalsæˆ‘ä»¬å¯ä»¥åœ¨çˆ¶çº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹çš„æ—¶å€™å°†Localä¸­çš„å€¼ä¼ é€’ç»™å­çº¿ç¨‹,è¿™ä¸ªç‰¹æ€§å·²ç»èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†çš„éœ€æ±‚äº†.ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜æ˜¯å¦‚æœæ˜¯åœ¨çº¿ç¨‹å¤ç”¨çš„æƒ…å†µä¸‹å°±ä¼šå‡ºé—®é¢˜,æ¯”å¦‚çº¿ç¨‹æ± ä¸­å»ä½¿ç”¨inheritableThreadLocalsè¿›è¡Œä¼ å€¼,å› ä¸ºinheritableThreadLocals åªæ˜¯ä¼šå†æ–°åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™è¿›è¡Œä¼ å€¼,çº¿ç¨‹å¤ç”¨å¹¶ä¸ä¼šåšè¿™ä¸ªæ“ä½œ,é‚£ä¹ˆè¦è§£å†³è¿™ä¸ªé—®é¢˜å°±å¾—è‡ªå·±å»æ‰©å±•çº¿ç¨‹ç±»å®ç°è¿™ä¸ªåŠŸèƒ½. é˜¿é‡Œè§£å†³ä¹‹é“å¼€æºçš„ä¸–ç•Œåº”æœ‰å°½æœ‰,ä¸ºäº†è§£å†³ä¸Šè¿°é—ç•™çš„é—®é¢˜,é˜¿é‡Œå¼€æºäº†ä¸€æ¬¾Javaæ¡†æ¶: transmittable-thread-localå…¶ä¸»è¦åŠŸèƒ½å°±æ˜¯è§£å†³åœ¨ä½¿ç”¨çº¿ç¨‹æ± ç­‰ä¼šç¼“å­˜çº¿ç¨‹çš„ç»„ä»¶æƒ…å†µä¸‹,æä¾›ThreadLocalå€¼çš„ä¼ é€’åŠŸèƒ½,è§£å†³å¼‚æ­¥æ‰§è¡Œæ—¶ä¸Šä¸‹æ–‡ä¼ é€’çš„é—®é¢˜.JDKçš„InheritableThreadLocalç±»å¯ä»¥å®Œæˆçˆ¶çº¿ç¨‹åˆ°å­çº¿ç¨‹çš„å€¼ä¼ é€’.ä½†å¯¹äºä½¿ç”¨çº¿ç¨‹æ± ç­‰ä¼šç¼“å­˜çº¿ç¨‹çš„ç»„ä»¶çš„æƒ…å†µ,çº¿ç¨‹ç”±çº¿ç¨‹æ± åˆ›å»ºå¥½,å¹¶ä¸”çº¿ç¨‹æ˜¯ç¼“å­˜èµ·æ¥åå¤ä½¿ç”¨çš„;è¿™æ—¶çˆ¶å­çº¿ç¨‹å…³ç³»çš„ThreadLocalå€¼ä¼ é€’å·²ç»æ²¡æœ‰æ„ä¹‰,åº”ç”¨éœ€è¦çš„å®é™…ä¸Šæ˜¯æŠŠä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± æ—¶çš„ThreadLocalå€¼ä¼ é€’åˆ°ä»»åŠ¡æ‰§è¡Œæ—¶.transmittable-thread-localä½¿ç”¨æ–¹å¼åˆ†ä¸ºä¸‰ç§:ä¿®é¥°Runnableå’ŒCallable,ä¿®é¥°çº¿ç¨‹æ± ,Java Agentæ¥ä¿®é¥°JDKçº¿ç¨‹æ± å®ç°ç±».æ¥ä¸‹æ¥ç»™å¤§å®¶æ¼”ç¤ºä¸‹çº¿ç¨‹æ± çš„ä¿®é¥°æ–¹å¼,é¦–å…ˆæ¥ä¸€ä¸ªéæ­£å¸¸çš„æ¡ˆä¾‹,ä»£ç å¦‚ä¸‹:1234567891011121314151617181920212223242526272829303132333435363738394041public class CustomThreadLocal &#123; static ThreadLocal&lt;String&gt; threadLocal = new InheritableThreadLocal&lt;&gt;(); /** * åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°ä¸º2çš„çº¿ç¨‹æ±  */ static ExecutorService pool = Executors.newFixedThreadPool(2); public static void main(String[] args) &#123; for(int i=0;i&lt;100;i++) &#123; int j = i; pool.execute(new Thread(new Runnable() &#123; @Override public void run() &#123; CustomThreadLocal.threadLocal.set(&quot;å½¤å“¥å“¥&quot;+j); new Service().call(); &#125; &#125;)); &#125; &#125;&#125;class Service &#123; public void call() &#123; CustomThreadLocal.pool.execute(new Runnable() &#123; @Override public void run() &#123; new Dao().call(); &#125; &#125;); &#125;&#125;class Dao &#123; public void call() &#123; System.out.println(&quot;Dao:&quot; + CustomThreadLocal.threadLocal.get()); &#125;&#125; è¿è¡Œä¸Šé¢çš„ä»£ç ,å‡ºç°çš„ç»“æœæ˜¯ä¸æ­£ç¡®çš„,è¾“å‡ºç»“æœå¦‚ä¸‹:12345678910111213Dao:å½¤å“¥å“¥99Dao:å½¤å“¥å“¥99Dao:å½¤å“¥å“¥62Dao:å½¤å“¥å“¥99Dao:å½¤å“¥å“¥62Dao:å½¤å“¥å“¥99Dao:å½¤å“¥å“¥99Dao:å½¤å“¥å“¥62Dao:å½¤å“¥å“¥99Dao:å½¤å“¥å“¥62Dao:å½¤å“¥å“¥62Dao:å½¤å“¥å“¥99çœç•¥ä¹‹åçš„ç»“æœ... æ­£ç¡®çš„åº”è¯¥æ˜¯ä»0-99ä¸èƒ½æœ‰é‡å¤,ç”±äºçº¿ç¨‹çš„å¤ç”¨,å€¼è¢«æ›¿æ¢æ‰äº†æ‰ä¼šå‡ºç°ä¸æ­£ç¡®çš„ç»“æœ.æ¥ä¸‹æ¥ä½¿ç”¨transmittable-thread-localæ¥æ”¹é€ æœ‰é—®é¢˜çš„ä»£ç ,æ·»åŠ transmittable-thread-localçš„Mavenä¾èµ–ï¼š12345&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;transmittable-thread-local&lt;/artifactId&gt; &lt;version&gt;2.2.0&lt;/version&gt;&lt;/dependency&gt; åªéœ€è¦ä¿®æ”¹2ä¸ªåœ°æ–¹,ä¿®é¥°çº¿ç¨‹æ± å’Œæ›¿æ¢InheritableThreadLocal:12static TransmittableThreadLocal&lt;String&gt; threadLocal = new TransmittableThreadLocal&lt;&gt;();static ExecutorService pool = TtlExecutors.getTtlExecutorService(Executors.newFixedThreadPool(2)); æ­£ç¡®ç»“æœå¦‚ä¸‹:123456789101112Dao:å½¤å“¥å“¥1Dao:å½¤å“¥å“¥2Dao:å½¤å“¥å“¥4Dao:å½¤å“¥å“¥5Dao:å½¤å“¥å“¥3Dao:å½¤å“¥å“¥6Dao:å½¤å“¥å“¥7Dao:å½¤å“¥å“¥8Dao:å½¤å“¥å“¥9Dao:å½¤å“¥å“¥10Dao:å½¤å“¥å“¥11çœç•¥ä¹‹åçš„ç»“æœ... åˆ°è¿™é‡Œæˆ‘ä»¬å°±å·²ç»å¯ä»¥å®Œç¾çš„è§£å†³çº¿ç¨‹ä¸­,çº¿ç¨‹æ± ä¸­ThreadLocalæ•°æ®çš„ä¼ é€’äº†,é¢˜ä¸»è¶ç€ä¸­åˆå–èŒ¶çš„æ—¶é—´,æ— æ„é—´æ‰¾åˆ°å…¶ä»–è§£å†³æ–¹æ¡ˆ,ä¸‹èŠ‚ç»§ç»­ç”¨å…¶ä»–æ–¹å¼è¿›è¡Œè§£å†³.","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://ltyeamin.github.io/tags/Java/"}]},{"title":"ä½¿ç”¨Jenkinsè¿›è¡ŒæŒç»­é›†æˆ","slug":"ä½¿ç”¨Jenkinsè¿›è¡ŒæŒç»­é›†æˆ","date":"2018-02-07T12:18:53.000Z","updated":"2019-11-20T15:08:57.032Z","comments":true,"path":"2018/02/07/ä½¿ç”¨Jenkinsè¿›è¡ŒæŒç»­é›†æˆ/","link":"","permalink":"http://ltyeamin.github.io/2018/02/07/ä½¿ç”¨Jenkinsè¿›è¡ŒæŒç»­é›†æˆ/","excerpt":"","text":"Jenkinsæ˜¯ä¸€ä¸ªå¼€æºè½¯ä»¶é¡¹ç›®ï¼Œæ˜¯åŸºäºJavaå¼€å‘çš„ä¸€ç§æŒç»­é›†æˆå·¥å…·ï¼Œç”¨äºç›‘æ§æŒç»­é‡å¤çš„å·¥ä½œï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå¼€æ”¾æ˜“ç”¨çš„è½¯ä»¶å¹³å°ï¼Œä½¿è½¯ä»¶çš„æŒç»­é›†æˆå˜æˆå¯èƒ½ã€‚ å®‰è£…Jenkinsé¦–å…ˆæˆ‘ä»¬å»Jenkinså®˜æ–¹ç½‘ç«™ä¸‹è½½æœ€æ–°çš„éƒ¨ç½²åŒ…(.war):Jenkins.å› ä¸ºæˆ‘æ˜¯åœ¨Linuxå¹³å°éƒ¨ç½²,éœ€è¦æ³¨æ„çš„æ˜¯Jenkinsæ˜¯åŸºäºJavaæ„å»ºçš„,æ‰€ä»¥æˆ‘ä»¬å¿…é¡»å®‰è£…å¥½JDKç³»åˆ—çš„ä¾èµ–æ‰è¡Œ.Linuxå®‰è£…JDKæ—¶å€™å…ˆå¸è½½æœ¬èº«è‡ªå¸¦çš„OpenJDKå†è¿›è¡Œå®‰è£…,å¹¶é…ç½®å¥½ç¯å¢ƒå˜é‡.JDKå®‰è£…æˆ‘ä¸åœ¨ç´¯è¿°,è¯»è€…å¯è‡ªè¡Œç™¾åº¦. 12# é€šè¿‡wgetæ–¹å¼ä¸‹è½½Tomcatå’ŒJenkinså®‰è£…åŒ…[root@localhost bin]# wget http://mirrors.jenkins.io/war/latest/jenkins.war ä¸‹è½½å®Œæˆåä¼šåœ¨å½“å‰ç›®å½•å‡ºç°jenkins.war,å› ä¸ºJenkinså†…åµŒJettyæœåŠ¡å™¨(ä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨Tomcatå®¹å™¨é‡Œ),å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯åŠ¨.1[root@localhost bin]# java -jar jenkins.war æ‰§è¡Œä»¥ä¸‹å‘½ä»¤,ä¼šæ‰“å°å‡ºå¦‚ä¸‹æ—¥å¿—ä¿¡æ¯:12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182Running from: /usr/local/bin/jenkins.warwebroot: $user.home/.jenkinsäºŒæœˆ 06, 2018 11:19:44 ä¸Šåˆ Main deleteWinstoneTempContentsè­¦å‘Š: Failed to delete the temporary Winstone file /tmp/winstone/jenkins.waräºŒæœˆ 06, 2018 11:19:44 ä¸Šåˆ org.eclipse.jetty.util.log.Log initializedä¿¡æ¯: Logging initialized @1303ms to org.eclipse.jetty.util.log.JavaUtilLogäºŒæœˆ 06, 2018 11:19:44 ä¸Šåˆ winstone.Logger logInternalä¿¡æ¯: Beginning extraction from war fileäºŒæœˆ 06, 2018 11:19:47 ä¸Šåˆ org.eclipse.jetty.server.handler.ContextHandler setContextPathè­¦å‘Š: Empty contextPathäºŒæœˆ 06, 2018 11:19:47 ä¸Šåˆ org.eclipse.jetty.server.Server doStartä¿¡æ¯: jetty-9.4.z-SNAPSHOTäºŒæœˆ 06, 2018 11:19:47 ä¸Šåˆ org.eclipse.jetty.webapp.StandardDescriptorProcessor visitServletä¿¡æ¯: NO JSP Support for /, did not find org.eclipse.jetty.jsp.JettyJspServletäºŒæœˆ 06, 2018 11:19:48 ä¸Šåˆ org.eclipse.jetty.server.session.DefaultSessionIdManager doStartä¿¡æ¯: DefaultSessionIdManager workerName=node0äºŒæœˆ 06, 2018 11:19:48 ä¸Šåˆ org.eclipse.jetty.server.session.DefaultSessionIdManager doStartä¿¡æ¯: No SessionScavenger set, using defaultsäºŒæœˆ 06, 2018 11:19:48 ä¸Šåˆ org.eclipse.jetty.server.session.HouseKeeper startScavengingä¿¡æ¯: Scavenging every 600000msJenkins home directory: /root/.jenkins found at: $user.home/.jenkinsäºŒæœˆ 06, 2018 11:19:49 ä¸Šåˆ org.eclipse.jetty.server.handler.ContextHandler doStartä¿¡æ¯: Started w.@f9b7332&#123;/,file:///root/.jenkins/war/,AVAILABLE&#125;&#123;/root/.jenkins/war&#125;äºŒæœˆ 06, 2018 11:19:49 ä¸Šåˆ org.eclipse.jetty.server.AbstractConnector doStartä¿¡æ¯: Started ServerConnector@2baa8d82&#123;HTTP/1.1,[http/1.1]&#125;&#123;0.0.0.0:8080&#125;äºŒæœˆ 06, 2018 11:19:49 ä¸Šåˆ org.eclipse.jetty.server.Server doStartä¿¡æ¯: Started @6419msäºŒæœˆ 06, 2018 11:19:49 ä¸Šåˆ winstone.Logger logInternalä¿¡æ¯: Winstone Servlet Engine v4.0 running: controlPort=disabledäºŒæœˆ 06, 2018 11:19:52 ä¸Šåˆ jenkins.InitReactorRunner$1 onAttainedä¿¡æ¯: Started initializationäºŒæœˆ 06, 2018 11:19:52 ä¸Šåˆ jenkins.InitReactorRunner$1 onAttainedä¿¡æ¯: Listed all pluginsäºŒæœˆ 06, 2018 11:19:56 ä¸Šåˆ jenkins.InitReactorRunner$1 onAttainedä¿¡æ¯: Prepared all pluginsäºŒæœˆ 06, 2018 11:19:56 ä¸Šåˆ jenkins.InitReactorRunner$1 onAttainedä¿¡æ¯: Started all pluginsäºŒæœˆ 06, 2018 11:19:56 ä¸Šåˆ jenkins.InitReactorRunner$1 onAttainedä¿¡æ¯: Augmented all extensionsäºŒæœˆ 06, 2018 11:19:59 ä¸Šåˆ jenkins.InitReactorRunner$1 onAttainedä¿¡æ¯: Loaded all jobsäºŒæœˆ 06, 2018 11:19:59 ä¸Šåˆ hudson.eureka1-server.AsyncPeriodicWork$1 runä¿¡æ¯: Started Download metadataäºŒæœˆ 06, 2018 11:20:00 ä¸Šåˆ jenkins.InitReactorRunner$1 onAttainedä¿¡æ¯: Completed initializationäºŒæœˆ 06, 2018 11:20:02 ä¸Šåˆ org.springframework.context.support.AbstractApplicationContext prepareRefreshä¿¡æ¯: Refreshing org.springframework.web.context.support.StaticWebApplicationContext@fabd330: display name [Root WebApplicationContext]; startup date [Tue Feb 06 11:20:02 CST 2018]; root of context hierarchyäºŒæœˆ 06, 2018 11:20:02 ä¸Šåˆ org.springframework.context.support.AbstractApplicationContext obtainFreshBeanFactoryä¿¡æ¯: Bean factory for application context [org.springframework.web.context.support.StaticWebApplicationContext@fabd330]: org.springframework.beans.factory.support.DefaultListableBeanFactory@1452b2bcäºŒæœˆ 06, 2018 11:20:02 ä¸Šåˆ org.springframework.beans.factory.support.DefaultListableBeanFactory preInstantiateSingletonsä¿¡æ¯: Pre-instantiating singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@1452b2bc: defining beans [authenticationManager]; root of factory hierarchyäºŒæœˆ 06, 2018 11:20:02 ä¸Šåˆ org.springframework.context.support.AbstractApplicationContext prepareRefreshä¿¡æ¯: Refreshing org.springframework.web.context.support.StaticWebApplicationContext@1a724d6e: display name [Root WebApplicationContext]; startup date [Tue Feb 06 11:20:02 CST 2018]; root of context hierarchyäºŒæœˆ 06, 2018 11:20:02 ä¸Šåˆ org.springframework.context.support.AbstractApplicationContext obtainFreshBeanFactoryä¿¡æ¯: Bean factory for application context [org.springframework.web.context.support.StaticWebApplicationContext@1a724d6e]: org.springframework.beans.factory.support.DefaultListableBeanFactory@7be61840äºŒæœˆ 06, 2018 11:20:02 ä¸Šåˆ org.springframework.beans.factory.support.DefaultListableBeanFactory preInstantiateSingletonsä¿¡æ¯: Pre-instantiating singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@7be61840: defining beans [filter,legacy]; root of factory hierarchyäºŒæœˆ 06, 2018 11:20:03 ä¸Šåˆ jenkins.install.SetupWizard initä¿¡æ¯: ***************************************************************************************************************************************************************************************Jenkins initial setup is required. An admin user has been created and a password generated.Please use the following password to proceed to installation:00caaea4ac874d4db11cb31c27e5c7ceThis may also be found at: /root/.jenkins/secrets/initialAdminPassword***************************************************************************************************************************************************************************************äºŒæœˆ 06, 2018 11:21:34 ä¸Šåˆ hudson.eureka1-server.UpdateSite updateDataä¿¡æ¯: Obtained the latest update center data file for UpdateSource defaultäºŒæœˆ 06, 2018 11:21:37 ä¸Šåˆ hudson.eureka1-server.UpdateSite updateDataä¿¡æ¯: Obtained the latest update center data file for UpdateSource defaultäºŒæœˆ 06, 2018 11:21:37 ä¸Šåˆ hudson.WebAppMain$3 runä¿¡æ¯: Jenkins is fully up and runningäºŒæœˆ 06, 2018 11:21:37 ä¸Šåˆ hudson.eureka1-server.DownloadService$Downloadable loadä¿¡æ¯: Obtained the updated data file for hudson.tasks.Maven.MavenInstaller å¯åŠ¨æˆåŠŸå,æµè§ˆå™¨è¾“å…¥http://192.168.64.128:8080,åˆ™ä¼šè¿›å…¥ä»¥ä¸‹ç•Œé¢:è·å–å£ä»¤æœ‰å¥½å‡ ç§æ–¹å¼: ä¸Šè¿°å¯åŠ¨æ—¥å¿—é‡Œ,è¿™é‡Œå£ä»¤ä¸º:00caaea4ac874d4db11cb31c27e5c7ce /root/.jenkins/secrets/initialAdminPasswordå¤åˆ¶å£ä»¤å¡«å……è¿›å»å¹¶ç‚¹å‡»ç»§ç»­åˆ™è¿›å…¥ä¸‹åˆ—ç•Œé¢:è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å®‰è£…æ¨èçš„é»˜è®¤å®‰è£…æ–¹å¼,Jenkinså°±è‡ªåŠ¨é…ç½®å¥½äº†ä¸€äº›å¸¸ç”¨æ’ä»¶.æœ€å,åˆ›å»ºä¸€ä¸ªadminç”¨æˆ·,å®Œæˆå®‰è£….Jenkinsé…ç½®å®‰è£…å®Œæˆå,æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨é…ç½®ä¸€äº›æ’ä»¶.å¦‚JDK,Maven,Git,Gradleç­‰å¸¸ç”¨æ’ä»¶. é¦–é¡µâ€”â€”&gt;ç³»ç»Ÿç®¡ç†â€”-&gt; å…¨å±€å·¥å…·ç®¡ç†1234567891011# ä¸‹è½½maven-Dmaven.test.skip=truevi seting&lt;localRepository&gt;/usr/local/bin/apache-maven-3.5.2/repository&lt;/localRepository&gt; &lt;mirrors&gt; &lt;mirror&gt; &lt;id&gt;nexus-aliyun&lt;/id&gt; &lt;mirrorOf&gt;*&lt;/mirrorOf&gt; &lt;name&gt;Nexus aliyun&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt; &lt;/mirror&gt; &lt;/mirrors&gt; Gitæˆ‘ä»¬é€‰æ‹©é»˜è®¤å®‰è£…,JDKæ‰‹åŠ¨å»é…ç½®. é¦–é¡µâ€”â€”&gt;ç³»ç»Ÿç®¡ç†â€”-&gt; ç®¡ç†æ’ä»¶â€”â€“&gt;å¯é€‰æ’ä»¶â€”-&gt;è¿‡æ»¤â€”â€”&gt;è¾“å…¥:Maven Integration pluginæˆ–è€…Git pluginâ€”â€“&gt;é€‰æ‹©æ€§å®‰è£…æ’ä»¶ æ„å»ºè‡ªåŠ¨åŒ–éƒ¨ç½²Gité¡¹ç›®åœ°å€: https://gitee.com/ltalex/GitCeShi.gitåœ¨Jenkinsé¦–é¡µé€‰æ‹©æ–°å»ºä»»åŠ¡,å¦‚ä¸‹ ä»¥ä¸‹é…ç½®è¡¨ç¤ºmavenæ„å»ºç»“æŸåæ‰§è¡Œçš„è„šæœ¬(Execute shell)1234/usr/local/eureka/stop.sh/usr/local/eureka/replace.sh# ç†è®ºæ¥è¯´å¯ä»¥è¿™æ ·å†™nohup java -jar xxx.jar &amp;,ä½†æ˜¯è¿™ç§é…ç½®åœ¨jenkisæ˜¯æ— æ•ˆçš„BUILD_ID=dontKillMe nohup /usr/local/eureka/startup.sh &amp; åœæ­¢è„šæœ¬123456789# å°†åº”ç”¨åœæ­¢#stop.sh#!/bin/bashecho &quot;Stopping SpringBoot Application&quot;pid=`ps -ef | grep eureka1-server.jar | grep -v grep | awk &apos;&#123;print $2&#125;&apos;`if [ -n &quot;$pid&quot; ]then kill -9 $pidfi å¤‡ä»½è„šæœ¬123456789#replace.sh ç”¨äºå°†ä¸Šæ¬¡æ„å»ºçš„ç»“æœå¤‡ä»½ï¼Œç„¶åå°†æ–°çš„æ„å»ºç»“æœç§»åŠ¨åˆ°åˆé€‚çš„ä½ç½®#!/bin/bash# å…ˆåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å¤‡ä»½file=&quot;/usr/local/eureka/eureka1-server.jar&quot;if [ -f &quot;$file&quot; ]then mv /usr/local/eureka/eureka1-server.jar /usr/local/eureka/backup/eureka1-server.jar.`date +%Y%m%d%H%M%S`fimv /root/.jenkins/workspace/Test/target/eureka1-server.jar /usr/local/eureka/eureka1-server.jar å¯åŠ¨è„šæœ¬123456# startup.sh å¯åŠ¨é¡¹ç›®#!/bin/shecho &quot;æˆäºˆå½“å‰ç”¨æˆ·æƒé™&quot;chmod 777 /usr/local/eureka/eureka1-server.jarecho &quot;æ‰§è¡Œ.....&quot;java -jar /usr/local/eureka/eureka1-server.jar ç‚¹å‡»ç«‹å³æ„å»º,Consoleä¼šå‡ºç°å¦‚ä¸‹ä¿¡æ¯: éƒ¨ç½²æˆåŠŸå,è®¿é—®http://192.168.64.128:8099/,å¦‚ä¸‹å›¾: é‡åˆ°çš„é—®é¢˜ åœ¨éƒ¨ç½²çš„æ—¶å€™ä¼šå‡ºç°java -jarå‡ºç°æ²¡æœ‰ä¸»æ¸…å•å±æ€§çš„é—®é¢˜,é‚£æ˜¯å› ä¸ºé¡¹ç›®ä¸­Pomæ–‡ä»¶æ²¡æœ‰é…ç½®SpringBootæ’ä»¶,å¯¼è‡´åœ¨jaråŒ…ä¸­MANIFEST.MFæ–‡ä»¶æ²¡æœ‰å¯åŠ¨ä¿¡æ¯12java -jar eureka1-server.jareureka1-server.jarä¸­æ²¡æœ‰ä¸»æ¸…å•å±æ€§ è§£å†³æ–¹æ¡ˆ:1234567891011&lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;executions&gt; &lt;execution&gt; &lt;goals&gt; &lt;goal&gt;repackage&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt;&lt;/plugin&gt; æ„å»ºæˆåŠŸåçš„è„šæœ¬,å³Execute shellå°½é‡æ‰§è¡Œè¿œç¨‹çš„shellè„šæœ¬,ä¸è¦ç›´æ¥åœ¨é‡Œé¢å¯åŠ¨é¡¹ç›®,å› ä¸ºé¡¹ç›®å¯åŠ¨åä¼šä¸€ç›´åœç•™,Jenkinså°±æ˜¯æ„å»ºæˆåŠŸä¹Ÿä¸ä¼šåœæ­¢å½“å‰é¡¹ç›®çš„æ„å»ºçŠ¶æ€. å¯ä»¥å®šåˆ¶æ„å»ºå‡ºå‘å™¨,å½“æˆ‘ä»¬å¸Œæœ›pushä¸€äº›ä¸œè¥¿èƒ½å¤Ÿç«‹é©¬æ„å»ºé¡¹ç›®æ—¶,å¯åœ¨æ„å»ºè§¦å‘å™¨ä¸­å‹¾é€‰Poll SCMæ—¥ç¨‹è¡¨è¡¨å¡«å†™è¡¨è¾¾å¼:* * * * *","categories":[{"name":"ops","slug":"ops","permalink":"http://ltyeamin.github.io/categories/ops/"}],"tags":[{"name":"Jenkins","slug":"Jenkins","permalink":"http://ltyeamin.github.io/tags/Jenkins/"}]},{"title":"æµ…è°ˆåŒ¿åå‡½æ•°,Lambdaå’Œé—­åŒ…(Closure)","slug":"æµ…è°ˆåŒ¿åå‡½æ•°,Lambda,é—­åŒ…(Closure)","date":"2018-01-30T09:46:04.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2018/01/30/æµ…è°ˆåŒ¿åå‡½æ•°,Lambda,é—­åŒ…(Closure)/","link":"","permalink":"http://ltyeamin.github.io/2018/01/30/æµ…è°ˆåŒ¿åå‡½æ•°,Lambda,é—­åŒ…(Closure)/","excerpt":"","text":"å‡ ä¹æ‰€æœ‰çš„ä¸»æµç¼–ç¨‹è¯­è¨€éƒ½å¯¹å‡½æ•°å¼ç¼–ç¨‹æœ‰æ”¯æŒ,æˆ‘æ‰€ç”¨è¿‡çš„æ¯”å¦‚Java8çš„Lambdaè¡¨è¾¾å¼,JavaScriptå’ŒGroovyè¯­è¨€çš„é—­åŒ…(Closure)ç­‰,å…¶ä»–çš„ç±»ä¼¼äºObject-Cçš„block,pythonçš„Lambdaå’ŒC++11,çœ‹åˆ°è¿™äº›,æˆ‘éƒ½æœ‰ç‚¹çœ©æ™•æƒ³åçš„æ„Ÿè§‰. åŒ¿åå‡½æ•°,Lambda,é—­åŒ…(Closure)åŒºåˆ«ä»è¡¨è±¡ä¸Šè¯´Lambdaå’ŒClosureæ˜¯ä¸€ä¸ªä¸œè¥¿,åªæ˜¯è¯­è¨€ä¸åŒç½¢äº†,å®ƒä»¬éƒ½å¯ä»¥å»æ›¿ä»£åŒ¿åå‡½æ•°ç”¨äºç®€åŒ–ä¹¦å†™,åŒ¿åå‡½æ•°å†…éƒ¨å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨å˜é‡.ä»è€Œå½¢æˆä¸€ä¸ªâ€é—­åŒ…â€.è®°ä½,è¿™åªæ˜¯è¡¨è±¡.ä¸‹é¢å°±è®©ä½ æ€€ç–‘äººç”Ÿ?çœŸçš„æ˜¯ä¸€æ ·å—? Javaä¸­Lambdaè¡¨è¾¾å¼æµ…è°ˆå…¶å®Javaåœ¨å¾ˆæ—©çš„ç‰ˆæœ¬å°±æ”¯æŒé—­åŒ…,åªæ˜¯å› ä¸ºåº”ç”¨åœºæ™¯å¤ªå°‘äº†,æ‰€ä»¥è¿™ä¸ªæ¦‚å¿µæ‰ä»Java8æ¨å¹¿.è¯ä¸å¤šè¯´,å…ˆä¸Šä»£ç : 12345678910111213141516171819202122public static Supplier&lt;Integer&gt; testClosure()&#123; final int i = 1; return new Supplier&lt;Integer&gt;() &#123; @Override public Integer get() &#123; return i; &#125; &#125;;&#125;public interface Supplier&lt;T&gt; &#123; T get();&#125; ä¸Šè¿°ä»£ç ä¸­,å˜é‡iæ˜¯testClosure()çš„å±€éƒ¨å˜é‡,ä½†æ˜¯æœ€ç»ˆè¿”å›é‡Œçš„åŒ¿åå¯¹è±¡é‡Œ,ä»ç„¶è¿”å›äº†i.æˆ‘ä»¬çŸ¥é“ï¼Œå‡½æ•°çš„å±€éƒ¨å˜é‡ï¼Œå…¶ä½œç”¨åŸŸä»…é™äºå‡½æ•°å†…éƒ¨ï¼Œåœ¨å‡½æ•°ç»“æŸæ—¶ï¼Œå±€éƒ¨å˜é‡iä»æ ˆå†…å­˜æ¶ˆå¤±äº†,å°±åº”è¯¥æ˜¯ä¸å¯è§çŠ¶æ€ï¼Œè€Œé—­åŒ…åˆ™å°†içš„ç”Ÿå­˜å‘¨æœŸå»¶é•¿äº†ï¼Œå¹¶ä¸”ä½¿å¾—å˜é‡å¯ä»¥è¢«å¤–éƒ¨å‡½æ•°æ‰€å¼•ç”¨ã€‚åœ¨JDK8ä¹‹å‰,å¦‚æœè®¿é—®i,å˜é‡iå¿…é¡»åŠ finalå…³é”®å­—ä¿®é¥°,è®©iæˆä¸ºå˜ä¸ºå¸¸é‡æ± ä¸­çš„å¸¸é‡ä»¥å»¶è¿Ÿiçš„ç”Ÿå‘½å‘¨æœŸ.è€Œåœ¨JDK8ä¸­ä»¥Lambdaè¡¨è¾¾å¼æ–¹å¼å†™,iåˆ™ä¸éœ€è¦åŠ ,è¿™é‡Œåªæ˜¯ä¸ªè¯­æ³•ç³–,å› ä¸ºåº•å±‚.classæ–‡ä»¶ä¼šè‡ªåŠ¨æ¨æ–­åŠ ä¸Š.åœ¨Javaçš„ç»å…¸è‘—ä½œã€ŠEffective Javaã€‹ã€ã€ŠJava Concurrency in Practiceã€‹é‡Œï¼Œå¤§ç¥ä»¬éƒ½æåˆ°ï¼šåŒ¿åå‡½æ•°é‡Œçš„å˜é‡å¼•ç”¨ï¼Œä¹Ÿå«åšå˜é‡å¼•ç”¨æ³„éœ²ï¼Œä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› æ­¤åœ¨Java8ä¹‹å‰ï¼Œå¦‚æœåœ¨åŒ¿åç±»å†…éƒ¨å¼•ç”¨å‡½æ•°å±€éƒ¨å˜é‡ï¼Œå¿…é¡»å°†å…¶å£°æ˜ä¸ºfinalï¼Œå³ä¸å¯å˜å¯¹è±¡ã€‚(Pythonå’ŒJavascriptä»ä¸€å¼€å§‹å°±æ˜¯ä¸ºå•çº¿ç¨‹è€Œç”Ÿçš„è¯­è¨€ï¼Œä¸€èˆ¬ä¹Ÿä¸ä¼šè€ƒè™‘è¿™æ ·çš„é—®é¢˜ï¼Œæ‰€ä»¥å®ƒçš„å¤–éƒ¨å˜é‡æ˜¯å¯ä»¥ä»»æ„ä¿®æ”¹çš„)ã€‚å¦‚æœç”¨Java8çš„Lambdaæ”¹å†™ä¸Šè¿°ä»£ç ,åˆ™ä¸º:1234567891011public static Supplier&lt;Integer&gt; testClosure() &#123; int i = 1; return () -&gt; &#123; //å•ä¸ªè¯­å¥,å¯ä»¥çœç•¥&#123;&#125; return i; &#125;;&#125; Wow,çªç„¶æ„Ÿè§‰æ”¹å†™åçš„ä»£ç ç®€æ´æ˜äº†,é«˜ç«¯å¤§æ°”ä¸Šæ¡£æ¬¡.","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://ltyeamin.github.io/tags/Java/"}]},{"title":"Spring Cloud-ä½¿ç”¨é«˜æ€§èƒ½çš„OkHttpåº“","slug":"Spring Cloud-ä½¿ç”¨é«˜æ€§èƒ½çš„OkHttpåº“","date":"2018-01-30T01:27:55.000Z","updated":"2019-05-29T14:03:53.000Z","comments":true,"path":"2018/01/30/Spring Cloud-ä½¿ç”¨é«˜æ€§èƒ½çš„OkHttpåº“/","link":"","permalink":"http://ltyeamin.github.io/2018/01/30/Spring Cloud-ä½¿ç”¨é«˜æ€§èƒ½çš„OkHttpåº“/","excerpt":"","text":"æœ€è¿‘åœ¨åšé¡¹ç›®ä¼˜åŒ–,ç ”ç©¶äº†Spring Cloudåº•å±‚æºç ,Httpè¯·æ±‚åº“é»˜è®¤æ˜¯Apache HttpClientæˆ–è€…JDKè‡ªå¸¦çš„HttpURLConnectionåº“.Javaæ ‡å‡†åº“æä¾›äº†HttpURLConnectionç±»æ¥æ”¯æŒHTTPé€šè®¯ã€‚ä¸è¿‡HttpURLConnectionæœ¬èº«çš„APIä¸å¤Ÿå‹å¥½ï¼Œæ‰€æä¾›çš„åŠŸèƒ½ä¹Ÿæœ‰é™ã€‚å¤§éƒ¨åˆ†Javaç¨‹åºéƒ½é€‰æ‹©ä½¿ç”¨Apacheçš„å¼€æºé¡¹ç›®HttpClientä½œä¸ºHTTPå®¢æˆ·ç«¯ã€‚ApacheHttpClientåº“çš„åŠŸèƒ½å¼ºå¤§ï¼Œä½¿ç”¨ç‡ä¹Ÿå¾ˆé«˜ï¼ŒåŸºæœ¬ä¸Šæ˜¯Javaå¹³å°ä¸­äº‹å®ä¸Šçš„æ ‡å‡†HTTPå®¢æˆ·ç«¯,ä½†æ˜¯åšAndroidçš„å°ä¼™ä¼´æ—©å·²ç»æ·˜æ±°è¯¥åº“äº†,å°±æ˜¯å› ä¸ºå…¶APIæ•°é‡è¿‡å¤šè¿‡äºç¹é‡,ä½¿å¾—æˆ‘ä»¬å¾ˆéš¾åœ¨ä¸ç ´åå…¼å®¹æ€§çš„æƒ…å†µä¸‹å¯¹å®ƒè¿›è¡Œå‡çº§å’Œæ‰©å±•,å› è€Œå›¢é˜Ÿä¸æ„¿æ„å»ç»´æŠ¤è¯¥åº“.æœ¬ç« ä»‹ç»çš„æ˜¯ç”± Square å…¬å¸å¼€å‘çš„OkHttpï¼Œæ˜¯ä¸€ä¸ªä¸“æ³¨äºæ€§èƒ½å’Œæ˜“ç”¨æ€§çš„ HTTP å®¢æˆ·ç«¯ã€‚OkHttp åº“çš„è®¾è®¡å’Œå®ç°çš„é¦–è¦ç›®æ ‡æ˜¯é«˜æ•ˆ.æ”¯æŒSPDY,,å¯ä»¥åˆå¹¶å¤šä¸ªåˆ°åŒä¸€ä¸ªä¸»æœºçš„è¯·æ±‚, ä½¿ç”¨è¿æ¥æ± æŠ€æœ¯å‡å°‘è¯·æ±‚çš„å»¶è¿Ÿ(å¦‚æœSPDYæ˜¯å¯ç”¨çš„è¯),ä½¿ç”¨GZIPå‹ç¼©å‡å°‘ä¼ è¾“çš„æ•°æ®é‡,ç¼“å­˜å“åº”é¿å…é‡å¤çš„ç½‘ç»œè¯·æ±‚,å½“ç½‘ç»œå‡ºç°é—®é¢˜æ—¶ï¼ŒOkHttp ä¼šè‡ªåŠ¨é‡è¯•ä¸€ä¸ªä¸»æœºçš„å¤šä¸ªIPåœ°å€ã€‚ OkHttpåœ¨Zuulä¸­çš„åº”ç”¨è¯è¯´è‡³æ­¤,æœ‰äº›äººå¯èƒ½åˆç–‘é—®?æˆ‘æ€ä¹ˆçŸ¥é“é»˜è®¤åº•å±‚ç”¨çš„æ˜¯çš„Apache Client?æˆ‘åœ¨å…¬å¸è´Ÿè´£Zuulç½‘å…³æ¨¡å—,Zuulçš„åŠ¨æ€è·¯ç”±è½¬å‘ç”¨Ribbonè°ƒç”¨.æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£,å¦‚ä¸‹: 19.3 Zuul Http ClientThe default HTTP client used by zuul is now backed by the Apache HTTP Client instead of the deprecated Ribbon RestClient. To use RestClient or to use the okhttp3.OkHttpClient set ribbon.restclient.enabled=true or ribbon.okhttp.enabled=true respectively. If you would like to customize the Apache HTTP client or the OK HTTP client provide a bean of type ClosableHttpClient or OkHttpClient.1234567å‚ç…§ä¸Šè¿°å®˜æ–¹æ–‡æ¡£è¯´æ˜,è§£å†³æ–¹æ¡ˆå·²ç»æ˜äº†,å…·ä½“å®æ–½å¦‚ä¸‹:1.ç¡®ä¿ä½ çš„é¡¹ç›®æœ‰okhttpä¾èµ–:&lt;!-- OkHttp --&gt;&lt;dependency&gt; &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt; &lt;artifactId&gt;okhttp&lt;/artifactId&gt;&lt;/dependency&gt; application.ymlæ·»åŠ ribboné…ç½® 12345ribbon: httpclient: enabled: false # é»˜è®¤å¼€å¯éœ€è¦ç¦ç”¨ okhttp: enabled: true æµ‹è¯•æ›¿æ¢æ˜¯å¦æˆåŠŸa,å°†GateWayæœåŠ¡æ—¥å¿—è®¾ç½®ä¸ºDEBUGæ¨¡å¼è¿›è¡Œè°ƒç”¨,æŸ¥çœ‹æ—¥å¿—ä¼šæœ‰è®¸å¤šæœ‰å…³OkHttpçš„ä¸œè¥¿,ä½†æ—¥å¿—æ‰“å°å¤ªå¤š,ä¸æ˜“æ•è·,ä¸æ˜“è§‚å¯Ÿ 12345678910111213141516RibbonCommandFactoryConfiguration.HttpClientRibbonConfiguration matched:- AnyNestedCondition 1 matched 1 did not; NestedCondition on RibbonCommandFactoryConfiguration.OnRibbonHttpClientCondition.RibbonProperty@ConditionalOnProperty (ribbon.httpclient.enabled) found different value in property &apos;ribbon.httpclient.enabled&apos;; NestedCondition on RibbonCommandFactoryConfiguration.OnRibbonHttpClientCondition.ZuulProperty @ConditionalOnProperty (zuul.ribbon.httpclient.enabled) matched (RibbonCommandFactoryConfiguration.OnRibbonHttpClientCondition)RibbonCommandFactoryConfiguration.OkHttpRibbonConfigurationmatched:-@ConditionalOnClass found required class &apos;okhttp3.OkHttpClient&apos;; @ConditionalOnMissingClass did not find unwanted class (OnClassCondition)- AnyNestedCondition 1 matched 1 did not; NestedCondition on RibbonCommandFactoryConfiguration.OnRibbonOkHttpClientCondition.RibbonProperty@ConditionalOnProperty (ribbon.okhttp.enabled) matched; NestedCondition on RibbonCommandFactoryConfiguration.OnRibbonOkHttpClientCondition.ZuulProperty @ConditionalOnProperty (zuul.ribbon.okhttp.enabled) did not find property &apos;zuul.ribbon.okhttp.enabled&apos; (RibbonCommandFactoryConfiguration.OnRibbonOkHttpClientCondition) b,Debugå¯åŠ¨GateWayæœåŠ¡,é€šè¿‡æºç æ–¹å¼æŸ¥çœ‹RibbonCommandFactoryConfigurationå®é™…é…ç½®çš„Httpå®¢æˆ·ç«¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138package org.springframework.cloud.netflix.zuul;import java.lang.annotation.Documented;import java.lang.annotation.ElementType;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;import java.util.Collections;import java.util.Set;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.autoconfigure.condition.AnyNestedCondition;import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;import org.springframework.cloud.netflix.ribbon.SpringClientFactory;import org.springframework.cloud.netflix.zuul.filters.ZuulProperties;import org.springframework.cloud.netflix.zuul.filters.route.RestClientRibbonCommandFactory;import org.springframework.cloud.netflix.zuul.filters.route.RibbonCommandFactory;import org.springframework.cloud.netflix.zuul.filters.route.ZuulFallbackProvider;import org.springframework.cloud.netflix.zuul.filters.route.apache.HttpClientRibbonCommandFactory;import org.springframework.cloud.netflix.zuul.filters.route.okhttp.OkHttpRibbonCommandFactory;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Conditional;import org.springframework.context.annotation.Configuration;/** * @author Dave Syer * */public class RibbonCommandFactoryConfiguration &#123; @Configuration @ConditionalOnRibbonRestClient protected static class RestClientRibbonConfiguration &#123; @Autowired(required = false) private Set&lt;ZuulFallbackProvider&gt; zuulFallbackProviders = Collections.emptySet(); @Bean @ConditionalOnMissingBean public RibbonCommandFactory&lt;?&gt; ribbonCommandFactory( SpringClientFactory clientFactory, ZuulProperties zuulProperties) &#123; return new RestClientRibbonCommandFactory(clientFactory, zuulProperties, zuulFallbackProviders); &#125; &#125; @Configuration @ConditionalOnRibbonOkHttpClient @ConditionalOnClass(name = &quot;okhttp3.OkHttpClient&quot;) protected static class OkHttpRibbonConfiguration &#123; @Autowired(required = false) private Set&lt;ZuulFallbackProvider&gt; zuulFallbackProviders = Collections.emptySet(); @Bean @ConditionalOnMissingBean public RibbonCommandFactory&lt;?&gt; ribbonCommandFactory( SpringClientFactory clientFactory, ZuulProperties zuulProperties) &#123; return new OkHttpRibbonCommandFactory(clientFactory, zuulProperties, zuulFallbackProviders); &#125; &#125; @Configuration @ConditionalOnRibbonHttpClient protected static class HttpClientRibbonConfiguration &#123; @Autowired(required = false) private Set&lt;ZuulFallbackProvider&gt; zuulFallbackProviders = Collections.emptySet(); @Bean @ConditionalOnMissingBean public RibbonCommandFactory&lt;?&gt; ribbonCommandFactory( SpringClientFactory clientFactory, ZuulProperties zuulProperties) &#123; return new HttpClientRibbonCommandFactory(clientFactory, zuulProperties, zuulFallbackProviders); &#125; &#125; @Target(&#123; ElementType.TYPE, ElementType.METHOD &#125;) @Retention(RetentionPolicy.RUNTIME) @Documented @Conditional(OnRibbonHttpClientCondition.class) @interface ConditionalOnRibbonHttpClient &#123; &#125; private static class OnRibbonHttpClientCondition extends AnyNestedCondition &#123; public OnRibbonHttpClientCondition() &#123; super(ConfigurationPhase.PARSE_CONFIGURATION); &#125; @Deprecated //remove in Edgware&quot; @ConditionalOnProperty(name = &quot;zuul.ribbon.httpclient.enabled&quot;, matchIfMissing = true) static class ZuulProperty &#123;&#125; @ConditionalOnProperty(name = &quot;ribbon.httpclient.enabled&quot;, matchIfMissing = true) static class RibbonProperty &#123;&#125; &#125; @Target(&#123; ElementType.TYPE, ElementType.METHOD &#125;) @Retention(RetentionPolicy.RUNTIME) @Documented @Conditional(OnRibbonOkHttpClientCondition.class) @interface ConditionalOnRibbonOkHttpClient &#123; &#125; private static class OnRibbonOkHttpClientCondition extends AnyNestedCondition &#123; public OnRibbonOkHttpClientCondition() &#123; super(ConfigurationPhase.PARSE_CONFIGURATION); &#125; @Deprecated //remove in Edgware&quot; @ConditionalOnProperty(&quot;zuul.ribbon.okhttp.enabled&quot;) static class ZuulProperty &#123;&#125; @ConditionalOnProperty(&quot;ribbon.okhttp.enabled&quot;) static class RibbonProperty &#123;&#125; &#125; @Target(&#123; ElementType.TYPE, ElementType.METHOD &#125;) @Retention(RetentionPolicy.RUNTIME) @Documented @Conditional(OnRibbonRestClientCondition.class) @interface ConditionalOnRibbonRestClient &#123; &#125; private static class OnRibbonRestClientCondition extends AnyNestedCondition &#123; public OnRibbonRestClientCondition() &#123; super(ConfigurationPhase.PARSE_CONFIGURATION); &#125; @Deprecated //remove in Edgware&quot; @ConditionalOnProperty(&quot;zuul.ribbon.restclient.enabled&quot;) static class ZuulProperty &#123;&#125; @ConditionalOnProperty(&quot;ribbon.restclient.enabled&quot;) static class RibbonProperty &#123;&#125; &#125; &#125; è§£è¯»:æˆ‘ä»¬å¾ˆæ¸…æ¥šZuulçš„è´Ÿè½½å‡è¡¡å®ç°å°±é€šè¿‡Ribbonçš„å®ç°,æ‰€ä»¥Httpå®¢æˆ·ç«¯çš„é…ç½®è‡ªç„¶ä¹Ÿæ˜¯å¯¹Ribbonç»„ä»¶çš„é…ç½®,æºä»£ç ä¸­å¾ˆæ˜æ˜¾éƒ½æ˜¯é€šè¿‡@Conditionalå®ç°äº†æ¡ä»¶åŠ è½½,å…¶ä¸­è¯¥ç±»æä¾›äº†ä¸æ­¢ä¸€ç§çš„Httpå®¢æˆ·ç«¯(RestClient,é»˜è®¤çš„HttpClient,OkhttpClient)é…ç½®å®ç°.è¦æƒ³ç¡®ä¿æ”¹é€ æˆåŠŸ,åˆ™éœ€è¦åœ¨å…¶å†…éƒ¨ç±»OkHttpRibbonConfigurationä¸­çš„RibbonCommandFactoryæ‰“ä¸Šç«¯ç‚¹,çœ‹æœ‰æ²¡æœ‰è¿›å³å¯. Feignä¸­Okhttpåº”ç”¨å¤§å®¶ä¹Ÿéƒ½çŸ¥é“Feginçš„åº•å±‚ä¹Ÿæ˜¯Ribbon,ä¸Šè¿°æ–¹å¼å¯ä»¥è§£å†³,ä½†æ˜¯æ›´æ¨èFeignç«¯å¼€å§‹è§£å†³. é¦–å…ˆåœ¨æœåŠ¡è°ƒç”¨æ–¹åŠ å…¥ä»¥ä¸‹ä¾èµ– 12345&lt;!-- feignæ•´åˆOkHttp --&gt;&lt;dependency&gt; &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt; &lt;artifactId&gt;feign-okhttp&lt;/artifactId&gt;&lt;/dependency&gt; åœ¨application.ymlæ–‡ä»¶é…ç½® 12345feign: httpclient: enabled: false okhttp: enabled: true æµ‹è¯•æ˜¯å¦é…ç½®æˆåŠŸa, å¯åŠ¨æœåŠ¡è¿›è¡Œæ¥å£è°ƒç”¨,å¯ä»¥åˆ†ææ—¥å¿— 1234567891011121314151617181920[2018-01-30 13:04:03.398] [DEBUG] [restartedMain] o.s.c.e.PropertySourcesPropertyResolver -Found key &apos;feign.okhttp.enabled&apos; in [applicationConfigurationProperties] with type [String][2018-01-30 13:04:03.398] [DEBUG] [restartedMain] o.s.b.f.s.DefaultListableBeanFactory - Returning cached instance of singleton bean &apos;autoConfigurationReport&apos;[2018-01-30 13:04:03.398] [DEBUG] [restartedMain] o.s.c.a.ConfigurationClassBeanDefinitionReader - Registered bean definition for imported class &apos;org.springframework.cloud.netflix.feign.ribbon.FeignRibbonClientAutoConfiguration$OkHttpFeignLoadBalancedConfiguration&apos;[2018-01-30 13:04:03.399] [DEBUG] [restartedMain] o.s.b.f.s.DefaultListableBeanFactory - Returning cached instance of singleton bean &apos;org.springframework.boot.autoconfigure.condition.BeanTypeRegistry&apos;[2018-01-30 13:04:03.399] [DEBUG] [restartedMain] o.s.b.f.s.DefaultListableBeanFactory - Returning cached instance of singleton bean &apos;org.springframework.boot.autoconfigure.condition.BeanTypeRegistry&apos;[2018-01-30 13:04:03.399] [DEBUG] [restartedMain] o.s.b.f.s.DefaultListableBeanFactory - Returning cached instance of singleton bean &apos;autoConfigurationReport&apos;[2018-01-30 13:04:03.399] [DEBUG] [restartedMain] o.s.c.a.ConfigurationClassBeanDefinitionReader -Registering bean definition for @Bean method org.springframework.cloud.netflix.feign.ribbon.FeignRibbonClientAutoConfiguration$OkHttpFeignLoadBalancedConfigur å¦‚ä¸Šè¿°æ—¥å¿—æ–‡ä»¶Found key â€˜feign.okhttp.enabledâ€™å¯ä»¥çœ‹å‡ºæ›¿æ¢æˆåŠŸ.b, åˆ†æè°ƒç”¨æºç æ¥æµ‹è¯•æ˜¯å¦æˆåŠŸæ›¿æ¢æˆOkhttpå…¶è‡ªåŠ¨è£…é…æºç åœ¨FeignRibbonClientAutoConfigurationä¸­12345678910111213141516171819@ConditionalOnClass(&#123; ILoadBalancer.class, Feign.class &#125;)@Configuration@AutoConfigureBefore(FeignAutoConfiguration.class)//Order is important here, last should be the default, first should be optional@Import(&#123; HttpClientFeignLoadBalancedConfiguration.class, OkHttpFeignLoadBalancedConfiguration.class, DefaultFeignLoadBalancedConfiguration.class &#125;)public class FeignRibbonClientAutoConfiguration &#123; @Bean @ConditionalOnMissingBean public Client feignClient(CachingSpringLoadBalancerFactory cachingFactory, SpringClientFactory clientFactory) &#123; //Feigné»˜è®¤çš„å®¢æˆ·ç«¯æ˜¯Client.Default return new LoadBalancerFeignClient(new Client.Default(null, null), cachingFactory, clientFactory); &#125; //çœç•¥ç±»ä¸­çš„å†…å®¹...&#125; ä»è¯¥ç±»ä¸­çš„æ³¨é‡Šå¯ä»¥çœ‹å‡º,DefaultFeignLoadBalancedConfiguration.classæ˜¯é»˜è®¤é…ç½®,HttpClientFeignLoadBalancedConfiguration.classæ˜¯å¯é€‰çš„.Debugå¯åŠ¨æœåŠ¡å¹¶è¿›è¡Œè¿œç¨‹Feignçš„ä¸€è·¯è°ƒç”¨å‘ç°,ä¼šèµ°å¦‚ä¸‹çš„æ–¹æ³•:123456789101112131415161718192021222324252627282930313233343536373839404142final class SynchronousMethodHandler implements MethodHandler &#123; @Override public Object invoke(Object[] argv) throws Throwable &#123; RequestTemplate template = buildTemplateFromArgs.create(argv); Retryer retryer = this.retryer.clone(); while (true) &#123; try &#123; return executeAndDecode(template); &#125; catch (RetryableException e) &#123; retryer.continueOrPropagate(e); if (logLevel != Logger.Level.NONE) &#123; logger.logRetry(metadata.configKey(), logLevel); &#125; continue; &#125; &#125; &#125; Object executeAndDecode(RequestTemplate template) throws Throwable &#123; Request request = targetRequest(template); if (logLevel != Logger.Level.NONE) &#123; logger.logRequest(metadata.configKey(), logLevel, request); &#125; Response response; long start = System.nanoTime(); try &#123; response = client.execute(request, options); // ensure the request is set. TODO: remove in Feign 10 response.toBuilder().request(request).build(); &#125; catch (IOException e) &#123; if (logLevel != Logger.Level.NONE) &#123; logger.logIOException(metadata.configKey(), logLevel, e, elapsedTime(start)); &#125; throw errorExecuting(request, e); &#125; //çœç•¥ä»£ç ...... &#125;&#125; æˆ‘ä»¬å‘ç°SynchronousMethodHandlerä¸­çš„invoke()æ–¹æ³•åˆå»è°ƒç”¨executeAndDecode()æ–¹æ³•,åœ¨æ‰§è¡Œä¸‹åˆ—ä¸€æ®µä»£ç çš„æ—¶å€™,ä½ ä¼šå‘ç°åˆ°åº•æ˜¯ç”¨å“ªä¸ªHttpå®¢æˆ·ç«¯è¿›è¡Œè°ƒç”¨1response = client.execute(request, options); Clientæ˜¯Feignçš„Clientæ¥å£å£°æ˜,è¿™æ—¶å€™ä¼šæœ‰å¥½å‡ ä¸ªå®ç°:Default,LoadBalancerFeignClinet,OkHttpClient,TraceFeignClient.è¿™ä¸‹æ˜æ˜¾äº†,å¦‚æœä½ çš„classpathä¸‹æœ‰okhttpçš„ä¾èµ–,åˆ™ä¼šèµ°feign.okhttp.OkHttpClient.execute()æ–¹æ³•,å¦‚æœæ²¡æœ‰ä¾èµ–,å°±ä¼šèµ°feign.Client.Default.execute()æ–¹æ³•.okhttpæ²¡ä»€ä¹ˆè¯´çš„,å¯ä»¥çœ‹ä¸€ä¸‹é»˜è®¤çš„Feign Client - Defaultä¸­çš„execute()ä»£ç ç‰‡æ®µ:12345@Override public Response execute(Request request, Options options) throws IOException &#123; HttpURLConnection connection = convertAndSend(request, options); return convertResponse(connection).toBuilder().request(request).build(); &#125; ç”±ä¸Šé¢ä»£ç ç‰‡æ®µå¯ä»¥å¾—å‡º,Spring Cloudé»˜è®¤Feignçš„å®¢æˆ·ç«¯æ˜¯HttpURLConnectionæ„å»ºçš„.éœ€è¦æ³¨æ„çš„æ˜¯,æ— è®ºFeignæ˜¯å“ªç§Client,é»˜è®¤éƒ½æ˜¯å¼€å¯çš„,é‡ç‚¹åœ¨äºclasspathä¸‹çš„ä¾èµ–,è€Œä¸æ˜¯application.ymlé‡Œçš„å¼€å…³é…ç½®.ä¹‹æ‰€ä»¥é…ç½®å¼€å…³æ˜¯å› ä¸ºå…³é—­æ‰æ— ç”¨çš„Client. é»˜è®¤é…ç½®è§£è¯´Feign è¯»å–æ—¶é—´é…ç½®ï¼šé»˜è®¤è¯»å–è¿æ¥æ—¶é—´10s,é»˜è®¤è¿æ¥è¯»å–æ—¶é—´60sæºç :123456789101112131415161718public final class Request &#123; public static class Options &#123; private final int connectTimeoutMillis; private final int readTimeoutMillis; public Options(int connectTimeoutMillis, int readTimeoutMillis) &#123; this.connectTimeoutMillis = connectTimeoutMillis; this.readTimeoutMillis = readTimeoutMillis; &#125; //é»˜è®¤æ„é€ å™¨æ—¶é—´ public Options() &#123; this(10 * 1000, 60 * 1000); &#125; &#125;&#125; æ‰‹åŠ¨è®¾ç½®é»˜è®¤çš„è¯»å–æ—¶é—´å’Œè¿æ¥æ—¶é—´:1234@Beanpublic Request.Options options() &#123; Request.Options options = new Request.Options(5 * 1000, 5 * 1000);&#125; æ‰‹åŠ¨é…ç½®Okhttp312345678910111213141516171819@Configuration@ConditionalOnClass(Feign.class)@AutoConfigureBefore(FeignAutoConfiguration.class)public class FeignOkHttpConfig &#123; @Autowired OkHttpLoggingInterceptor okHttpLoggingInterceptor; @Bean public okhttp3.OkHttpClient okHttpClient()&#123; return new okhttp3.OkHttpClient.Builder() .readTimeout(60, TimeUnit.SECONDS) //è®¾ç½®è¯»å–è¶…æ—¶æ—¶é—´ .connectTimeout(60, TimeUnit.SECONDS) //è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ .writeTimeout(120, TimeUnit.SECONDS) .connectionPool(new ConnectionPool()) // .addInterceptor(); //æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨ .build(); &#125;&#125; å‚è€ƒæ–‡çŒ®:å®˜æ–¹æ–‡æ¡£Feignäº§ç”Ÿçš„é—®é¢˜Feignæºç è§£è¯»","categories":[{"name":"backend","slug":"backend","permalink":"http://ltyeamin.github.io/categories/backend/"}],"tags":[{"name":"Spring Cloud","slug":"Spring-Cloud","permalink":"http://ltyeamin.github.io/tags/Spring-Cloud/"}]},{"title":"ES6æ–°çš„æ•°æ®ç±»å‹-generator","slug":"ES6æ–°çš„æ•°æ®ç±»å‹-generator","date":"2017-12-15T07:39:23.000Z","updated":"2019-05-29T14:03:53.000Z","comments":true,"path":"2017/12/15/ES6æ–°çš„æ•°æ®ç±»å‹-generator/","link":"","permalink":"http://ltyeamin.github.io/2017/12/15/ES6æ–°çš„æ•°æ®ç±»å‹-generator/","excerpt":"","text":"æ–°çš„æ•°æ®ç±»å‹-generatorgeneratorï¼ˆç”Ÿæˆå™¨ï¼‰æ˜¯ES6æ ‡å‡†å¼•å…¥çš„æ–°çš„æ•°æ®ç±»å‹ã€‚ä¸€ä¸ªgeneratorçœ‹ä¸Šå»åƒä¸€ä¸ªå‡½æ•°ï¼Œä½†å¯ä»¥è¿”å›å¤šæ¬¡.ES6å®šä¹‰generatoræ ‡å‡†çš„å“¥ä»¬å€Ÿé‰´äº†Pythonçš„generatorçš„æ¦‚å¿µå’Œè¯­æ³•.æˆ‘ä»¬å…ˆå¤ä¹ å‡½æ•°çš„æ¦‚å¿µã€‚ä¸€ä¸ªå‡½æ•°æ˜¯ä¸€æ®µå®Œæ•´çš„ä»£ç ï¼Œè°ƒç”¨ä¸€ä¸ªå‡½æ•°å°±æ˜¯ä¼ å…¥å‚æ•°ï¼Œç„¶åè¿”å›ç»“æœ:1234function foo(x) &#123; return x + x;&#125;var r = foo(1); // è°ƒç”¨fooå‡½æ•° å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ²¡æœ‰é‡åˆ°returnè¯­å¥ï¼ˆå‡½æ•°æœ«å°¾å¦‚æœæ²¡æœ‰returnï¼Œå°±æ˜¯éšå«çš„return undefined;ï¼‰ï¼Œæ§åˆ¶æƒæ— æ³•äº¤å›è¢«è°ƒç”¨çš„ä»£ç ã€‚generatorè·Ÿå‡½æ•°å¾ˆåƒï¼Œå®šä¹‰å¦‚ä¸‹:12345function* foo(x) &#123; yield x + 1; yield x + 2; return x + 3;&#125; generatorå’Œå‡½æ•°ä¸åŒçš„æ˜¯ï¼Œgeneratorç”±functionå®šä¹‰ï¼ˆæ³¨æ„å¤šå‡ºçš„å·ï¼‰ï¼Œå¹¶ä¸”ï¼Œé™¤äº†returnè¯­å¥ï¼Œè¿˜å¯ä»¥ç”¨yieldè¿”å›å¤šæ¬¡ã€‚å¤§å¤šæ•°åŒå­¦ç«‹åˆ»å°±æ™•äº†ï¼Œgeneratorå°±æ˜¯èƒ½å¤Ÿè¿”å›å¤šæ¬¡çš„â€œå‡½æ•°â€ï¼Ÿè¿”å›å¤šæ¬¡æœ‰å•¥ç”¨ï¼Ÿè¿˜æ˜¯ä¸¾ä¸ªä¾‹å­å§ã€‚æˆ‘ä»¬ä»¥ä¸€ä¸ªè‘—åçš„æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸ºä¾‹ï¼Œå®ƒç”±0ï¼Œ1å¼€å¤´:10 1 1 2 3 5 8 13 21 34 ... è¦ç¼–å†™ä¸€ä¸ªäº§ç”Ÿæ–æ³¢é‚£å¥‘æ•°åˆ—çš„å‡½æ•°ï¼Œå¯ä»¥è¿™ä¹ˆå†™:12345678910111213141516function fib(max) &#123; var t, a = 0, b = 1, arr = [0, 1]; while (arr.length &lt; max) &#123; [a, b] = [b, a + b]; arr.push(b); &#125; return arr;&#125;// æµ‹è¯•:fib(5); // [0, 1, 1, 2, 3]fib(10); // [0, 1, 1, 2, 3, 5, 8, 13, 21, 34] å‡½æ•°åªèƒ½è¿”å›ä¸€æ¬¡ï¼Œæ‰€ä»¥å¿…é¡»è¿”å›ä¸€ä¸ªArrayã€‚ä½†æ˜¯ï¼Œå¦‚æœæ¢æˆgeneratorï¼Œå°±å¯ä»¥ä¸€æ¬¡è¿”å›ä¸€ä¸ªæ•°ï¼Œä¸æ–­è¿”å›å¤šæ¬¡ã€‚ç”¨generatoræ”¹å†™å¦‚ä¸‹:12345678910111213function* fib(max) &#123; var t, a = 0, b = 1, n = 0; while (n &lt; max) &#123; yield a; [a, b] = [b, a + b]; n ++; &#125; return;&#125; ç›´æ¥è°ƒç”¨è¯•è¯•:1fib(5); // fib &#123;[[GeneratorStatus]]: &quot;suspended&quot;, [[GeneratorReceiver]]: Window&#125; ç›´æ¥è°ƒç”¨ä¸€ä¸ªgeneratorå’Œè°ƒç”¨å‡½æ•°ä¸ä¸€æ ·ï¼Œfib(5)ä»…ä»…æ˜¯åˆ›å»ºäº†ä¸€ä¸ªgeneratorå¯¹è±¡ï¼Œè¿˜æ²¡æœ‰å»æ‰§è¡Œå®ƒã€‚è°ƒç”¨generatorå¯¹è±¡æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€æ˜¯ä¸æ–­åœ°è°ƒç”¨generatorå¯¹è±¡çš„next()æ–¹æ³•:1234567var f = fib(5);f.next(); // &#123;value: 0, done: false&#125;f.next(); // &#123;value: 1, done: false&#125;f.next(); // &#123;value: 1, done: false&#125;f.next(); // &#123;value: 2, done: false&#125;f.next(); // &#123;value: 3, done: false&#125;f.next(); // &#123;value: undefined, done: true&#125; next()æ–¹æ³•ä¼šæ‰§è¡Œgeneratorçš„ä»£ç ï¼Œç„¶åï¼Œæ¯æ¬¡é‡åˆ°yield x;å°±è¿”å›ä¸€ä¸ªå¯¹è±¡{value: x, done: true/false}ï¼Œç„¶åâ€œæš‚åœâ€ã€‚è¿”å›çš„valueå°±æ˜¯yieldçš„è¿”å›å€¼ï¼Œdoneè¡¨ç¤ºè¿™ä¸ªgeneratoræ˜¯å¦å·²ç»æ‰§è¡Œç»“æŸäº†ã€‚å¦‚æœdoneä¸ºtrueï¼Œåˆ™valueå°±æ˜¯returnçš„è¿”å›å€¼ã€‚å½“æ‰§è¡Œåˆ°doneä¸ºtrueæ—¶ï¼Œè¿™ä¸ªgeneratorå¯¹è±¡å°±å·²ç»å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œä¸è¦å†ç»§ç»­è°ƒç”¨next()äº†ã€‚ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ç›´æ¥ç”¨for â€¦ ofå¾ªç¯è¿­ä»£generatorå¯¹è±¡ï¼Œè¿™ç§æ–¹å¼ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±åˆ¤æ–­done:123for (var x of fib(10)) &#123; console.log(x); // ä¾æ¬¡è¾“å‡º0, 1, 1, 2, 3, ...&#125; generatorå’Œæ™®é€šå‡½æ•°ç›¸æ¯”ï¼Œæœ‰ä»€ä¹ˆç”¨?å› ä¸ºgeneratorå¯ä»¥åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¤šæ¬¡è¿”å›ï¼Œæ‰€ä»¥å®ƒçœ‹ä¸Šå»å°±åƒä¸€ä¸ªå¯ä»¥è®°ä½æ‰§è¡ŒçŠ¶æ€çš„å‡½æ•°ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå†™ä¸€ä¸ªgeneratorå°±å¯ä»¥å®ç°éœ€è¦ç”¨é¢å‘å¯¹è±¡æ‰èƒ½å®ç°çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œç”¨ä¸€ä¸ªå¯¹è±¡æ¥ä¿å­˜çŠ¶æ€ï¼Œå¾—è¿™ä¹ˆå†™:12345678910111213141516171819var fib = &#123; a: 0, b: 1, n: 0, max: 5, next: function () &#123; var r = this.a, t = this.a + this.b; this.a = this.b; this.b = t; if (this.n &lt; this.max) &#123; this.n ++; return r; &#125; else &#123; return undefined; &#125; &#125;&#125;; ç”¨å¯¹è±¡çš„å±æ€§æ¥ä¿å­˜çŠ¶æ€ï¼Œç›¸å½“ç¹çã€‚generatorè¿˜æœ‰å¦ä¸€ä¸ªå·¨å¤§çš„å¥½å¤„ï¼Œå°±æ˜¯æŠŠå¼‚æ­¥å›è°ƒä»£ç å˜æˆâ€åŒæ­¥â€ä»£ç ã€‚è¿™ä¸ªå¥½å¤„è¦ç­‰åˆ°åé¢å­¦äº†AJAXä»¥åæ‰èƒ½ä½“ä¼šåˆ°ã€‚æ²¡æœ‰generatorä¹‹å‰çš„é»‘æš—æ—¶ä»£ï¼Œç”¨AJAXæ—¶éœ€è¦è¿™ä¹ˆå†™ä»£ç :12345678910111213141516ajax(&apos;http://url-1&apos;, data1, function (err, result) &#123; if (err) &#123; return handle(err); &#125; ajax(&apos;http://url-2&apos;, data2, function (err, result) &#123; if (err) &#123; return handle(err); &#125; ajax(&apos;http://url-3&apos;, data3, function (err, result) &#123; if (err) &#123; return handle(err); &#125; return success(result); &#125;); &#125;);&#125;); å›è°ƒè¶Šå¤šï¼Œä»£ç è¶Šéš¾çœ‹ã€‚æœ‰äº†generatorçš„ç¾å¥½æ—¶ä»£ï¼Œç”¨AJAXæ—¶å¯ä»¥è¿™ä¹ˆå†™:123456789try &#123; r1 = yield ajax(&apos;http://url-1&apos;, data1); r2 = yield ajax(&apos;http://url-2&apos;, data2); r3 = yield ajax(&apos;http://url-3&apos;, data3); success(r3);&#125;catch (err) &#123; handle(err);&#125; çœ‹ä¸Šå»æ˜¯åŒæ­¥çš„ä»£ç ï¼Œå®é™…æ‰§è¡Œæ˜¯å¼‚æ­¥çš„.","categories":[{"name":"frontend","slug":"frontend","permalink":"http://ltyeamin.github.io/categories/frontend/"}],"tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"http://ltyeamin.github.io/tags/JavaScript/"}]},{"title":"ç®­å¤´å‡½æ•°","slug":"ç®­å¤´å‡½æ•°","date":"2017-12-15T07:10:46.000Z","updated":"2019-05-29T14:03:53.000Z","comments":true,"path":"2017/12/15/ç®­å¤´å‡½æ•°/","link":"","permalink":"http://ltyeamin.github.io/2017/12/15/ç®­å¤´å‡½æ•°/","excerpt":"","text":"ç®­å¤´å‡½æ•°ES6æ ‡å‡†æ–°å¢äº†ä¸€ç§æ–°çš„å‡½æ•°ï¼šArrow Functionï¼ˆç®­å¤´å‡½æ•°ï¼‰ã€‚ä¸ºä»€ä¹ˆå«Arrow Functionï¼Ÿå› ä¸ºå®ƒçš„å®šä¹‰ç”¨çš„å°±æ˜¯ä¸€ä¸ªç®­å¤´:12var fn = x =&gt; x * x;alert(fn(5)); //25 ä¸Šé¢çš„ç®­å¤´å‡½æ•°ç›¸å½“äº:1234function (x) &#123; return x * x;&#125;alert(fn(5)); //25 ç®­å¤´å‡½æ•°ç›¸å½“äºåŒ¿åå‡½æ•°ï¼Œå¹¶ä¸”ç®€åŒ–äº†å‡½æ•°å®šä¹‰ã€‚ç®­å¤´å‡½æ•°æœ‰ä¸¤ç§æ ¼å¼ï¼Œä¸€ç§åƒä¸Šé¢çš„ï¼ŒåªåŒ…å«ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿{ â€¦ }å’Œreturnéƒ½çœç•¥æ‰äº†ã€‚è¿˜æœ‰ä¸€ç§å¯ä»¥åŒ…å«å¤šæ¡è¯­å¥ï¼Œè¿™æ—¶å€™å°±ä¸èƒ½çœç•¥{ â€¦ }å’Œreturn:12345678x =&gt; &#123; if (x &gt; 0) &#123; return x * x; &#125; else &#123; return - x * x; &#125;&#125; å¦‚æœå‚æ•°ä¸æ˜¯ä¸€ä¸ªï¼Œå°±éœ€è¦ç”¨æ‹¬å·()æ‹¬èµ·æ¥:1234567891011121314// ä¸¤ä¸ªå‚æ•°:(x, y) =&gt; x * x + y * y// æ— å‚æ•°:() =&gt; 3.14// å¯å˜å‚æ•°:(x, y, ...rest) =&gt; &#123; var i, sum = x + y; for (i=0; i&lt;rest.length; i++) &#123; sum += rest[i]; &#125; return sum;&#125; å¦‚æœè¦è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå°±è¦æ³¨æ„ï¼Œå¦‚æœæ˜¯å•è¡¨è¾¾å¼ï¼Œè¿™ä¹ˆå†™çš„è¯ä¼šæŠ¥é”™:12// SyntaxError:x =&gt; &#123; foo: x &#125; å› ä¸ºå’Œå‡½æ•°ä½“çš„{ â€¦ }æœ‰è¯­æ³•å†²çªï¼Œæ‰€ä»¥è¦æ”¹ä¸º:12// ok:x =&gt; (&#123; foo: x &#125;) è§£å†³thisç»‘å®šé”™è¯¯çš„é—®é¢˜ç®­å¤´å‡½æ•°çœ‹ä¸Šå»æ˜¯åŒ¿åå‡½æ•°çš„ä¸€ç§ç®€å†™ï¼Œä½†å®é™…ä¸Šï¼Œç®­å¤´å‡½æ•°å’ŒåŒ¿åå‡½æ•°æœ‰ä¸ªæ˜æ˜¾çš„åŒºåˆ«ï¼šç®­å¤´å‡½æ•°å†…éƒ¨çš„thisæ˜¯è¯æ³•ä½œç”¨åŸŸï¼Œç”±ä¸Šä¸‹æ–‡ç¡®å®šã€‚å›é¡¾å‰é¢çš„ä¾‹å­ï¼Œç”±äºJavaScriptå‡½æ•°å¯¹thisç»‘å®šçš„é”™è¯¯å¤„ç†ï¼Œä¸‹é¢çš„ä¾‹å­æ— æ³•å¾—åˆ°é¢„æœŸç»“æœ:12345678910var obj = &#123; birth: 1990, getAge: function () &#123; var b = this.birth; // 1990 var fn = function () &#123; return new Date().getFullYear() - this.birth; // thisæŒ‡å‘windowæˆ–undefined &#125;; return fn(); &#125;&#125;; ç°åœ¨ï¼Œç®­å¤´å‡½æ•°å®Œå…¨ä¿®å¤äº†thisçš„æŒ‡å‘ï¼Œthisæ€»æ˜¯æŒ‡å‘è¯æ³•ä½œç”¨åŸŸï¼Œä¹Ÿå°±æ˜¯å¤–å±‚è°ƒç”¨è€…obj:123456789var obj = &#123; birth: 1990, getAge: function () &#123; var b = this.birth; // 1990 var fn = () =&gt; new Date().getFullYear() - this.birth; // thisæŒ‡å‘objå¯¹è±¡ return fn(); &#125;&#125;;obj.getAge(); // 25 å¦‚æœä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œä»¥å‰çš„é‚£ç§hackå†™æ³•:1var that = this; å°±ä¸å†éœ€è¦äº†ã€‚ç”±äºthisåœ¨ç®­å¤´å‡½æ•°ä¸­å·²ç»æŒ‰ç…§è¯æ³•ä½œç”¨åŸŸç»‘å®šäº†ï¼Œæ‰€ä»¥ï¼Œç”¨call()æˆ–è€…apply()è°ƒç”¨ç®­å¤´å‡½æ•°æ—¶ï¼Œæ— æ³•å¯¹thisè¿›è¡Œç»‘å®šï¼Œå³ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°è¢«å¿½ç•¥:123456789var obj = &#123; birth: 1990, getAge: function (year) &#123; var b = this.birth; // 1990 var fn = (y) =&gt; y - this.birth; // this.birthä»æ˜¯1990 return fn.call(&#123;birth:2000&#125;, year); &#125;&#125;;obj.getAge(2015); // 25","categories":[{"name":"frontend","slug":"frontend","permalink":"http://ltyeamin.github.io/categories/frontend/"}],"tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"http://ltyeamin.github.io/tags/JavaScript/"}]},{"title":"é—­åŒ…","slug":"é—­åŒ…","date":"2017-12-13T09:54:10.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2017/12/13/é—­åŒ…/","link":"","permalink":"http://ltyeamin.github.io/2017/12/13/é—­åŒ…/","excerpt":"","text":"å‡½æ•°ä½œä¸ºè¿”å›å€¼é«˜é˜¶å‡½æ•°é™¤äº†å¯ä»¥æ¥å—å‡½æ•°ä½œä¸ºå‚æ•°å¤–ï¼Œè¿˜å¯ä»¥æŠŠå‡½æ•°ä½œä¸ºç»“æœå€¼è¿”å›ã€‚æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªå¯¹Arrayçš„æ±‚å’Œã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ±‚å’Œçš„å‡½æ•°æ˜¯è¿™æ ·å®šä¹‰çš„:123456function sum(arr) &#123; return arr.reduce(function (x, y) &#123; return x + y; &#125;);&#125;sum([1, 2, 3, 4, 5]); // 15 ä½†æ˜¯ï¼Œå¦‚æœä¸éœ€è¦ç«‹åˆ»æ±‚å’Œï¼Œè€Œæ˜¯åœ¨åé¢çš„ä»£ç ä¸­ï¼Œæ ¹æ®éœ€è¦å†è®¡ç®—æ€ä¹ˆåŠï¼Ÿå¯ä»¥ä¸è¿”å›æ±‚å’Œçš„ç»“æœï¼Œè€Œæ˜¯è¿”å›æ±‚å’Œçš„å‡½æ•°!12345678function lazy_sum(arr) &#123; var sum = function () &#123; return arr.reduce(function (x, y) &#123; return x + y; &#125;); &#125; return sum;&#125; å½“æˆ‘ä»¬è°ƒç”¨lazy_sum()æ—¶ï¼Œè¿”å›çš„å¹¶ä¸æ˜¯æ±‚å’Œç»“æœï¼Œè€Œæ˜¯æ±‚å’Œå‡½æ•°:1var f = lazy_sum([1, 2, 3, 4, 5]); // function sum() è°ƒç”¨å‡½æ•°fæ—¶ï¼Œæ‰çœŸæ­£è®¡ç®—æ±‚å’Œçš„ç»“æœ:1f(); // 15 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°lazy_sumä¸­åˆå®šä¹‰äº†å‡½æ•°sumï¼Œå¹¶ä¸”ï¼Œå†…éƒ¨å‡½æ•°sumå¯ä»¥å¼•ç”¨å¤–éƒ¨å‡½æ•°lazy_sumçš„å‚æ•°å’Œå±€éƒ¨å˜é‡ï¼Œå½“lazy_sumè¿”å›å‡½æ•°sumæ—¶ï¼Œç›¸å…³å‚æ•°å’Œå˜é‡éƒ½ä¿å­˜åœ¨è¿”å›çš„å‡½æ•°ä¸­ï¼Œè¿™ç§ç§°ä¸ºâ€œé—­åŒ…ï¼ˆClosureï¼‰â€çš„ç¨‹åºç»“æ„æ‹¥æœ‰æå¤§çš„å¨åŠ›ã€‚è¯·å†æ³¨æ„ä¸€ç‚¹ï¼Œå½“æˆ‘ä»¬è°ƒç”¨lazy_sum()æ—¶ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå³ä½¿ä¼ å…¥ç›¸åŒçš„å‚æ•°:123var f1 = lazy_sum([1, 2, 3, 4, 5]);var f2 = lazy_sum([1, 2, 3, 4, 5]);f1 === f2; // false f1()å’Œf2()çš„è°ƒç”¨ç»“æœäº’ä¸å½±å“ã€‚ é—­åŒ…æ³¨æ„åˆ°è¿”å›çš„å‡½æ•°åœ¨å…¶å®šä¹‰å†…éƒ¨å¼•ç”¨äº†å±€éƒ¨å˜é‡arrï¼Œæ‰€ä»¥ï¼Œå½“ä¸€ä¸ªå‡½æ•°è¿”å›äº†ä¸€ä¸ªå‡½æ•°åï¼Œå…¶å†…éƒ¨çš„å±€éƒ¨å˜é‡è¿˜è¢«æ–°å‡½æ•°å¼•ç”¨ï¼Œæ‰€ä»¥ï¼Œé—­åŒ…ç”¨èµ·æ¥ç®€å•ï¼Œå®ç°èµ·æ¥å¯ä¸å®¹æ˜“ã€‚å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯ï¼Œè¿”å›çš„å‡½æ•°å¹¶æ²¡æœ‰ç«‹åˆ»æ‰§è¡Œï¼Œè€Œæ˜¯ç›´åˆ°è°ƒç”¨äº†f()æ‰æ‰§è¡Œã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­:12345678910111213function count() &#123; var arr = []; for (var i=1; i&lt;=3; i++) &#123; arr.push(function () &#123; return i * i; &#125;); &#125; return arr;&#125;var results = count();var f1 = results[0];var f2 = results[1];var f3 = results[2]; åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ¯æ¬¡å¾ªç¯ï¼Œéƒ½åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œç„¶åï¼ŒæŠŠåˆ›å»ºçš„3ä¸ªå‡½æ•°éƒ½æ·»åŠ åˆ°ä¸€ä¸ªArrayä¸­è¿”å›äº†ã€‚ä½ å¯èƒ½è®¤ä¸ºè°ƒç”¨f1()ï¼Œf2()å’Œf3()ç»“æœåº”è¯¥æ˜¯1ï¼Œ4ï¼Œ9ï¼Œä½†å®é™…ç»“æœæ˜¯:123f1(); // 16f2(); // 16f3(); // 16 å…¨éƒ¨éƒ½æ˜¯16ï¼åŸå› å°±åœ¨äºè¿”å›çš„å‡½æ•°å¼•ç”¨äº†å˜é‡iï¼Œä½†å®ƒå¹¶éç«‹åˆ»æ‰§è¡Œã€‚ç­‰åˆ°3ä¸ªå‡½æ•°éƒ½è¿”å›æ—¶ï¼Œå®ƒä»¬æ‰€å¼•ç”¨çš„å˜é‡iå·²ç»å˜æˆäº†4ï¼Œå› æ­¤æœ€ç»ˆç»“æœä¸º16ã€‚è¿”å›é—­åŒ…æ—¶ç‰¢è®°çš„ä¸€ç‚¹å°±æ˜¯ï¼šè¿”å›å‡½æ•°ä¸è¦å¼•ç”¨ä»»ä½•å¾ªç¯å˜é‡ï¼Œæˆ–è€…åç»­ä¼šå‘ç”Ÿå˜åŒ–çš„å˜é‡ã€‚å¦‚æœä¸€å®šè¦å¼•ç”¨å¾ªç¯å˜é‡æ€ä¹ˆåŠï¼Ÿæ–¹æ³•æ˜¯å†åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œç”¨è¯¥å‡½æ•°çš„å‚æ•°ç»‘å®šå¾ªç¯å˜é‡å½“å‰çš„å€¼ï¼Œæ— è®ºè¯¥å¾ªç¯å˜é‡åç»­å¦‚ä½•æ›´æ”¹ï¼Œå·²ç»‘å®šåˆ°å‡½æ•°å‚æ•°çš„å€¼ä¸å˜:123456789101112131415161718function count() &#123; var arr = []; for (var i=1; i&lt;=3; i++) &#123; arr.push((function (n) &#123; return function () &#123; return n * n; &#125; &#125;)(i)); &#125; return arr;&#125;var results = count();var f1 = results[0];var f2 = results[1];var f3 = results[2];f1(); // 1f2(); // 4f3(); // 9 æ³¨æ„è¿™é‡Œç”¨äº†ä¸€ä¸ªâ€åˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°å¹¶ç«‹åˆ»æ‰§è¡Œâ€çš„è¯­æ³•:(function (x) { return x * x;})(3); // 9ç†è®ºä¸Šè®²ï¼Œåˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°å¹¶ç«‹åˆ»æ‰§è¡Œå¯ä»¥è¿™ä¹ˆå†™:1function (x) &#123; return x * x &#125; (3); ä½†æ˜¯ç”±äºJavaScriptè¯­æ³•è§£æçš„é—®é¢˜ï¼Œä¼šæŠ¥SyntaxErroré”™è¯¯ï¼Œå› æ­¤éœ€è¦ç”¨æ‹¬å·æŠŠæ•´ä¸ªå‡½æ•°å®šä¹‰æ‹¬èµ·æ¥:1(function (x) &#123; return x * x &#125;) (3); é€šå¸¸ï¼Œä¸€ä¸ªç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°å¯ä»¥æŠŠå‡½æ•°ä½“æ‹†å¼€ï¼Œä¸€èˆ¬è¿™ä¹ˆå†™:123(function (x) &#123; return x * x;&#125;)(3); è¯´äº†è¿™ä¹ˆå¤šï¼Œéš¾é“é—­åŒ…å°±æ˜¯ä¸ºäº†è¿”å›ä¸€ä¸ªå‡½æ•°ç„¶åå»¶è¿Ÿæ‰§è¡Œå—?å½“ç„¶ä¸æ˜¯ï¼é—­åŒ…æœ‰éå¸¸å¼ºå¤§çš„åŠŸèƒ½ã€‚ä¸¾ä¸ªä¾‹å­ï¼šåœ¨é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡è¯­è¨€é‡Œï¼Œæ¯”å¦‚Javaå’ŒC++ï¼Œè¦åœ¨å¯¹è±¡å†…éƒ¨å°è£…ä¸€ä¸ªç§æœ‰å˜é‡ï¼Œå¯ä»¥ç”¨privateä¿®é¥°ä¸€ä¸ªæˆå‘˜å˜é‡ã€‚åœ¨æ²¡æœ‰classæœºåˆ¶ï¼Œåªæœ‰å‡½æ•°çš„è¯­è¨€é‡Œï¼Œå€ŸåŠ©é—­åŒ…ï¼ŒåŒæ ·å¯ä»¥å°è£…ä¸€ä¸ªç§æœ‰å˜é‡ã€‚æˆ‘ä»¬ç”¨JavaScriptåˆ›å»ºä¸€ä¸ªè®¡æ•°å™¨ï¼š123456789function create_counter(initial) &#123; var x = initial || 0; return &#123; inc: function () &#123; x += 1; return x; &#125; &#125;&#125; å®ƒç”¨èµ·æ¥åƒè¿™æ ·:12345678var c1 = create_counter();c1.inc(); // 1c1.inc(); // 2c1.inc(); // 3var c2 = create_counter(10);c2.inc(); // 11c2.inc(); // 12c2.inc(); // 13 åœ¨è¿”å›çš„å¯¹è±¡ä¸­ï¼Œå®ç°äº†ä¸€ä¸ªé—­åŒ…ï¼Œè¯¥é—­åŒ…æºå¸¦äº†å±€éƒ¨å˜é‡xï¼Œå¹¶ä¸”ï¼Œä»å¤–éƒ¨ä»£ç æ ¹æœ¬æ— æ³•è®¿é—®åˆ°å˜é‡xã€‚æ¢å¥è¯è¯´ï¼Œé—­åŒ…å°±æ˜¯æºå¸¦çŠ¶æ€çš„å‡½æ•°ï¼Œå¹¶ä¸”å®ƒçš„çŠ¶æ€å¯ä»¥å®Œå…¨å¯¹å¤–éšè—èµ·æ¥ã€‚é—­åŒ…è¿˜å¯ä»¥æŠŠå¤šå‚æ•°çš„å‡½æ•°å˜æˆå•å‚æ•°çš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œè¦è®¡ç®—xyå¯ä»¥ç”¨Math.pow(x, y)å‡½æ•°ï¼Œä¸è¿‡è€ƒè™‘åˆ°ç»å¸¸è®¡ç®—x2æˆ–x3ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨é—­åŒ…åˆ›å»ºæ–°çš„å‡½æ•°pow2å’Œpow3:1234567891011&apos;use strict&apos;;function make_pow(n) &#123; return function (x) &#123; return Math.pow(x, n); &#125;&#125;// åˆ›å»ºä¸¤ä¸ªæ–°å‡½æ•°:var pow2 = make_pow(2);var pow3 = make_pow(3);console.log(pow2(5)); // 25console.log(pow3(7)); // 343","categories":[{"name":"frontend","slug":"frontend","permalink":"http://ltyeamin.github.io/categories/frontend/"}],"tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"http://ltyeamin.github.io/tags/JavaScript/"}]},{"title":"é«˜é˜¶å‡½æ•°","slug":"é«˜é˜¶å‡½æ•°","date":"2017-12-13T08:37:15.000Z","updated":"2019-05-29T14:03:53.000Z","comments":true,"path":"2017/12/13/é«˜é˜¶å‡½æ•°/","link":"","permalink":"http://ltyeamin.github.io/2017/12/13/é«˜é˜¶å‡½æ•°/","excerpt":"","text":"é«˜é˜¶å‡½æ•°æ¦‚è¿°é«˜é˜¶å‡½æ•°è‹±æ–‡å«Higher-order functionã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°ï¼ŸJavaScriptçš„å‡½æ•°å…¶å®éƒ½æŒ‡å‘æŸä¸ªå˜é‡ã€‚æ—¢ç„¶å˜é‡å¯ä»¥æŒ‡å‘å‡½æ•°ï¼Œå‡½æ•°çš„å‚æ•°èƒ½æ¥æ”¶å˜é‡ï¼Œé‚£ä¹ˆä¸€ä¸ªå‡½æ•°å°±å¯ä»¥æ¥æ”¶å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ç§å‡½æ•°å°±ç§°ä¹‹ä¸ºé«˜é˜¶å‡½æ•°ã€‚ä¸€ä¸ªæœ€ç®€å•çš„é«˜é˜¶å‡½æ•°: 12345function add(x, y, f) &#123; return f(x) + f(y);&#125;var x = add(-5, 6, Math.abs); console.log(x); // 11 å½“æˆ‘ä»¬è°ƒç”¨add(-5, 6, Math.abs)æ—¶ï¼Œå‚æ•°xï¼Œyå’Œfåˆ†åˆ«æ¥æ”¶-5ï¼Œ6å’Œå‡½æ•°Math.absï¼Œæ ¹æ®å‡½æ•°å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼è®¡ç®—è¿‡ç¨‹ä¸º:123456//åˆ†ææ€è·¯x = -5;y = 6;f = Math.abs;f(x) + f(y) ==&gt; Math.abs(-5) + Math.abs(6) ==&gt; 11;return 11; ç¼–å†™é«˜é˜¶å‡½æ•°ï¼Œå°±æ˜¯è®©å‡½æ•°çš„å‚æ•°èƒ½å¤Ÿæ¥æ”¶åˆ«çš„å‡½æ•°. map/reduceä¸¾ä¾‹è¯´æ˜ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°f(x)=$x^2â€‹$ï¼Œè¦æŠŠè¿™ä¸ªå‡½æ•°ä½œç”¨åœ¨ä¸€ä¸ªæ•°ç»„[1, 2, 3, 4, 5, 6, 7, 8, 9]ä¸Šï¼Œå°±å¯ä»¥ç”¨mapå®ç°å¦‚ä¸‹å›¾:ç”±äºmap()æ–¹æ³•å®šä¹‰åœ¨JavaScriptçš„Arrayä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨Arrayçš„map()æ–¹æ³•ï¼Œä¼ å…¥æˆ‘ä»¬è‡ªå·±çš„å‡½æ•°ï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªæ–°çš„Arrayä½œä¸ºç»“æœ:12345678&apos;use strict&apos;;function pow(x) &#123; return x * x;&#125;var arr = [1, 2, 3, 4, 5, 6, 7, 8, 9];var results = arr.map(pow); // [1, 4, 9, 16, 25, 36, 49, 64, 81]console.log(results); æ³¨æ„ï¼šmap()ä¼ å…¥çš„å‚æ•°æ˜¯powï¼Œå³å‡½æ•°å¯¹è±¡æœ¬èº«.ä½ å¯èƒ½ä¼šæƒ³ï¼Œä¸éœ€è¦map()ï¼Œå†™ä¸€ä¸ªå¾ªç¯ï¼Œä¹Ÿå¯ä»¥è®¡ç®—å‡ºç»“æœ:12345678var f = function (x) &#123; return x * x;&#125;;var arr = [1, 2, 3, 4, 5, 6, 7, 8, 9];var result = [];for (var i=0; i&lt;arr.length; i++) &#123; result.push(f(arr[i]));&#125; çš„ç¡®å¯ä»¥ï¼Œä½†æ˜¯ï¼Œä»ä¸Šé¢çš„å¾ªç¯ä»£ç ï¼Œæˆ‘ä»¬æ— æ³•ä¸€çœ¼çœ‹æ˜ç™½â€œæŠŠf(x)ä½œç”¨åœ¨Arrayçš„æ¯ä¸€ä¸ªå…ƒç´ å¹¶æŠŠç»“æœç”Ÿæˆä¸€ä¸ªæ–°çš„Arrayâ€ã€‚æ‰€ä»¥ï¼Œmap()ä½œä¸ºé«˜é˜¶å‡½æ•°ï¼Œäº‹å®ä¸Šå®ƒæŠŠè¿ç®—è§„åˆ™æŠ½è±¡äº†ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¸ä½†å¯ä»¥è®¡ç®—ç®€å•çš„f(x)=x2ï¼Œè¿˜å¯ä»¥è®¡ç®—ä»»æ„å¤æ‚çš„å‡½æ•°ï¼Œæ¯”å¦‚ï¼ŒæŠŠArrayçš„æ‰€æœ‰æ•°å­—è½¬ä¸ºå­—ç¬¦ä¸²ï¼š12var arr = [1, 2, 3, 4, 5, 6, 7, 8, 9];arr.map(String); // [&apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;] åªéœ€è¦ä¸€è¡Œä»£ç ã€‚å†çœ‹reduceçš„ç”¨æ³•ã€‚Arrayçš„reduce()æŠŠä¸€ä¸ªå‡½æ•°ä½œç”¨åœ¨è¿™ä¸ªArrayçš„[x1, x2, x3â€¦]ä¸Šï¼Œè¿™ä¸ªå‡½æ•°å¿…é¡»æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œreduce()æŠŠç»“æœç»§ç»­å’Œåºåˆ—çš„ä¸‹ä¸€ä¸ªå…ƒç´ åšç´¯ç§¯è®¡ç®—ï¼Œå…¶æ•ˆæœå°±æ˜¯:1[x1, x2, x3, x4].reduce(f) = f(f(f(x1, x2), x3), x4) æ¯”æ–¹è¯´å¯¹ä¸€ä¸ªArrayæ±‚å’Œï¼Œå°±å¯ä»¥ç”¨reduceå®ç°1234var arr = [1, 3, 5, 7, 9];arr.reduce(function (x, y) &#123; return x + y;&#125;); // 25 è¦æŠŠ[1, 3, 5, 7, 9]å˜æ¢æˆæ•´æ•°13579ï¼Œreduce()ä¹Ÿèƒ½æ´¾ä¸Šç”¨åœº:1234var arr = [1, 3, 5, 7, 9];arr.reduce(function (x, y) &#123; return x * 10 + y;&#125;); // 13579 filterfilterä¹Ÿæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ“ä½œï¼Œå®ƒç”¨äºæŠŠArrayçš„æŸäº›å…ƒç´ è¿‡æ»¤æ‰ï¼Œç„¶åè¿”å›å‰©ä¸‹çš„å…ƒç´ ã€‚å’Œmap()ç±»ä¼¼ï¼ŒArrayçš„filter()ä¹Ÿæ¥æ”¶ä¸€ä¸ªå‡½æ•°ã€‚å’Œmap()ä¸åŒçš„æ˜¯ï¼Œfilter()æŠŠä¼ å…¥çš„å‡½æ•°ä¾æ¬¡ä½œç”¨äºæ¯ä¸ªå…ƒç´ ï¼Œç„¶åæ ¹æ®è¿”å›å€¼æ˜¯trueè¿˜æ˜¯falseå†³å®šä¿ç•™è¿˜æ˜¯ä¸¢å¼ƒè¯¥å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªArrayä¸­ï¼Œåˆ æ‰å¶æ•°ï¼Œåªä¿ç•™å¥‡æ•°ï¼Œå¯ä»¥è¿™ä¹ˆå†™:12345var arr = [1, 2, 4, 5, 6, 9, 10, 15];var r = arr.filter(function (x) &#123; return x % 2 !== 0;&#125;);r; // [1, 5, 9, 15] æŠŠä¸€ä¸ªArrayä¸­çš„ç©ºå­—ç¬¦ä¸²åˆ æ‰ï¼Œå¯ä»¥è¿™ä¹ˆå†™:12345var arr = [&apos;A&apos;, &apos;&apos;, &apos;B&apos;, null, undefined, &apos;C&apos;, &apos; &apos;];var r = arr.filter(function (s) &#123; return s &amp;&amp; s.trim(); // æ³¨æ„ï¼šIE9ä»¥ä¸‹çš„ç‰ˆæœ¬æ²¡æœ‰trim()æ–¹æ³•&#125;);r; // [&apos;A&apos;, &apos;B&apos;, &apos;C&apos;] å¯è§ç”¨filter()è¿™ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå…³é”®åœ¨äºæ­£ç¡®å®ç°ä¸€ä¸ªâ€ç­›é€‰â€å‡½æ•°. å›è°ƒå‡½æ•°filter()æ¥æ”¶çš„å›è°ƒå‡½æ•°ï¼Œå…¶å®å¯ä»¥æœ‰å¤šä¸ªå‚æ•°ã€‚é€šå¸¸æˆ‘ä»¬ä»…ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºArrayçš„æŸä¸ªå…ƒç´ ã€‚å›è°ƒå‡½æ•°è¿˜å¯ä»¥æ¥æ”¶å¦å¤–ä¸¤ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºå…ƒç´ çš„ä½ç½®å’Œæ•°ç»„æœ¬èº«ï¼š1234567var arr = [&apos;A&apos;, &apos;B&apos;, &apos;C&apos;];var r = arr.filter(function (element, index, self) &#123; console.log(element); // ä¾æ¬¡æ‰“å°&apos;A&apos;, &apos;B&apos;, &apos;C&apos; console.log(index); // ä¾æ¬¡æ‰“å°0, 1, 2 console.log(self); // selfå°±æ˜¯å˜é‡arr return true;&#125;); åˆ©ç”¨filterï¼Œå¯ä»¥å·§å¦™åœ°å»é™¤Arrayçš„é‡å¤å…ƒç´ :123456&apos;use strict&apos;;var r,arr = [&apos;apple&apos;, &apos;strawberry&apos;, &apos;banana&apos;, &apos;pear&apos;, &apos;apple&apos;, &apos;orange&apos;, &apos;orange&apos;, &apos;strawberry&apos;];r = arr.filter(function (element, index, self) &#123; return self.indexOf(element) === index;&#125;);console.log(r.toString()); //apple,strawberry,banana,pear,orange å»é™¤é‡å¤å…ƒç´ ä¾é çš„æ˜¯indexOfæ€»æ˜¯è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œåç»­çš„é‡å¤å…ƒç´ ä½ç½®ä¸indexOfè¿”å›çš„ä½ç½®ä¸ç›¸ç­‰ï¼Œå› æ­¤è¢«filteræ»¤æ‰äº†. sortæ’åºç®—æ³•æ’åºä¹Ÿæ˜¯åœ¨ç¨‹åºä¸­ç»å¸¸ç”¨åˆ°çš„ç®—æ³•ã€‚æ— è®ºä½¿ç”¨å†’æ³¡æ’åºè¿˜æ˜¯å¿«é€Ÿæ’åºï¼Œæ’åºçš„æ ¸å¿ƒæ˜¯æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ çš„å¤§å°ã€‚å¦‚æœæ˜¯æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ¯”è¾ƒï¼Œä½†å¦‚æœæ˜¯å­—ç¬¦ä¸²æˆ–è€…ä¸¤ä¸ªå¯¹è±¡å‘¢ï¼Ÿç›´æ¥æ¯”è¾ƒæ•°å­¦ä¸Šçš„å¤§å°æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› æ­¤ï¼Œæ¯”è¾ƒçš„è¿‡ç¨‹å¿…é¡»é€šè¿‡å‡½æ•°æŠ½è±¡å‡ºæ¥ã€‚é€šå¸¸è§„å®šï¼Œå¯¹äºä¸¤ä¸ªå…ƒç´ xå’Œyï¼Œå¦‚æœè®¤ä¸ºx &lt; yï¼Œåˆ™è¿”å›-1ï¼Œå¦‚æœè®¤ä¸ºx == yï¼Œåˆ™è¿”å›0ï¼Œå¦‚æœè®¤ä¸ºx &gt; yï¼Œåˆ™è¿”å›1ï¼Œè¿™æ ·ï¼Œæ’åºç®—æ³•å°±ä¸ç”¨å…³å¿ƒå…·ä½“çš„æ¯”è¾ƒè¿‡ç¨‹ï¼Œè€Œæ˜¯æ ¹æ®æ¯”è¾ƒç»“æœç›´æ¥æ’åºã€‚JavaScriptçš„Arrayçš„sort()æ–¹æ³•å°±æ˜¯ç”¨äºæ’åºçš„ï¼Œä½†æ˜¯æ’åºç»“æœå¯èƒ½è®©ä½ å¤§åƒä¸€æƒŠ:123456// çœ‹ä¸Šå»æ­£å¸¸çš„ç»“æœ:[&apos;Google&apos;, &apos;Apple&apos;, &apos;Microsoft&apos;].sort(); // [&apos;Apple&apos;, &apos;Google&apos;, &apos;Microsoft&apos;];// appleæ’åœ¨äº†æœ€å:[&apos;Google&apos;, &apos;apple&apos;, &apos;Microsoft&apos;].sort(); // [&apos;Google&apos;, &apos;Microsoft&quot;, &apos;apple&apos;]// æ— æ³•ç†è§£çš„ç»“æœ:[10, 20, 1, 2].sort(); // [1, 10, 2, 20] ç¬¬äºŒä¸ªæ’åºæŠŠappleæ’åœ¨äº†æœ€åï¼Œæ˜¯å› ä¸ºå­—ç¬¦ä¸²æ ¹æ®ASCIIç è¿›è¡Œæ’åºï¼Œè€Œå°å†™å­—æ¯açš„ASCIIç åœ¨å¤§å†™å­—æ¯ä¹‹åã€‚ç¬¬ä¸‰ä¸ªæ’åºç»“æœæ˜¯ä»€ä¹ˆé¬¼ï¼Ÿç®€å•çš„æ•°å­—æ’åºéƒ½èƒ½é”™ï¼Ÿè¿™æ˜¯å› ä¸ºArrayçš„sort()æ–¹æ³•é»˜è®¤æŠŠæ‰€æœ‰å…ƒç´ å…ˆè½¬æ¢ä¸ºStringå†æ’åºï¼Œç»“æœâ€™10â€™æ’åœ¨äº†â€™2â€™çš„å‰é¢ï¼Œå› ä¸ºå­—ç¬¦â€™1â€™æ¯”å­—ç¬¦â€™2â€™çš„ASCIIç å°ã€‚å¦‚æœä¸çŸ¥é“sort()æ–¹æ³•çš„é»˜è®¤æ’åºè§„åˆ™ï¼Œç›´æ¥å¯¹æ•°å­—æ’åºï¼Œç»å¯¹æ ½è¿›å‘é‡Œï¼å¹¸è¿çš„æ˜¯ï¼Œsort()æ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒè¿˜å¯ä»¥æ¥æ”¶ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°æ¥å®ç°è‡ªå®šä¹‰çš„æ’åºã€‚è¦æŒ‰æ•°å­—å¤§å°æ’åºï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™:123456789101112&apos;use strict&apos;;var arr = [10, 20, 1, 2];arr.sort(function (x, y) &#123; if (x &lt; y) &#123; return -1; &#125; if (x &gt; y) &#123; return 1; &#125; return 0;&#125;);console.log(arr); // [1, 2, 10, 20] å¦‚æœè¦å€’åºæ’åºï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤§çš„æ•°æ”¾å‰é¢:12345678910var arr = [10, 20, 1, 2];arr.sort(function (x, y) &#123; if (x &lt; y) &#123; return 1; &#125; if (x &gt; y) &#123; return -1; &#125; return 0;&#125;); // [20, 10, 2, 1] é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹å­—ç¬¦ä¸²æ’åºï¼Œæ˜¯æŒ‰ç…§ASCIIçš„å¤§å°æ¯”è¾ƒçš„ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬æå‡ºæ’åºåº”è¯¥å¿½ç•¥å¤§å°å†™ï¼ŒæŒ‰ç…§å­—æ¯åºæ’åºã€‚è¦å®ç°è¿™ä¸ªç®—æ³•ï¼Œä¸å¿…å¯¹ç°æœ‰ä»£ç å¤§åŠ æ”¹åŠ¨ï¼Œåªè¦æˆ‘ä»¬èƒ½å®šä¹‰å‡ºå¿½ç•¥å¤§å°å†™çš„æ¯”è¾ƒç®—æ³•å°±å¯ä»¥:123456789101112var arr = [&apos;Google&apos;, &apos;apple&apos;, &apos;Microsoft&apos;];arr.sort(function (s1, s2) &#123; x1 = s1.toUpperCase(); x2 = s2.toUpperCase(); if (x1 &lt; x2) &#123; return -1; &#125; if (x1 &gt; x2) &#123; return 1; &#125; return 0;&#125;); // [&apos;apple&apos;, &apos;Google&apos;, &apos;Microsoft&apos;] å¿½ç•¥å¤§å°å†™æ¥æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå®é™…ä¸Šå°±æ˜¯å…ˆæŠŠå­—ç¬¦ä¸²éƒ½å˜æˆå¤§å†™ï¼ˆæˆ–è€…éƒ½å˜æˆå°å†™ï¼‰ï¼Œå†æ¯”è¾ƒã€‚ä»ä¸Šè¿°ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œé«˜é˜¶å‡½æ•°çš„æŠ½è±¡èƒ½åŠ›æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œè€Œä¸”ï¼Œæ ¸å¿ƒä»£ç å¯ä»¥ä¿æŒå¾—éå¸¸ç®€æ´ã€‚æœ€åå‹æƒ…æç¤ºï¼Œsort()æ–¹æ³•ä¼šç›´æ¥å¯¹Arrayè¿›è¡Œä¿®æ”¹ï¼Œå®ƒè¿”å›çš„ç»“æœä»æ˜¯å½“å‰Array:12345var a1 = [&apos;B&apos;, &apos;A&apos;, &apos;C&apos;];var a2 = a1.sort();a1; // [&apos;A&apos;, &apos;B&apos;, &apos;C&apos;]a2; // [&apos;A&apos;, &apos;B&apos;, &apos;C&apos;]a1 === a2; // true, a1å’Œa2æ˜¯åŒä¸€å¯¹è±¡","categories":[{"name":"frontend","slug":"frontend","permalink":"http://ltyeamin.github.io/categories/frontend/"}],"tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"http://ltyeamin.github.io/tags/JavaScript/"}]},{"title":"JSæ–¹æ³•","slug":"JSæ–¹æ³•","date":"2017-12-13T08:18:31.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2017/12/13/JSæ–¹æ³•/","link":"","permalink":"http://ltyeamin.github.io/2017/12/13/JSæ–¹æ³•/","excerpt":"","text":"å¯¹è±¡çš„æ–¹æ³•åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ç»‘å®šå‡½æ•°ï¼Œç§°ä¸ºè¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚åœ¨JavaScriptä¸­ï¼Œå¯¹è±¡çš„å®šä¹‰æ˜¯è¿™æ ·çš„:1234var xiaoming = &#123; name: &apos;å°æ˜&apos;, birth: 1990&#125;; ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ç»™xiaomingç»‘å®šä¸€ä¸ªå‡½æ•°ï¼Œå°±å¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€‚æ¯”å¦‚ï¼Œå†™ä¸ªage()æ–¹æ³•ï¼Œè¿”å›xiaomingçš„å¹´é¾„:1234567891011var xiaoming = &#123; name: &apos;å°æ˜&apos;, birth: 1990, age: function () &#123; var y = new Date().getFullYear(); return y - this.birth; &#125;&#125;;xiaoming.age; // function xiaoming.age()xiaoming.age(); // ä»Šå¹´è°ƒç”¨æ˜¯25,æ˜å¹´è°ƒç”¨å°±å˜æˆ26äº† ç»‘å®šåˆ°å¯¹è±¡ä¸Šçš„å‡½æ•°ç§°ä¸ºæ–¹æ³•ï¼Œå’Œæ™®é€šå‡½æ•°ä¹Ÿæ²¡å•¥åŒºåˆ«ï¼Œä½†æ˜¯å®ƒåœ¨å†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ªthiså…³é”®å­—ï¼Œè¿™ä¸ªä¸œä¸œæ˜¯ä»€ä¹ˆ?åœ¨ä¸€ä¸ªæ–¹æ³•å†…éƒ¨ï¼Œthisæ˜¯ä¸€ä¸ªç‰¹æ®Šå˜é‡ï¼Œå®ƒå§‹ç»ˆæŒ‡å‘å½“å‰å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯xiaomingè¿™ä¸ªå˜é‡ã€‚æ‰€ä»¥ï¼Œthis.birthå¯ä»¥æ‹¿åˆ°xiaomingçš„birthå±æ€§ã€‚è®©æˆ‘ä»¬æ‹†å¼€å†™ï¼š1234567891011function getAge() &#123; var y = new Date().getFullYear(); return y - this.birth;&#125;var xiaoming = &#123; name: &apos;å°æ˜&apos;, birth: 1990, age: getAge&#125;;xiaoming.age(); // 25, æ­£å¸¸ç»“æœgetAge(); // NaN å•ç‹¬è°ƒç”¨å‡½æ•°getAge()æ€ä¹ˆè¿”å›äº†NaNï¼Ÿè¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»è¿›å…¥åˆ°äº†JavaScriptçš„ä¸€ä¸ªå¤§å‘é‡Œ.JavaScriptçš„å‡½æ•°å†…éƒ¨å¦‚æœè°ƒç”¨äº†thisï¼Œé‚£ä¹ˆè¿™ä¸ªthisåˆ°åº•æŒ‡å‘è°?ç­”æ¡ˆæ˜¯ï¼Œè§†æƒ…å†µè€Œå®š!å¦‚æœä»¥å¯¹è±¡çš„æ–¹æ³•å½¢å¼è°ƒç”¨ï¼Œæ¯”å¦‚xiaoming.age()ï¼Œè¯¥å‡½æ•°çš„thisæŒ‡å‘è¢«è°ƒç”¨çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯xiaomingï¼Œè¿™æ˜¯ç¬¦åˆæˆ‘ä»¬é¢„æœŸçš„.å¦‚æœå•ç‹¬è°ƒç”¨å‡½æ•°ï¼Œæ¯”å¦‚getAge()ï¼Œæ­¤æ—¶ï¼Œè¯¥å‡½æ•°çš„thisæŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯window.å‘çˆ¹å•Š!æ›´å‘çˆ¹çš„æ˜¯ï¼Œå¦‚æœè¿™ä¹ˆå†™:12var fn = xiaoming.age; // å…ˆæ‹¿åˆ°xiaomingçš„ageå‡½æ•°fn(); // NaN ä¹Ÿæ˜¯ä¸è¡Œçš„ï¼è¦ä¿è¯thisæŒ‡å‘æ­£ç¡®ï¼Œå¿…é¡»ç”¨obj.xxx()çš„å½¢å¼è°ƒç”¨ï¼ç”±äºè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„è®¾è®¡é”™è¯¯ï¼Œè¦æƒ³çº æ­£å¯æ²¡é‚£ä¹ˆç®€å•ã€‚ECMAå†³å®šï¼Œåœ¨strictæ¨¡å¼ä¸‹è®©å‡½æ•°çš„thisæŒ‡å‘undefinedï¼Œå› æ­¤ï¼Œåœ¨strictæ¨¡å¼ä¸‹ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯:12345678910111213&apos;use strict&apos;;var xiaoming = &#123; name: &apos;å°æ˜&apos;, birth: 1990, age: function () &#123; var y = new Date().getFullYear(); return y - this.birth; &#125;&#125;;var fn = xiaoming.age;fn(); // Uncaught TypeError: Cannot read property &apos;birth&apos; of undefined è¿™ä¸ªå†³å®šåªæ˜¯è®©é”™è¯¯åŠæ—¶æš´éœ²å‡ºæ¥ï¼Œå¹¶æ²¡æœ‰è§£å†³thisåº”è¯¥æŒ‡å‘çš„æ­£ç¡®ä½ç½®ã€‚æœ‰äº›æ—¶å€™ï¼Œå–œæ¬¢é‡æ„çš„ä½ æŠŠæ–¹æ³•é‡æ„äº†ä¸€ä¸‹:1234567891011121314&apos;use strict&apos;;var xiaoming = &#123; name: &apos;å°æ˜&apos;, birth: 1990, age: function () &#123; function getAgeFromBirth() &#123; var y = new Date().getFullYear(); return y - this.birth; &#125; return getAgeFromBirth(); &#125;&#125;;xiaoming.age(); // Uncaught TypeError: Cannot read property &apos;birth&apos; of undefined ç»“æœåˆæŠ¥é”™äº†ï¼åŸå› æ˜¯thisæŒ‡é’ˆåªåœ¨ageæ–¹æ³•çš„å‡½æ•°å†…æŒ‡å‘xiaomingï¼Œåœ¨å‡½æ•°å†…éƒ¨å®šä¹‰çš„å‡½æ•°ï¼ŒthisåˆæŒ‡å‘undefinedäº†ï¼ï¼ˆåœ¨éstrictæ¨¡å¼ä¸‹ï¼Œå®ƒé‡æ–°æŒ‡å‘å…¨å±€å¯¹è±¡windowï¼ï¼‰ä¿®å¤çš„åŠæ³•ä¹Ÿä¸æ˜¯æ²¡æœ‰ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªthatå˜é‡é¦–å…ˆæ•è·thisï¼š123456789101112131415&apos;use strict&apos;;var xiaoming = &#123; name: &apos;å°æ˜&apos;, birth: 1990, age: function () &#123; var that = this; // åœ¨æ–¹æ³•å†…éƒ¨ä¸€å¼€å§‹å°±æ•è·this function getAgeFromBirth() &#123; var y = new Date().getFullYear(); return y - that.birth; // ç”¨thatè€Œä¸æ˜¯this &#125; return getAgeFromBirth(); &#125;&#125;;xiaoming.age(); // 25 ç”¨var that = this;ï¼Œä½ å°±å¯ä»¥æ”¾å¿ƒåœ°åœ¨æ–¹æ³•å†…éƒ¨å®šä¹‰å…¶ä»–å‡½æ•°ï¼Œè€Œä¸æ˜¯æŠŠæ‰€æœ‰è¯­å¥éƒ½å †åˆ°ä¸€ä¸ªæ–¹æ³•ä¸­. applyæ–¹æ³•è¯¦è§£è™½ç„¶åœ¨ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°è°ƒç”¨ä¸­ï¼Œæ ¹æ®æ˜¯å¦æ˜¯strictæ¨¡å¼ï¼ŒthisæŒ‡å‘undefinedæˆ–windowï¼Œä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥æ§åˆ¶thisçš„æŒ‡å‘çš„ï¼è¦æŒ‡å®šå‡½æ•°çš„thisæŒ‡å‘å“ªä¸ªå¯¹è±¡ï¼Œå¯ä»¥ç”¨å‡½æ•°æœ¬èº«çš„applyæ–¹æ³•ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯éœ€è¦ç»‘å®šçš„thiså˜é‡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯Arrayï¼Œè¡¨ç¤ºå‡½æ•°æœ¬èº«çš„å‚æ•°ã€‚ç”¨applyä¿®å¤getAge()è°ƒç”¨:1234567891011function getAge() &#123; var y = new Date().getFullYear(); return y - this.birth;&#125;var xiaoming = &#123; name: &apos;å°æ˜&apos;, birth: 1990, age: getAge&#125;;xiaoming.age(); // 25getAge.apply(xiaoming, []); // 25, thisæŒ‡å‘xiaoming, å‚æ•°ä¸ºç©º å¦ä¸€ä¸ªä¸apply()ç±»ä¼¼çš„æ–¹æ³•æ˜¯call()ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯: apply()æŠŠå‚æ•°æ‰“åŒ…æˆArrayå†ä¼ å…¥; call()æŠŠå‚æ•°æŒ‰é¡ºåºä¼ å…¥.æ¯”å¦‚è°ƒç”¨Math.max(3, 5, 4)ï¼Œåˆ†åˆ«ç”¨apply()å’Œcall()å®ç°å¦‚ä¸‹:12Math.max.apply(null, [3, 5, 4]); // 5Math.max.call(null, 3, 5, 4); // 5 å¯¹æ™®é€šå‡½æ•°è°ƒç”¨ï¼Œæˆ‘ä»¬é€šå¸¸æŠŠthisç»‘å®šä¸ºnull. è£…é¥°å™¨åˆ©ç”¨apply()ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åŠ¨æ€æ”¹å˜å‡½æ•°çš„è¡Œä¸ºã€‚JavaScriptçš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯åŠ¨æ€çš„ï¼Œå³ä½¿å†…ç½®çš„å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é‡æ–°æŒ‡å‘æ–°çš„å‡½æ•°ã€‚ç°åœ¨å‡å®šæˆ‘ä»¬æƒ³ç»Ÿè®¡ä¸€ä¸‹ä»£ç ä¸€å…±è°ƒç”¨äº†å¤šå°‘æ¬¡parseInt()ï¼Œå¯ä»¥æŠŠæ‰€æœ‰çš„è°ƒç”¨éƒ½æ‰¾å‡ºæ¥ï¼Œç„¶åæ‰‹åŠ¨åŠ ä¸Šcount += 1ï¼Œä¸è¿‡è¿™æ ·åšå¤ªå‚»äº†ã€‚æœ€ä½³æ–¹æ¡ˆæ˜¯ç”¨æˆ‘ä»¬è‡ªå·±çš„å‡½æ•°æ›¿æ¢æ‰é»˜è®¤çš„parseInt()ï¼š1234567891011121314&apos;use strict&apos;;var count = 0;var oldParseInt = parseInt; // ä¿å­˜åŸå‡½æ•°window.parseInt = function () &#123; count += 1; return oldParseInt.apply(null, arguments); // è°ƒç”¨åŸå‡½æ•°&#125;;// æµ‹è¯•:parseInt(&apos;10&apos;);parseInt(&apos;20&apos;);parseInt(&apos;30&apos;);console.log(&apos;count = &apos; + count); // 3","categories":[{"name":"frontend","slug":"frontend","permalink":"http://ltyeamin.github.io/categories/frontend/"}],"tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"http://ltyeamin.github.io/tags/JavaScript/"}]},{"title":"å˜é‡ä½œç”¨åŸŸä¸è§£æ„èµ‹å€¼","slug":"å˜é‡ä½œç”¨åŸŸä¸è§£æ„èµ‹å€¼","date":"2017-12-13T07:04:21.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2017/12/13/å˜é‡ä½œç”¨åŸŸä¸è§£æ„èµ‹å€¼/","link":"","permalink":"http://ltyeamin.github.io/2017/12/13/å˜é‡ä½œç”¨åŸŸä¸è§£æ„èµ‹å€¼/","excerpt":"","text":"å˜é‡ä½œç”¨åŸŸåœ¨JavaScriptä¸­ï¼Œç”¨varç”³æ˜çš„å˜é‡å®é™…ä¸Šæ˜¯æœ‰ä½œç”¨åŸŸçš„ã€‚å¦‚æœä¸€ä¸ªå˜é‡åœ¨å‡½æ•°ä½“å†…éƒ¨ç”³æ˜ï¼Œåˆ™è¯¥å˜é‡çš„ä½œç”¨åŸŸä¸ºæ•´ä¸ªå‡½æ•°ä½“ï¼Œåœ¨å‡½æ•°ä½“å¤–ä¸å¯å¼•ç”¨è¯¥å˜é‡:12345function foo() &#123; var x = 1; x = x + 1;&#125;x = x + 2; // ReferenceError! æ— æ³•åœ¨å‡½æ•°ä½“å¤–å¼•ç”¨å˜é‡x å¦‚æœä¸¤ä¸ªä¸åŒçš„å‡½æ•°å„è‡ªç”³æ˜äº†åŒä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆè¯¥å˜é‡åªåœ¨å„è‡ªçš„å‡½æ•°ä½“å†…èµ·ä½œç”¨ã€‚æ¢å¥è¯è¯´ï¼Œä¸åŒå‡½æ•°å†…éƒ¨çš„åŒåå˜é‡äº’ç›¸ç‹¬ç«‹ï¼Œäº’ä¸å½±å“:123456789function foo() &#123; var x = 1; x = x + 1;&#125;function bar() &#123; var x = &apos;A&apos;; x = x + &apos;B&apos;;&#125; ç”±äºJavaScriptçš„å‡½æ•°å¯ä»¥åµŒå¥—ï¼Œæ­¤æ—¶ï¼Œå†…éƒ¨å‡½æ•°å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°å®šä¹‰çš„å˜é‡ï¼Œåè¿‡æ¥åˆ™ä¸è¡Œ:1234567function foo() &#123; var x = 1; function bar() &#123; var y = x + 1; // barå¯ä»¥è®¿é—®fooçš„å˜é‡x! &#125; var z = y + 1; // ReferenceError! fooä¸å¯ä»¥è®¿é—®barçš„å˜é‡y!&#125; å¦‚æœå†…éƒ¨å‡½æ•°å’Œå¤–éƒ¨å‡½æ•°çš„å˜é‡åé‡åæ€ä¹ˆåŠï¼Ÿæ¥æµ‹è¯•ä¸€ä¸‹:12345678910function foo() &#123; var x = 1; function bar() &#123; var x = &apos;A&apos;; console.log(&apos;x in bar() = &apos; + x); // &apos;A&apos; &#125; console.log(&apos;x in foo() = &apos; + x); // 1 bar();&#125;foo(); è¿™è¯´æ˜JavaScriptçš„å‡½æ•°åœ¨æŸ¥æ‰¾å˜é‡æ—¶ä»è‡ªèº«å‡½æ•°å®šä¹‰å¼€å§‹ï¼Œä»â€œå†…â€å‘â€œå¤–â€æŸ¥æ‰¾ã€‚å¦‚æœå†…éƒ¨å‡½æ•°å®šä¹‰äº†ä¸å¤–éƒ¨å‡½æ•°é‡åçš„å˜é‡ï¼Œåˆ™å†…éƒ¨å‡½æ•°çš„å˜é‡å°†â€œå±è”½â€å¤–éƒ¨å‡½æ•°çš„å˜é‡ã€‚ å˜é‡æå‡JavaScriptçš„å‡½æ•°å®šä¹‰æœ‰ä¸ªç‰¹ç‚¹ï¼Œå®ƒä¼šå…ˆæ‰«ææ•´ä¸ªå‡½æ•°ä½“çš„è¯­å¥ï¼ŒæŠŠæ‰€æœ‰ç”³æ˜çš„å˜é‡â€œæå‡â€åˆ°å‡½æ•°é¡¶éƒ¨:1234567&apos;use strict&apos;;function foo() &#123; var x = &apos;Hello, &apos; + y; console.log(x); var y = &apos;Bob&apos;;&#125;foo(); è™½ç„¶æ˜¯strictæ¨¡å¼ï¼Œä½†è¯­å¥var x = â€˜Hello, â€˜ + y;å¹¶ä¸æŠ¥é”™ï¼ŒåŸå› æ˜¯å˜é‡yåœ¨ç¨åç”³æ˜äº†ã€‚ä½†æ˜¯console.logæ˜¾ç¤ºHello, undefinedï¼Œè¯´æ˜å˜é‡yçš„å€¼ä¸ºundefinedã€‚è¿™æ­£æ˜¯å› ä¸ºJavaScriptå¼•æ“è‡ªåŠ¨æå‡äº†å˜é‡yçš„å£°æ˜ï¼Œä½†ä¸ä¼šæå‡å˜é‡yçš„èµ‹å€¼ã€‚å¯¹äºä¸Šè¿°foo()å‡½æ•°ï¼ŒJavaScriptå¼•æ“çœ‹åˆ°çš„ä»£ç ç›¸å½“äº:123456function foo() &#123; var y; // æå‡å˜é‡yçš„ç”³æ˜ï¼Œæ­¤æ—¶yä¸ºundefined var x = &apos;Hello, &apos; + y; console.log(x); y = &apos;Bob&apos;;&#125; ç”±äºJavaScriptçš„è¿™ä¸€æ€ªå¼‚çš„â€œç‰¹æ€§â€ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰å˜é‡æ—¶ï¼Œè¯·ä¸¥æ ¼éµå®ˆâ€œåœ¨å‡½æ•°å†…éƒ¨é¦–å…ˆç”³æ˜æ‰€æœ‰å˜é‡â€è¿™ä¸€è§„åˆ™ã€‚æœ€å¸¸è§çš„åšæ³•æ˜¯ç”¨ä¸€ä¸ªvarç”³æ˜å‡½æ•°å†…éƒ¨ç”¨åˆ°çš„æ‰€æœ‰å˜é‡ï¼š12345678910function foo() &#123; var x = 1, // xåˆå§‹åŒ–ä¸º1 y = x + 1, // yåˆå§‹åŒ–ä¸º2 z, i; // zå’Œiä¸ºundefined // å…¶ä»–è¯­å¥: for (i=0; i&lt;100; i++) &#123; ... &#125;&#125; å…¨å±€ä½œç”¨åŸŸä¸åœ¨ä»»ä½•å‡½æ•°å†…å®šä¹‰çš„å˜é‡å°±å…·æœ‰å…¨å±€ä½œç”¨åŸŸã€‚å®é™…ä¸Šï¼ŒJavaScripté»˜è®¤æœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡windowï¼Œå…¨å±€ä½œç”¨åŸŸçš„å˜é‡å®é™…ä¸Šè¢«ç»‘å®šåˆ°windowçš„ä¸€ä¸ªå±æ€§:1234&apos;use strict&apos;;var course = &apos;Learn JavaScript&apos;;alert(course); // &apos;Learn JavaScript&apos;alert(window.course); // &apos;Learn JavaScript&apos; å› æ­¤ï¼Œç›´æ¥è®¿é—®å…¨å±€å˜é‡courseå’Œè®¿é—®window.courseæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ä½ å¯èƒ½çŒœåˆ°äº†ï¼Œç”±äºå‡½æ•°å®šä¹‰æœ‰ä¸¤ç§æ–¹å¼ï¼Œä»¥å˜é‡æ–¹å¼var foo = function () {}å®šä¹‰çš„å‡½æ•°å®é™…ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå› æ­¤ï¼Œé¡¶å±‚å‡½æ•°çš„å®šä¹‰ä¹Ÿè¢«è§†ä¸ºä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå¹¶ç»‘å®šåˆ°windowå¯¹è±¡:123456&apos;use strict&apos;;function foo() &#123; alert(&apos;foo&apos;);&#125;foo(); // ç›´æ¥è°ƒç”¨foo()window.foo(); // é€šè¿‡window.foo()è°ƒç”¨ è¿›ä¸€æ­¥å¤§èƒ†åœ°çŒœæµ‹ï¼Œæˆ‘ä»¬æ¯æ¬¡ç›´æ¥è°ƒç”¨çš„alert()å‡½æ•°å…¶å®ä¹Ÿæ˜¯windowçš„ä¸€ä¸ªå˜é‡ï¼š12345678910&apos;use strict&apos;;window.alert(&apos;è°ƒç”¨window.alert()&apos;);// æŠŠalertä¿å­˜åˆ°å¦ä¸€ä¸ªå˜é‡:var old_alert = window.alert;// ç»™alertèµ‹ä¸€ä¸ªæ–°å‡½æ•°:window.alert = function () &#123;&#125;alert(&apos;æ— æ³•ç”¨alert()æ˜¾ç¤ºäº†!&apos;);// æ¢å¤alert:window.alert = old_alert;alert(&apos;åˆå¯ä»¥ç”¨alert()äº†!&apos;); è¿™è¯´æ˜JavaScriptå®é™…ä¸Šåªæœ‰ä¸€ä¸ªå…¨å±€ä½œç”¨åŸŸã€‚ä»»ä½•å˜é‡ï¼ˆå‡½æ•°ä¹Ÿè§†ä¸ºå˜é‡ï¼‰ï¼Œå¦‚æœæ²¡æœ‰åœ¨å½“å‰å‡½æ•°ä½œç”¨åŸŸä¸­æ‰¾åˆ°ï¼Œå°±ä¼šç»§ç»­å¾€ä¸ŠæŸ¥æ‰¾ï¼Œæœ€åå¦‚æœåœ¨å…¨å±€ä½œç”¨åŸŸä¸­ä¹Ÿæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æŠ¥ReferenceErroré”™è¯¯. åç§°ç©ºé—´å…¨å±€å˜é‡ä¼šç»‘å®šåˆ°windowä¸Šï¼Œä¸åŒçš„JavaScriptæ–‡ä»¶å¦‚æœä½¿ç”¨äº†ç›¸åŒçš„å…¨å±€å˜é‡ï¼Œæˆ–è€…å®šä¹‰äº†ç›¸åŒåå­—çš„é¡¶å±‚å‡½æ•°ï¼Œéƒ½ä¼šé€ æˆå‘½åå†²çªï¼Œå¹¶ä¸”å¾ˆéš¾è¢«å‘ç°ã€‚å‡å°‘å†²çªçš„ä¸€ä¸ªæ–¹æ³•æ˜¯æŠŠè‡ªå·±çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°å…¨éƒ¨ç»‘å®šåˆ°ä¸€ä¸ªå…¨å±€å˜é‡ä¸­ã€‚ä¾‹å¦‚:123456789// å”¯ä¸€çš„å…¨å±€å˜é‡MYAPP:var MYAPP = &#123;&#125;;// å…¶ä»–å˜é‡:MYAPP.name = &apos;myapp&apos;;MYAPP.version = 1.0;// å…¶ä»–å‡½æ•°:MYAPP.foo = function () &#123; return &apos;foo&apos;;&#125;; æŠŠè‡ªå·±çš„ä»£ç å…¨éƒ¨æ”¾å…¥å”¯ä¸€çš„åå­—ç©ºé—´MYAPPä¸­ï¼Œä¼šå¤§å¤§å‡å°‘å…¨å±€å˜é‡å†²çªçš„å¯èƒ½ã€‚è®¸å¤šè‘—åçš„JavaScriptåº“éƒ½æ˜¯è¿™ä¹ˆå¹²çš„ï¼šjQueryï¼ŒYUIï¼Œunderscoreç­‰ç­‰ã€‚ å±€éƒ¨ä½œç”¨åŸŸç”±äºJavaScriptçš„å˜é‡ä½œç”¨åŸŸå®é™…ä¸Šæ˜¯å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬åœ¨forå¾ªç¯ç­‰è¯­å¥å—ä¸­æ˜¯æ— æ³•å®šä¹‰å…·æœ‰å±€éƒ¨ä½œç”¨åŸŸçš„å˜é‡çš„:12345678&apos;use strict&apos;;function foo() &#123; for (var i=0; i&lt;100; i++) &#123; // &#125; i += 100; // ä»ç„¶å¯ä»¥å¼•ç”¨å˜é‡i&#125; ä¸ºäº†è§£å†³å—çº§ä½œç”¨åŸŸï¼ŒES6å¼•å…¥äº†æ–°çš„å…³é”®å­—letï¼Œç”¨letæ›¿ä»£varå¯ä»¥ç”³æ˜ä¸€ä¸ªå—çº§ä½œç”¨åŸŸçš„å˜é‡:12345678function foo() &#123; var sum = 0; for (let i=0; i&lt;100; i++) &#123; sum += i; &#125; // SyntaxError: i += 1;&#125; å¸¸é‡ç”±äºvarå’Œletç”³æ˜çš„æ˜¯å˜é‡ï¼Œå¦‚æœè¦ç”³æ˜ä¸€ä¸ªå¸¸é‡ï¼Œåœ¨ES6ä¹‹å‰æ˜¯ä¸è¡Œçš„ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨å…¨éƒ¨å¤§å†™çš„å˜é‡æ¥è¡¨ç¤ºâ€œè¿™æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä¸è¦ä¿®æ”¹å®ƒçš„å€¼â€:1var PI = 3.14; ES6æ ‡å‡†å¼•å…¥äº†æ–°çš„å…³é”®å­—constæ¥å®šä¹‰å¸¸é‡ï¼Œconstä¸letéƒ½å…·æœ‰å—çº§ä½œç”¨åŸŸ:1234&apos;use strict&apos;;const PI = 3.14;PI = 3; // æŸäº›æµè§ˆå™¨ä¸æŠ¥é”™ï¼Œä½†æ˜¯æ— æ•ˆæœï¼PI; // 3.14 è§£æ„èµ‹å€¼ä»ES6å¼€å§‹ï¼ŒJavaScriptå¼•å…¥äº†è§£æ„èµ‹å€¼ï¼Œå¯ä»¥åŒæ—¶å¯¹ä¸€ç»„å˜é‡è¿›è¡Œèµ‹å€¼ã€‚ä»€ä¹ˆæ˜¯è§£æ„èµ‹å€¼ï¼Ÿæˆ‘ä»¬å…ˆçœ‹çœ‹ä¼ ç»Ÿçš„åšæ³•ï¼Œå¦‚ä½•æŠŠä¸€ä¸ªæ•°ç»„çš„å…ƒç´ åˆ†åˆ«èµ‹å€¼ç»™å‡ ä¸ªå˜é‡:123456var array = [&apos;æå½¤&apos;, &apos;å¥•æ˜åˆ›æ„ä¼ åª’&apos;, &apos;è‰ºæœ¯æºäºç”Ÿæ´»,ä½†é«˜äºç”Ÿæ´»&apos;];//ä¸€èˆ¬èµ‹å€¼æ–¹æ³•var x = array[0];var y = array[1];var z = array[2];console.log(&apos;x : &apos; + x + &apos;, y : &apos; + y + &apos;, z : &apos; + z); //x : æå½¤, y : å¥•æ˜åˆ›æ„ä¼ åª’, z : è‰ºæœ¯æºäºç”Ÿæ´»,ä½†é«˜äºç”Ÿæ´» ç°åœ¨ï¼Œåœ¨ES6ä¸­ï¼Œå¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼ï¼Œç›´æ¥å¯¹å¤šä¸ªå˜é‡åŒæ—¶èµ‹å€¼:12var [x, y, z] = [&apos;Java&apos;, &apos;JavaScript&apos;, &apos;Python&apos;];console.log(&apos;x : &apos; + x + &apos;, y : &apos; + y + &apos;, z : &apos; + z); //x : Java, y : JavaScript, z : Python æ³¨æ„ï¼Œå¯¹æ•°ç»„å…ƒç´ è¿›è¡Œè§£æ„èµ‹å€¼æ—¶ï¼Œå¤šä¸ªå˜é‡è¦ç”¨[â€¦]æ‹¬èµ·æ¥ã€‚å¦‚æœæ•°ç»„æœ¬èº«è¿˜æœ‰åµŒå¥—ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„å½¢å¼è¿›è¡Œè§£æ„èµ‹å€¼ï¼Œæ³¨æ„åµŒå¥—å±‚æ¬¡å’Œä½ç½®è¦ä¿æŒä¸€è‡´:1234let [x, [y, z]] = [&apos;hello&apos;, [&apos;JavaScript&apos;, &apos;ES6&apos;]];x; // &apos;hello&apos;y; // &apos;JavaScript&apos;z; // &apos;ES6&apos; è§£æ„èµ‹å€¼è¿˜å¯ä»¥å¿½ç•¥æŸäº›å…ƒç´ ï¼š12let [, , z] = [&apos;hello&apos;, &apos;JavaScript&apos;, &apos;ES6&apos;]; // å¿½ç•¥å‰ä¸¤ä¸ªå…ƒç´ ï¼Œåªå¯¹zèµ‹å€¼ç¬¬ä¸‰ä¸ªå…ƒç´ z; // &apos;ES6&apos; å¦‚æœéœ€è¦ä»ä¸€ä¸ªå¯¹è±¡ä¸­å–å‡ºè‹¥å¹²å±æ€§ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼ï¼Œä¾¿äºå¿«é€Ÿè·å–å¯¹è±¡çš„æŒ‡å®šå±æ€§:12345678910var person = &#123; name: &apos;æ—ºè´¢&apos;, age: 20, gender: &apos;male&apos;, passport: &apos;G-12345678&apos;, school: &apos;No.4 middle school&apos;&#125;;var &#123;name, age, passport&#125; = person;// name, age, passportåˆ†åˆ«è¢«èµ‹å€¼ä¸ºå¯¹åº”å±æ€§:console.log(&apos;name = &apos; + name + &apos;, age = &apos; + age + &apos;, passport = &apos; + passport); //name = æ—ºè´¢, age = 20, passport = G-12345678 å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œè§£æ„èµ‹å€¼æ—¶ï¼ŒåŒæ ·å¯ä»¥ç›´æ¥å¯¹åµŒå¥—çš„å¯¹è±¡å±æ€§è¿›è¡Œèµ‹å€¼ï¼Œåªè¦ä¿è¯å¯¹åº”çš„å±‚æ¬¡æ˜¯ä¸€è‡´çš„:123456789101112131415161718var person = &#123; name: &apos;å°å¼º&apos;, age: 20, gender: &apos;male&apos;, passport: &apos;G-12345678&apos;, school: &apos;No.4 middle school&apos;, address: &#123; city: &apos;Beijing&apos;, street: &apos;No.1 Road&apos;, zipcode: &apos;100001&apos; &#125;&#125;;var &#123;name, address: &#123;city, zip&#125;&#125; = person;name; // &apos;å°å¼º&apos;city; // &apos;Beijing&apos;zip; // undefined, å› ä¸ºå±æ€§åæ˜¯zipcodeè€Œä¸æ˜¯zip// æ³¨æ„: addressä¸æ˜¯å˜é‡ï¼Œè€Œæ˜¯ä¸ºäº†è®©cityå’Œzipè·å¾—åµŒå¥—çš„addresså¯¹è±¡çš„å±æ€§:address; // Uncaught ReferenceError: address is not defined ä½¿ç”¨è§£æ„èµ‹å€¼å¯¹å¯¹è±¡å±æ€§è¿›è¡Œèµ‹å€¼æ—¶ï¼Œå¦‚æœå¯¹åº”çš„å±æ€§ä¸å­˜åœ¨ï¼Œå˜é‡å°†è¢«èµ‹å€¼ä¸ºundefinedï¼Œè¿™å’Œå¼•ç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§è·å¾—undefinedæ˜¯ä¸€è‡´çš„ã€‚å¦‚æœè¦ä½¿ç”¨çš„å˜é‡åå’Œå±æ€§åä¸ä¸€è‡´ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„è¯­æ³•è·å–:1234567891011121314var person = &#123; name: &apos;å°å¼º&apos;, age: 20, gender: &apos;male&apos;, passport: &apos;G-12345678&apos;, school: &apos;No.4 middle school&apos;&#125;;// æŠŠpassportå±æ€§èµ‹å€¼ç»™å˜é‡id:let &#123;name, passport:id&#125; = person;name; // &apos;å°å¼º&apos;id; // &apos;G-12345678&apos;// æ³¨æ„: passportä¸æ˜¯å˜é‡ï¼Œè€Œæ˜¯ä¸ºäº†è®©å˜é‡idè·å¾—passportå±æ€§:passport; // Uncaught ReferenceError: passport is not defined è§£æ„èµ‹å€¼è¿˜å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼ï¼Œè¿™æ ·å°±é¿å…äº†ä¸å­˜åœ¨çš„å±æ€§è¿”å›undefinedçš„é—®é¢˜:1234567891011var person = &#123; name: &apos;å°å¼º&apos;, age: 20, gender: &apos;male&apos;, passport: &apos;G-12345678&apos;&#125;;// å¦‚æœpersonå¯¹è±¡æ²¡æœ‰singleå±æ€§ï¼Œé»˜è®¤èµ‹å€¼ä¸ºtrue:var &#123;name, single=true&#125; = person;name; // &apos;å°å¼º&apos;single; // true æœ‰äº›æ—¶å€™ï¼Œå¦‚æœå˜é‡å·²ç»è¢«å£°æ˜äº†ï¼Œå†æ¬¡èµ‹å€¼çš„æ—¶å€™ï¼Œæ­£ç¡®çš„å†™æ³•ä¹Ÿä¼šæŠ¥è¯­æ³•é”™è¯¯:12345// å£°æ˜å˜é‡:var x, y;// è§£æ„èµ‹å€¼:&#123;x, y&#125; = &#123; name: &apos;å°å¼º&apos;, x: 100, y: 200&#125;;// è¯­æ³•é”™è¯¯: Uncaught SyntaxError: Unexpected token = è¿™æ˜¯å› ä¸ºJavaScriptå¼•æ“æŠŠ{å¼€å¤´çš„è¯­å¥å½“ä½œäº†å—å¤„ç†ï¼Œäºæ˜¯=ä¸å†åˆæ³•ã€‚è§£å†³æ–¹æ³•æ˜¯ç”¨å°æ‹¬å·æ‹¬èµ·æ¥:1(&#123;x, y&#125; = &#123; name: &apos;å°å¼º&apos;, x: 100, y: 200&#125;); è§£æèµ‹å€¼ä½¿ç”¨åœºæ™¯ è§£æ„èµ‹å€¼åœ¨å¾ˆå¤šæ—¶å€™å¯ä»¥å¤§å¤§ç®€åŒ–ä»£ç ã€‚ä¾‹å¦‚ï¼Œäº¤æ¢ä¸¤ä¸ªå˜é‡xå’Œyçš„å€¼ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼Œä¸å†éœ€è¦ä¸´æ—¶å˜é‡: 12var x=1, y=2;[x, y] = [y, x] å¿«é€Ÿè·å–å½“å‰é¡µé¢çš„åŸŸåå’Œè·¯å¾„: 123var &#123;hostname:domain, pathname:path&#125; = location;domain //&quot;ltyeamin.github.io&quot;path // &quot;/2017/12/04/JS%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89%E5%92%8C%E8%B0%83%E7%94%A8/&quot; å¦‚æœä¸€ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œé‚£ä¹ˆï¼Œå¯ä»¥ä½¿ç”¨è§£æ„ç›´æ¥æŠŠå¯¹è±¡çš„å±æ€§ç»‘å®šåˆ°å˜é‡ä¸­ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„å‡½æ•°å¯ä»¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ªDateå¯¹è±¡: 123function buildDate(&#123;year, month, day, hour=0, minute=0, second=0&#125;) &#123; return new Date(year + &apos;-&apos; + month + &apos;-&apos; + day + &apos; &apos; + hour + &apos;:&apos; + minute + &apos;:&apos; + second);&#125; å®ƒçš„æ–¹ä¾¿ä¹‹å¤„åœ¨äºä¼ å…¥çš„å¯¹è±¡åªéœ€è¦yearã€monthå’Œdayè¿™ä¸‰ä¸ªå±æ€§: 1buildDate(&#123; year: 2017, month: 12, day: 4 &#125;); // Mon Dec 04 2017 00:00:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) ä¹Ÿå¯ä»¥ä¼ å…¥hourã€minuteå’Œsecondå±æ€§: 1buildDate(&#123; year: 2017, month: 1, day: 1, hour: 20, minute: 15 &#125;); // Sun Jan 01 2017 20:15:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) ä½¿ç”¨è§£æ„èµ‹å€¼å¯ä»¥å‡å°‘ä»£ç é‡ï¼Œä½†æ˜¯ï¼Œéœ€è¦åœ¨æ”¯æŒES6è§£æ„èµ‹å€¼ç‰¹æ€§çš„ç°ä»£æµè§ˆå™¨ä¸­æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚ç›®å‰æ”¯æŒè§£æ„èµ‹å€¼çš„æµè§ˆå™¨åŒ…æ‹¬Chromeï¼ŒFirefoxï¼ŒEdgeç­‰.","categories":[{"name":"frontend","slug":"frontend","permalink":"http://ltyeamin.github.io/categories/frontend/"}],"tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"http://ltyeamin.github.io/tags/JavaScript/"}]},{"title":"JSå‡½æ•°å®šä¹‰å’Œè°ƒç”¨","slug":"JSå‡½æ•°å®šä¹‰å’Œè°ƒç”¨","date":"2017-12-04T13:53:01.000Z","updated":"2019-05-29T14:03:52.000Z","comments":true,"path":"2017/12/04/JSå‡½æ•°å®šä¹‰å’Œè°ƒç”¨/","link":"","permalink":"http://ltyeamin.github.io/2017/12/04/JSå‡½æ•°å®šä¹‰å’Œè°ƒç”¨/","excerpt":"","text":"å®šä¹‰å‡½æ•°JavaScriptå‡½æ•°æ—¶å‚æ•°åŒ–çš„,å¹¶ä¸”æ¯æ¬¡è°ƒç”¨è¿˜ä¼šæœ‰ä¸ªä¸Šä¸‹æ–‡(thiså…³é”®å­—).å¦‚æœå‡½æ•°æŒ‚è½½åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Š,ä½œä¸ºå¯¹è±¡çš„ä¸€ä¸ªå±æ€§,é‚£å°±æ˜¯å¯¹è±¡çš„æ–¹æ³•.JSçš„å‡½æ•°å¯ä»¥åµŒå¥—åœ¨å…¶ä»–å‡½æ•°ä¸­å®šä¹‰,è¿™æ ·å®ƒä»¬å°±å¯ä»¥è®¿é—®å®ƒä»¬è¢«å®šä¹‰æ—¶æ‰€å¤„çš„ä½œç”¨åŸŸä¸­çš„ä»»ä½•éå†.è¿™æ„å‘³ç€JSå‡½æ•°æ„æˆäº†ä¸€ä¸ªé—­åŒ…(closure).åœ¨JavaScriptä¸­ï¼Œå®šä¹‰å‡½æ•°çš„æ–¹å¼å¦‚ä¸‹:1234567function abs(x) &#123; if (x &gt;= 0) &#123; return x; &#125; else &#123; return -x; &#125;&#125; ä¸Šè¿°abs()å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹: functionæŒ‡å‡ºè¿™æ˜¯ä¸€ä¸ªå‡½æ•°å®šä¹‰; absæ˜¯å‡½æ•°çš„åç§°; æ‹¬å·å†…åˆ—å‡ºå‡½æ•°çš„å‚æ•°ï¼Œå¤šä¸ªå‚æ•°ä»¥,åˆ†éš”; {â€¦}ä¹‹é—´çš„ä»£ç æ˜¯å‡½æ•°ä½“ï¼Œå¯ä»¥åŒ…å«è‹¥å¹²è¯­å¥ï¼Œç”šè‡³å¯ä»¥æ²¡æœ‰ä»»ä½•è¯­å¥ã€‚ è¯·æ³¨æ„ï¼Œå‡½æ•°ä½“å†…éƒ¨çš„è¯­å¥åœ¨æ‰§è¡Œæ—¶ï¼Œä¸€æ—¦æ‰§è¡Œåˆ°returnæ—¶ï¼Œå‡½æ•°å°±æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶å°†ç»“æœè¿”å›ã€‚å› æ­¤ï¼Œå‡½æ•°å†…éƒ¨é€šè¿‡æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯å¯ä»¥å®ç°éå¸¸å¤æ‚çš„é€»è¾‘ã€‚å¦‚æœæ²¡æœ‰returnè¯­å¥ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•åä¹Ÿä¼šè¿”å›ç»“æœï¼Œåªæ˜¯ç»“æœä¸ºundefinedã€‚ç”±äºJavaScriptçš„å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸Šè¿°å®šä¹‰çš„abs()å‡½æ•°å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œè€Œå‡½æ•°åabså¯ä»¥è§†ä¸ºæŒ‡å‘è¯¥å‡½æ•°çš„å˜é‡ã€‚å› æ­¤ï¼Œç¬¬äºŒç§å®šä¹‰å‡½æ•°(åŒ¿åå‡½æ•°)çš„æ–¹å¼å¦‚ä¸‹ï¼š1234567var abs = function (x) &#123; if (x &gt;= 0) &#123; return x; &#125; else &#123; return -x; &#125;&#125;; åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œfunction(x){â€¦}æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå®ƒæ²¡æœ‰å‡½æ•°åã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªåŒ¿åå‡½æ•°èµ‹å€¼ç»™äº†å˜é‡abs.æ‰€ä»¥,é€šè¿‡å˜é‡abså°±å¯ä»¥è°ƒç”¨è¯¥å‡½æ•°ã€‚ä¸Šè¿°ä¸¤ç§å®šä¹‰å®Œå…¨ç­‰ä»·ï¼Œæ³¨æ„ç¬¬äºŒç§æ–¹å¼æŒ‰ç…§å®Œæ•´è¯­æ³•éœ€è¦åœ¨å‡½æ•°ä½“æœ«å°¾åŠ ä¸€ä¸ª;ï¼Œè¡¨ç¤ºèµ‹å€¼è¯­å¥ç»“æŸã€‚ è°ƒç”¨å‡½æ•°è°ƒç”¨å‡½æ•°æ—¶ï¼ŒæŒ‰é¡ºåºä¼ å…¥å‚æ•°å³å¯:12abs(10); // è¿”å›10abs(-9); // è¿”å›9 ç”±äºJavaScriptå…è®¸ä¼ å…¥ä»»æ„ä¸ªå‚æ•°è€Œä¸å½±å“è°ƒç”¨ï¼Œå› æ­¤ä¼ å…¥çš„å‚æ•°æ¯”å®šä¹‰çš„å‚æ•°å¤šä¹Ÿæ²¡æœ‰é—®é¢˜(å¼ºç±»å‹è¯­è¨€ä¸å…è®¸)ï¼Œè™½ç„¶å‡½æ•°å†…éƒ¨å¹¶ä¸éœ€è¦è¿™äº›å‚æ•°:12abs(10, &apos;blablabla&apos;); // è¿”å›10abs(-9, &apos;haha&apos;, &apos;hehe&apos;, null); // è¿”å›9 ä¼ å…¥çš„å‚æ•°æ¯”å®šä¹‰çš„å°‘ä¹Ÿæ²¡æœ‰é—®é¢˜:1abs(); // è¿”å›NaN æ­¤æ—¶abs(x)å‡½æ•°çš„å‚æ•°xå°†æ”¶åˆ°undefinedï¼Œè®¡ç®—ç»“æœä¸ºNaNã€‚è¦é¿å…æ”¶åˆ°undefinedï¼Œå¯ä»¥å¯¹å‚æ•°è¿›è¡Œæ£€æŸ¥:12345678910function abs(x) &#123; if (typeof x !== &apos;number&apos;) &#123; throw &apos;Not a number&apos;; &#125; if (x &gt;= 0) &#123; return x; &#125; else &#123; return -x; &#125;&#125; argumentsJavaScriptè¿˜æœ‰ä¸€ä¸ªå…è´¹èµ é€çš„å…³é”®å­—argumentsï¼Œå®ƒåªåœ¨å‡½æ•°å†…éƒ¨èµ·ä½œç”¨ï¼Œå¹¶ä¸”æ°¸è¿œæŒ‡å‘å½“å‰å‡½æ•°çš„è°ƒç”¨è€…ä¼ å…¥çš„æ‰€æœ‰å‚æ•°ã€‚argumentsç±»ä¼¼Arrayä½†å®ƒä¸æ˜¯ä¸€ä¸ªArray:1234567function sayHello () &#123; //éªŒè¯argumentså°è£…äº†æ‰€æœ‰çš„è°ƒç”¨å‚æ•° for (var i = 0; i &lt; arguments.length; i++) &#123; console.log(&apos;arg&apos; + i +&apos; = &apos; + arguments[i]) &#125;&#125;sayHello(&apos;æå½¤&apos;,22,&apos;ä¸Šæµ·&apos;,&apos;Java-JavaScript-Python&apos;); åˆ©ç”¨argumentsï¼Œä½ å¯ä»¥è·å¾—è°ƒç”¨è€…ä¼ å…¥çš„æ‰€æœ‰å‚æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿å‡½æ•°ä¸å®šä¹‰ä»»ä½•å‚æ•°ï¼Œè¿˜æ˜¯å¯ä»¥æ‹¿åˆ°å‚æ•°çš„å€¼.å®é™…ä¸Šargumentsæœ€å¸¸ç”¨äºåˆ¤æ–­ä¼ å…¥å‚æ•°çš„ä¸ªæ•°ã€‚ä½ å¯èƒ½ä¼šçœ‹åˆ°è¿™æ ·çš„å†™æ³•:12345678910// foo(a[, b], c)// æ¥æ”¶2~3ä¸ªå‚æ•°ï¼Œbæ˜¯å¯é€‰å‚æ•°ï¼Œå¦‚æœåªä¼ 2ä¸ªå‚æ•°ï¼Œbé»˜è®¤ä¸ºnullï¼šfunction foo(a, b, c) &#123; if (arguments.length === 2) &#123; // å®é™…æ‹¿åˆ°çš„å‚æ•°æ˜¯aå’Œbï¼Œcä¸ºundefined c = b; // æŠŠbèµ‹ç»™c b = null; // bå˜ä¸ºé»˜è®¤å€¼ &#125; // ...&#125; è¦æŠŠä¸­é—´çš„å‚æ•°bå˜ä¸ºâ€œå¯é€‰â€å‚æ•°ï¼Œå°±åªèƒ½é€šè¿‡argumentsåˆ¤æ–­ï¼Œç„¶åé‡æ–°è°ƒæ•´å‚æ•°å¹¶èµ‹å€¼ã€‚ restå‚æ•°ç”±äºJavaScriptå‡½æ•°å…è®¸æ¥æ”¶ä»»æ„ä¸ªå‚æ•°ï¼Œäºæ˜¯æˆ‘ä»¬å°±ä¸å¾—ä¸ç”¨argumentsæ¥è·å–æ‰€æœ‰å‚æ•°:1234567891011function foo(a, b) &#123; var i, rest = []; if (arguments.length &gt; 2) &#123; for (i = 2; i&lt;arguments.length; i++) &#123; rest.push(arguments[i]); &#125; &#125; console.log(&apos;a = &apos; + a); console.log(&apos;b = &apos; + b); console.log(rest);&#125; ä¸ºäº†è·å–é™¤äº†å·²å®šä¹‰å‚æ•°aã€bä¹‹å¤–çš„å‚æ•°ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ç”¨argumentsï¼Œå¹¶ä¸”å¾ªç¯è¦ä»ç´¢å¼•2å¼€å§‹ä»¥ä¾¿æ’é™¤å‰ä¸¤ä¸ªå‚æ•°ï¼Œè¿™ç§å†™æ³•å¾ˆåˆ«æ‰­ï¼Œåªæ˜¯ä¸ºäº†è·å¾—é¢å¤–çš„restå‚æ•°ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•?ES6æ ‡å‡†(æ³¨æ„æµè§ˆå™¨æ˜¯å¦æ”¯æŒES6)å¼•å…¥äº†restå‚æ•°ï¼Œä¸Šé¢çš„å‡½æ•°å¯ä»¥æ”¹å†™ä¸º:1234567891011121314151617function foo(a, b, ...rest) &#123; console.log(&apos;a = &apos; + a); console.log(&apos;b = &apos; + b); console.log(rest);&#125;foo(1, 2, 3, 4, 5);// ç»“æœ:// a = 1// b = 2// Array [ 3, 4, 5 ]foo(1);// ç»“æœ:// a = 1// b = undefined// Array [] restå‚æ•°åªèƒ½å†™åœ¨æœ€åï¼Œå‰é¢ç”¨â€¦æ ‡è¯†ï¼Œä»è¿è¡Œç»“æœå¯çŸ¥ï¼Œä¼ å…¥çš„å‚æ•°å…ˆç»‘å®šaã€bï¼Œå¤šä½™çš„å‚æ•°ä»¥æ•°ç»„å½¢å¼äº¤ç»™å˜é‡restï¼Œæ‰€ä»¥ï¼Œä¸å†éœ€è¦argumentsæˆ‘ä»¬å°±è·å–äº†å…¨éƒ¨å‚æ•°ã€‚å¦‚æœä¼ å…¥çš„å‚æ•°è¿æ­£å¸¸å®šä¹‰çš„å‚æ•°éƒ½æ²¡å¡«æ»¡ï¼Œä¹Ÿä¸è¦ç´§ï¼Œrestå‚æ•°ä¼šæ¥æ”¶ä¸€ä¸ªç©ºæ•°ç»„(æ³¨æ„ä¸æ˜¯undefined)ã€‚ å°å¿ƒä½ çš„returnè¯­å¥JavaScriptå¼•æ“æœ‰ä¸€ä¸ªåœ¨è¡Œæœ«è‡ªåŠ¨æ·»åŠ åˆ†å·çš„æœºåˆ¶ï¼Œè¿™å¯èƒ½è®©ä½ æ ½åˆ°returnè¯­å¥çš„ä¸€ä¸ªå¤§å‘:12345function foo() &#123; return &#123; name: &apos;foo&apos; &#125;;&#125;foo(); // &#123; name: &apos;foo&apos; &#125; å¦‚æœæŠŠreturnè¯­å¥æ‹†æˆä¸¤è¡Œ:123456function foo() &#123; return &#123; name: &apos;foo&apos; &#125;;&#125;foo(); // undefined è¦å°å¿ƒäº†ï¼Œç”±äºJavaScriptå¼•æ“åœ¨è¡Œæœ«è‡ªåŠ¨æ·»åŠ åˆ†å·çš„æœºåˆ¶ï¼Œä¸Šé¢çš„ä»£ç å®é™…ä¸Šå˜æˆäº†:1234function foo() &#123; return; // è‡ªåŠ¨æ·»åŠ äº†åˆ†å·ï¼Œç›¸å½“äºreturn undefined; &#123; name: &apos;foo&apos; &#125;; // è¿™è¡Œè¯­å¥å·²ç»æ²¡æ³•æ‰§è¡Œåˆ°äº†&#125; æ‰€ä»¥æ­£ç¡®çš„å¤šè¡Œå†™æ³•æ˜¯:12345function foo() &#123; return &#123; // è¿™é‡Œä¸ä¼šè‡ªåŠ¨åŠ åˆ†å·ï¼Œå› ä¸º&#123;è¡¨ç¤ºè¯­å¥å°šæœªç»“æŸ name: &apos;foo&apos; &#125;;&#125;","categories":[{"name":"frontend","slug":"frontend","permalink":"http://ltyeamin.github.io/categories/frontend/"}],"tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"http://ltyeamin.github.io/tags/JavaScript/"}]}]}